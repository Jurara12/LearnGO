(function(){const it=document.createElement("link").relList;if(it&&it.supports&&it.supports("modulepreload"))return;for(const Qe of document.querySelectorAll('link[rel="modulepreload"]'))St(Qe);new MutationObserver(Qe=>{for(const rt of Qe)if(rt.type==="childList")for(const ye of rt.addedNodes)ye.tagName==="LINK"&&ye.rel==="modulepreload"&&St(ye)}).observe(document,{childList:!0,subtree:!0});function ue(Qe){const rt={};return Qe.integrity&&(rt.integrity=Qe.integrity),Qe.referrerPolicy&&(rt.referrerPolicy=Qe.referrerPolicy),Qe.crossOrigin==="use-credentials"?rt.credentials="include":Qe.crossOrigin==="anonymous"?rt.credentials="omit":rt.credentials="same-origin",rt}function St(Qe){if(Qe.ep)return;Qe.ep=!0;const rt=ue(Qe);fetch(Qe.href,rt)}})();var jo={exports:{}},on={},Zo={exports:{}},Xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nc;function Au(){if(Nc)return Xe;Nc=1;var We=Symbol.for("react.element"),it=Symbol.for("react.portal"),ue=Symbol.for("react.fragment"),St=Symbol.for("react.strict_mode"),Qe=Symbol.for("react.profiler"),rt=Symbol.for("react.provider"),ye=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),q=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),L=Symbol.iterator;function C(x){return x===null||typeof x!="object"?null:(x=L&&x[L]||x["@@iterator"],typeof x=="function"?x:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R=Object.assign,O={};function p(x,z,U){this.props=x,this.context=z,this.refs=O,this.updater=U||E}p.prototype.isReactComponent={},p.prototype.setState=function(x,z){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,z,"setState")},p.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function v(){}v.prototype=p.prototype;function s(x,z,U){this.props=x,this.context=z,this.refs=O,this.updater=U||E}var a=s.prototype=new v;a.constructor=s,R(a,p.prototype),a.isPureReactComponent=!0;var c=Array.isArray,d=Object.prototype.hasOwnProperty,g={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function f(x,z,U){var D,B={},j=null,ee=null;if(z!=null)for(D in z.ref!==void 0&&(ee=z.ref),z.key!==void 0&&(j=""+z.key),z)d.call(z,D)&&!k.hasOwnProperty(D)&&(B[D]=z[D]);var me=arguments.length-2;if(me===1)B.children=U;else if(1<me){for(var Z=Array(me),se=0;se<me;se++)Z[se]=arguments[se+2];B.children=Z}if(x&&x.defaultProps)for(D in me=x.defaultProps,me)B[D]===void 0&&(B[D]=me[D]);return{$$typeof:We,type:x,key:j,ref:ee,props:B,_owner:g.current}}function u(x,z){return{$$typeof:We,type:x.type,key:z,ref:x.ref,props:x.props,_owner:x._owner}}function o(x){return typeof x=="object"&&x!==null&&x.$$typeof===We}function r(x){var z={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(U){return z[U]})}var b=/\/+/g;function h(x,z){return typeof x=="object"&&x!==null&&x.key!=null?r(""+x.key):z.toString(36)}function F(x,z,U,D,B){var j=typeof x;(j==="undefined"||j==="boolean")&&(x=null);var ee=!1;if(x===null)ee=!0;else switch(j){case"string":case"number":ee=!0;break;case"object":switch(x.$$typeof){case We:case it:ee=!0}}if(ee)return ee=x,B=B(ee),x=D===""?"."+h(ee,0):D,c(B)?(U="",x!=null&&(U=x.replace(b,"$&/")+"/"),F(B,z,U,"",function(se){return se})):B!=null&&(o(B)&&(B=u(B,U+(!B.key||ee&&ee.key===B.key?"":(""+B.key).replace(b,"$&/")+"/")+x)),z.push(B)),1;if(ee=0,D=D===""?".":D+":",c(x))for(var me=0;me<x.length;me++){j=x[me];var Z=D+h(j,me);ee+=F(j,z,U,Z,B)}else if(Z=C(x),typeof Z=="function")for(x=Z.call(x),me=0;!(j=x.next()).done;)j=j.value,Z=D+h(j,me++),ee+=F(j,z,U,Z,B);else if(j==="object")throw z=String(x),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.");return ee}function T(x,z,U){if(x==null)return x;var D=[],B=0;return F(x,D,"","",function(j){return z.call(U,j,B++)}),D}function P(x){if(x._status===-1){var z=x._result;z=z(),z.then(function(U){(x._status===0||x._status===-1)&&(x._status=1,x._result=U)},function(U){(x._status===0||x._status===-1)&&(x._status=2,x._result=U)}),x._status===-1&&(x._status=0,x._result=z)}if(x._status===1)return x._result.default;throw x._result}var m={current:null},w={transition:null},y={ReactCurrentDispatcher:m,ReactCurrentBatchConfig:w,ReactCurrentOwner:g};function N(){throw Error("act(...) is not supported in production builds of React.")}return Xe.Children={map:T,forEach:function(x,z,U){T(x,function(){z.apply(this,arguments)},U)},count:function(x){var z=0;return T(x,function(){z++}),z},toArray:function(x){return T(x,function(z){return z})||[]},only:function(x){if(!o(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Xe.Component=p,Xe.Fragment=ue,Xe.Profiler=Qe,Xe.PureComponent=s,Xe.StrictMode=St,Xe.Suspense=G,Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y,Xe.act=N,Xe.cloneElement=function(x,z,U){if(x==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+x+".");var D=R({},x.props),B=x.key,j=x.ref,ee=x._owner;if(z!=null){if(z.ref!==void 0&&(j=z.ref,ee=g.current),z.key!==void 0&&(B=""+z.key),x.type&&x.type.defaultProps)var me=x.type.defaultProps;for(Z in z)d.call(z,Z)&&!k.hasOwnProperty(Z)&&(D[Z]=z[Z]===void 0&&me!==void 0?me[Z]:z[Z])}var Z=arguments.length-2;if(Z===1)D.children=U;else if(1<Z){me=Array(Z);for(var se=0;se<Z;se++)me[se]=arguments[se+2];D.children=me}return{$$typeof:We,type:x.type,key:B,ref:j,props:D,_owner:ee}},Xe.createContext=function(x){return x={$$typeof:ye,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},x.Provider={$$typeof:rt,_context:x},x.Consumer=x},Xe.createElement=f,Xe.createFactory=function(x){var z=f.bind(null,x);return z.type=x,z},Xe.createRef=function(){return{current:null}},Xe.forwardRef=function(x){return{$$typeof:A,render:x}},Xe.isValidElement=o,Xe.lazy=function(x){return{$$typeof:S,_payload:{_status:-1,_result:x},_init:P}},Xe.memo=function(x,z){return{$$typeof:q,type:x,compare:z===void 0?null:z}},Xe.startTransition=function(x){var z=w.transition;w.transition={};try{x()}finally{w.transition=z}},Xe.unstable_act=N,Xe.useCallback=function(x,z){return m.current.useCallback(x,z)},Xe.useContext=function(x){return m.current.useContext(x)},Xe.useDebugValue=function(){},Xe.useDeferredValue=function(x){return m.current.useDeferredValue(x)},Xe.useEffect=function(x,z){return m.current.useEffect(x,z)},Xe.useId=function(){return m.current.useId()},Xe.useImperativeHandle=function(x,z,U){return m.current.useImperativeHandle(x,z,U)},Xe.useInsertionEffect=function(x,z){return m.current.useInsertionEffect(x,z)},Xe.useLayoutEffect=function(x,z){return m.current.useLayoutEffect(x,z)},Xe.useMemo=function(x,z){return m.current.useMemo(x,z)},Xe.useReducer=function(x,z,U){return m.current.useReducer(x,z,U)},Xe.useRef=function(x){return m.current.useRef(x)},Xe.useState=function(x){return m.current.useState(x)},Xe.useSyncExternalStore=function(x,z,U){return m.current.useSyncExternalStore(x,z,U)},Xe.useTransition=function(){return m.current.useTransition()},Xe.version="18.3.1",Xe}var Lc;function rl(){return Lc||(Lc=1,Zo.exports=Au()),Zo.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fc;function Nu(){if(Fc)return on;Fc=1;var We=rl(),it=Symbol.for("react.element"),ue=Symbol.for("react.fragment"),St=Object.prototype.hasOwnProperty,Qe=We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rt={key:!0,ref:!0,__self:!0,__source:!0};function ye(A,G,q){var S,L={},C=null,E=null;q!==void 0&&(C=""+q),G.key!==void 0&&(C=""+G.key),G.ref!==void 0&&(E=G.ref);for(S in G)St.call(G,S)&&!rt.hasOwnProperty(S)&&(L[S]=G[S]);if(A&&A.defaultProps)for(S in G=A.defaultProps,G)L[S]===void 0&&(L[S]=G[S]);return{$$typeof:it,type:A,key:C,ref:E,props:L,_owner:Qe.current}}return on.Fragment=ue,on.jsx=ye,on.jsxs=ye,on}var Rc;function Lu(){return Rc||(Rc=1,jo.exports=Nu()),jo.exports}var pr=Lu(),nl=rl(),mr={},el={exports:{}},Ut={},tl={exports:{}},il={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oc;function Fu(){return Oc||(Oc=1,function(We){function it(w,y){var N=w.length;w.push(y);e:for(;0<N;){var x=N-1>>>1,z=w[x];if(0<Qe(z,y))w[x]=y,w[N]=z,N=x;else break e}}function ue(w){return w.length===0?null:w[0]}function St(w){if(w.length===0)return null;var y=w[0],N=w.pop();if(N!==y){w[0]=N;e:for(var x=0,z=w.length,U=z>>>1;x<U;){var D=2*(x+1)-1,B=w[D],j=D+1,ee=w[j];if(0>Qe(B,N))j<z&&0>Qe(ee,B)?(w[x]=ee,w[j]=N,x=j):(w[x]=B,w[D]=N,x=D);else if(j<z&&0>Qe(ee,N))w[x]=ee,w[j]=N,x=j;else break e}}return y}function Qe(w,y){var N=w.sortIndex-y.sortIndex;return N!==0?N:w.id-y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var rt=performance;We.unstable_now=function(){return rt.now()}}else{var ye=Date,A=ye.now();We.unstable_now=function(){return ye.now()-A}}var G=[],q=[],S=1,L=null,C=3,E=!1,R=!1,O=!1,p=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,s=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function a(w){for(var y=ue(q);y!==null;){if(y.callback===null)St(q);else if(y.startTime<=w)St(q),y.sortIndex=y.expirationTime,it(G,y);else break;y=ue(q)}}function c(w){if(O=!1,a(w),!R)if(ue(G)!==null)R=!0,P(d);else{var y=ue(q);y!==null&&m(c,y.startTime-w)}}function d(w,y){R=!1,O&&(O=!1,v(f),f=-1),E=!0;var N=C;try{for(a(y),L=ue(G);L!==null&&(!(L.expirationTime>y)||w&&!r());){var x=L.callback;if(typeof x=="function"){L.callback=null,C=L.priorityLevel;var z=x(L.expirationTime<=y);y=We.unstable_now(),typeof z=="function"?L.callback=z:L===ue(G)&&St(G),a(y)}else St(G);L=ue(G)}if(L!==null)var U=!0;else{var D=ue(q);D!==null&&m(c,D.startTime-y),U=!1}return U}finally{L=null,C=N,E=!1}}var g=!1,k=null,f=-1,u=5,o=-1;function r(){return!(We.unstable_now()-o<u)}function b(){if(k!==null){var w=We.unstable_now();o=w;var y=!0;try{y=k(!0,w)}finally{y?h():(g=!1,k=null)}}else g=!1}var h;if(typeof s=="function")h=function(){s(b)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,T=F.port2;F.port1.onmessage=b,h=function(){T.postMessage(null)}}else h=function(){p(b,0)};function P(w){k=w,g||(g=!0,h())}function m(w,y){f=p(function(){w(We.unstable_now())},y)}We.unstable_IdlePriority=5,We.unstable_ImmediatePriority=1,We.unstable_LowPriority=4,We.unstable_NormalPriority=3,We.unstable_Profiling=null,We.unstable_UserBlockingPriority=2,We.unstable_cancelCallback=function(w){w.callback=null},We.unstable_continueExecution=function(){R||E||(R=!0,P(d))},We.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):u=0<w?Math.floor(1e3/w):5},We.unstable_getCurrentPriorityLevel=function(){return C},We.unstable_getFirstCallbackNode=function(){return ue(G)},We.unstable_next=function(w){switch(C){case 1:case 2:case 3:var y=3;break;default:y=C}var N=C;C=y;try{return w()}finally{C=N}},We.unstable_pauseExecution=function(){},We.unstable_requestPaint=function(){},We.unstable_runWithPriority=function(w,y){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var N=C;C=w;try{return y()}finally{C=N}},We.unstable_scheduleCallback=function(w,y,N){var x=We.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?x+N:x):N=x,w){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=N+z,w={id:S++,callback:y,priorityLevel:w,startTime:N,expirationTime:z,sortIndex:-1},N>x?(w.sortIndex=N,it(q,w),ue(G)===null&&w===ue(q)&&(O?(v(f),f=-1):O=!0,m(c,N-x))):(w.sortIndex=z,it(G,w),R||E||(R=!0,P(d))),w},We.unstable_shouldYield=r,We.unstable_wrapCallback=function(w){var y=C;return function(){var N=C;C=y;try{return w.apply(this,arguments)}finally{C=N}}}}(il)),il}var Gc;function Ru(){return Gc||(Gc=1,tl.exports=Fu()),tl.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bc;function Ou(){if(Bc)return Ut;Bc=1;var We=rl(),it=Ru();function ue(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var St=new Set,Qe={};function rt(e,t){ye(e,t),ye(e+"Capture",t)}function ye(e,t){for(Qe[e]=t,e=0;e<t.length;e++)St.add(t[e])}var A=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),G=Object.prototype.hasOwnProperty,q=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S={},L={};function C(e){return G.call(L,e)?!0:G.call(S,e)?!1:q.test(e)?L[e]=!0:(S[e]=!0,!1)}function E(e,t,i,n){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function R(e,t,i,n){if(t===null||typeof t>"u"||E(e,t,i,n))return!0;if(n)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function O(e,t,i,n,l,_,M){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=l,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=_,this.removeEmptyString=M}var p={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){p[e]=new O(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];p[t]=new O(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){p[e]=new O(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){p[e]=new O(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){p[e]=new O(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){p[e]=new O(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){p[e]=new O(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){p[e]=new O(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){p[e]=new O(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function s(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,s);p[t]=new O(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,s);p[t]=new O(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,s);p[t]=new O(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){p[e]=new O(e,1,!1,e.toLowerCase(),null,!1,!1)}),p.xlinkHref=new O("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){p[e]=new O(e,1,!1,e.toLowerCase(),null,!0,!0)});function a(e,t,i,n){var l=p.hasOwnProperty(t)?p[t]:null;(l!==null?l.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(R(t,i,l,n)&&(i=null),n||l===null?C(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):l.mustUseProperty?e[l.propertyName]=i===null?l.type===3?!1:"":i:(t=l.attributeName,n=l.attributeNamespace,i===null?e.removeAttribute(t):(l=l.type,i=l===3||l===4&&i===!0?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}var c=We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d=Symbol.for("react.element"),g=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),r=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),w=Symbol.iterator;function y(e){return e===null||typeof e!="object"?null:(e=w&&e[w]||e["@@iterator"],typeof e=="function"?e:null)}var N=Object.assign,x;function z(e){if(x===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);x=t&&t[1]||""}return`
`+x+e}var U=!1;function D(e,t){if(!e||U)return"";U=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(ce){var n=ce}Reflect.construct(e,[],t)}else{try{t.call()}catch(ce){n=ce}e.call(t.prototype)}else{try{throw Error()}catch(ce){n=ce}e()}}catch(ce){if(ce&&n&&typeof ce.stack=="string"){for(var l=ce.stack.split(`
`),_=n.stack.split(`
`),M=l.length-1,$=_.length-1;1<=M&&0<=$&&l[M]!==_[$];)$--;for(;1<=M&&0<=$;M--,$--)if(l[M]!==_[$]){if(M!==1||$!==1)do if(M--,$--,0>$||l[M]!==_[$]){var V=`
`+l[M].replace(" at new "," at ");return e.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",e.displayName)),V}while(1<=M&&0<=$);break}}}finally{U=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?z(e):""}function B(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=D(e.type,!1),e;case 11:return e=D(e.type.render,!1),e;case 1:return e=D(e.type,!0),e;default:return""}}function j(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case k:return"Fragment";case g:return"Portal";case u:return"Profiler";case f:return"StrictMode";case h:return"Suspense";case F:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case r:return(e.displayName||"Context")+".Consumer";case o:return(e._context.displayName||"Context")+".Provider";case b:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case T:return t=e.displayName||null,t!==null?t:j(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return j(e(t))}catch{}}return null}function ee(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(t);case 8:return t===f?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function me(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Z(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function se(e){var t=Z(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var l=i.get,_=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return l.call(this)},set:function(M){n=""+M,_.call(this,M)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(M){n=""+M},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function he(e){e._valueTracker||(e._valueTracker=se(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=Z(e)?e.checked?"true":"false":e.value),e=n,e!==i?(t.setValue(e),!0):!1}function W(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function H(e,t){var i=t.checked;return N({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function I(e,t){var i=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;i=me(t.value!=null?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function le(e,t){t=t.checked,t!=null&&a(e,"checked",t,!1)}function _e(e,t){le(e,t);var i=me(t.value),n=t.type;if(i!=null)n==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Y(e,t.type,i):t.hasOwnProperty("defaultValue")&&Y(e,t.type,me(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function K(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function Y(e,t,i){(t!=="number"||W(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var Q=Array.isArray;function ae(e,t,i,n){if(e=e.options,t){t={};for(var l=0;l<i.length;l++)t["$"+i[l]]=!0;for(i=0;i<e.length;i++)l=t.hasOwnProperty("$"+e[i].value),e[i].selected!==l&&(e[i].selected=l),l&&n&&(e[i].defaultSelected=!0)}else{for(i=""+me(i),t=null,l=0;l<e.length;l++){if(e[l].value===i){e[l].selected=!0,n&&(e[l].defaultSelected=!0);return}t!==null||e[l].disabled||(t=e[l])}t!==null&&(t.selected=!0)}}function te(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ue(91));return N({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ne(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(ue(92));if(Q(i)){if(1<i.length)throw Error(ue(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:me(i)}}function re(e,t){var i=me(t.value),n=me(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),n!=null&&(e.defaultValue=""+n)}function Ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Me(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function we(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Me(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var be,Be=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,n,l){MSApp.execUnsafeLocalFunction(function(){return e(t,i,n,l)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(be=be||document.createElement("div"),be.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=be.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ee=["Webkit","ms","Moz","O"];Object.keys(fe).forEach(function(e){Ee.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});function Se(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function xe(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var n=i.indexOf("--")===0,l=Se(i,t[i],n);i==="float"&&(i="cssFloat"),n?e.setProperty(i,l):e[i]=l}}var Ae=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ue(e,t){if(t){if(Ae[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ue(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ue(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ue(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ue(62))}}function Ie(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ne=null;function Ke(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ft=null,st=null,Yt=null;function ss(e){if(e=Us(e)){if(typeof ft!="function")throw Error(ue(280));var t=e.stateNode;t&&(t=zn(t),ft(e.stateNode,e.type,t))}}function ln(e){st?Yt?Yt.push(e):Yt=[e]:st=e}function Le(){if(st){var e=st,t=Yt;if(Yt=st=null,ss(e),t)for(e=0;e<t.length;e++)ss(t[e])}}function Te(e,t){return e(t)}function ct(){}var Ye=!1;function ot(e,t,i){if(Ye)return e(t,i);Ye=!0;try{return Te(e,t,i)}finally{Ye=!1,(st!==null||Yt!==null)&&(ct(),Le())}}function He(e,t){var i=e.stateNode;if(i===null)return null;var n=zn(i);if(n===null)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(ue(231,t,typeof i));return i}var Pe=!1;if(A)try{var $e={};Object.defineProperty($e,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",$e,$e),window.removeEventListener("test",$e,$e)}catch{Pe=!1}function je(e,t,i,n,l,_,M,$,V){var ce=Array.prototype.slice.call(arguments,3);try{t.apply(i,ce)}catch(ge){this.onError(ge)}}var et=!1,wt=null,Bt=!1,ui=null,Je={onError:function(e){et=!0,wt=e}};function Rt(e,t,i,n,l,_,M,$,V){et=!1,wt=null,je.apply(Je,arguments)}function di(e,t,i,n,l,_,M,$,V){if(Rt.apply(this,arguments),et){if(et){var ce=wt;et=!1,wt=null}else throw Error(ue(198));Bt||(Bt=!0,ui=ce)}}function Ht(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function si(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Pt(e){if(Ht(e)!==e)throw Error(ue(188))}function lt(e){var t=e.alternate;if(!t){if(t=Ht(e),t===null)throw Error(ue(188));return t!==e?null:e}for(var i=e,n=t;;){var l=i.return;if(l===null)break;var _=l.alternate;if(_===null){if(n=l.return,n!==null){i=n;continue}break}if(l.child===_.child){for(_=l.child;_;){if(_===i)return Pt(l),e;if(_===n)return Pt(l),t;_=_.sibling}throw Error(ue(188))}if(i.return!==n.return)i=l,n=_;else{for(var M=!1,$=l.child;$;){if($===i){M=!0,i=l,n=_;break}if($===n){M=!0,n=l,i=_;break}$=$.sibling}if(!M){for($=_.child;$;){if($===i){M=!0,i=_,n=l;break}if($===n){M=!0,n=_,i=l;break}$=$.sibling}if(!M)throw Error(ue(189))}}if(i.alternate!==n)throw Error(ue(190))}if(i.tag!==3)throw Error(ue(188));return i.stateNode.current===i?e:t}function xt(e){return e=lt(e),e!==null?an(e):null}function an(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=an(e);if(t!==null)return t;e=e.sibling}return null}var cn=it.unstable_scheduleCallback,ol=it.unstable_cancelCallback,$c=it.unstable_shouldYield,Wc=it.unstable_requestPaint,gt=it.unstable_now,Uc=it.unstable_getCurrentPriorityLevel,gr=it.unstable_ImmediatePriority,ll=it.unstable_UserBlockingPriority,hn=it.unstable_NormalPriority,Hc=it.unstable_LowPriority,al=it.unstable_IdlePriority,un=null,fi=null;function Vc(e){if(fi&&typeof fi.onCommitFiberRoot=="function")try{fi.onCommitFiberRoot(un,e,void 0,(e.current.flags&128)===128)}catch{}}var ni=Math.clz32?Math.clz32:Qc,Kc=Math.log,Jc=Math.LN2;function Qc(e){return e>>>=0,e===0?32:31-(Kc(e)/Jc|0)|0}var dn=64,fn=4194304;function Ms(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function _n(e,t){var i=e.pendingLanes;if(i===0)return 0;var n=0,l=e.suspendedLanes,_=e.pingedLanes,M=i&268435455;if(M!==0){var $=M&~l;$!==0?n=Ms($):(_&=M,_!==0&&(n=Ms(_)))}else M=i&~l,M!==0?n=Ms(M):_!==0&&(n=Ms(_));if(n===0)return 0;if(t!==0&&t!==n&&!(t&l)&&(l=n&-n,_=t&-t,l>=_||l===16&&(_&4194240)!==0))return t;if(n&4&&(n|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)i=31-ni(t),l=1<<i,n|=e[i],t&=~l;return n}function Yc(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xc(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,l=e.expirationTimes,_=e.pendingLanes;0<_;){var M=31-ni(_),$=1<<M,V=l[M];V===-1?(!($&i)||$&n)&&(l[M]=Yc($,t)):V<=t&&(e.expiredLanes|=$),_&=~$}}function vr(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function cl(){var e=dn;return dn<<=1,!(dn&4194240)&&(dn=64),e}function yr(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Es(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ni(t),e[t]=i}function jc(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var l=31-ni(i),_=1<<l;t[l]=0,n[l]=-1,e[l]=-1,i&=~_}}function wr(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-ni(i),l=1<<n;l&t|e[n]&t&&(e[n]|=t),i&=~l}}var nt=0;function hl(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var ul,br,dl,fl,_l,kr=!1,mn=[],Mi=null,Ei=null,Pi=null,Ps=new Map,Ts=new Map,Ti=[],Zc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ml(e,t){switch(e){case"focusin":case"focusout":Mi=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":Pi=null;break;case"pointerover":case"pointerout":Ps.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ts.delete(t.pointerId)}}function zs(e,t,i,n,l,_){return e===null||e.nativeEvent!==_?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:_,targetContainers:[l]},t!==null&&(t=Us(t),t!==null&&br(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,l!==null&&t.indexOf(l)===-1&&t.push(l),e)}function eh(e,t,i,n,l){switch(t){case"focusin":return Mi=zs(Mi,e,t,i,n,l),!0;case"dragenter":return Ei=zs(Ei,e,t,i,n,l),!0;case"mouseover":return Pi=zs(Pi,e,t,i,n,l),!0;case"pointerover":var _=l.pointerId;return Ps.set(_,zs(Ps.get(_)||null,e,t,i,n,l)),!0;case"gotpointercapture":return _=l.pointerId,Ts.set(_,zs(Ts.get(_)||null,e,t,i,n,l)),!0}return!1}function pl(e){var t=Hi(e.target);if(t!==null){var i=Ht(t);if(i!==null){if(t=i.tag,t===13){if(t=si(i),t!==null){e.blockedOn=t,_l(e.priority,function(){dl(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pn(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=xr(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var n=new i.constructor(i.type,i);Ne=n,i.target.dispatchEvent(n),Ne=null}else return t=Us(i),t!==null&&br(t),e.blockedOn=i,!1;t.shift()}return!0}function gl(e,t,i){pn(e)&&i.delete(t)}function th(){kr=!1,Mi!==null&&pn(Mi)&&(Mi=null),Ei!==null&&pn(Ei)&&(Ei=null),Pi!==null&&pn(Pi)&&(Pi=null),Ps.forEach(gl),Ts.forEach(gl)}function As(e,t){e.blockedOn===t&&(e.blockedOn=null,kr||(kr=!0,it.unstable_scheduleCallback(it.unstable_NormalPriority,th)))}function Ns(e){function t(l){return As(l,e)}if(0<mn.length){As(mn[0],e);for(var i=1;i<mn.length;i++){var n=mn[i];n.blockedOn===e&&(n.blockedOn=null)}}for(Mi!==null&&As(Mi,e),Ei!==null&&As(Ei,e),Pi!==null&&As(Pi,e),Ps.forEach(t),Ts.forEach(t),i=0;i<Ti.length;i++)n=Ti[i],n.blockedOn===e&&(n.blockedOn=null);for(;0<Ti.length&&(i=Ti[0],i.blockedOn===null);)pl(i),i.blockedOn===null&&Ti.shift()}var ns=c.ReactCurrentBatchConfig,gn=!0;function ih(e,t,i,n){var l=nt,_=ns.transition;ns.transition=null;try{nt=1,Sr(e,t,i,n)}finally{nt=l,ns.transition=_}}function sh(e,t,i,n){var l=nt,_=ns.transition;ns.transition=null;try{nt=4,Sr(e,t,i,n)}finally{nt=l,ns.transition=_}}function Sr(e,t,i,n){if(gn){var l=xr(e,t,i,n);if(l===null)Dr(e,t,n,vn,i),ml(e,n);else if(eh(l,e,t,i,n))n.stopPropagation();else if(ml(e,n),t&4&&-1<Zc.indexOf(e)){for(;l!==null;){var _=Us(l);if(_!==null&&ul(_),_=xr(e,t,i,n),_===null&&Dr(e,t,n,vn,i),_===l)break;l=_}l!==null&&n.stopPropagation()}else Dr(e,t,n,null,i)}}var vn=null;function xr(e,t,i,n){if(vn=null,e=Ke(n),e=Hi(e),e!==null)if(t=Ht(e),t===null)e=null;else if(i=t.tag,i===13){if(e=si(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return vn=e,null}function vl(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Uc()){case gr:return 1;case ll:return 4;case hn:case Hc:return 16;case al:return 536870912;default:return 16}default:return 16}}var zi=null,Cr=null,yn=null;function yl(){if(yn)return yn;var e,t=Cr,i=t.length,n,l="value"in zi?zi.value:zi.textContent,_=l.length;for(e=0;e<i&&t[e]===l[e];e++);var M=i-e;for(n=1;n<=M&&t[i-n]===l[_-n];n++);return yn=l.slice(e,1<n?1-n:void 0)}function wn(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function bn(){return!0}function wl(){return!1}function Vt(e){function t(i,n,l,_,M){this._reactName=i,this._targetInst=l,this.type=n,this.nativeEvent=_,this.target=M,this.currentTarget=null;for(var $ in e)e.hasOwnProperty($)&&(i=e[$],this[$]=i?i(_):_[$]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?bn:wl,this.isPropagationStopped=wl,this}return N(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=bn)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=bn)},persist:function(){},isPersistent:bn}),t}var rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mr=Vt(rs),Ls=N({},rs,{view:0,detail:0}),nh=Vt(Ls),Er,Pr,Fs,kn=N({},Ls,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zr,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Fs&&(Fs&&e.type==="mousemove"?(Er=e.screenX-Fs.screenX,Pr=e.screenY-Fs.screenY):Pr=Er=0,Fs=e),Er)},movementY:function(e){return"movementY"in e?e.movementY:Pr}}),bl=Vt(kn),rh=N({},kn,{dataTransfer:0}),oh=Vt(rh),lh=N({},Ls,{relatedTarget:0}),Tr=Vt(lh),ah=N({},rs,{animationName:0,elapsedTime:0,pseudoElement:0}),ch=Vt(ah),hh=N({},rs,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),uh=Vt(hh),dh=N({},rs,{data:0}),kl=Vt(dh),fh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_h={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ph(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=mh[e])?!!t[e]:!1}function zr(){return ph}var gh=N({},Ls,{key:function(e){if(e.key){var t=fh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=wn(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?_h[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zr,charCode:function(e){return e.type==="keypress"?wn(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?wn(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),vh=Vt(gh),yh=N({},kn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sl=Vt(yh),wh=N({},Ls,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zr}),bh=Vt(wh),kh=N({},rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sh=Vt(kh),xh=N({},kn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ch=Vt(xh),Mh=[9,13,27,32],Ar=A&&"CompositionEvent"in window,Rs=null;A&&"documentMode"in document&&(Rs=document.documentMode);var Eh=A&&"TextEvent"in window&&!Rs,xl=A&&(!Ar||Rs&&8<Rs&&11>=Rs),Cl=" ",Ml=!1;function El(e,t){switch(e){case"keyup":return Mh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pl(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var os=!1;function Ph(e,t){switch(e){case"compositionend":return Pl(t);case"keypress":return t.which!==32?null:(Ml=!0,Cl);case"textInput":return e=t.data,e===Cl&&Ml?null:e;default:return null}}function Th(e,t){if(os)return e==="compositionend"||!Ar&&El(e,t)?(e=yl(),yn=Cr=zi=null,os=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return xl&&t.locale!=="ko"?null:t.data;default:return null}}var zh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Tl(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!zh[e.type]:t==="textarea"}function zl(e,t,i,n){ln(n),t=En(t,"onChange"),0<t.length&&(i=new Mr("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Os=null,Gs=null;function Ah(e){Jl(e,0)}function Sn(e){var t=us(e);if(J(t))return e}function Nh(e,t){if(e==="change")return t}var Al=!1;if(A){var Nr;if(A){var Lr="oninput"in document;if(!Lr){var Nl=document.createElement("div");Nl.setAttribute("oninput","return;"),Lr=typeof Nl.oninput=="function"}Nr=Lr}else Nr=!1;Al=Nr&&(!document.documentMode||9<document.documentMode)}function Ll(){Os&&(Os.detachEvent("onpropertychange",Fl),Gs=Os=null)}function Fl(e){if(e.propertyName==="value"&&Sn(Gs)){var t=[];zl(t,Gs,e,Ke(e)),ot(Ah,t)}}function Lh(e,t,i){e==="focusin"?(Ll(),Os=t,Gs=i,Os.attachEvent("onpropertychange",Fl)):e==="focusout"&&Ll()}function Fh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Sn(Gs)}function Rh(e,t){if(e==="click")return Sn(t)}function Oh(e,t){if(e==="input"||e==="change")return Sn(t)}function Gh(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ri=typeof Object.is=="function"?Object.is:Gh;function Bs(e,t){if(ri(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var l=i[n];if(!G.call(t,l)||!ri(e[l],t[l]))return!1}return!0}function Rl(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ol(e,t){var i=Rl(e);e=0;for(var n;i;){if(i.nodeType===3){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Rl(i)}}function Gl(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Gl(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Bl(){for(var e=window,t=W();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=W(e.document)}return t}function Fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Bh(e){var t=Bl(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&Gl(i.ownerDocument.documentElement,i)){if(n!==null&&Fr(i)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var l=i.textContent.length,_=Math.min(n.start,l);n=n.end===void 0?_:Math.min(n.end,l),!e.extend&&_>n&&(l=n,n=_,_=l),l=Ol(i,_);var M=Ol(i,n);l&&M&&(e.rangeCount!==1||e.anchorNode!==l.node||e.anchorOffset!==l.offset||e.focusNode!==M.node||e.focusOffset!==M.offset)&&(t=t.createRange(),t.setStart(l.node,l.offset),e.removeAllRanges(),_>n?(e.addRange(t),e.extend(M.node,M.offset)):(t.setEnd(M.node,M.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ih=A&&"documentMode"in document&&11>=document.documentMode,ls=null,Rr=null,Is=null,Or=!1;function Il(e,t,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;Or||ls==null||ls!==W(n)||(n=ls,"selectionStart"in n&&Fr(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Is&&Bs(Is,n)||(Is=n,n=En(Rr,"onSelect"),0<n.length&&(t=new Mr("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=ls)))}function xn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var as={animationend:xn("Animation","AnimationEnd"),animationiteration:xn("Animation","AnimationIteration"),animationstart:xn("Animation","AnimationStart"),transitionend:xn("Transition","TransitionEnd")},Gr={},ql={};A&&(ql=document.createElement("div").style,"AnimationEvent"in window||(delete as.animationend.animation,delete as.animationiteration.animation,delete as.animationstart.animation),"TransitionEvent"in window||delete as.transitionend.transition);function Cn(e){if(Gr[e])return Gr[e];if(!as[e])return e;var t=as[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in ql)return Gr[e]=t[i];return e}var Dl=Cn("animationend"),$l=Cn("animationiteration"),Wl=Cn("animationstart"),Ul=Cn("transitionend"),Hl=new Map,Vl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ai(e,t){Hl.set(e,t),rt(t,[e])}for(var Br=0;Br<Vl.length;Br++){var Ir=Vl[Br],qh=Ir.toLowerCase(),Dh=Ir[0].toUpperCase()+Ir.slice(1);Ai(qh,"on"+Dh)}Ai(Dl,"onAnimationEnd"),Ai($l,"onAnimationIteration"),Ai(Wl,"onAnimationStart"),Ai("dblclick","onDoubleClick"),Ai("focusin","onFocus"),Ai("focusout","onBlur"),Ai(Ul,"onTransitionEnd"),ye("onMouseEnter",["mouseout","mouseover"]),ye("onMouseLeave",["mouseout","mouseover"]),ye("onPointerEnter",["pointerout","pointerover"]),ye("onPointerLeave",["pointerout","pointerover"]),rt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rt("onBeforeInput",["compositionend","keypress","textInput","paste"]),rt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$h=new Set("cancel close invalid load scroll toggle".split(" ").concat(qs));function Kl(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,di(n,t,void 0,e),e.currentTarget=null}function Jl(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var n=e[i],l=n.event;n=n.listeners;e:{var _=void 0;if(t)for(var M=n.length-1;0<=M;M--){var $=n[M],V=$.instance,ce=$.currentTarget;if($=$.listener,V!==_&&l.isPropagationStopped())break e;Kl(l,$,ce),_=V}else for(M=0;M<n.length;M++){if($=n[M],V=$.instance,ce=$.currentTarget,$=$.listener,V!==_&&l.isPropagationStopped())break e;Kl(l,$,ce),_=V}}}if(Bt)throw e=ui,Bt=!1,ui=null,e}function ht(e,t){var i=t[Kr];i===void 0&&(i=t[Kr]=new Set);var n=e+"__bubble";i.has(n)||(Ql(t,e,2,!1),i.add(n))}function qr(e,t,i){var n=0;t&&(n|=4),Ql(i,e,n,t)}var Mn="_reactListening"+Math.random().toString(36).slice(2);function Ds(e){if(!e[Mn]){e[Mn]=!0,St.forEach(function(i){i!=="selectionchange"&&($h.has(i)||qr(i,!1,e),qr(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Mn]||(t[Mn]=!0,qr("selectionchange",!1,t))}}function Ql(e,t,i,n){switch(vl(t)){case 1:var l=ih;break;case 4:l=sh;break;default:l=Sr}i=l.bind(null,t,i,e),l=void 0,!Pe||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(l=!0),n?l!==void 0?e.addEventListener(t,i,{capture:!0,passive:l}):e.addEventListener(t,i,!0):l!==void 0?e.addEventListener(t,i,{passive:l}):e.addEventListener(t,i,!1)}function Dr(e,t,i,n,l){var _=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var M=n.tag;if(M===3||M===4){var $=n.stateNode.containerInfo;if($===l||$.nodeType===8&&$.parentNode===l)break;if(M===4)for(M=n.return;M!==null;){var V=M.tag;if((V===3||V===4)&&(V=M.stateNode.containerInfo,V===l||V.nodeType===8&&V.parentNode===l))return;M=M.return}for(;$!==null;){if(M=Hi($),M===null)return;if(V=M.tag,V===5||V===6){n=_=M;continue e}$=$.parentNode}}n=n.return}ot(function(){var ce=_,ge=Ke(i),ve=[];e:{var pe=Hl.get(e);if(pe!==void 0){var ze=Mr,Re=e;switch(e){case"keypress":if(wn(i)===0)break e;case"keydown":case"keyup":ze=vh;break;case"focusin":Re="focus",ze=Tr;break;case"focusout":Re="blur",ze=Tr;break;case"beforeblur":case"afterblur":ze=Tr;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=bl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=oh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=bh;break;case Dl:case $l:case Wl:ze=ch;break;case Ul:ze=Sh;break;case"scroll":ze=nh;break;case"wheel":ze=Ch;break;case"copy":case"cut":case"paste":ze=uh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=Sl}var Oe=(t&4)!==0,vt=!Oe&&e==="scroll",ie=Oe?pe!==null?pe+"Capture":null:pe;Oe=[];for(var X=ce,oe;X!==null;){oe=X;var ke=oe.stateNode;if(oe.tag===5&&ke!==null&&(oe=ke,ie!==null&&(ke=He(X,ie),ke!=null&&Oe.push($s(X,ke,oe)))),vt)break;X=X.return}0<Oe.length&&(pe=new ze(pe,Re,null,i,ge),ve.push({event:pe,listeners:Oe}))}}if(!(t&7)){e:{if(pe=e==="mouseover"||e==="pointerover",ze=e==="mouseout"||e==="pointerout",pe&&i!==Ne&&(Re=i.relatedTarget||i.fromElement)&&(Hi(Re)||Re[vi]))break e;if((ze||pe)&&(pe=ge.window===ge?ge:(pe=ge.ownerDocument)?pe.defaultView||pe.parentWindow:window,ze?(Re=i.relatedTarget||i.toElement,ze=ce,Re=Re?Hi(Re):null,Re!==null&&(vt=Ht(Re),Re!==vt||Re.tag!==5&&Re.tag!==6)&&(Re=null)):(ze=null,Re=ce),ze!==Re)){if(Oe=bl,ke="onMouseLeave",ie="onMouseEnter",X="mouse",(e==="pointerout"||e==="pointerover")&&(Oe=Sl,ke="onPointerLeave",ie="onPointerEnter",X="pointer"),vt=ze==null?pe:us(ze),oe=Re==null?pe:us(Re),pe=new Oe(ke,X+"leave",ze,i,ge),pe.target=vt,pe.relatedTarget=oe,ke=null,Hi(ge)===ce&&(Oe=new Oe(ie,X+"enter",Re,i,ge),Oe.target=oe,Oe.relatedTarget=vt,ke=Oe),vt=ke,ze&&Re)t:{for(Oe=ze,ie=Re,X=0,oe=Oe;oe;oe=cs(oe))X++;for(oe=0,ke=ie;ke;ke=cs(ke))oe++;for(;0<X-oe;)Oe=cs(Oe),X--;for(;0<oe-X;)ie=cs(ie),oe--;for(;X--;){if(Oe===ie||ie!==null&&Oe===ie.alternate)break t;Oe=cs(Oe),ie=cs(ie)}Oe=null}else Oe=null;ze!==null&&Yl(ve,pe,ze,Oe,!1),Re!==null&&vt!==null&&Yl(ve,vt,Re,Oe,!0)}}e:{if(pe=ce?us(ce):window,ze=pe.nodeName&&pe.nodeName.toLowerCase(),ze==="select"||ze==="input"&&pe.type==="file")var Ge=Nh;else if(Tl(pe))if(Al)Ge=Oh;else{Ge=Fh;var qe=Lh}else(ze=pe.nodeName)&&ze.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(Ge=Rh);if(Ge&&(Ge=Ge(e,ce))){zl(ve,Ge,i,ge);break e}qe&&qe(e,pe,ce),e==="focusout"&&(qe=pe._wrapperState)&&qe.controlled&&pe.type==="number"&&Y(pe,"number",pe.value)}switch(qe=ce?us(ce):window,e){case"focusin":(Tl(qe)||qe.contentEditable==="true")&&(ls=qe,Rr=ce,Is=null);break;case"focusout":Is=Rr=ls=null;break;case"mousedown":Or=!0;break;case"contextmenu":case"mouseup":case"dragend":Or=!1,Il(ve,i,ge);break;case"selectionchange":if(Ih)break;case"keydown":case"keyup":Il(ve,i,ge)}var De;if(Ar)e:{switch(e){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else os?El(e,i)&&(Ve="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(Ve="onCompositionStart");Ve&&(xl&&i.locale!=="ko"&&(os||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&os&&(De=yl()):(zi=ge,Cr="value"in zi?zi.value:zi.textContent,os=!0)),qe=En(ce,Ve),0<qe.length&&(Ve=new kl(Ve,e,null,i,ge),ve.push({event:Ve,listeners:qe}),De?Ve.data=De:(De=Pl(i),De!==null&&(Ve.data=De)))),(De=Eh?Ph(e,i):Th(e,i))&&(ce=En(ce,"onBeforeInput"),0<ce.length&&(ge=new kl("onBeforeInput","beforeinput",null,i,ge),ve.push({event:ge,listeners:ce}),ge.data=De))}Jl(ve,t)})}function $s(e,t,i){return{instance:e,listener:t,currentTarget:i}}function En(e,t){for(var i=t+"Capture",n=[];e!==null;){var l=e,_=l.stateNode;l.tag===5&&_!==null&&(l=_,_=He(e,i),_!=null&&n.unshift($s(e,_,l)),_=He(e,t),_!=null&&n.push($s(e,_,l))),e=e.return}return n}function cs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Yl(e,t,i,n,l){for(var _=t._reactName,M=[];i!==null&&i!==n;){var $=i,V=$.alternate,ce=$.stateNode;if(V!==null&&V===n)break;$.tag===5&&ce!==null&&($=ce,l?(V=He(i,_),V!=null&&M.unshift($s(i,V,$))):l||(V=He(i,_),V!=null&&M.push($s(i,V,$)))),i=i.return}M.length!==0&&e.push({event:t,listeners:M})}var Wh=/\r\n?/g,Uh=/\u0000|\uFFFD/g;function Xl(e){return(typeof e=="string"?e:""+e).replace(Wh,`
`).replace(Uh,"")}function Pn(e,t,i){if(t=Xl(t),Xl(e)!==t&&i)throw Error(ue(425))}function Tn(){}var $r=null,Wr=null;function Ur(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Hr=typeof setTimeout=="function"?setTimeout:void 0,Hh=typeof clearTimeout=="function"?clearTimeout:void 0,jl=typeof Promise=="function"?Promise:void 0,Vh=typeof queueMicrotask=="function"?queueMicrotask:typeof jl<"u"?function(e){return jl.resolve(null).then(e).catch(Kh)}:Hr;function Kh(e){setTimeout(function(){throw e})}function Vr(e,t){var i=t,n=0;do{var l=i.nextSibling;if(e.removeChild(i),l&&l.nodeType===8)if(i=l.data,i==="/$"){if(n===0){e.removeChild(l),Ns(t);return}n--}else i!=="$"&&i!=="$?"&&i!=="$!"||n++;i=l}while(i);Ns(t)}function Ni(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Zl(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var hs=Math.random().toString(36).slice(2),_i="__reactFiber$"+hs,Ws="__reactProps$"+hs,vi="__reactContainer$"+hs,Kr="__reactEvents$"+hs,Jh="__reactListeners$"+hs,Qh="__reactHandles$"+hs;function Hi(e){var t=e[_i];if(t)return t;for(var i=e.parentNode;i;){if(t=i[vi]||i[_i]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Zl(e);e!==null;){if(i=e[_i])return i;e=Zl(e)}return t}e=i,i=e.parentNode}return null}function Us(e){return e=e[_i]||e[vi],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function us(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ue(33))}function zn(e){return e[Ws]||null}var Jr=[],ds=-1;function Li(e){return{current:e}}function ut(e){0>ds||(e.current=Jr[ds],Jr[ds]=null,ds--)}function at(e,t){ds++,Jr[ds]=e.current,e.current=t}var Fi={},At=Li(Fi),It=Li(!1),Vi=Fi;function fs(e,t){var i=e.type.contextTypes;if(!i)return Fi;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var l={},_;for(_ in i)l[_]=t[_];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function qt(e){return e=e.childContextTypes,e!=null}function An(){ut(It),ut(At)}function ea(e,t,i){if(At.current!==Fi)throw Error(ue(168));at(At,t),at(It,i)}function ta(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return i;n=n.getChildContext();for(var l in n)if(!(l in t))throw Error(ue(108,ee(e)||"Unknown",l));return N({},i,n)}function Nn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Fi,Vi=At.current,at(At,e),at(It,It.current),!0}function ia(e,t,i){var n=e.stateNode;if(!n)throw Error(ue(169));i?(e=ta(e,t,Vi),n.__reactInternalMemoizedMergedChildContext=e,ut(It),ut(At),at(At,e)):ut(It),at(It,i)}var yi=null,Ln=!1,Qr=!1;function sa(e){yi===null?yi=[e]:yi.push(e)}function Yh(e){Ln=!0,sa(e)}function Ri(){if(!Qr&&yi!==null){Qr=!0;var e=0,t=nt;try{var i=yi;for(nt=1;e<i.length;e++){var n=i[e];do n=n(!0);while(n!==null)}yi=null,Ln=!1}catch(l){throw yi!==null&&(yi=yi.slice(e+1)),cn(gr,Ri),l}finally{nt=t,Qr=!1}}return null}var _s=[],ms=0,Fn=null,Rn=0,Xt=[],jt=0,Ki=null,wi=1,bi="";function Ji(e,t){_s[ms++]=Rn,_s[ms++]=Fn,Fn=e,Rn=t}function na(e,t,i){Xt[jt++]=wi,Xt[jt++]=bi,Xt[jt++]=Ki,Ki=e;var n=wi;e=bi;var l=32-ni(n)-1;n&=~(1<<l),i+=1;var _=32-ni(t)+l;if(30<_){var M=l-l%5;_=(n&(1<<M)-1).toString(32),n>>=M,l-=M,wi=1<<32-ni(t)+l|i<<l|n,bi=_+e}else wi=1<<_|i<<l|n,bi=e}function Yr(e){e.return!==null&&(Ji(e,1),na(e,1,0))}function Xr(e){for(;e===Fn;)Fn=_s[--ms],_s[ms]=null,Rn=_s[--ms],_s[ms]=null;for(;e===Ki;)Ki=Xt[--jt],Xt[jt]=null,bi=Xt[--jt],Xt[jt]=null,wi=Xt[--jt],Xt[jt]=null}var Kt=null,Jt=null,dt=!1,oi=null;function ra(e,t){var i=ii(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function oa(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Kt=e,Jt=Ni(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Kt=e,Jt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Ki!==null?{id:wi,overflow:bi}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=ii(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Kt=e,Jt=null,!0):!1;default:return!1}}function jr(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Zr(e){if(dt){var t=Jt;if(t){var i=t;if(!oa(e,t)){if(jr(e))throw Error(ue(418));t=Ni(i.nextSibling);var n=Kt;t&&oa(e,t)?ra(n,i):(e.flags=e.flags&-4097|2,dt=!1,Kt=e)}}else{if(jr(e))throw Error(ue(418));e.flags=e.flags&-4097|2,dt=!1,Kt=e}}}function la(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Kt=e}function On(e){if(e!==Kt)return!1;if(!dt)return la(e),dt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ur(e.type,e.memoizedProps)),t&&(t=Jt)){if(jr(e))throw aa(),Error(ue(418));for(;t;)ra(e,t),t=Ni(t.nextSibling)}if(la(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ue(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Jt=Ni(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Jt=null}}else Jt=Kt?Ni(e.stateNode.nextSibling):null;return!0}function aa(){for(var e=Jt;e;)e=Ni(e.nextSibling)}function ps(){Jt=Kt=null,dt=!1}function eo(e){oi===null?oi=[e]:oi.push(e)}var Xh=c.ReactCurrentBatchConfig;function Hs(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ue(309));var n=i.stateNode}if(!n)throw Error(ue(147,e));var l=n,_=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===_?t.ref:(t=function(M){var $=l.refs;M===null?delete $[_]:$[_]=M},t._stringRef=_,t)}if(typeof e!="string")throw Error(ue(284));if(!i._owner)throw Error(ue(290,e))}return e}function Gn(e,t){throw e=Object.prototype.toString.call(t),Error(ue(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ca(e){var t=e._init;return t(e._payload)}function ha(e){function t(ie,X){if(e){var oe=ie.deletions;oe===null?(ie.deletions=[X],ie.flags|=16):oe.push(X)}}function i(ie,X){if(!e)return null;for(;X!==null;)t(ie,X),X=X.sibling;return null}function n(ie,X){for(ie=new Map;X!==null;)X.key!==null?ie.set(X.key,X):ie.set(X.index,X),X=X.sibling;return ie}function l(ie,X){return ie=Wi(ie,X),ie.index=0,ie.sibling=null,ie}function _(ie,X,oe){return ie.index=oe,e?(oe=ie.alternate,oe!==null?(oe=oe.index,oe<X?(ie.flags|=2,X):oe):(ie.flags|=2,X)):(ie.flags|=1048576,X)}function M(ie){return e&&ie.alternate===null&&(ie.flags|=2),ie}function $(ie,X,oe,ke){return X===null||X.tag!==6?(X=Vo(oe,ie.mode,ke),X.return=ie,X):(X=l(X,oe),X.return=ie,X)}function V(ie,X,oe,ke){var Ge=oe.type;return Ge===k?ge(ie,X,oe.props.children,ke,oe.key):X!==null&&(X.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===P&&ca(Ge)===X.type)?(ke=l(X,oe.props),ke.ref=Hs(ie,X,oe),ke.return=ie,ke):(ke=lr(oe.type,oe.key,oe.props,null,ie.mode,ke),ke.ref=Hs(ie,X,oe),ke.return=ie,ke)}function ce(ie,X,oe,ke){return X===null||X.tag!==4||X.stateNode.containerInfo!==oe.containerInfo||X.stateNode.implementation!==oe.implementation?(X=Ko(oe,ie.mode,ke),X.return=ie,X):(X=l(X,oe.children||[]),X.return=ie,X)}function ge(ie,X,oe,ke,Ge){return X===null||X.tag!==7?(X=is(oe,ie.mode,ke,Ge),X.return=ie,X):(X=l(X,oe),X.return=ie,X)}function ve(ie,X,oe){if(typeof X=="string"&&X!==""||typeof X=="number")return X=Vo(""+X,ie.mode,oe),X.return=ie,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case d:return oe=lr(X.type,X.key,X.props,null,ie.mode,oe),oe.ref=Hs(ie,null,X),oe.return=ie,oe;case g:return X=Ko(X,ie.mode,oe),X.return=ie,X;case P:var ke=X._init;return ve(ie,ke(X._payload),oe)}if(Q(X)||y(X))return X=is(X,ie.mode,oe,null),X.return=ie,X;Gn(ie,X)}return null}function pe(ie,X,oe,ke){var Ge=X!==null?X.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Ge!==null?null:$(ie,X,""+oe,ke);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case d:return oe.key===Ge?V(ie,X,oe,ke):null;case g:return oe.key===Ge?ce(ie,X,oe,ke):null;case P:return Ge=oe._init,pe(ie,X,Ge(oe._payload),ke)}if(Q(oe)||y(oe))return Ge!==null?null:ge(ie,X,oe,ke,null);Gn(ie,oe)}return null}function ze(ie,X,oe,ke,Ge){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ie=ie.get(oe)||null,$(X,ie,""+ke,Ge);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case d:return ie=ie.get(ke.key===null?oe:ke.key)||null,V(X,ie,ke,Ge);case g:return ie=ie.get(ke.key===null?oe:ke.key)||null,ce(X,ie,ke,Ge);case P:var qe=ke._init;return ze(ie,X,oe,qe(ke._payload),Ge)}if(Q(ke)||y(ke))return ie=ie.get(oe)||null,ge(X,ie,ke,Ge,null);Gn(X,ke)}return null}function Re(ie,X,oe,ke){for(var Ge=null,qe=null,De=X,Ve=X=0,Et=null;De!==null&&Ve<oe.length;Ve++){De.index>Ve?(Et=De,De=null):Et=De.sibling;var tt=pe(ie,De,oe[Ve],ke);if(tt===null){De===null&&(De=Et);break}e&&De&&tt.alternate===null&&t(ie,De),X=_(tt,X,Ve),qe===null?Ge=tt:qe.sibling=tt,qe=tt,De=Et}if(Ve===oe.length)return i(ie,De),dt&&Ji(ie,Ve),Ge;if(De===null){for(;Ve<oe.length;Ve++)De=ve(ie,oe[Ve],ke),De!==null&&(X=_(De,X,Ve),qe===null?Ge=De:qe.sibling=De,qe=De);return dt&&Ji(ie,Ve),Ge}for(De=n(ie,De);Ve<oe.length;Ve++)Et=ze(De,ie,Ve,oe[Ve],ke),Et!==null&&(e&&Et.alternate!==null&&De.delete(Et.key===null?Ve:Et.key),X=_(Et,X,Ve),qe===null?Ge=Et:qe.sibling=Et,qe=Et);return e&&De.forEach(function(Ui){return t(ie,Ui)}),dt&&Ji(ie,Ve),Ge}function Oe(ie,X,oe,ke){var Ge=y(oe);if(typeof Ge!="function")throw Error(ue(150));if(oe=Ge.call(oe),oe==null)throw Error(ue(151));for(var qe=Ge=null,De=X,Ve=X=0,Et=null,tt=oe.next();De!==null&&!tt.done;Ve++,tt=oe.next()){De.index>Ve?(Et=De,De=null):Et=De.sibling;var Ui=pe(ie,De,tt.value,ke);if(Ui===null){De===null&&(De=Et);break}e&&De&&Ui.alternate===null&&t(ie,De),X=_(Ui,X,Ve),qe===null?Ge=Ui:qe.sibling=Ui,qe=Ui,De=Et}if(tt.done)return i(ie,De),dt&&Ji(ie,Ve),Ge;if(De===null){for(;!tt.done;Ve++,tt=oe.next())tt=ve(ie,tt.value,ke),tt!==null&&(X=_(tt,X,Ve),qe===null?Ge=tt:qe.sibling=tt,qe=tt);return dt&&Ji(ie,Ve),Ge}for(De=n(ie,De);!tt.done;Ve++,tt=oe.next())tt=ze(De,ie,Ve,tt.value,ke),tt!==null&&(e&&tt.alternate!==null&&De.delete(tt.key===null?Ve:tt.key),X=_(tt,X,Ve),qe===null?Ge=tt:qe.sibling=tt,qe=tt);return e&&De.forEach(function(zu){return t(ie,zu)}),dt&&Ji(ie,Ve),Ge}function vt(ie,X,oe,ke){if(typeof oe=="object"&&oe!==null&&oe.type===k&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case d:e:{for(var Ge=oe.key,qe=X;qe!==null;){if(qe.key===Ge){if(Ge=oe.type,Ge===k){if(qe.tag===7){i(ie,qe.sibling),X=l(qe,oe.props.children),X.return=ie,ie=X;break e}}else if(qe.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===P&&ca(Ge)===qe.type){i(ie,qe.sibling),X=l(qe,oe.props),X.ref=Hs(ie,qe,oe),X.return=ie,ie=X;break e}i(ie,qe);break}else t(ie,qe);qe=qe.sibling}oe.type===k?(X=is(oe.props.children,ie.mode,ke,oe.key),X.return=ie,ie=X):(ke=lr(oe.type,oe.key,oe.props,null,ie.mode,ke),ke.ref=Hs(ie,X,oe),ke.return=ie,ie=ke)}return M(ie);case g:e:{for(qe=oe.key;X!==null;){if(X.key===qe)if(X.tag===4&&X.stateNode.containerInfo===oe.containerInfo&&X.stateNode.implementation===oe.implementation){i(ie,X.sibling),X=l(X,oe.children||[]),X.return=ie,ie=X;break e}else{i(ie,X);break}else t(ie,X);X=X.sibling}X=Ko(oe,ie.mode,ke),X.return=ie,ie=X}return M(ie);case P:return qe=oe._init,vt(ie,X,qe(oe._payload),ke)}if(Q(oe))return Re(ie,X,oe,ke);if(y(oe))return Oe(ie,X,oe,ke);Gn(ie,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"?(oe=""+oe,X!==null&&X.tag===6?(i(ie,X.sibling),X=l(X,oe),X.return=ie,ie=X):(i(ie,X),X=Vo(oe,ie.mode,ke),X.return=ie,ie=X),M(ie)):i(ie,X)}return vt}var gs=ha(!0),ua=ha(!1),Bn=Li(null),In=null,vs=null,to=null;function io(){to=vs=In=null}function so(e){var t=Bn.current;ut(Bn),e._currentValue=t}function no(e,t,i){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function ys(e,t){In=e,to=vs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Dt=!0),e.firstContext=null)}function Zt(e){var t=e._currentValue;if(to!==e)if(e={context:e,memoizedValue:t,next:null},vs===null){if(In===null)throw Error(ue(308));vs=e,In.dependencies={lanes:0,firstContext:e}}else vs=vs.next=e;return t}var Qi=null;function ro(e){Qi===null?Qi=[e]:Qi.push(e)}function da(e,t,i,n){var l=t.interleaved;return l===null?(i.next=i,ro(t)):(i.next=l.next,l.next=i),t.interleaved=i,ki(e,n)}function ki(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Oi=!1;function oo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Si(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gi(e,t,i){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ze&2){var l=n.pending;return l===null?t.next=t:(t.next=l.next,l.next=t),n.pending=t,ki(e,i)}return l=n.interleaved,l===null?(t.next=t,ro(n)):(t.next=l.next,l.next=t),n.interleaved=t,ki(e,i)}function qn(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,wr(e,i)}}function _a(e,t){var i=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var l=null,_=null;if(i=i.firstBaseUpdate,i!==null){do{var M={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};_===null?l=_=M:_=_.next=M,i=i.next}while(i!==null);_===null?l=_=t:_=_.next=t}else l=_=t;i={baseState:n.baseState,firstBaseUpdate:l,lastBaseUpdate:_,shared:n.shared,effects:n.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Dn(e,t,i,n){var l=e.updateQueue;Oi=!1;var _=l.firstBaseUpdate,M=l.lastBaseUpdate,$=l.shared.pending;if($!==null){l.shared.pending=null;var V=$,ce=V.next;V.next=null,M===null?_=ce:M.next=ce,M=V;var ge=e.alternate;ge!==null&&(ge=ge.updateQueue,$=ge.lastBaseUpdate,$!==M&&($===null?ge.firstBaseUpdate=ce:$.next=ce,ge.lastBaseUpdate=V))}if(_!==null){var ve=l.baseState;M=0,ge=ce=V=null,$=_;do{var pe=$.lane,ze=$.eventTime;if((n&pe)===pe){ge!==null&&(ge=ge.next={eventTime:ze,lane:0,tag:$.tag,payload:$.payload,callback:$.callback,next:null});e:{var Re=e,Oe=$;switch(pe=t,ze=i,Oe.tag){case 1:if(Re=Oe.payload,typeof Re=="function"){ve=Re.call(ze,ve,pe);break e}ve=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=Oe.payload,pe=typeof Re=="function"?Re.call(ze,ve,pe):Re,pe==null)break e;ve=N({},ve,pe);break e;case 2:Oi=!0}}$.callback!==null&&$.lane!==0&&(e.flags|=64,pe=l.effects,pe===null?l.effects=[$]:pe.push($))}else ze={eventTime:ze,lane:pe,tag:$.tag,payload:$.payload,callback:$.callback,next:null},ge===null?(ce=ge=ze,V=ve):ge=ge.next=ze,M|=pe;if($=$.next,$===null){if($=l.shared.pending,$===null)break;pe=$,$=pe.next,pe.next=null,l.lastBaseUpdate=pe,l.shared.pending=null}}while(!0);if(ge===null&&(V=ve),l.baseState=V,l.firstBaseUpdate=ce,l.lastBaseUpdate=ge,t=l.shared.interleaved,t!==null){l=t;do M|=l.lane,l=l.next;while(l!==t)}else _===null&&(l.shared.lanes=0);ji|=M,e.lanes=M,e.memoizedState=ve}}function ma(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],l=n.callback;if(l!==null){if(n.callback=null,n=i,typeof l!="function")throw Error(ue(191,l));l.call(n)}}}var Vs={},mi=Li(Vs),Ks=Li(Vs),Js=Li(Vs);function Yi(e){if(e===Vs)throw Error(ue(174));return e}function lo(e,t){switch(at(Js,t),at(Ks,e),at(mi,Vs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:we(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=we(t,e)}ut(mi),at(mi,t)}function ws(){ut(mi),ut(Ks),ut(Js)}function pa(e){Yi(Js.current);var t=Yi(mi.current),i=we(t,e.type);t!==i&&(at(Ks,e),at(mi,i))}function ao(e){Ks.current===e&&(ut(mi),ut(Ks))}var _t=Li(0);function $n(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function ho(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var Wn=c.ReactCurrentDispatcher,uo=c.ReactCurrentBatchConfig,Xi=0,mt=null,bt=null,Ct=null,Un=!1,Qs=!1,Ys=0,jh=0;function Nt(){throw Error(ue(321))}function fo(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!ri(e[i],t[i]))return!1;return!0}function _o(e,t,i,n,l,_){if(Xi=_,mt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Wn.current=e===null||e.memoizedState===null?iu:su,e=i(n,l),Qs){_=0;do{if(Qs=!1,Ys=0,25<=_)throw Error(ue(301));_+=1,Ct=bt=null,t.updateQueue=null,Wn.current=nu,e=i(n,l)}while(Qs)}if(Wn.current=Kn,t=bt!==null&&bt.next!==null,Xi=0,Ct=bt=mt=null,Un=!1,t)throw Error(ue(300));return e}function mo(){var e=Ys!==0;return Ys=0,e}function pi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?mt.memoizedState=Ct=e:Ct=Ct.next=e,Ct}function ei(){if(bt===null){var e=mt.alternate;e=e!==null?e.memoizedState:null}else e=bt.next;var t=Ct===null?mt.memoizedState:Ct.next;if(t!==null)Ct=t,bt=e;else{if(e===null)throw Error(ue(310));bt=e,e={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Ct===null?mt.memoizedState=Ct=e:Ct=Ct.next=e}return Ct}function Xs(e,t){return typeof t=="function"?t(e):t}function po(e){var t=ei(),i=t.queue;if(i===null)throw Error(ue(311));i.lastRenderedReducer=e;var n=bt,l=n.baseQueue,_=i.pending;if(_!==null){if(l!==null){var M=l.next;l.next=_.next,_.next=M}n.baseQueue=l=_,i.pending=null}if(l!==null){_=l.next,n=n.baseState;var $=M=null,V=null,ce=_;do{var ge=ce.lane;if((Xi&ge)===ge)V!==null&&(V=V.next={lane:0,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),n=ce.hasEagerState?ce.eagerState:e(n,ce.action);else{var ve={lane:ge,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null};V===null?($=V=ve,M=n):V=V.next=ve,mt.lanes|=ge,ji|=ge}ce=ce.next}while(ce!==null&&ce!==_);V===null?M=n:V.next=$,ri(n,t.memoizedState)||(Dt=!0),t.memoizedState=n,t.baseState=M,t.baseQueue=V,i.lastRenderedState=n}if(e=i.interleaved,e!==null){l=e;do _=l.lane,mt.lanes|=_,ji|=_,l=l.next;while(l!==e)}else l===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function go(e){var t=ei(),i=t.queue;if(i===null)throw Error(ue(311));i.lastRenderedReducer=e;var n=i.dispatch,l=i.pending,_=t.memoizedState;if(l!==null){i.pending=null;var M=l=l.next;do _=e(_,M.action),M=M.next;while(M!==l);ri(_,t.memoizedState)||(Dt=!0),t.memoizedState=_,t.baseQueue===null&&(t.baseState=_),i.lastRenderedState=_}return[_,n]}function ga(){}function va(e,t){var i=mt,n=ei(),l=t(),_=!ri(n.memoizedState,l);if(_&&(n.memoizedState=l,Dt=!0),n=n.queue,vo(ba.bind(null,i,n,e),[e]),n.getSnapshot!==t||_||Ct!==null&&Ct.memoizedState.tag&1){if(i.flags|=2048,js(9,wa.bind(null,i,n,l,t),void 0,null),Mt===null)throw Error(ue(349));Xi&30||ya(i,t,l)}return l}function ya(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=mt.updateQueue,t===null?(t={lastEffect:null,stores:null},mt.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function wa(e,t,i,n){t.value=i,t.getSnapshot=n,ka(t)&&Sa(e)}function ba(e,t,i){return i(function(){ka(t)&&Sa(e)})}function ka(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!ri(e,i)}catch{return!0}}function Sa(e){var t=ki(e,1);t!==null&&hi(t,e,1,-1)}function xa(e){var t=pi();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xs,lastRenderedState:e},t.queue=e,e=e.dispatch=tu.bind(null,mt,e),[t.memoizedState,e]}function js(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},t=mt.updateQueue,t===null?(t={lastEffect:null,stores:null},mt.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e)),e}function Ca(){return ei().memoizedState}function Hn(e,t,i,n){var l=pi();mt.flags|=e,l.memoizedState=js(1|t,i,void 0,n===void 0?null:n)}function Vn(e,t,i,n){var l=ei();n=n===void 0?null:n;var _=void 0;if(bt!==null){var M=bt.memoizedState;if(_=M.destroy,n!==null&&fo(n,M.deps)){l.memoizedState=js(t,i,_,n);return}}mt.flags|=e,l.memoizedState=js(1|t,i,_,n)}function Ma(e,t){return Hn(8390656,8,e,t)}function vo(e,t){return Vn(2048,8,e,t)}function Ea(e,t){return Vn(4,2,e,t)}function Pa(e,t){return Vn(4,4,e,t)}function Ta(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function za(e,t,i){return i=i!=null?i.concat([e]):null,Vn(4,4,Ta.bind(null,t,e),i)}function yo(){}function Aa(e,t){var i=ei();t=t===void 0?null:t;var n=i.memoizedState;return n!==null&&t!==null&&fo(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Na(e,t){var i=ei();t=t===void 0?null:t;var n=i.memoizedState;return n!==null&&t!==null&&fo(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function La(e,t,i){return Xi&21?(ri(i,t)||(i=cl(),mt.lanes|=i,ji|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Dt=!0),e.memoizedState=i)}function Zh(e,t){var i=nt;nt=i!==0&&4>i?i:4,e(!0);var n=uo.transition;uo.transition={};try{e(!1),t()}finally{nt=i,uo.transition=n}}function Fa(){return ei().memoizedState}function eu(e,t,i){var n=Di(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Ra(e))Oa(t,i);else if(i=da(e,t,i,n),i!==null){var l=Gt();hi(i,e,n,l),Ga(i,t,n)}}function tu(e,t,i){var n=Di(e),l={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Ra(e))Oa(t,l);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=t.lastRenderedReducer,_!==null))try{var M=t.lastRenderedState,$=_(M,i);if(l.hasEagerState=!0,l.eagerState=$,ri($,M)){var V=t.interleaved;V===null?(l.next=l,ro(t)):(l.next=V.next,V.next=l),t.interleaved=l;return}}catch{}finally{}i=da(e,t,l,n),i!==null&&(l=Gt(),hi(i,e,n,l),Ga(i,t,n))}}function Ra(e){var t=e.alternate;return e===mt||t!==null&&t===mt}function Oa(e,t){Qs=Un=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Ga(e,t,i){if(i&4194240){var n=t.lanes;n&=e.pendingLanes,i|=n,t.lanes=i,wr(e,i)}}var Kn={readContext:Zt,useCallback:Nt,useContext:Nt,useEffect:Nt,useImperativeHandle:Nt,useInsertionEffect:Nt,useLayoutEffect:Nt,useMemo:Nt,useReducer:Nt,useRef:Nt,useState:Nt,useDebugValue:Nt,useDeferredValue:Nt,useTransition:Nt,useMutableSource:Nt,useSyncExternalStore:Nt,useId:Nt,unstable_isNewReconciler:!1},iu={readContext:Zt,useCallback:function(e,t){return pi().memoizedState=[e,t===void 0?null:t],e},useContext:Zt,useEffect:Ma,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,Hn(4194308,4,Ta.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Hn(4194308,4,e,t)},useInsertionEffect:function(e,t){return Hn(4,2,e,t)},useMemo:function(e,t){var i=pi();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=pi();return t=i!==void 0?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=eu.bind(null,mt,e),[n.memoizedState,e]},useRef:function(e){var t=pi();return e={current:e},t.memoizedState=e},useState:xa,useDebugValue:yo,useDeferredValue:function(e){return pi().memoizedState=e},useTransition:function(){var e=xa(!1),t=e[0];return e=Zh.bind(null,e[1]),pi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=mt,l=pi();if(dt){if(i===void 0)throw Error(ue(407));i=i()}else{if(i=t(),Mt===null)throw Error(ue(349));Xi&30||ya(n,t,i)}l.memoizedState=i;var _={value:i,getSnapshot:t};return l.queue=_,Ma(ba.bind(null,n,_,e),[e]),n.flags|=2048,js(9,wa.bind(null,n,_,i,t),void 0,null),i},useId:function(){var e=pi(),t=Mt.identifierPrefix;if(dt){var i=bi,n=wi;i=(n&~(1<<32-ni(n)-1)).toString(32)+i,t=":"+t+"R"+i,i=Ys++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=jh++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},su={readContext:Zt,useCallback:Aa,useContext:Zt,useEffect:vo,useImperativeHandle:za,useInsertionEffect:Ea,useLayoutEffect:Pa,useMemo:Na,useReducer:po,useRef:Ca,useState:function(){return po(Xs)},useDebugValue:yo,useDeferredValue:function(e){var t=ei();return La(t,bt.memoizedState,e)},useTransition:function(){var e=po(Xs)[0],t=ei().memoizedState;return[e,t]},useMutableSource:ga,useSyncExternalStore:va,useId:Fa,unstable_isNewReconciler:!1},nu={readContext:Zt,useCallback:Aa,useContext:Zt,useEffect:vo,useImperativeHandle:za,useInsertionEffect:Ea,useLayoutEffect:Pa,useMemo:Na,useReducer:go,useRef:Ca,useState:function(){return go(Xs)},useDebugValue:yo,useDeferredValue:function(e){var t=ei();return bt===null?t.memoizedState=e:La(t,bt.memoizedState,e)},useTransition:function(){var e=go(Xs)[0],t=ei().memoizedState;return[e,t]},useMutableSource:ga,useSyncExternalStore:va,useId:Fa,unstable_isNewReconciler:!1};function li(e,t){if(e&&e.defaultProps){t=N({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function wo(e,t,i,n){t=e.memoizedState,i=i(n,t),i=i==null?t:N({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var Jn={isMounted:function(e){return(e=e._reactInternals)?Ht(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=Gt(),l=Di(e),_=Si(n,l);_.payload=t,i!=null&&(_.callback=i),t=Gi(e,_,l),t!==null&&(hi(t,e,l,n),qn(t,e,l))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=Gt(),l=Di(e),_=Si(n,l);_.tag=1,_.payload=t,i!=null&&(_.callback=i),t=Gi(e,_,l),t!==null&&(hi(t,e,l,n),qn(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Gt(),n=Di(e),l=Si(i,n);l.tag=2,t!=null&&(l.callback=t),t=Gi(e,l,n),t!==null&&(hi(t,e,n,i),qn(t,e,n))}};function Ba(e,t,i,n,l,_,M){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,_,M):t.prototype&&t.prototype.isPureReactComponent?!Bs(i,n)||!Bs(l,_):!0}function Ia(e,t,i){var n=!1,l=Fi,_=t.contextType;return typeof _=="object"&&_!==null?_=Zt(_):(l=qt(t)?Vi:At.current,n=t.contextTypes,_=(n=n!=null)?fs(e,l):Fi),t=new t(i,_),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Jn,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=l,e.__reactInternalMemoizedMaskedChildContext=_),t}function qa(e,t,i,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Jn.enqueueReplaceState(t,t.state,null)}function bo(e,t,i,n){var l=e.stateNode;l.props=i,l.state=e.memoizedState,l.refs={},oo(e);var _=t.contextType;typeof _=="object"&&_!==null?l.context=Zt(_):(_=qt(t)?Vi:At.current,l.context=fs(e,_)),l.state=e.memoizedState,_=t.getDerivedStateFromProps,typeof _=="function"&&(wo(e,t,_,i),l.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(t=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),t!==l.state&&Jn.enqueueReplaceState(l,l.state,null),Dn(e,i,l,n),l.state=e.memoizedState),typeof l.componentDidMount=="function"&&(e.flags|=4194308)}function bs(e,t){try{var i="",n=t;do i+=B(n),n=n.return;while(n);var l=i}catch(_){l=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:t,stack:l,digest:null}}function ko(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function So(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var ru=typeof WeakMap=="function"?WeakMap:Map;function Da(e,t,i){i=Si(-1,i),i.tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){tr||(tr=!0,Bo=n),So(e,t)},i}function $a(e,t,i){i=Si(-1,i),i.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var l=t.value;i.payload=function(){return n(l)},i.callback=function(){So(e,t)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(i.callback=function(){So(e,t),typeof n!="function"&&(Ii===null?Ii=new Set([this]):Ii.add(this));var M=t.stack;this.componentDidCatch(t.value,{componentStack:M!==null?M:""})}),i}function Wa(e,t,i){var n=e.pingCache;if(n===null){n=e.pingCache=new ru;var l=new Set;n.set(t,l)}else l=n.get(t),l===void 0&&(l=new Set,n.set(t,l));l.has(i)||(l.add(i),e=yu.bind(null,e,t,i),t.then(e,e))}function Ua(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ha(e,t,i,n,l){return e.mode&1?(e.flags|=65536,e.lanes=l,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Si(-1,1),t.tag=2,Gi(i,t,1))),i.lanes|=1),e)}var ou=c.ReactCurrentOwner,Dt=!1;function Ot(e,t,i,n){t.child=e===null?ua(t,null,i,n):gs(t,e.child,i,n)}function Va(e,t,i,n,l){i=i.render;var _=t.ref;return ys(t,l),n=_o(e,t,i,n,_,l),i=mo(),e!==null&&!Dt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,xi(e,t,l)):(dt&&i&&Yr(t),t.flags|=1,Ot(e,t,n,l),t.child)}function Ka(e,t,i,n,l){if(e===null){var _=i.type;return typeof _=="function"&&!Ho(_)&&_.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=_,Ja(e,t,_,n,l)):(e=lr(i.type,null,n,t,t.mode,l),e.ref=t.ref,e.return=t,t.child=e)}if(_=e.child,!(e.lanes&l)){var M=_.memoizedProps;if(i=i.compare,i=i!==null?i:Bs,i(M,n)&&e.ref===t.ref)return xi(e,t,l)}return t.flags|=1,e=Wi(_,n),e.ref=t.ref,e.return=t,t.child=e}function Ja(e,t,i,n,l){if(e!==null){var _=e.memoizedProps;if(Bs(_,n)&&e.ref===t.ref)if(Dt=!1,t.pendingProps=n=_,(e.lanes&l)!==0)e.flags&131072&&(Dt=!0);else return t.lanes=e.lanes,xi(e,t,l)}return xo(e,t,i,n,l)}function Qa(e,t,i){var n=t.pendingProps,l=n.children,_=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(Ss,Qt),Qt|=i;else{if(!(i&1073741824))return e=_!==null?_.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,at(Ss,Qt),Qt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=_!==null?_.baseLanes:i,at(Ss,Qt),Qt|=n}else _!==null?(n=_.baseLanes|i,t.memoizedState=null):n=i,at(Ss,Qt),Qt|=n;return Ot(e,t,l,i),t.child}function Ya(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function xo(e,t,i,n,l){var _=qt(i)?Vi:At.current;return _=fs(t,_),ys(t,l),i=_o(e,t,i,n,_,l),n=mo(),e!==null&&!Dt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,xi(e,t,l)):(dt&&n&&Yr(t),t.flags|=1,Ot(e,t,i,l),t.child)}function Xa(e,t,i,n,l){if(qt(i)){var _=!0;Nn(t)}else _=!1;if(ys(t,l),t.stateNode===null)Yn(e,t),Ia(t,i,n),bo(t,i,n,l),n=!0;else if(e===null){var M=t.stateNode,$=t.memoizedProps;M.props=$;var V=M.context,ce=i.contextType;typeof ce=="object"&&ce!==null?ce=Zt(ce):(ce=qt(i)?Vi:At.current,ce=fs(t,ce));var ge=i.getDerivedStateFromProps,ve=typeof ge=="function"||typeof M.getSnapshotBeforeUpdate=="function";ve||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||($!==n||V!==ce)&&qa(t,M,n,ce),Oi=!1;var pe=t.memoizedState;M.state=pe,Dn(t,n,M,l),V=t.memoizedState,$!==n||pe!==V||It.current||Oi?(typeof ge=="function"&&(wo(t,i,ge,n),V=t.memoizedState),($=Oi||Ba(t,i,$,n,pe,V,ce))?(ve||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(t.flags|=4194308)):(typeof M.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=V),M.props=n,M.state=V,M.context=ce,n=$):(typeof M.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{M=t.stateNode,fa(e,t),$=t.memoizedProps,ce=t.type===t.elementType?$:li(t.type,$),M.props=ce,ve=t.pendingProps,pe=M.context,V=i.contextType,typeof V=="object"&&V!==null?V=Zt(V):(V=qt(i)?Vi:At.current,V=fs(t,V));var ze=i.getDerivedStateFromProps;(ge=typeof ze=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||($!==ve||pe!==V)&&qa(t,M,n,V),Oi=!1,pe=t.memoizedState,M.state=pe,Dn(t,n,M,l);var Re=t.memoizedState;$!==ve||pe!==Re||It.current||Oi?(typeof ze=="function"&&(wo(t,i,ze,n),Re=t.memoizedState),(ce=Oi||Ba(t,i,ce,n,pe,Re,V)||!1)?(ge||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(n,Re,V),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(n,Re,V)),typeof M.componentDidUpdate=="function"&&(t.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof M.componentDidUpdate!="function"||$===e.memoizedProps&&pe===e.memoizedState||(t.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||$===e.memoizedProps&&pe===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=Re),M.props=n,M.state=Re,M.context=V,n=ce):(typeof M.componentDidUpdate!="function"||$===e.memoizedProps&&pe===e.memoizedState||(t.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||$===e.memoizedProps&&pe===e.memoizedState||(t.flags|=1024),n=!1)}return Co(e,t,i,n,_,l)}function Co(e,t,i,n,l,_){Ya(e,t);var M=(t.flags&128)!==0;if(!n&&!M)return l&&ia(t,i,!1),xi(e,t,_);n=t.stateNode,ou.current=t;var $=M&&typeof i.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&M?(t.child=gs(t,e.child,null,_),t.child=gs(t,null,$,_)):Ot(e,t,$,_),t.memoizedState=n.state,l&&ia(t,i,!0),t.child}function ja(e){var t=e.stateNode;t.pendingContext?ea(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ea(e,t.context,!1),lo(e,t.containerInfo)}function Za(e,t,i,n,l){return ps(),eo(l),t.flags|=256,Ot(e,t,i,n),t.child}var Mo={dehydrated:null,treeContext:null,retryLane:0};function Eo(e){return{baseLanes:e,cachePool:null,transitions:null}}function ec(e,t,i){var n=t.pendingProps,l=_t.current,_=!1,M=(t.flags&128)!==0,$;if(($=M)||($=e!==null&&e.memoizedState===null?!1:(l&2)!==0),$?(_=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(l|=1),at(_t,l&1),e===null)return Zr(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(M=n.children,e=n.fallback,_?(n=t.mode,_=t.child,M={mode:"hidden",children:M},!(n&1)&&_!==null?(_.childLanes=0,_.pendingProps=M):_=ar(M,n,0,null),e=is(e,n,i,null),_.return=t,e.return=t,_.sibling=e,t.child=_,t.child.memoizedState=Eo(i),t.memoizedState=Mo,e):Po(t,M));if(l=e.memoizedState,l!==null&&($=l.dehydrated,$!==null))return lu(e,t,M,n,$,l,i);if(_){_=n.fallback,M=t.mode,l=e.child,$=l.sibling;var V={mode:"hidden",children:n.children};return!(M&1)&&t.child!==l?(n=t.child,n.childLanes=0,n.pendingProps=V,t.deletions=null):(n=Wi(l,V),n.subtreeFlags=l.subtreeFlags&14680064),$!==null?_=Wi($,_):(_=is(_,M,i,null),_.flags|=2),_.return=t,n.return=t,n.sibling=_,t.child=n,n=_,_=t.child,M=e.child.memoizedState,M=M===null?Eo(i):{baseLanes:M.baseLanes|i,cachePool:null,transitions:M.transitions},_.memoizedState=M,_.childLanes=e.childLanes&~i,t.memoizedState=Mo,n}return _=e.child,e=_.sibling,n=Wi(_,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=i),n.return=t,n.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n}function Po(e,t){return t=ar({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Qn(e,t,i,n){return n!==null&&eo(n),gs(t,e.child,null,i),e=Po(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function lu(e,t,i,n,l,_,M){if(i)return t.flags&256?(t.flags&=-257,n=ko(Error(ue(422))),Qn(e,t,M,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(_=n.fallback,l=t.mode,n=ar({mode:"visible",children:n.children},l,0,null),_=is(_,l,M,null),_.flags|=2,n.return=t,_.return=t,n.sibling=_,t.child=n,t.mode&1&&gs(t,e.child,null,M),t.child.memoizedState=Eo(M),t.memoizedState=Mo,_);if(!(t.mode&1))return Qn(e,t,M,null);if(l.data==="$!"){if(n=l.nextSibling&&l.nextSibling.dataset,n)var $=n.dgst;return n=$,_=Error(ue(419)),n=ko(_,n,void 0),Qn(e,t,M,n)}if($=(M&e.childLanes)!==0,Dt||$){if(n=Mt,n!==null){switch(M&-M){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(n.suspendedLanes|M)?0:l,l!==0&&l!==_.retryLane&&(_.retryLane=l,ki(e,l),hi(n,e,l,-1))}return Uo(),n=ko(Error(ue(421))),Qn(e,t,M,n)}return l.data==="$?"?(t.flags|=128,t.child=e.child,t=wu.bind(null,e),l._reactRetry=t,null):(e=_.treeContext,Jt=Ni(l.nextSibling),Kt=t,dt=!0,oi=null,e!==null&&(Xt[jt++]=wi,Xt[jt++]=bi,Xt[jt++]=Ki,wi=e.id,bi=e.overflow,Ki=t),t=Po(t,n.children),t.flags|=4096,t)}function tc(e,t,i){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),no(e.return,t,i)}function To(e,t,i,n,l){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:l}:(_.isBackwards=t,_.rendering=null,_.renderingStartTime=0,_.last=n,_.tail=i,_.tailMode=l)}function ic(e,t,i){var n=t.pendingProps,l=n.revealOrder,_=n.tail;if(Ot(e,t,n.children,i),n=_t.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&tc(e,i,t);else if(e.tag===19)tc(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(at(_t,n),!(t.mode&1))t.memoizedState=null;else switch(l){case"forwards":for(i=t.child,l=null;i!==null;)e=i.alternate,e!==null&&$n(e)===null&&(l=i),i=i.sibling;i=l,i===null?(l=t.child,t.child=null):(l=i.sibling,i.sibling=null),To(t,!1,l,i,_);break;case"backwards":for(i=null,l=t.child,t.child=null;l!==null;){if(e=l.alternate,e!==null&&$n(e)===null){t.child=l;break}e=l.sibling,l.sibling=i,i=l,l=e}To(t,!0,i,null,_);break;case"together":To(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Yn(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function xi(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),ji|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ue(153));if(t.child!==null){for(e=t.child,i=Wi(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Wi(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function au(e,t,i){switch(t.tag){case 3:ja(t),ps();break;case 5:pa(t);break;case 1:qt(t.type)&&Nn(t);break;case 4:lo(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,l=t.memoizedProps.value;at(Bn,n._currentValue),n._currentValue=l;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(at(_t,_t.current&1),t.flags|=128,null):i&t.child.childLanes?ec(e,t,i):(at(_t,_t.current&1),e=xi(e,t,i),e!==null?e.sibling:null);at(_t,_t.current&1);break;case 19:if(n=(i&t.childLanes)!==0,e.flags&128){if(n)return ic(e,t,i);t.flags|=128}if(l=t.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),at(_t,_t.current),n)break;return null;case 22:case 23:return t.lanes=0,Qa(e,t,i)}return xi(e,t,i)}var sc,zo,nc,rc;sc=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},zo=function(){},nc=function(e,t,i,n){var l=e.memoizedProps;if(l!==n){e=t.stateNode,Yi(mi.current);var _=null;switch(i){case"input":l=H(e,l),n=H(e,n),_=[];break;case"select":l=N({},l,{value:void 0}),n=N({},n,{value:void 0}),_=[];break;case"textarea":l=te(e,l),n=te(e,n),_=[];break;default:typeof l.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Tn)}Ue(i,n);var M;i=null;for(ce in l)if(!n.hasOwnProperty(ce)&&l.hasOwnProperty(ce)&&l[ce]!=null)if(ce==="style"){var $=l[ce];for(M in $)$.hasOwnProperty(M)&&(i||(i={}),i[M]="")}else ce!=="dangerouslySetInnerHTML"&&ce!=="children"&&ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&ce!=="autoFocus"&&(Qe.hasOwnProperty(ce)?_||(_=[]):(_=_||[]).push(ce,null));for(ce in n){var V=n[ce];if($=l!=null?l[ce]:void 0,n.hasOwnProperty(ce)&&V!==$&&(V!=null||$!=null))if(ce==="style")if($){for(M in $)!$.hasOwnProperty(M)||V&&V.hasOwnProperty(M)||(i||(i={}),i[M]="");for(M in V)V.hasOwnProperty(M)&&$[M]!==V[M]&&(i||(i={}),i[M]=V[M])}else i||(_||(_=[]),_.push(ce,i)),i=V;else ce==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,$=$?$.__html:void 0,V!=null&&$!==V&&(_=_||[]).push(ce,V)):ce==="children"?typeof V!="string"&&typeof V!="number"||(_=_||[]).push(ce,""+V):ce!=="suppressContentEditableWarning"&&ce!=="suppressHydrationWarning"&&(Qe.hasOwnProperty(ce)?(V!=null&&ce==="onScroll"&&ht("scroll",e),_||$===V||(_=[])):(_=_||[]).push(ce,V))}i&&(_=_||[]).push("style",i);var ce=_;(t.updateQueue=ce)&&(t.flags|=4)}},rc=function(e,t,i,n){i!==n&&(t.flags|=4)};function Zs(e,t){if(!dt)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Lt(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,n=0;if(t)for(var l=e.child;l!==null;)i|=l.lanes|l.childLanes,n|=l.subtreeFlags&14680064,n|=l.flags&14680064,l.return=e,l=l.sibling;else for(l=e.child;l!==null;)i|=l.lanes|l.childLanes,n|=l.subtreeFlags,n|=l.flags,l.return=e,l=l.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function cu(e,t,i){var n=t.pendingProps;switch(Xr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(t),null;case 1:return qt(t.type)&&An(),Lt(t),null;case 3:return n=t.stateNode,ws(),ut(It),ut(At),ho(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(On(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,oi!==null&&(Do(oi),oi=null))),zo(e,t),Lt(t),null;case 5:ao(t);var l=Yi(Js.current);if(i=t.type,e!==null&&t.stateNode!=null)nc(e,t,i,n,l),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(ue(166));return Lt(t),null}if(e=Yi(mi.current),On(t)){n=t.stateNode,i=t.type;var _=t.memoizedProps;switch(n[_i]=t,n[Ws]=_,e=(t.mode&1)!==0,i){case"dialog":ht("cancel",n),ht("close",n);break;case"iframe":case"object":case"embed":ht("load",n);break;case"video":case"audio":for(l=0;l<qs.length;l++)ht(qs[l],n);break;case"source":ht("error",n);break;case"img":case"image":case"link":ht("error",n),ht("load",n);break;case"details":ht("toggle",n);break;case"input":I(n,_),ht("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!_.multiple},ht("invalid",n);break;case"textarea":ne(n,_),ht("invalid",n)}Ue(i,_),l=null;for(var M in _)if(_.hasOwnProperty(M)){var $=_[M];M==="children"?typeof $=="string"?n.textContent!==$&&(_.suppressHydrationWarning!==!0&&Pn(n.textContent,$,e),l=["children",$]):typeof $=="number"&&n.textContent!==""+$&&(_.suppressHydrationWarning!==!0&&Pn(n.textContent,$,e),l=["children",""+$]):Qe.hasOwnProperty(M)&&$!=null&&M==="onScroll"&&ht("scroll",n)}switch(i){case"input":he(n),K(n,_,!0);break;case"textarea":he(n),Ce(n);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(n.onclick=Tn)}n=l,t.updateQueue=n,n!==null&&(t.flags|=4)}else{M=l.nodeType===9?l:l.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Me(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=M.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=M.createElement(i,{is:n.is}):(e=M.createElement(i),i==="select"&&(M=e,n.multiple?M.multiple=!0:n.size&&(M.size=n.size))):e=M.createElementNS(e,i),e[_i]=t,e[Ws]=n,sc(e,t,!1,!1),t.stateNode=e;e:{switch(M=Ie(i,n),i){case"dialog":ht("cancel",e),ht("close",e),l=n;break;case"iframe":case"object":case"embed":ht("load",e),l=n;break;case"video":case"audio":for(l=0;l<qs.length;l++)ht(qs[l],e);l=n;break;case"source":ht("error",e),l=n;break;case"img":case"image":case"link":ht("error",e),ht("load",e),l=n;break;case"details":ht("toggle",e),l=n;break;case"input":I(e,n),l=H(e,n),ht("invalid",e);break;case"option":l=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},l=N({},n,{value:void 0}),ht("invalid",e);break;case"textarea":ne(e,n),l=te(e,n),ht("invalid",e);break;default:l=n}Ue(i,l),$=l;for(_ in $)if($.hasOwnProperty(_)){var V=$[_];_==="style"?xe(e,V):_==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&Be(e,V)):_==="children"?typeof V=="string"?(i!=="textarea"||V!=="")&&de(e,V):typeof V=="number"&&de(e,""+V):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(Qe.hasOwnProperty(_)?V!=null&&_==="onScroll"&&ht("scroll",e):V!=null&&a(e,_,V,M))}switch(i){case"input":he(e),K(e,n,!1);break;case"textarea":he(e),Ce(e);break;case"option":n.value!=null&&e.setAttribute("value",""+me(n.value));break;case"select":e.multiple=!!n.multiple,_=n.value,_!=null?ae(e,!!n.multiple,_,!1):n.defaultValue!=null&&ae(e,!!n.multiple,n.defaultValue,!0);break;default:typeof l.onClick=="function"&&(e.onclick=Tn)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Lt(t),null;case 6:if(e&&t.stateNode!=null)rc(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(ue(166));if(i=Yi(Js.current),Yi(mi.current),On(t)){if(n=t.stateNode,i=t.memoizedProps,n[_i]=t,(_=n.nodeValue!==i)&&(e=Kt,e!==null))switch(e.tag){case 3:Pn(n.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Pn(n.nodeValue,i,(e.mode&1)!==0)}_&&(t.flags|=4)}else n=(i.nodeType===9?i:i.ownerDocument).createTextNode(n),n[_i]=t,t.stateNode=n}return Lt(t),null;case 13:if(ut(_t),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(dt&&Jt!==null&&t.mode&1&&!(t.flags&128))aa(),ps(),t.flags|=98560,_=!1;else if(_=On(t),n!==null&&n.dehydrated!==null){if(e===null){if(!_)throw Error(ue(318));if(_=t.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(ue(317));_[_i]=t}else ps(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Lt(t),_=!1}else oi!==null&&(Do(oi),oi=null),_=!0;if(!_)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||_t.current&1?kt===0&&(kt=3):Uo())),t.updateQueue!==null&&(t.flags|=4),Lt(t),null);case 4:return ws(),zo(e,t),e===null&&Ds(t.stateNode.containerInfo),Lt(t),null;case 10:return so(t.type._context),Lt(t),null;case 17:return qt(t.type)&&An(),Lt(t),null;case 19:if(ut(_t),_=t.memoizedState,_===null)return Lt(t),null;if(n=(t.flags&128)!==0,M=_.rendering,M===null)if(n)Zs(_,!1);else{if(kt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(M=$n(e),M!==null){for(t.flags|=128,Zs(_,!1),n=M.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;i!==null;)_=i,e=n,_.flags&=14680066,M=_.alternate,M===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=M.childLanes,_.lanes=M.lanes,_.child=M.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=M.memoizedProps,_.memoizedState=M.memoizedState,_.updateQueue=M.updateQueue,_.type=M.type,e=M.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return at(_t,_t.current&1|2),t.child}e=e.sibling}_.tail!==null&&gt()>xs&&(t.flags|=128,n=!0,Zs(_,!1),t.lanes=4194304)}else{if(!n)if(e=$n(M),e!==null){if(t.flags|=128,n=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Zs(_,!0),_.tail===null&&_.tailMode==="hidden"&&!M.alternate&&!dt)return Lt(t),null}else 2*gt()-_.renderingStartTime>xs&&i!==1073741824&&(t.flags|=128,n=!0,Zs(_,!1),t.lanes=4194304);_.isBackwards?(M.sibling=t.child,t.child=M):(i=_.last,i!==null?i.sibling=M:t.child=M,_.last=M)}return _.tail!==null?(t=_.tail,_.rendering=t,_.tail=t.sibling,_.renderingStartTime=gt(),t.sibling=null,i=_t.current,at(_t,n?i&1|2:i&1),t):(Lt(t),null);case 22:case 23:return Wo(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Qt&1073741824&&(Lt(t),t.subtreeFlags&6&&(t.flags|=8192)):Lt(t),null;case 24:return null;case 25:return null}throw Error(ue(156,t.tag))}function hu(e,t){switch(Xr(t),t.tag){case 1:return qt(t.type)&&An(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ws(),ut(It),ut(At),ho(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return ao(t),null;case 13:if(ut(_t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ue(340));ps()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ut(_t),null;case 4:return ws(),null;case 10:return so(t.type._context),null;case 22:case 23:return Wo(),null;case 24:return null;default:return null}}var Xn=!1,Ft=!1,uu=typeof WeakSet=="function"?WeakSet:Set,Fe=null;function ks(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(n){pt(e,t,n)}else i.current=null}function Ao(e,t,i){try{i()}catch(n){pt(e,t,n)}}var oc=!1;function du(e,t){if($r=gn,e=Bl(),Fr(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var l=n.anchorOffset,_=n.focusNode;n=n.focusOffset;try{i.nodeType,_.nodeType}catch{i=null;break e}var M=0,$=-1,V=-1,ce=0,ge=0,ve=e,pe=null;t:for(;;){for(var ze;ve!==i||l!==0&&ve.nodeType!==3||($=M+l),ve!==_||n!==0&&ve.nodeType!==3||(V=M+n),ve.nodeType===3&&(M+=ve.nodeValue.length),(ze=ve.firstChild)!==null;)pe=ve,ve=ze;for(;;){if(ve===e)break t;if(pe===i&&++ce===l&&($=M),pe===_&&++ge===n&&(V=M),(ze=ve.nextSibling)!==null)break;ve=pe,pe=ve.parentNode}ve=ze}i=$===-1||V===-1?null:{start:$,end:V}}else i=null}i=i||{start:0,end:0}}else i=null;for(Wr={focusedElem:e,selectionRange:i},gn=!1,Fe=t;Fe!==null;)if(t=Fe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Fe=e;else for(;Fe!==null;){t=Fe;try{var Re=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Re!==null){var Oe=Re.memoizedProps,vt=Re.memoizedState,ie=t.stateNode,X=ie.getSnapshotBeforeUpdate(t.elementType===t.type?Oe:li(t.type,Oe),vt);ie.__reactInternalSnapshotBeforeUpdate=X}break;case 3:var oe=t.stateNode.containerInfo;oe.nodeType===1?oe.textContent="":oe.nodeType===9&&oe.documentElement&&oe.removeChild(oe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ue(163))}}catch(ke){pt(t,t.return,ke)}if(e=t.sibling,e!==null){e.return=t.return,Fe=e;break}Fe=t.return}return Re=oc,oc=!1,Re}function en(e,t,i){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&e)===e){var _=l.destroy;l.destroy=void 0,_!==void 0&&Ao(t,i,_)}l=l.next}while(l!==n)}}function jn(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function No(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function lc(e){var t=e.alternate;t!==null&&(e.alternate=null,lc(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[_i],delete t[Ws],delete t[Kr],delete t[Jh],delete t[Qh])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ac(e){return e.tag===5||e.tag===3||e.tag===4}function cc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ac(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Lo(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=Tn));else if(n!==4&&(e=e.child,e!==null))for(Lo(e,t,i),e=e.sibling;e!==null;)Lo(e,t,i),e=e.sibling}function Fo(e,t,i){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(Fo(e,t,i),e=e.sibling;e!==null;)Fo(e,t,i),e=e.sibling}var Tt=null,ai=!1;function Bi(e,t,i){for(i=i.child;i!==null;)hc(e,t,i),i=i.sibling}function hc(e,t,i){if(fi&&typeof fi.onCommitFiberUnmount=="function")try{fi.onCommitFiberUnmount(un,i)}catch{}switch(i.tag){case 5:Ft||ks(i,t);case 6:var n=Tt,l=ai;Tt=null,Bi(e,t,i),Tt=n,ai=l,Tt!==null&&(ai?(e=Tt,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Tt.removeChild(i.stateNode));break;case 18:Tt!==null&&(ai?(e=Tt,i=i.stateNode,e.nodeType===8?Vr(e.parentNode,i):e.nodeType===1&&Vr(e,i),Ns(e)):Vr(Tt,i.stateNode));break;case 4:n=Tt,l=ai,Tt=i.stateNode.containerInfo,ai=!0,Bi(e,t,i),Tt=n,ai=l;break;case 0:case 11:case 14:case 15:if(!Ft&&(n=i.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){l=n=n.next;do{var _=l,M=_.destroy;_=_.tag,M!==void 0&&(_&2||_&4)&&Ao(i,t,M),l=l.next}while(l!==n)}Bi(e,t,i);break;case 1:if(!Ft&&(ks(i,t),n=i.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch($){pt(i,t,$)}Bi(e,t,i);break;case 21:Bi(e,t,i);break;case 22:i.mode&1?(Ft=(n=Ft)||i.memoizedState!==null,Bi(e,t,i),Ft=n):Bi(e,t,i);break;default:Bi(e,t,i)}}function uc(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new uu),t.forEach(function(n){var l=bu.bind(null,e,n);i.has(n)||(i.add(n),n.then(l,l))})}}function ci(e,t){var i=t.deletions;if(i!==null)for(var n=0;n<i.length;n++){var l=i[n];try{var _=e,M=t,$=M;e:for(;$!==null;){switch($.tag){case 5:Tt=$.stateNode,ai=!1;break e;case 3:Tt=$.stateNode.containerInfo,ai=!0;break e;case 4:Tt=$.stateNode.containerInfo,ai=!0;break e}$=$.return}if(Tt===null)throw Error(ue(160));hc(_,M,l),Tt=null,ai=!1;var V=l.alternate;V!==null&&(V.return=null),l.return=null}catch(ce){pt(l,t,ce)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)dc(t,e),t=t.sibling}function dc(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ci(t,e),gi(e),n&4){try{en(3,e,e.return),jn(3,e)}catch(Oe){pt(e,e.return,Oe)}try{en(5,e,e.return)}catch(Oe){pt(e,e.return,Oe)}}break;case 1:ci(t,e),gi(e),n&512&&i!==null&&ks(i,i.return);break;case 5:if(ci(t,e),gi(e),n&512&&i!==null&&ks(i,i.return),e.flags&32){var l=e.stateNode;try{de(l,"")}catch(Oe){pt(e,e.return,Oe)}}if(n&4&&(l=e.stateNode,l!=null)){var _=e.memoizedProps,M=i!==null?i.memoizedProps:_,$=e.type,V=e.updateQueue;if(e.updateQueue=null,V!==null)try{$==="input"&&_.type==="radio"&&_.name!=null&&le(l,_),Ie($,M);var ce=Ie($,_);for(M=0;M<V.length;M+=2){var ge=V[M],ve=V[M+1];ge==="style"?xe(l,ve):ge==="dangerouslySetInnerHTML"?Be(l,ve):ge==="children"?de(l,ve):a(l,ge,ve,ce)}switch($){case"input":_e(l,_);break;case"textarea":re(l,_);break;case"select":var pe=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!_.multiple;var ze=_.value;ze!=null?ae(l,!!_.multiple,ze,!1):pe!==!!_.multiple&&(_.defaultValue!=null?ae(l,!!_.multiple,_.defaultValue,!0):ae(l,!!_.multiple,_.multiple?[]:"",!1))}l[Ws]=_}catch(Oe){pt(e,e.return,Oe)}}break;case 6:if(ci(t,e),gi(e),n&4){if(e.stateNode===null)throw Error(ue(162));l=e.stateNode,_=e.memoizedProps;try{l.nodeValue=_}catch(Oe){pt(e,e.return,Oe)}}break;case 3:if(ci(t,e),gi(e),n&4&&i!==null&&i.memoizedState.isDehydrated)try{Ns(t.containerInfo)}catch(Oe){pt(e,e.return,Oe)}break;case 4:ci(t,e),gi(e);break;case 13:ci(t,e),gi(e),l=e.child,l.flags&8192&&(_=l.memoizedState!==null,l.stateNode.isHidden=_,!_||l.alternate!==null&&l.alternate.memoizedState!==null||(Go=gt())),n&4&&uc(e);break;case 22:if(ge=i!==null&&i.memoizedState!==null,e.mode&1?(Ft=(ce=Ft)||ge,ci(t,e),Ft=ce):ci(t,e),gi(e),n&8192){if(ce=e.memoizedState!==null,(e.stateNode.isHidden=ce)&&!ge&&e.mode&1)for(Fe=e,ge=e.child;ge!==null;){for(ve=Fe=ge;Fe!==null;){switch(pe=Fe,ze=pe.child,pe.tag){case 0:case 11:case 14:case 15:en(4,pe,pe.return);break;case 1:ks(pe,pe.return);var Re=pe.stateNode;if(typeof Re.componentWillUnmount=="function"){n=pe,i=pe.return;try{t=n,Re.props=t.memoizedProps,Re.state=t.memoizedState,Re.componentWillUnmount()}catch(Oe){pt(n,i,Oe)}}break;case 5:ks(pe,pe.return);break;case 22:if(pe.memoizedState!==null){mc(ve);continue}}ze!==null?(ze.return=pe,Fe=ze):mc(ve)}ge=ge.sibling}e:for(ge=null,ve=e;;){if(ve.tag===5){if(ge===null){ge=ve;try{l=ve.stateNode,ce?(_=l.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):($=ve.stateNode,V=ve.memoizedProps.style,M=V!=null&&V.hasOwnProperty("display")?V.display:null,$.style.display=Se("display",M))}catch(Oe){pt(e,e.return,Oe)}}}else if(ve.tag===6){if(ge===null)try{ve.stateNode.nodeValue=ce?"":ve.memoizedProps}catch(Oe){pt(e,e.return,Oe)}}else if((ve.tag!==22&&ve.tag!==23||ve.memoizedState===null||ve===e)&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===e)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===e)break e;ge===ve&&(ge=null),ve=ve.return}ge===ve&&(ge=null),ve.sibling.return=ve.return,ve=ve.sibling}}break;case 19:ci(t,e),gi(e),n&4&&uc(e);break;case 21:break;default:ci(t,e),gi(e)}}function gi(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(ac(i)){var n=i;break e}i=i.return}throw Error(ue(160))}switch(n.tag){case 5:var l=n.stateNode;n.flags&32&&(de(l,""),n.flags&=-33);var _=cc(e);Fo(e,_,l);break;case 3:case 4:var M=n.stateNode.containerInfo,$=cc(e);Lo(e,$,M);break;default:throw Error(ue(161))}}catch(V){pt(e,e.return,V)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function fu(e,t,i){Fe=e,fc(e)}function fc(e,t,i){for(var n=(e.mode&1)!==0;Fe!==null;){var l=Fe,_=l.child;if(l.tag===22&&n){var M=l.memoizedState!==null||Xn;if(!M){var $=l.alternate,V=$!==null&&$.memoizedState!==null||Ft;$=Xn;var ce=Ft;if(Xn=M,(Ft=V)&&!ce)for(Fe=l;Fe!==null;)M=Fe,V=M.child,M.tag===22&&M.memoizedState!==null?pc(l):V!==null?(V.return=M,Fe=V):pc(l);for(;_!==null;)Fe=_,fc(_),_=_.sibling;Fe=l,Xn=$,Ft=ce}_c(e)}else l.subtreeFlags&8772&&_!==null?(_.return=l,Fe=_):_c(e)}}function _c(e){for(;Fe!==null;){var t=Fe;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ft||jn(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Ft)if(i===null)n.componentDidMount();else{var l=t.elementType===t.type?i.memoizedProps:li(t.type,i.memoizedProps);n.componentDidUpdate(l,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var _=t.updateQueue;_!==null&&ma(t,_,n);break;case 3:var M=t.updateQueue;if(M!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}ma(t,M,i)}break;case 5:var $=t.stateNode;if(i===null&&t.flags&4){i=$;var V=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&i.focus();break;case"img":V.src&&(i.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var ce=t.alternate;if(ce!==null){var ge=ce.memoizedState;if(ge!==null){var ve=ge.dehydrated;ve!==null&&Ns(ve)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ue(163))}Ft||t.flags&512&&No(t)}catch(pe){pt(t,t.return,pe)}}if(t===e){Fe=null;break}if(i=t.sibling,i!==null){i.return=t.return,Fe=i;break}Fe=t.return}}function mc(e){for(;Fe!==null;){var t=Fe;if(t===e){Fe=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Fe=i;break}Fe=t.return}}function pc(e){for(;Fe!==null;){var t=Fe;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{jn(4,t)}catch(V){pt(t,i,V)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var l=t.return;try{n.componentDidMount()}catch(V){pt(t,l,V)}}var _=t.return;try{No(t)}catch(V){pt(t,_,V)}break;case 5:var M=t.return;try{No(t)}catch(V){pt(t,M,V)}}}catch(V){pt(t,t.return,V)}if(t===e){Fe=null;break}var $=t.sibling;if($!==null){$.return=t.return,Fe=$;break}Fe=t.return}}var _u=Math.ceil,Zn=c.ReactCurrentDispatcher,Ro=c.ReactCurrentOwner,ti=c.ReactCurrentBatchConfig,Ze=0,Mt=null,yt=null,zt=0,Qt=0,Ss=Li(0),kt=0,tn=null,ji=0,er=0,Oo=0,sn=null,$t=null,Go=0,xs=1/0,Ci=null,tr=!1,Bo=null,Ii=null,ir=!1,qi=null,sr=0,nn=0,Io=null,nr=-1,rr=0;function Gt(){return Ze&6?gt():nr!==-1?nr:nr=gt()}function Di(e){return e.mode&1?Ze&2&&zt!==0?zt&-zt:Xh.transition!==null?(rr===0&&(rr=cl()),rr):(e=nt,e!==0||(e=window.event,e=e===void 0?16:vl(e.type)),e):1}function hi(e,t,i,n){if(50<nn)throw nn=0,Io=null,Error(ue(185));Es(e,i,n),(!(Ze&2)||e!==Mt)&&(e===Mt&&(!(Ze&2)&&(er|=i),kt===4&&$i(e,zt)),Wt(e,n),i===1&&Ze===0&&!(t.mode&1)&&(xs=gt()+500,Ln&&Ri()))}function Wt(e,t){var i=e.callbackNode;Xc(e,t);var n=_n(e,e===Mt?zt:0);if(n===0)i!==null&&ol(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(i!=null&&ol(i),t===1)e.tag===0?Yh(vc.bind(null,e)):sa(vc.bind(null,e)),Vh(function(){!(Ze&6)&&Ri()}),i=null;else{switch(hl(n)){case 1:i=gr;break;case 4:i=ll;break;case 16:i=hn;break;case 536870912:i=al;break;default:i=hn}i=Mc(i,gc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function gc(e,t){if(nr=-1,rr=0,Ze&6)throw Error(ue(327));var i=e.callbackNode;if(Cs()&&e.callbackNode!==i)return null;var n=_n(e,e===Mt?zt:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=or(e,n);else{t=n;var l=Ze;Ze|=2;var _=wc();(Mt!==e||zt!==t)&&(Ci=null,xs=gt()+500,es(e,t));do try{gu();break}catch($){yc(e,$)}while(!0);io(),Zn.current=_,Ze=l,yt!==null?t=0:(Mt=null,zt=0,t=kt)}if(t!==0){if(t===2&&(l=vr(e),l!==0&&(n=l,t=qo(e,l))),t===1)throw i=tn,es(e,0),$i(e,n),Wt(e,gt()),i;if(t===6)$i(e,n);else{if(l=e.current.alternate,!(n&30)&&!mu(l)&&(t=or(e,n),t===2&&(_=vr(e),_!==0&&(n=_,t=qo(e,_))),t===1))throw i=tn,es(e,0),$i(e,n),Wt(e,gt()),i;switch(e.finishedWork=l,e.finishedLanes=n,t){case 0:case 1:throw Error(ue(345));case 2:ts(e,$t,Ci);break;case 3:if($i(e,n),(n&130023424)===n&&(t=Go+500-gt(),10<t)){if(_n(e,0)!==0)break;if(l=e.suspendedLanes,(l&n)!==n){Gt(),e.pingedLanes|=e.suspendedLanes&l;break}e.timeoutHandle=Hr(ts.bind(null,e,$t,Ci),t);break}ts(e,$t,Ci);break;case 4:if($i(e,n),(n&4194240)===n)break;for(t=e.eventTimes,l=-1;0<n;){var M=31-ni(n);_=1<<M,M=t[M],M>l&&(l=M),n&=~_}if(n=l,n=gt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*_u(n/1960))-n,10<n){e.timeoutHandle=Hr(ts.bind(null,e,$t,Ci),n);break}ts(e,$t,Ci);break;case 5:ts(e,$t,Ci);break;default:throw Error(ue(329))}}}return Wt(e,gt()),e.callbackNode===i?gc.bind(null,e):null}function qo(e,t){var i=sn;return e.current.memoizedState.isDehydrated&&(es(e,t).flags|=256),e=or(e,t),e!==2&&(t=$t,$t=i,t!==null&&Do(t)),e}function Do(e){$t===null?$t=e:$t.push.apply($t,e)}function mu(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var n=0;n<i.length;n++){var l=i[n],_=l.getSnapshot;l=l.value;try{if(!ri(_(),l))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function $i(e,t){for(t&=~Oo,t&=~er,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ni(t),n=1<<i;e[i]=-1,t&=~n}}function vc(e){if(Ze&6)throw Error(ue(327));Cs();var t=_n(e,0);if(!(t&1))return Wt(e,gt()),null;var i=or(e,t);if(e.tag!==0&&i===2){var n=vr(e);n!==0&&(t=n,i=qo(e,n))}if(i===1)throw i=tn,es(e,0),$i(e,t),Wt(e,gt()),i;if(i===6)throw Error(ue(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ts(e,$t,Ci),Wt(e,gt()),null}function $o(e,t){var i=Ze;Ze|=1;try{return e(t)}finally{Ze=i,Ze===0&&(xs=gt()+500,Ln&&Ri())}}function Zi(e){qi!==null&&qi.tag===0&&!(Ze&6)&&Cs();var t=Ze;Ze|=1;var i=ti.transition,n=nt;try{if(ti.transition=null,nt=1,e)return e()}finally{nt=n,ti.transition=i,Ze=t,!(Ze&6)&&Ri()}}function Wo(){Qt=Ss.current,ut(Ss)}function es(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Hh(i)),yt!==null)for(i=yt.return;i!==null;){var n=i;switch(Xr(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&An();break;case 3:ws(),ut(It),ut(At),ho();break;case 5:ao(n);break;case 4:ws();break;case 13:ut(_t);break;case 19:ut(_t);break;case 10:so(n.type._context);break;case 22:case 23:Wo()}i=i.return}if(Mt=e,yt=e=Wi(e.current,null),zt=Qt=t,kt=0,tn=null,Oo=er=ji=0,$t=sn=null,Qi!==null){for(t=0;t<Qi.length;t++)if(i=Qi[t],n=i.interleaved,n!==null){i.interleaved=null;var l=n.next,_=i.pending;if(_!==null){var M=_.next;_.next=l,n.next=M}i.pending=n}Qi=null}return e}function yc(e,t){do{var i=yt;try{if(io(),Wn.current=Kn,Un){for(var n=mt.memoizedState;n!==null;){var l=n.queue;l!==null&&(l.pending=null),n=n.next}Un=!1}if(Xi=0,Ct=bt=mt=null,Qs=!1,Ys=0,Ro.current=null,i===null||i.return===null){kt=1,tn=t,yt=null;break}e:{var _=e,M=i.return,$=i,V=t;if(t=zt,$.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var ce=V,ge=$,ve=ge.tag;if(!(ge.mode&1)&&(ve===0||ve===11||ve===15)){var pe=ge.alternate;pe?(ge.updateQueue=pe.updateQueue,ge.memoizedState=pe.memoizedState,ge.lanes=pe.lanes):(ge.updateQueue=null,ge.memoizedState=null)}var ze=Ua(M);if(ze!==null){ze.flags&=-257,Ha(ze,M,$,_,t),ze.mode&1&&Wa(_,ce,t),t=ze,V=ce;var Re=t.updateQueue;if(Re===null){var Oe=new Set;Oe.add(V),t.updateQueue=Oe}else Re.add(V);break e}else{if(!(t&1)){Wa(_,ce,t),Uo();break e}V=Error(ue(426))}}else if(dt&&$.mode&1){var vt=Ua(M);if(vt!==null){!(vt.flags&65536)&&(vt.flags|=256),Ha(vt,M,$,_,t),eo(bs(V,$));break e}}_=V=bs(V,$),kt!==4&&(kt=2),sn===null?sn=[_]:sn.push(_),_=M;do{switch(_.tag){case 3:_.flags|=65536,t&=-t,_.lanes|=t;var ie=Da(_,V,t);_a(_,ie);break e;case 1:$=V;var X=_.type,oe=_.stateNode;if(!(_.flags&128)&&(typeof X.getDerivedStateFromError=="function"||oe!==null&&typeof oe.componentDidCatch=="function"&&(Ii===null||!Ii.has(oe)))){_.flags|=65536,t&=-t,_.lanes|=t;var ke=$a(_,$,t);_a(_,ke);break e}}_=_.return}while(_!==null)}kc(i)}catch(Ge){t=Ge,yt===i&&i!==null&&(yt=i=i.return);continue}break}while(!0)}function wc(){var e=Zn.current;return Zn.current=Kn,e===null?Kn:e}function Uo(){(kt===0||kt===3||kt===2)&&(kt=4),Mt===null||!(ji&268435455)&&!(er&268435455)||$i(Mt,zt)}function or(e,t){var i=Ze;Ze|=2;var n=wc();(Mt!==e||zt!==t)&&(Ci=null,es(e,t));do try{pu();break}catch(l){yc(e,l)}while(!0);if(io(),Ze=i,Zn.current=n,yt!==null)throw Error(ue(261));return Mt=null,zt=0,kt}function pu(){for(;yt!==null;)bc(yt)}function gu(){for(;yt!==null&&!$c();)bc(yt)}function bc(e){var t=Cc(e.alternate,e,Qt);e.memoizedProps=e.pendingProps,t===null?kc(e):yt=t,Ro.current=null}function kc(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=hu(i,t),i!==null){i.flags&=32767,yt=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kt=6,yt=null;return}}else if(i=cu(i,t,Qt),i!==null){yt=i;return}if(t=t.sibling,t!==null){yt=t;return}yt=t=e}while(t!==null);kt===0&&(kt=5)}function ts(e,t,i){var n=nt,l=ti.transition;try{ti.transition=null,nt=1,vu(e,t,i,n)}finally{ti.transition=l,nt=n}return null}function vu(e,t,i,n){do Cs();while(qi!==null);if(Ze&6)throw Error(ue(327));i=e.finishedWork;var l=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(ue(177));e.callbackNode=null,e.callbackPriority=0;var _=i.lanes|i.childLanes;if(jc(e,_),e===Mt&&(yt=Mt=null,zt=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||ir||(ir=!0,Mc(hn,function(){return Cs(),null})),_=(i.flags&15990)!==0,i.subtreeFlags&15990||_){_=ti.transition,ti.transition=null;var M=nt;nt=1;var $=Ze;Ze|=4,Ro.current=null,du(e,i),dc(i,e),Bh(Wr),gn=!!$r,Wr=$r=null,e.current=i,fu(i),Wc(),Ze=$,nt=M,ti.transition=_}else e.current=i;if(ir&&(ir=!1,qi=e,sr=l),_=e.pendingLanes,_===0&&(Ii=null),Vc(i.stateNode),Wt(e,gt()),t!==null)for(n=e.onRecoverableError,i=0;i<t.length;i++)l=t[i],n(l.value,{componentStack:l.stack,digest:l.digest});if(tr)throw tr=!1,e=Bo,Bo=null,e;return sr&1&&e.tag!==0&&Cs(),_=e.pendingLanes,_&1?e===Io?nn++:(nn=0,Io=e):nn=0,Ri(),null}function Cs(){if(qi!==null){var e=hl(sr),t=ti.transition,i=nt;try{if(ti.transition=null,nt=16>e?16:e,qi===null)var n=!1;else{if(e=qi,qi=null,sr=0,Ze&6)throw Error(ue(331));var l=Ze;for(Ze|=4,Fe=e.current;Fe!==null;){var _=Fe,M=_.child;if(Fe.flags&16){var $=_.deletions;if($!==null){for(var V=0;V<$.length;V++){var ce=$[V];for(Fe=ce;Fe!==null;){var ge=Fe;switch(ge.tag){case 0:case 11:case 15:en(8,ge,_)}var ve=ge.child;if(ve!==null)ve.return=ge,Fe=ve;else for(;Fe!==null;){ge=Fe;var pe=ge.sibling,ze=ge.return;if(lc(ge),ge===ce){Fe=null;break}if(pe!==null){pe.return=ze,Fe=pe;break}Fe=ze}}}var Re=_.alternate;if(Re!==null){var Oe=Re.child;if(Oe!==null){Re.child=null;do{var vt=Oe.sibling;Oe.sibling=null,Oe=vt}while(Oe!==null)}}Fe=_}}if(_.subtreeFlags&2064&&M!==null)M.return=_,Fe=M;else e:for(;Fe!==null;){if(_=Fe,_.flags&2048)switch(_.tag){case 0:case 11:case 15:en(9,_,_.return)}var ie=_.sibling;if(ie!==null){ie.return=_.return,Fe=ie;break e}Fe=_.return}}var X=e.current;for(Fe=X;Fe!==null;){M=Fe;var oe=M.child;if(M.subtreeFlags&2064&&oe!==null)oe.return=M,Fe=oe;else e:for(M=X;Fe!==null;){if($=Fe,$.flags&2048)try{switch($.tag){case 0:case 11:case 15:jn(9,$)}}catch(Ge){pt($,$.return,Ge)}if($===M){Fe=null;break e}var ke=$.sibling;if(ke!==null){ke.return=$.return,Fe=ke;break e}Fe=$.return}}if(Ze=l,Ri(),fi&&typeof fi.onPostCommitFiberRoot=="function")try{fi.onPostCommitFiberRoot(un,e)}catch{}n=!0}return n}finally{nt=i,ti.transition=t}}return!1}function Sc(e,t,i){t=bs(i,t),t=Da(e,t,1),e=Gi(e,t,1),t=Gt(),e!==null&&(Es(e,1,t),Wt(e,t))}function pt(e,t,i){if(e.tag===3)Sc(e,e,i);else for(;t!==null;){if(t.tag===3){Sc(t,e,i);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ii===null||!Ii.has(n))){e=bs(i,e),e=$a(t,e,1),t=Gi(t,e,1),e=Gt(),t!==null&&(Es(t,1,e),Wt(t,e));break}}t=t.return}}function yu(e,t,i){var n=e.pingCache;n!==null&&n.delete(t),t=Gt(),e.pingedLanes|=e.suspendedLanes&i,Mt===e&&(zt&i)===i&&(kt===4||kt===3&&(zt&130023424)===zt&&500>gt()-Go?es(e,0):Oo|=i),Wt(e,t)}function xc(e,t){t===0&&(e.mode&1?(t=fn,fn<<=1,!(fn&130023424)&&(fn=4194304)):t=1);var i=Gt();e=ki(e,t),e!==null&&(Es(e,t,i),Wt(e,i))}function wu(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),xc(e,i)}function bu(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,l=e.memoizedState;l!==null&&(i=l.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(ue(314))}n!==null&&n.delete(t),xc(e,i)}var Cc;Cc=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||It.current)Dt=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Dt=!1,au(e,t,i);Dt=!!(e.flags&131072)}else Dt=!1,dt&&t.flags&1048576&&na(t,Rn,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Yn(e,t),e=t.pendingProps;var l=fs(t,At.current);ys(t,i),l=_o(null,t,n,e,l,i);var _=mo();return t.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,qt(n)?(_=!0,Nn(t)):_=!1,t.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,oo(t),l.updater=Jn,t.stateNode=l,l._reactInternals=t,bo(t,n,e,i),t=Co(null,t,n,!0,_,i)):(t.tag=0,dt&&_&&Yr(t),Ot(null,t,l,i),t=t.child),t;case 16:n=t.elementType;e:{switch(Yn(e,t),e=t.pendingProps,l=n._init,n=l(n._payload),t.type=n,l=t.tag=Su(n),e=li(n,e),l){case 0:t=xo(null,t,n,e,i);break e;case 1:t=Xa(null,t,n,e,i);break e;case 11:t=Va(null,t,n,e,i);break e;case 14:t=Ka(null,t,n,li(n.type,e),i);break e}throw Error(ue(306,n,""))}return t;case 0:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:li(n,l),xo(e,t,n,l,i);case 1:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:li(n,l),Xa(e,t,n,l,i);case 3:e:{if(ja(t),e===null)throw Error(ue(387));n=t.pendingProps,_=t.memoizedState,l=_.element,fa(e,t),Dn(t,n,null,i);var M=t.memoizedState;if(n=M.element,_.isDehydrated)if(_={element:n,isDehydrated:!1,cache:M.cache,pendingSuspenseBoundaries:M.pendingSuspenseBoundaries,transitions:M.transitions},t.updateQueue.baseState=_,t.memoizedState=_,t.flags&256){l=bs(Error(ue(423)),t),t=Za(e,t,n,i,l);break e}else if(n!==l){l=bs(Error(ue(424)),t),t=Za(e,t,n,i,l);break e}else for(Jt=Ni(t.stateNode.containerInfo.firstChild),Kt=t,dt=!0,oi=null,i=ua(t,null,n,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(ps(),n===l){t=xi(e,t,i);break e}Ot(e,t,n,i)}t=t.child}return t;case 5:return pa(t),e===null&&Zr(t),n=t.type,l=t.pendingProps,_=e!==null?e.memoizedProps:null,M=l.children,Ur(n,l)?M=null:_!==null&&Ur(n,_)&&(t.flags|=32),Ya(e,t),Ot(e,t,M,i),t.child;case 6:return e===null&&Zr(t),null;case 13:return ec(e,t,i);case 4:return lo(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=gs(t,null,n,i):Ot(e,t,n,i),t.child;case 11:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:li(n,l),Va(e,t,n,l,i);case 7:return Ot(e,t,t.pendingProps,i),t.child;case 8:return Ot(e,t,t.pendingProps.children,i),t.child;case 12:return Ot(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,l=t.pendingProps,_=t.memoizedProps,M=l.value,at(Bn,n._currentValue),n._currentValue=M,_!==null)if(ri(_.value,M)){if(_.children===l.children&&!It.current){t=xi(e,t,i);break e}}else for(_=t.child,_!==null&&(_.return=t);_!==null;){var $=_.dependencies;if($!==null){M=_.child;for(var V=$.firstContext;V!==null;){if(V.context===n){if(_.tag===1){V=Si(-1,i&-i),V.tag=2;var ce=_.updateQueue;if(ce!==null){ce=ce.shared;var ge=ce.pending;ge===null?V.next=V:(V.next=ge.next,ge.next=V),ce.pending=V}}_.lanes|=i,V=_.alternate,V!==null&&(V.lanes|=i),no(_.return,i,t),$.lanes|=i;break}V=V.next}}else if(_.tag===10)M=_.type===t.type?null:_.child;else if(_.tag===18){if(M=_.return,M===null)throw Error(ue(341));M.lanes|=i,$=M.alternate,$!==null&&($.lanes|=i),no(M,i,t),M=_.sibling}else M=_.child;if(M!==null)M.return=_;else for(M=_;M!==null;){if(M===t){M=null;break}if(_=M.sibling,_!==null){_.return=M.return,M=_;break}M=M.return}_=M}Ot(e,t,l.children,i),t=t.child}return t;case 9:return l=t.type,n=t.pendingProps.children,ys(t,i),l=Zt(l),n=n(l),t.flags|=1,Ot(e,t,n,i),t.child;case 14:return n=t.type,l=li(n,t.pendingProps),l=li(n.type,l),Ka(e,t,n,l,i);case 15:return Ja(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:li(n,l),Yn(e,t),t.tag=1,qt(n)?(e=!0,Nn(t)):e=!1,ys(t,i),Ia(t,n,l),bo(t,n,l,i),Co(null,t,n,!0,e,i);case 19:return ic(e,t,i);case 22:return Qa(e,t,i)}throw Error(ue(156,t.tag))};function Mc(e,t){return cn(e,t)}function ku(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ii(e,t,i,n){return new ku(e,t,i,n)}function Ho(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Su(e){if(typeof e=="function")return Ho(e)?1:0;if(e!=null){if(e=e.$$typeof,e===b)return 11;if(e===T)return 14}return 2}function Wi(e,t){var i=e.alternate;return i===null?(i=ii(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function lr(e,t,i,n,l,_){var M=2;if(n=e,typeof e=="function")Ho(e)&&(M=1);else if(typeof e=="string")M=5;else e:switch(e){case k:return is(i.children,l,_,t);case f:M=8,l|=8;break;case u:return e=ii(12,i,t,l|2),e.elementType=u,e.lanes=_,e;case h:return e=ii(13,i,t,l),e.elementType=h,e.lanes=_,e;case F:return e=ii(19,i,t,l),e.elementType=F,e.lanes=_,e;case m:return ar(i,l,_,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case o:M=10;break e;case r:M=9;break e;case b:M=11;break e;case T:M=14;break e;case P:M=16,n=null;break e}throw Error(ue(130,e==null?e:typeof e,""))}return t=ii(M,i,t,l),t.elementType=e,t.type=n,t.lanes=_,t}function is(e,t,i,n){return e=ii(7,e,n,t),e.lanes=i,e}function ar(e,t,i,n){return e=ii(22,e,n,t),e.elementType=m,e.lanes=i,e.stateNode={isHidden:!1},e}function Vo(e,t,i){return e=ii(6,e,null,t),e.lanes=i,e}function Ko(e,t,i){return t=ii(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function xu(e,t,i,n,l){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yr(0),this.expirationTimes=yr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yr(0),this.identifierPrefix=n,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function Jo(e,t,i,n,l,_,M,$,V){return e=new xu(e,t,i,$,V),t===1?(t=1,_===!0&&(t|=8)):t=0,_=ii(3,null,null,t),e.current=_,_.stateNode=e,_.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},oo(_),e}function Cu(e,t,i){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:n==null?null:""+n,children:e,containerInfo:t,implementation:i}}function Ec(e){if(!e)return Fi;e=e._reactInternals;e:{if(Ht(e)!==e||e.tag!==1)throw Error(ue(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(qt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ue(171))}if(e.tag===1){var i=e.type;if(qt(i))return ta(e,i,t)}return t}function Pc(e,t,i,n,l,_,M,$,V){return e=Jo(i,n,!0,e,l,_,M,$,V),e.context=Ec(null),i=e.current,n=Gt(),l=Di(i),_=Si(n,l),_.callback=t??null,Gi(i,_,l),e.current.lanes=l,Es(e,l,n),Wt(e,n),e}function cr(e,t,i,n){var l=t.current,_=Gt(),M=Di(l);return i=Ec(i),t.context===null?t.context=i:t.pendingContext=i,t=Si(_,M),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Gi(l,t,M),e!==null&&(hi(e,l,M,_),qn(e,l,M)),M}function hr(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Tc(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Qo(e,t){Tc(e,t),(e=e.alternate)&&Tc(e,t)}function Mu(){return null}var zc=typeof reportError=="function"?reportError:function(e){console.error(e)};function Yo(e){this._internalRoot=e}ur.prototype.render=Yo.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ue(409));cr(e,t,null,null)},ur.prototype.unmount=Yo.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Zi(function(){cr(null,e,null,null)}),t[vi]=null}};function ur(e){this._internalRoot=e}ur.prototype.unstable_scheduleHydration=function(e){if(e){var t=fl();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Ti.length&&t!==0&&t<Ti[i].priority;i++);Ti.splice(i,0,e),i===0&&pl(e)}};function Xo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function dr(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Ac(){}function Eu(e,t,i,n,l){if(l){if(typeof n=="function"){var _=n;n=function(){var ce=hr(M);_.call(ce)}}var M=Pc(t,n,e,0,null,!1,!1,"",Ac);return e._reactRootContainer=M,e[vi]=M.current,Ds(e.nodeType===8?e.parentNode:e),Zi(),M}for(;l=e.lastChild;)e.removeChild(l);if(typeof n=="function"){var $=n;n=function(){var ce=hr(V);$.call(ce)}}var V=Jo(e,0,!1,null,null,!1,!1,"",Ac);return e._reactRootContainer=V,e[vi]=V.current,Ds(e.nodeType===8?e.parentNode:e),Zi(function(){cr(t,V,i,n)}),V}function fr(e,t,i,n,l){var _=i._reactRootContainer;if(_){var M=_;if(typeof l=="function"){var $=l;l=function(){var V=hr(M);$.call(V)}}cr(t,M,e,l)}else M=Eu(i,t,e,l,n);return hr(M)}ul=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=Ms(t.pendingLanes);i!==0&&(wr(t,i|1),Wt(t,gt()),!(Ze&6)&&(xs=gt()+500,Ri()))}break;case 13:Zi(function(){var n=ki(e,1);if(n!==null){var l=Gt();hi(n,e,1,l)}}),Qo(e,1)}},br=function(e){if(e.tag===13){var t=ki(e,134217728);if(t!==null){var i=Gt();hi(t,e,134217728,i)}Qo(e,134217728)}},dl=function(e){if(e.tag===13){var t=Di(e),i=ki(e,t);if(i!==null){var n=Gt();hi(i,e,t,n)}Qo(e,t)}},fl=function(){return nt},_l=function(e,t){var i=nt;try{return nt=e,t()}finally{nt=i}},ft=function(e,t,i){switch(t){case"input":if(_e(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var l=zn(n);if(!l)throw Error(ue(90));J(n),_e(n,l)}}}break;case"textarea":re(e,i);break;case"select":t=i.value,t!=null&&ae(e,!!i.multiple,t,!1)}},Te=$o,ct=Zi;var Pu={usingClientEntryPoint:!1,Events:[Us,us,zn,ln,Le,$o]},rn={findFiberByHostInstance:Hi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Tu={bundleType:rn.bundleType,version:rn.version,rendererPackageName:rn.rendererPackageName,rendererConfig:rn.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=xt(e),e===null?null:e.stateNode},findFiberByHostInstance:rn.findFiberByHostInstance||Mu,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _r=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_r.isDisabled&&_r.supportsFiber)try{un=_r.inject(Tu),fi=_r}catch{}}return Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pu,Ut.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xo(t))throw Error(ue(200));return Cu(e,t,null,i)},Ut.createRoot=function(e,t){if(!Xo(e))throw Error(ue(299));var i=!1,n="",l=zc;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(l=t.onRecoverableError)),t=Jo(e,1,!1,null,null,i,!1,n,l),e[vi]=t.current,Ds(e.nodeType===8?e.parentNode:e),new Yo(t)},Ut.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ue(188)):(e=Object.keys(e).join(","),Error(ue(268,e)));return e=xt(t),e=e===null?null:e.stateNode,e},Ut.flushSync=function(e){return Zi(e)},Ut.hydrate=function(e,t,i){if(!dr(t))throw Error(ue(200));return fr(null,e,t,!0,i)},Ut.hydrateRoot=function(e,t,i){if(!Xo(e))throw Error(ue(405));var n=i!=null&&i.hydratedSources||null,l=!1,_="",M=zc;if(i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(M=i.onRecoverableError)),t=Pc(t,null,e,1,i??null,l,!1,_,M),e[vi]=t.current,Ds(e),n)for(e=0;e<n.length;e++)i=n[e],l=i._getVersion,l=l(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,l]:t.mutableSourceEagerHydrationData.push(i,l);return new ur(t)},Ut.render=function(e,t,i){if(!dr(t))throw Error(ue(200));return fr(null,e,t,!1,i)},Ut.unmountComponentAtNode=function(e){if(!dr(e))throw Error(ue(40));return e._reactRootContainer?(Zi(function(){fr(null,null,e,!1,function(){e._reactRootContainer=null,e[vi]=null})}),!0):!1},Ut.unstable_batchedUpdates=$o,Ut.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!dr(i))throw Error(ue(200));if(e==null||e._reactInternals===void 0)throw Error(ue(38));return fr(e,t,i,!1,n)},Ut.version="18.3.1-next-f1338f8080-20240426",Ut}var Ic;function Gu(){if(Ic)return el.exports;Ic=1;function We(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(We)}catch(it){console.error(it)}}return We(),el.exports=Ou(),el.exports}var qc;function Bu(){if(qc)return mr;qc=1;var We=Gu();return mr.createRoot=We.createRoot,mr.hydrateRoot=We.hydrateRoot,mr}var Iu=Bu(),sl={exports:{}};/*!
 * Copyright (C)  Online-Go.com
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */var Dc;function qu(){return Dc||(Dc=1,function(We,it){(function(St,Qe){We.exports=Qe()})(self,()=>(()=>{var ue={"./node_modules/eventemitter3/index.js":ye=>{var A=Object.prototype.hasOwnProperty,G="~";function q(){}Object.create&&(q.prototype=Object.create(null),new q().__proto__||(G=!1));function S(R,O,p){this.fn=R,this.context=O,this.once=p||!1}function L(R,O,p,v,s){if(typeof p!="function")throw new TypeError("The listener must be a function");var a=new S(p,v||R,s),c=G?G+O:O;return R._events[c]?R._events[c].fn?R._events[c]=[R._events[c],a]:R._events[c].push(a):(R._events[c]=a,R._eventsCount++),R}function C(R,O){--R._eventsCount===0?R._events=new q:delete R._events[O]}function E(){this._events=new q,this._eventsCount=0}E.prototype.eventNames=function(){var O=[],p,v;if(this._eventsCount===0)return O;for(v in p=this._events)A.call(p,v)&&O.push(G?v.slice(1):v);return Object.getOwnPropertySymbols?O.concat(Object.getOwnPropertySymbols(p)):O},E.prototype.listeners=function(O){var p=G?G+O:O,v=this._events[p];if(!v)return[];if(v.fn)return[v.fn];for(var s=0,a=v.length,c=new Array(a);s<a;s++)c[s]=v[s].fn;return c},E.prototype.listenerCount=function(O){var p=G?G+O:O,v=this._events[p];return v?v.fn?1:v.length:0},E.prototype.emit=function(O,p,v,s,a,c){var d=G?G+O:O;if(!this._events[d])return!1;var g=this._events[d],k=arguments.length,f,u;if(g.fn){switch(g.once&&this.removeListener(O,g.fn,void 0,!0),k){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,p),!0;case 3:return g.fn.call(g.context,p,v),!0;case 4:return g.fn.call(g.context,p,v,s),!0;case 5:return g.fn.call(g.context,p,v,s,a),!0;case 6:return g.fn.call(g.context,p,v,s,a,c),!0}for(u=1,f=new Array(k-1);u<k;u++)f[u-1]=arguments[u];g.fn.apply(g.context,f)}else{var o=g.length,r;for(u=0;u<o;u++)switch(g[u].once&&this.removeListener(O,g[u].fn,void 0,!0),k){case 1:g[u].fn.call(g[u].context);break;case 2:g[u].fn.call(g[u].context,p);break;case 3:g[u].fn.call(g[u].context,p,v);break;case 4:g[u].fn.call(g[u].context,p,v,s);break;default:if(!f)for(r=1,f=new Array(k-1);r<k;r++)f[r-1]=arguments[r];g[u].fn.apply(g[u].context,f)}}return!0},E.prototype.on=function(O,p,v){return L(this,O,p,v,!1)},E.prototype.once=function(O,p,v){return L(this,O,p,v,!0)},E.prototype.removeListener=function(O,p,v,s){var a=G?G+O:O;if(!this._events[a])return this;if(!p)return C(this,a),this;var c=this._events[a];if(c.fn)c.fn===p&&(!s||c.once)&&(!v||c.context===v)&&C(this,a);else{for(var d=0,g=[],k=c.length;d<k;d++)(c[d].fn!==p||s&&!c[d].once||v&&c[d].context!==v)&&g.push(c[d]);g.length?this._events[a]=g.length===1?g[0]:g:C(this,a)}return this},E.prototype.removeAllListeners=function(O){var p;return O?(p=G?G+O:O,this._events[p]&&C(this,p)):(this._events=new q,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=G,E.EventEmitter=E,ye.exports=E},"./assets/img/anime_black.svg":ye=>{ye.exports='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 112.55465 112.554658" version="1.1"><defs><radialGradient id="radial0" gradientUnits="userSpaceOnUse" cx="48.810944" cy="105.224472" fx="48.810944" fy="105.224472" r="14.537265" gradientTransform="matrix(2.53466,4.185893,-5.628051,3.407921,539.576526,-505.497666)"><stop offset="0" style="stop-color:rgb(18.039216%,18.039216%,18.039216%);stop-opacity:1;"></stop><stop offset="1" style="stop-color:rgb(3.137255%,3.137255%,3.137255%);stop-opacity:1;"></stop></radialGradient><clipPath id="clip1"><path d="M 1 1 L 106 1 L 106 99 L 1 99 Z M 1 1 "></path></clipPath><clipPath id="clip2"><path d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path></clipPath><filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%"><feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"></feColorMatrix></filter><mask id="mask0"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.706796;stroke:none;"></rect></g></mask><radialGradient id="radial1" gradientUnits="userSpaceOnUse" cx="-9.723866" cy="7.521198" fx="-9.723866" fy="7.521198" r="2.861191" gradientTransform="matrix(-1.420113,-4.713939,4.869265,-1.361286,-9.569667,-5.456746)"><stop offset="0" style="stop-color:rgb(50.196081%,50.196081%,50.196081%);stop-opacity:1;"></stop><stop offset="0.813946" style="stop-color:rgb(50.196081%,50.196081%,50.196081%);stop-opacity:0.396078;"></stop><stop offset="1" style="stop-color:rgb(50.196081%,50.196081%,50.196081%);stop-opacity:0;"></stop></radialGradient><clipPath id="clip3"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface5" clip-path="url(#clip3)"><path style=" stroke:none;fill-rule:nonzero;fill:url(#radial1);" d="M 36.796875 16.65625 C 44.492188 14.503906 52.550781 18.796875 54.792969 26.246094 C 57.039062 33.695312 52.621094 41.480469 44.925781 43.628906 C 37.230469 45.78125 29.175781 41.484375 26.929688 34.039062 C 24.6875 26.589844 29.105469 18.804688 36.796875 16.65625 Z M 36.796875 16.65625 "></path></g><mask id="mask1"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.826;stroke:none;"></rect></g></mask><radialGradient id="radial2" gradientUnits="userSpaceOnUse" cx="18.733471" cy="17.819284" fx="18.733471" fy="17.819284" r="14.537265" gradientTransform="matrix(3.779528,0,0,3.779528,-14.526343,-11.071147)"><stop offset="0" style="stop-color:rgb(97.647059%,97.647059%,97.647059%);stop-opacity:0;"></stop><stop offset="0.874109" style="stop-color:rgb(92.941177%,85.09804%,58.823532%);stop-opacity:0;"></stop><stop offset="0.954745" style="stop-color:rgb(88.235295%,72.941178%,19.607843%);stop-opacity:0.184314;"></stop><stop offset="1" style="stop-color:rgb(76.862746%,53.333336%,0%);stop-opacity:0.32549;"></stop></radialGradient><clipPath id="clip4"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface8" clip-path="url(#clip4)"><path style=" stroke:none;fill-rule:nonzero;fill:url(#radial2);" d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path></g><mask id="mask2"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.601;stroke:none;"></rect></g></mask><clipPath id="clip5"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface11" clip-path="url(#clip5)"><path style="fill:none;stroke-width:0.705556;stroke-linecap:round;stroke-linejoin:round;stroke:rgb(0%,0%,0%);stroke-opacity:1;stroke-miterlimit:4;" d="M 33.27109 17.819288 C 33.27109 25.847739 26.761926 32.356902 18.733476 32.356902 C 10.705025 32.356902 4.195862 25.847739 4.195862 17.819288 C 4.195862 9.790838 10.705025 3.281674 18.733476 3.281674 C 26.761926 3.281674 33.27109 9.790838 33.27109 17.819288 Z M 33.27109 17.819288 " transform="matrix(3.779528,0,0,3.779528,-14.526343,-11.071147)"></path></g><mask id="mask3"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.787781;stroke:none;"></rect></g></mask><clipPath id="clip6"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface14" clip-path="url(#clip6)"><path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:0.00392157;" d="M 0 0 L 112.554688 0 L 112.554688 112.554688 L 0 112.554688 Z M 0 0 "></path></g></defs><g id="surface1"><path style=" stroke:none;fill-rule:nonzero;fill:url(#radial0);" d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path><g clip-path="url(#clip1)" clip-rule="nonzero"><g clip-path="url(#clip2)" clip-rule="nonzero"><path style=" stroke:none;fill-rule:nonzero;fill:rgb(20%,20%,20%);fill-opacity:1;" d="M 105.859375 43.207031 C 105.859375 73.550781 81.257812 98.148438 50.914062 98.148438 C 20.570312 98.148438 -4.027344 73.550781 -4.027344 43.207031 C -4.027344 12.859375 20.570312 -11.738281 50.914062 -11.738281 C 81.257812 -11.738281 105.859375 12.859375 105.859375 43.207031 Z M 105.859375 43.207031 "></path></g></g><use xlink:href="#surface5" mask="url(#mask0)"></use><use xlink:href="#surface8" mask="url(#mask1)"></use><use xlink:href="#surface11" mask="url(#mask2)"></use><use xlink:href="#surface14" mask="url(#mask3)"></use></g></svg>'},"./assets/img/anime_white.svg":ye=>{ye.exports='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 112.55465 112.554658" version="1.1"><defs><radialGradient id="radial0" gradientUnits="userSpaceOnUse" cx="48.810944" cy="105.224472" fx="48.810944" fy="105.224472" r="14.537265" gradientTransform="matrix(2.53466,4.185893,-5.628051,3.407921,539.576526,-505.497666)"><stop offset="0" style="stop-color:rgb(90.588236%,90.588236%,90.588236%);stop-opacity:1;"></stop><stop offset="0.813946" style="stop-color:rgb(79.607844%,79.607844%,79.607844%);stop-opacity:1;"></stop><stop offset="1" style="stop-color:rgb(28.627452%,28.627452%,28.627452%);stop-opacity:1;"></stop></radialGradient><clipPath id="clip1"><path d="M 1 1 L 107 1 L 107 96 L 1 96 Z M 1 1 "></path></clipPath><clipPath id="clip2"><path d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path></clipPath><filter id="alpha" filterUnits="objectBoundingBox" x="0%" y="0%" width="100%" height="100%"><feColorMatrix type="matrix" in="SourceGraphic" values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 1 0"></feColorMatrix></filter><mask id="mask0"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.826;stroke:none;"></rect></g></mask><radialGradient id="radial1" gradientUnits="userSpaceOnUse" cx="18.733471" cy="17.819284" fx="18.733471" fy="17.819284" r="14.537265" gradientTransform="matrix(3.779528,0,0,3.779528,-14.526343,-11.071147)"><stop offset="0" style="stop-color:rgb(97.647059%,97.647059%,97.647059%);stop-opacity:0;"></stop><stop offset="0.874109" style="stop-color:rgb(92.941177%,85.09804%,58.823532%);stop-opacity:0;"></stop><stop offset="0.954745" style="stop-color:rgb(88.235295%,72.941178%,19.607843%);stop-opacity:0.184314;"></stop><stop offset="1" style="stop-color:rgb(76.862746%,53.333336%,0%);stop-opacity:0.32549;"></stop></radialGradient><clipPath id="clip3"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface5" clip-path="url(#clip3)"><path style=" stroke:none;fill-rule:nonzero;fill:url(#radial1);" d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path></g><mask id="mask1"><g filter="url(#alpha)"><rect x="0" y="0" width="112.55465" height="112.554658" style="fill:rgb(0%,0%,0%);fill-opacity:0.601;stroke:none;"></rect></g></mask><clipPath id="clip4"><rect x="0" y="0" width="113" height="113"></rect></clipPath><g id="surface8" clip-path="url(#clip4)"><path style="fill:none;stroke-width:0.705556;stroke-linecap:round;stroke-linejoin:round;stroke:rgb(0%,0%,0%);stroke-opacity:1;stroke-miterlimit:4;" d="M 33.27109 17.819288 C 33.27109 25.847739 26.761926 32.356902 18.733476 32.356902 C 10.705025 32.356902 4.195862 25.847739 4.195862 17.819288 C 4.195862 9.790838 10.705025 3.281674 18.733476 3.281674 C 26.761926 3.281674 33.27109 9.790838 33.27109 17.819288 Z M 33.27109 17.819288 " transform="matrix(3.779528,0,0,3.779528,-14.526343,-11.071147)"></path></g></defs><g id="surface1"><path style=" stroke:none;fill-rule:nonzero;fill:url(#radial0);" d="M 111.222656 56.277344 C 111.222656 86.621094 86.621094 111.222656 56.277344 111.222656 C 25.933594 111.222656 1.332031 86.621094 1.332031 56.277344 C 1.332031 25.933594 25.933594 1.332031 56.277344 1.332031 C 86.621094 1.332031 111.222656 25.933594 111.222656 56.277344 Z M 111.222656 56.277344 "></path><g clip-path="url(#clip1)" clip-rule="nonzero"><g clip-path="url(#clip2)" clip-rule="nonzero"><path style=" stroke:none;fill-rule:nonzero;fill:rgb(97.647059%,97.647059%,97.647059%);fill-opacity:1;" d="M 106.261719 40.789062 C 106.261719 71.132812 81.664062 95.734375 51.316406 95.734375 C 20.972656 95.734375 -3.625 71.132812 -3.625 40.789062 C -3.625 10.445312 20.972656 -14.15625 51.316406 -14.15625 C 81.664062 -14.15625 106.261719 10.445312 106.261719 40.789062 Z M 106.261719 40.789062 "></path></g></g><use xlink:href="#surface5" mask="url(#mask0)"></use><path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 56.304688 2.796875 C 27.097656 2.796875 3.417969 27.417969 3.417969 57.792969 C 3.421875 66.554688 5.4375 75.191406 9.300781 82.976562 C 6.59375 76.273438 6.175781 68.472656 6.160156 61.199219 C 4.53125 29.988281 25.882812 5.273438 55.335938 5.398438 C 75.542969 3.296875 96.640625 20.625 105.058594 36.609375 C 96.847656 16.148438 77.625 2.820312 56.304688 2.796875 Z M 56.304688 2.796875 "></path><use xlink:href="#surface8" mask="url(#mask1)"></use></g></svg>'},"./src/Goban/CanvasRenderer.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanCanvas=void 0;const q=G("./src/engine/formats/JGOF.ts"),S=G("./src/engine/MoveTree.ts"),L=G("./src/Goban/themes/index.ts"),C=G("./src/Goban/canvas_utils.ts"),E=G("./src/engine/translate.ts"),R=G("./src/engine/messages.ts"),O=G("./src/engine/util/index.ts"),p=G("./src/Goban/callbacks.ts"),v=G("./src/Goban/Goban.ts"),s={black:{},white:{}},a="#ff69b4";class c extends v.Goban{constructor(f,u){var o;super(f,u),this.__set_board_height=-1,this.__set_board_width=-1,this.ready_to_draw=!1,this.last_move_opacity=1,this.__borders_initialized=!1,this.autoplaying_puzzle_move=!1,this.byoyomi_label="",this.last_label_position={i:NaN,j:NaN},this.metrics={width:NaN,height:NaN,mid:NaN,offset:NaN},this.drawing_enabled=!0,this.themes={board:"Plain",black:"Plain",white:"Plain","removal-graphic":"x","removal-scale":1},this.theme_black_stones=[],this.theme_black_text_color=a,this.theme_blank_text_color=a,this.theme_faded_line_color=a,this.theme_faded_star_color=a,this.theme_line_color="",this.theme_star_color="",this.theme_stone_radius=10,this.theme_white_stones=[],this.theme_white_text_color=a,f.board_div?this.parent=f.board_div:(this.no_display=!0,this.parent=document.createElement("div")),this.title_div=f.title_div,this.board=(0,C.createDeviceScaledCanvas)(10,10),this.board.setAttribute("id","board-canvas"),this.board.className="StoneLayer",this.last_move_opacity=(o=f.last_move_opacity)!==null&&o!==void 0?o:1;const r=this.board.getContext("2d",{willReadFrequently:!0});if(r)this.ctx=r;else throw new Error("Failed to obtain drawing context for board");this.parent.appendChild(this.board),this.bindPointerBindings(this.board),this.move_tree_container=f.move_tree_container,this.handleShiftKey=F=>{try{F.shiftKey!==this.shift_key_is_down&&(this.shift_key_is_down=F.shiftKey,this.last_hover_square&&this.__drawSquare(this.last_hover_square.x,this.last_hover_square.y))}catch(T){console.error(T)}},window.addEventListener("keydown",this.handleShiftKey),window.addEventListener("keyup",this.handleShiftKey),this.setTheme(this.getSelectedThemes(),!0);let b=!0;const h=this.watchSelectedThemes(F=>{var T,P,m;this.engine&&(F.black==="Custom"||F.white==="Custom"||F.board,(T=s.black)===null||T===void 0||delete T.Custom,(P=s.white)===null||P===void 0||delete P.Custom,(m=s.board)===null||m===void 0||delete m.Custom,this.setTheme(F,!!b),b=!1)});this.on("destroy",()=>h.remove()),this.engine=this.post_config_constructor(),this.emit("engine.updated",this.engine),this.ready_to_draw=!0,this.redraw(!0)}setLastMoveOpacity(f){this.last_move_opacity=f}enablePen(){this.attachPenCanvas()}disablePen(){this.detachPenCanvas()}destroy(){super.destroy(),this.board&&this.board.parentNode&&this.board.parentNode.removeChild(this.board),delete this.board,delete this.ctx,this.detachPenCanvas(),this.detachShadowLayer(),this.message_timeout&&(clearTimeout(this.message_timeout),delete this.message_timeout),window.removeEventListener("keydown",this.handleShiftKey),window.removeEventListener("keyup",this.handleShiftKey),this.theme_black_stones=[],this.theme_white_stones=[],delete this.theme_board,delete this.theme_black,delete this.theme_white,delete this.message_div,delete this.message_td,delete this.message_text,delete this.move_tree_container,delete this.move_tree_inner_container,delete this.move_tree_canvas,delete this.title_div}detachShadowLayer(){this.shadow_layer&&(this.shadow_layer.parentNode&&this.shadow_layer.parentNode.removeChild(this.shadow_layer),delete this.shadow_layer,delete this.shadow_ctx)}attachShadowLayer(){if(!this.shadow_layer&&this.parent){this.shadow_layer=(0,C.createDeviceScaledCanvas)(this.metrics.width,this.metrics.height),this.shadow_layer.setAttribute("id","shadow-canvas"),this.shadow_layer.className="ShadowLayer";try{this.parent.insertBefore(this.shadow_layer,this.board)}catch(u){console.warn("Error inserting shadow layer before board"),console.warn(u);try{this.parent.appendChild(this.shadow_layer)}catch(o){console.error(o)}}const f=this.shadow_layer.getContext("2d",{willReadFrequently:!0});if(f)this.shadow_ctx=f;else{console.error(new Error("Failed to obtain shadow layer drawing context"));return}this.bindPointerBindings(this.shadow_layer)}}detachPenCanvas(){this.pen_layer&&(this.pen_layer.parentNode&&this.pen_layer.parentNode.removeChild(this.pen_layer),delete this.pen_layer,delete this.pen_ctx)}attachPenCanvas(){if(!this.pen_layer){this.pen_layer=(0,C.createDeviceScaledCanvas)(this.metrics.width,this.metrics.height),this.pen_layer.setAttribute("id","pen-canvas"),this.pen_layer.className="PenLayer",this.parent.appendChild(this.pen_layer);const f=this.pen_layer.getContext("2d",{willReadFrequently:!0});if(f)this.pen_ctx=f;else throw new Error("Failed to obtain pen drawing context");this.bindPointerBindings(this.pen_layer)}}bindPointerBindings(f){if(!this.interactive||f.getAttribute("data-pointers-bound")==="true")return;f.setAttribute("data-pointers-bound","true");let u=!1,o=this.xy2ij(0,0),r=0;const b=(B,j)=>{const ee=performance.now()-r;try{if(!u)return;let me=!1;if(B instanceof MouseEvent&&B.button===2&&(me=!0,B.preventDefault()),u=!1,this.scoring_mode){const Z=(0,C.getRelativeEventPosition)(B),se=this.xy2ij(Z.x,Z.y);se.i>=0&&se.i<this.width&&se.j>=0&&se.j<this.height&&(this.score_estimator&&this.score_estimator.handleClick(se.i,se.j,B.ctrlKey||B.metaKey||B.altKey||B.shiftKey,ee),this.emit("update"));return}if(B.ctrlKey||B.metaKey||B.altKey){try{const Z=(0,C.getRelativeEventPosition)(B),se=this.xy2ij(Z.x,Z.y);p.callbacks.addCoordinatesToChatInput&&p.callbacks.addCoordinatesToChatInput(this.engine.prettyCoordinates(se.i,se.j))}catch(Z){console.error(Z)}return}if(!(this.mode==="analyze"&&this.analyze_tool==="draw")){if(!(this.mode==="analyze"&&this.analyze_tool==="score"))if(this.mode==="analyze"&&this.analyze_tool==="removal")this.onAnalysisToggleStoneRemoval(B);else{const Z=(0,C.getRelativeEventPosition)(B),se=this.xy2ij(Z.x,Z.y);if(!j)o=se;else if(o.i!==se.i||o.j!==se.j){this.onMouseOut(B);return}this.onTap(B,j,me,ee),this.onMouseOut(B)}}}catch(me){console.error(me)}},h=B=>{r=performance.now();try{if(u=!0,this.mode==="analyze"&&this.analyze_tool==="draw")this.onPenStart(B);else if(this.mode==="analyze"&&this.analyze_tool==="label"){if(B.shiftKey&&this.analyze_subtool==="letters"){const j=prompt((0,E._)("Enter the label you want to add to the board"),"");if(j){this.label_character=j.substring(0,3),u=!1;return}}this.onLabelingStart(B)}else this.mode==="analyze"&&this.analyze_tool==="score"?this.onAnalysisScoringStart(B):this.mode==="analyze"&&this.analyze_tool}catch(j){console.error(j)}},F=B=>{try{if(this.mode==="analyze"&&this.analyze_tool==="draw"){if(!u)return;this.onPenMove(B)}else u&&this.mode==="analyze"&&this.analyze_tool==="label"?this.onLabelingMove(B):u&&this.mode==="analyze"&&this.analyze_tool==="score"?this.onAnalysisScoringMove(B):u&&this.mode==="analyze"&&this.analyze_tool==="removal"||this.onMouseMove(B)}catch(j){console.error(j)}},T=B=>{try{u=!1,this.onMouseOut(B)}catch(j){console.error(j)}};let P=0;f.addEventListener("click",B=>(P||(u=!0,b(B,!1)),B.preventDefault(),!1)),f.addEventListener("dblclick",B=>(P||(u=!0,b(B,!0)),B.preventDefault(),!1)),f.addEventListener("mousedown",B=>(P||h(B),B.preventDefault(),!1)),f.addEventListener("mousemove",B=>(P||F(B),B.preventDefault(),!1)),f.addEventListener("mouseout",B=>(P?B.preventDefault():T(B),!1)),f.addEventListener("contextmenu",B=>(P?B.preventDefault():b(B,!1),!1)),f.addEventListener("focus",B=>(B.preventDefault(),!1));let m=0,w=0,y=0,N=0;const x=B=>{try{P&&clearTimeout(P),P=setTimeout(()=>{P=0},5e3),(0,C.getRelativeEventPosition)(B),B.target===f?(m=B.touches[0].clientX,w=B.touches[0].clientY,y=B.touches[0].clientX,N=B.touches[0].clientY,h(B)):u&&T(B)}catch(j){console.error(j)}},z=B=>{try{const j=document.activeElement;B.target===f&&j&&j instanceof HTMLElement&&j.tagName.toLowerCase()==="input"&&j.blur(),P&&clearTimeout(P),P=setTimeout(()=>{P=0},5e3),B.target===f?Math.sqrt((y-m)*(y-m)+(N-w)*(N-w))>10?T(B):b(B,!1):u&&T(B)}catch(j){console.error(j)}},U=B=>{try{if(P&&clearTimeout(P),P=setTimeout(()=>{P=0},5e3),(0,C.getRelativeEventPosition)(B),B.target===f){if(m=B.touches[0].clientX,w=B.touches[0].clientY,this.mode==="analyze"&&this.analyze_tool==="draw")return F(B),B.preventDefault(),!1}else u&&T(B)}catch(j){console.error(j)}};document.addEventListener("touchstart",x),document.addEventListener("touchend",z),document.addEventListener("touchmove",U);const D=()=>{document.removeEventListener("touchstart",x),document.removeEventListener("touchend",z),document.removeEventListener("touchmove",U),this.off("destroy",D)};this.on("destroy",D)}clearAnalysisDrawing(){this.pen_marks=[],this.pen_ctx&&this.pen_ctx.clearRect(0,0,this.metrics.width,this.metrics.height)}xy2pen(f,u){const o=this.draw_left_labels?0:1,r=this.draw_top_labels?0:1;return[Math.round((f/this.square_size+o)*64),Math.round((u/this.square_size+r)*64)]}pen2xy(f,u){const o=this.draw_left_labels?0:1,r=this.draw_top_labels?0:1;return[(f/64-o)*this.square_size,(u/64-r)*this.square_size]}setPenStyle(f){if(!this.pen_ctx)throw new Error("setPenStyle called with null pen_ctx");this.pen_ctx.strokeStyle=f,this.pen_ctx.lineWidth=Math.max(1,Math.round(this.square_size*.1)),this.pen_ctx.lineCap="round"}onPenStart(f){this.attachPenCanvas();const u=(0,C.getRelativeEventPosition)(f);this.last_pen_position=this.xy2pen(u.x,u.y),this.current_pen_mark={color:this.analyze_subtool,points:this.xy2pen(u.x,u.y)},this.pen_marks.push(this.current_pen_mark),this.setPenStyle(this.analyze_subtool),this.syncReviewMove({pen:this.analyze_subtool,pp:this.xy2pen(u.x,u.y)})}onPenMove(f){if(!this.pen_ctx)throw new Error("onPenMove called with null pen_ctx");if(!this.last_pen_position||!this.current_pen_mark)throw new Error("onPenMove called with invalid last pen position or current pen mark");const u=(0,C.getRelativeEventPosition)(f),o=this.last_pen_position,r=this.pen2xy(o[0],o[1]),b=this.xy2pen(u.x,u.y),h=this.pen2xy(b[0],b[1]),F=b[0]-o[0],T=b[1]-o[1];F*F+T*T<64||(this.last_pen_position=b,this.current_pen_mark.points.push(F),this.current_pen_mark.points.push(T),this.pen_ctx.beginPath(),this.pen_ctx.moveTo(r[0],r[1]),this.pen_ctx.lineTo(h[0],h[1]),this.pen_ctx.stroke(),this.syncReviewMove({pp:[F,T]}))}drawPenMarks(f){if(!(this.review_id&&!this.done_loading_review)&&f.length){if(this.attachPenCanvas(),!this.pen_ctx)throw new Error("onPenMove called with null pen_ctx");this.clearAnalysisDrawing(),this.pen_marks=f;for(let u=0;u<f.length;++u){const o=f[u];this.setPenStyle(o.color);let r=o.points[0],b=o.points[1];this.pen_ctx.beginPath();const h=this.pen2xy(r,b);this.pen_ctx.moveTo(h[0],h[1]);for(let F=2;F<o.points.length;F+=2){r+=o.points[F],b+=o.points[F+1];const T=this.pen2xy(r,b);this.pen_ctx.lineTo(T[0],T[1])}this.pen_ctx.stroke()}}}onTap(f,u,o,r){if(!(this.stone_placement_enabled&&(this.player_id||!this.engine.players.black.id||this.mode==="analyze"||this.mode==="puzzle"))||o&&this.mode==="play")return;const b=(0,C.getRelativeEventPosition)(f),h=b.x,F=b.y,T=this.xy2ij(h,F),P=T.i,m=T.j;if(P<0||m<0||P>=this.engine.width||m>=this.engine.height)return;if(this.double_click_submit||(u=!1),this.mode==="analyze"&&f.shiftKey&&!(this.analyze_tool==="stone"&&(this.analyze_subtool==="black"||this.analyze_subtool==="white"))&&this.analyze_tool!=="label"){const z=this.engine.getMoveByLocation(P,m,!0);z&&(this.engine.jumpTo(z),this.emit("update"));return}if(this.mode==="analyze"&&this.analyze_tool==="label")return;this.setSubmit(void 0);const w=Date.now();let y=0;const N=[],x=()=>{const z=Date.now();if(!this.one_click_submit&&(!this.double_click_submit||!u)){const D=z-w;if(D<=50){console.info("Submit button pressed only ",D,"ms after stone was placed, presuming bad click");return}}this.sendMove({game_id:this.game_id,move:(0,O.encodeMove)(P,m)})?(this.playMovementSound(),this.setTitle((0,E._)("Submitting...")),y&&this.debouncedEmitCapturedStones(N),this.disableStonePlacement(),delete this.move_selected):console.log("Move not sent, not playing movement sound")};try{let z=!1;if(this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move){const{removed:U,group:D}=this.engine.toggleSingleGroupRemoval(P,m,f.shiftKey||r>500);D.length&&this.socket.send("game/removed_stones/set",{game_id:this.game_id,removed:U,stones:(0,O.encodeMoves)(D)})}else if(this.mode==="puzzle"){let U="place",D=0;if(this.getPuzzlePlacementSetting){const B=this.getPuzzlePlacementSetting();U=B.mode,B.mode==="setup"&&(D=B.color,(this.shift_key_is_down||o)&&(D=D===1?2:1))}if(U==="place"&&(u||(this.engine.place(P,m,!0,!1,!0,!1,!1),this.emit("puzzle-place",{x:P,y:m,width:this.engine.width,height:this.engine.height,color:this.engine.colorToMove()}))),U==="play"&&!u&&!this.autoplaying_puzzle_move){let B=0;if(this.engine.puzzle_player_move_mode!=="fixed"||this.engine.cur_move.lookupMove(P,m,this.engine.player,!1)){const j=(ee,me)=>{if(++B,y=this.engine.place(ee,me,!0,!1,!0,!1,!1,N),this.emit("puzzle-place",{x:ee,y:me,width:this.engine.width,height:this.engine.height,color:this.engine.colorToMove()}),this.engine.cur_move.wrong_answer&&this.emit("puzzle-wrong-answer"),this.engine.cur_move.correct_answer&&this.emit("puzzle-correct-answer"),this.engine.cur_move.branches.length===0){const Z=this.engine.cur_move.findStrongIsobranches();if(Z.length>0){const se=(0,O.getRandomInt)(0,Z.length),he=Z[se];console.info("Following isomorphism ("+(se+1)+" of "+Z.length+")"),this.engine.jumpTo(he),this.emit("update")}}if(this.engine.cur_move.branches.length){const Z=this.engine.cur_move.branches[(0,O.getRandomInt)(0,this.engine.cur_move.branches.length)];B===1&&(Z.player===2&&this.engine.config.initial_player==="black"||Z.player===1&&this.engine.config.initial_player==="white")&&this.engine.puzzle_opponent_move_mode!=="manual"&&(this.autoplaying_puzzle_move=!0,setTimeout(()=>{this.autoplaying_puzzle_move=!1,j(Z.x,Z.y),this.emit("update")},this.puzzle_autoplace_delay))}else{let Z=this.engine.cur_move,se=!1;for(;Z;){if(Z.correct_answer){se=!0;break}Z=Z.parent}se||this.engine.cur_move.wrong_answer||this.emit("puzzle-wrong-answer")}};j(P,m)}}U==="setup"&&(this.engine.board[m][P]===D?this.engine.initialStatePlace(P,m,0):this.engine.initialStatePlace(P,m,D)),this.emit("update"),y>0&&(this.emit("audio-capture-stones",{count:y,already_captured:0}),this.debouncedEmitCapturedStones(N))}else if(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze"){if(this.move_selected){this.mode==="play"&&this.engine.cur_move.removeIfNoChildren();let U=!1;if(this.move_selected.x===P&&this.move_selected.y===m&&(delete this.move_selected,U=!0),this.engine.jumpTo(this.engine.last_official_move),U&&(this.updatePlayerToMoveTitle(),!u)){this.emit("update");return}}this.move_selected={x:P,y:m};try{if(!(this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate"))y=this.engine.place(P,m,!0,!0,void 0,void 0,void 0,N),this.mode==="analyze"&&this.engine.handicapMovesLeft()>0&&this.engine.place(-1,-1);else{if(!this.edit_color)throw new Error("Edit place called with invalid edit_color value");let U=this.engine.playerByColor(this.edit_color);f.shiftKey&&U===1?U=2:f.shiftKey&&U===2&&(U=1),this.engine.board[m][P]===U?this.engine.editPlace(P,m,0):this.engine.editPlace(P,m,U)}if(this.mode==="analyze"&&this.analyze_tool==="stone"){let U=this.engine.cur_move;for(;U&&!U.trunk;){let D=U.getMoveNumberDifferenceFromTrunk();U.edited&&(D="triangle"),U.x>=0&&U.y>=0&&!this.engine.board[U.y][U.x]?this.clearTransientMark(U.x,U.y,D):this.setTransientMark(U.x,U.y,D,!0),U=U.parent}}this.isPlayerController()&&(this.syncReviewMove(),z=!0)}catch(U){throw delete this.move_selected,this.updatePlayerToMoveTitle(),U}switch(this.mode){case"play":this.one_click_submit||u?x():this.setSubmit(x);break;case"analyze":delete this.move_selected,this.updateTitleAndStonePlacement(),this.emit("update"),this.playMovementSound();break;case"conditional":this.followConditionalSegment(P,m),delete this.move_selected,this.updateTitleAndStonePlacement(),this.emit("update"),this.playMovementSound();break}z&&this.redraw()}}catch(z){delete this.move_selected,z.message_id!=="stone_already_placed_here"&&(this.errorHandler(z),this.emit("error","stone_already_placed_here")),this.emit("update")}}onMouseMove(f){if(!(this.stone_placement_enabled&&(this.player_id||!this.engine.players.black.id||this.mode==="analyze"||this.scoring_mode)))return;const u=(0,C.getRelativeEventPosition)(f),o=this.xy2ij(u.x,u.y);if(!(this.__last_pt.i===o.i&&this.__last_pt.j===o.j)){if(this.__last_pt.valid){const r=this.last_hover_square;delete this.last_hover_square,r&&this.drawSquare(r.x,r.y)}this.__last_pt=o,o.valid&&(this.last_hover_square={x:o.i,y:o.j},this.drawSquare(o.i,o.j))}}onMouseOut(f){if(this.__last_pt.valid){const u=this.last_hover_square;delete this.last_hover_square,u&&this.drawSquare(u.x,u.y)}this.__last_pt=this.xy2ij(-1,-1)}enableDrawing(){this.drawing_enabled=!0}disableDrawing(){this.drawing_enabled=!1}setByoYomiLabel(f){this.byoyomi_label!==f&&(this.byoyomi_label=f,this.last_hover_square&&this.drawSquare(this.last_hover_square.x,this.last_hover_square.y))}drawSquare(f,u){f<0||u<0||!this.drawing_enabled||this.no_display||this.__draw_state[u][f]!==this.drawingHash(f,u)&&this.__drawSquare(f,u)}__drawSquare(f,u){var o,r,b;if(!this.drawing_enabled||this.no_display)return;const h=this.ctx;if(!h||f<0||u<0)return;const F=this.square_size;let T=this.draw_left_labels?F:0,P=this.draw_top_labels?F:0;this.bounds.left>0&&(T=-F*this.bounds.left),this.bounds.top>0&&(P=-F*this.bounds.top);let m,w,y=!this.dont_draw_last_move,N=0;this.engine&&(N=this.engine.board[u][f]);let x=this.getMarks(f,u);x||(console.error("No position for ",u,f),x={});let z;if(this.engine&&this.engine.cur_move&&(this.mode!=="play"||typeof this.isInPushedAnalysis()<"u"&&this.isInPushedAnalysis())){let Z=this.engine.cur_move;for(;Z&&!Z.trunk;Z=Z.parent)Z.x===f&&Z.y===u&&Z.getMoveNumberDifferenceFromTrunk()!==Z.move_number&&!Z.edited&&this.show_variation_move_numbers&&(z=Z.getMoveNumberDifferenceFromTrunk().toString())}let U=!1;this.engine&&this.engine.cur_move.lookupMove(f,u,this.engine.player,!1)&&(U=!0);let D=!1,B=this.theme_blank_text_color;for(const Z in x)Z.length<=3&&(D=!0);(x.circle||x.triangle||x.chat_triangle||x.sub_triangle||x.cross||x.square)&&(D=!0),x.letter&&x.letter.length>0&&(D=!0),x.subscript&&x.subscript.length>0&&(D=!0);{const Z=f*F+T,se=(f+1)*F+T,he=u*F+P,J=(u+1)*F+P;if(h.clearRect(Z,he,se-Z,J-he),this.shadow_ctx){let Y=this.square_size*.1;this.shadow_ctx.clearRect(Z+Y,he+Y,this.square_size,this.square_size),Y=this.square_size*.2,this.shadow_ctx.clearRect(Z+Y,he+Y,this.square_size,this.square_size),Y=this.square_size*.3,this.shadow_ctx.clearRect(Z+Y,he+Y,this.square_size,this.square_size)}m=Z+this.metrics.mid,w=he+this.metrics.mid;let W=Z,H=se;const I=(se+Z)/2-this.metrics.offset;let le=he,_e=J;const K=(he+J)/2-this.metrics.offset;f===0&&(W+=this.metrics.mid),f===this.width-1&&(H-=this.metrics.mid),u===0&&(le+=this.metrics.mid),u===this.height-1&&(_e-=this.metrics.mid),f===this.width-1&&u===this.height-1&&I===H&&K===_e&&(H+=1,_e+=1),this.square_size<5?h.lineWidth=.2:h.lineWidth=1,D?h.strokeStyle=this.theme_faded_line_color:h.strokeStyle=this.theme_line_color,h.lineCap="butt",h.beginPath(),h.moveTo(Math.floor(W),K),h.lineTo(Math.floor(H),K),h.moveTo(I,Math.floor(le)),h.lineTo(I,Math.floor(_e)),h.stroke()}{let Z;this.square_size<5?Z=.5:Z=Math.max(2,(this.metrics.mid-1.5)*.16);let se=!1;this.width===19&&this.height===19&&(f===3&&(u===3||u===9||u===15)||f===9&&(u===3||u===9||u===15)||f===15&&(u===3||u===9||u===15))&&(se=!0),this.width===13&&this.height===13&&(f===3&&(u===3||u===9)||f===6&&u===6||f===9&&(u===3||u===9))&&(se=!0),this.width===9&&this.height===9&&(f===2&&(u===2||u===6)||f===4&&u===4||f===6&&(u===2||u===6))&&(se=!0),se&&(h.beginPath(),h.fillStyle=this.theme_star_color,D&&(h.fillStyle=this.theme_faded_star_color),h.arc(m,w,Z,.001,2*Math.PI,!1),h.fill())}if(this.heatmap&&this.heatmap[u][f]>.001){const Z="#00FF00";h.lineCap="square",h.save(),h.beginPath(),h.globalAlpha=Math.min(this.heatmap[u][f],.5);const se=Math.floor(this.square_size*.5)-.5;h.moveTo(m-se,w-se),h.lineTo(m+se,w-se),h.lineTo(m+se,w+se),h.lineTo(m-se,w+se),h.lineTo(m-se,w-se),h.fillStyle=Z,h.fill(),h.restore()}if(x.hint||this.highlight_movetree_moves&&U||x.color){const Z=x.color?x.color:x.hint?"#8EFF0A":"#FF8E0A";h.lineCap="square",h.save(),h.beginPath(),h.globalAlpha=.6;const se=Math.floor(this.square_size*.5)-.5;h.moveTo(m-se,w-se),h.lineTo(m+se,w-se),h.lineTo(m+se,w+se),h.lineTo(m-se,w+se),h.lineTo(m-se,w-se),h.fillStyle=Z,h.fill(),h.restore()}const j=(o=this.colored_circles)===null||o===void 0?void 0:o[u][f];if(j){const Z=j.color;h.save(),h.globalAlpha=1;const se=Math.floor(this.square_size*.5)-.5;let he=se*(j.border_width||.1);he<.3&&(he=0),h.fillStyle=Z,h.strokeStyle=j.border_color||"#000000",he>0&&(h.lineWidth=he),h.beginPath(),h.arc(m,w,Math.max(.1,se-he/2),.001,2*Math.PI,!1),he>0&&h.stroke(),h.fill(),h.restore()}let ee=!1;if(N||this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&this.engine&&!this.scoring_mode&&(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze")&&(this.engine.puzzle_player_move_mode!=="fixed"||U||this.getPuzzlePlacementSetting&&this.getPuzzlePlacementSetting().mode==="play")||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f]||this.engine&&this.engine.phase==="stone removal"&&this.engine.board[u][f]&&this.engine.removal[u][f]||x.black||x.white){let Z=!1,se=.6,he;if(this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f])he=this.score_estimator.board[u][f],Z=!0;else if(this.engine&&(this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move||this.engine.phase==="finished"&&this.mode!=="analyze")&&this.engine.board&&this.engine.removal&&this.engine.board[u][f]&&this.engine.removal[u][f])he=this.engine.board[u][f],Z=!0;else if(N)he=N;else if(this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate")he=this.edit_color==="black"?1:2,this.shift_key_is_down&&(he=this.edit_color==="black"?2:1);else if(this.move_selected)this.engine.handicapMovesLeft()<=0?he=this.engine.otherPlayer():he=this.engine.player;else if(this.mode==="puzzle")if(this.getPuzzlePlacementSetting){const W=this.getPuzzlePlacementSetting();W.mode==="setup"?(he=W.color,this.shift_key_is_down&&(he=he===1?2:1)):he=this.engine.player}else he=this.engine.player;else x.black||x.white?(he=x.black?1:2,Z=!0,se=this.variation_stone_opacity):he=this.engine.player;if(x.stone_removed&&(Z=!0),!(this.autoplaying_puzzle_move&&!N)){if(B=he===1?this.theme_black_text_color:this.theme_white_text_color,!this.theme_black_stones){const H=new Error(`Goban.theme_black_stones not set. Current themes is ${JSON.stringify(this.themes)}`);setTimeout(()=>{throw H},1);return}if(!this.theme_white_stones){const H=new Error(`Goban.theme_white_stones not set. Current themes is ${JSON.stringify(this.themes)}`);setTimeout(()=>{throw H},1);return}h.save();let W=this.shadow_ctx;if((!N||Z)&&(h.globalAlpha=se,W=null),W===void 0&&(W=null),he===1){const H=this.theme_black.getStone(f,u,this.theme_black_stones,this);this.theme_black.placeBlackStone(h,W,H,m,w,this.theme_stone_radius)}else{const H=this.theme_white.getStone(f,u,this.theme_white_stones,this);this.theme_white.placeWhiteStone(h,W,H,m,w,this.theme_stone_radius)}h.restore()}const J=(b=(r=this.colored_circles)===null||r===void 0?void 0:r[u])===null||b===void 0?void 0:b[f];if(x.blue_move&&J){h.save(),h.globalAlpha=1;const W=Math.floor(this.square_size*.5)-.5;let H=W*(J.border_width||.1);H<.3&&(H=0),h.strokeStyle=J.border_color||"#000000",H>0&&(h.lineWidth=H),h.beginPath(),h.arc(m,w,Math.max(.1,W-H/2),.001,2*Math.PI,!1),H>0&&h.stroke(),h.restore()}(this.engine&&this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move&&this.engine.board[u][f]&&this.engine.removal[u][f]||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f]||x.stone_removed)&&(ee=this.themes["removal-graphic"]==="x")}if(ee||this.mode==="analyze"&&this.analyze_tool==="removal"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u||this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u){const Z=this.engine.board[u][f]===q.JGOFNumericPlayerColor.BLACK?"black":"white",se=this.engine.board[u][f]?1:.2;h.lineCap="square",h.save(),h.beginPath(),h.lineWidth=this.square_size*.125,h.globalAlpha=se;const he=Math.max(1,this.metrics.mid*.65);h.moveTo(m-he,w-he),h.lineTo(m+he,w+he),h.moveTo(m+he,w-he),h.lineTo(m-he,w+he),x.score==="black"&&Z==="white"?h.strokeStyle=this.theme_white_text_color:x.score==="white"&&Z==="black"?h.strokeStyle=this.theme_black_text_color:x.score==="white"&&Z==="white"||x.score==="black"&&Z==="black"?h.strokeStyle="#ff0000":h.strokeStyle="#888888",h.stroke(),h.restore(),y=!1}if(x.score&&(this.engine.phase!=="finished"||this.mode==="play"||this.mode==="analyze")||this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[u][f]||this.score_estimator.removal[u][f]&&this.score_estimator.board[u][f]===0)||(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[u][f]===0&&(this.engine.removal[u][f]||x.needs_sealing)||this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u){h.beginPath();let Z=x.score;this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[u][f]||this.score_estimator.removal[u][f]&&this.score_estimator.board[u][f]===0)&&(Z=this.score_estimator.territory[u][f]===1?"black":"white",this.score_estimator.board[u][f]===0&&this.score_estimator.removal[u][f]&&(Z="dame")),(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[u][f]===0&&this.engine.removal[u][f]&&(Z="dame"),x.needs_sealing&&(Z="seal"),this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(Z=this.analyze_subtool),Z==="white"?(h.fillStyle=this.theme_black_text_color,h.strokeStyle="#777777"):Z==="black"?(h.fillStyle=this.theme_white_text_color,h.strokeStyle="#888888"):Z==="dame"?(h.fillStyle="#ff0000",h.strokeStyle="#365FE6"):Z==="seal"&&(h.fillStyle="#ff0000",h.strokeStyle="#E079CE"),(Z==null?void 0:Z[0])==="#"&&(h.fillStyle=Z,h.strokeStyle=(0,O.color_blend)("#888888",Z)),h.lineWidth=Math.ceil(this.square_size*.065)-.5;const se=this.square_size*.15;h.rect(m-se,w-se,se*2,se*2),Z!=="dame"&&h.fill(),h.stroke()}let me=!1;{let Z,se,he=!1;if(x.letter&&(Z=x.letter),x.subscript&&(se=x.subscript),this.mode==="play"&&this.byoyomi_label&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(Z=this.byoyomi_label),this.mode==="analyze"&&this.analyze_tool==="label"&&(this.analyze_subtool==="letters"||this.analyze_subtool==="numbers")&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(he=!0,Z=this.label_character),!Z&&z!=="triangle"&&(Z=z),this.show_variation_move_numbers&&!Z&&!(x.circle||x.triangle||x.chat_triangle||x.sub_triangle||x.cross||x.square)){const J=this.engine.getMoveByLocation(f,u,!1);J&&!J.trunk&&(J.edited?this.engine.board[u][f]&&(z="triangle"):Z=J.getMoveNumberDifferenceFromTrunk().toString())}if(Z){me=!0,h.save(),h.fillStyle=B;const[,,J]=g(h,Z,`bold FONT_SIZEpx ${v.GOBAN_FONT}`,this.square_size*.4,this.square_size*.8*(se?.9:1)),W=m-J.width/2;let H=w+(/WebKit|Trident/.test(navigator.userAgent)?this.square_size*-.03:1);se&&(H-=this.square_size*.15),h.textBaseline="middle",he&&(h.globalAlpha=.6),h.fillText(Z,W,H),y=!1,h.restore()}if(se){me=!0,h.save(),h.fillStyle=B,Z&&se==="0"&&(se="0.0");const[,,J]=g(h,se,`bold FONT_SIZEpx ${v.GOBAN_FONT}`,this.square_size*.4,this.square_size*.8*(Z?.9:1)),W=m-J.width/2;let H=w+(/WebKit|Trident/.test(navigator.userAgent)?this.square_size*-.03:1);Z&&(H+=this.square_size*.3),h.textBaseline="middle",he&&(h.globalAlpha=.6),h.fillText(se,W,H),y=!1,h.restore()}}{let Z=me,se;const he=N===1?this.theme_black_text_color:N===2?this.theme_white_text_color:B;if(this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(this.analyze_subtool==="triangle"||this.analyze_subtool==="square"||this.analyze_subtool==="cross"||this.analyze_subtool==="circle")&&(Z=!0,se=this.analyze_subtool),x.circle||se==="circle"){h.lineCap="round",h.save(),h.beginPath(),Z&&(h.globalAlpha=.6),h.strokeStyle=he,h.lineWidth=this.square_size*.075;const J=Math.max(.1,this.square_size*this.circle_radius);h.arc(m,w,J,0,2*Math.PI,!1),h.stroke(),h.restore(),y=!1}if(x.triangle||x.chat_triangle||x.sub_triangle||z==="triangle"||se==="triangle"){let J=1,W=0;x.sub_triangle&&(J=.5,W=this.square_size*.3,Z=!1),h.lineCap="round",h.save(),h.beginPath(),Z&&(h.globalAlpha=.6),h.strokeStyle=he,x.chat_triangle&&(h.strokeStyle="#00aaFF"),h.lineWidth=this.square_size*.075*J;let H=-(Math.PI*2)/4;const I=this.square_size*.3*J;h.moveTo(m+I*Math.cos(H),w+W+I*Math.sin(H)),H+=Math.PI*2/3,h.lineTo(m+I*Math.cos(H),w+W+I*Math.sin(H)),H+=Math.PI*2/3,h.lineTo(m+I*Math.cos(H),w+W+I*Math.sin(H)),H+=Math.PI*2/3,h.lineTo(m+I*Math.cos(H),w+W+I*Math.sin(H)),h.stroke(),h.restore(),y=!1}if(x.cross||se==="cross"){h.lineCap="square",h.save(),h.beginPath(),h.lineWidth=this.square_size*.075,Z&&(h.globalAlpha=.6);const J=Math.max(1,this.metrics.mid*.35);h.moveTo(m-J,w-J),h.lineTo(m+J,w+J),h.moveTo(m+J,w-J),h.lineTo(m-J,w+J),h.strokeStyle=he,h.stroke(),h.restore(),y=!1}if(x.square||se==="square"){h.lineCap="square",h.save(),h.beginPath(),h.lineWidth=this.square_size*.075,Z&&(h.globalAlpha=.6);const J=Math.max(1,this.metrics.mid*.4);h.moveTo(m-J,w-J),h.lineTo(m+J,w-J),h.lineTo(m+J,w+J),h.lineTo(m-J,w+J),h.lineTo(m-J,w-J),h.strokeStyle=he,h.stroke(),h.restore(),y=!1}}if(this.last_move&&this.engine&&!this.last_move.is(this.engine.cur_move)){const Z=this.last_move;delete this.last_move,this.drawSquare(Z.x,Z.y)}if(y&&this.engine&&this.engine.cur_move&&this.engine.cur_move.x===f&&this.engine.cur_move.y===u&&this.engine.board[u][f]&&(this.engine.phase==="play"||this.engine.phase==="finished")&&(this.last_move=this.engine.cur_move,f>=0&&u>=0)){const Z=N===1?this.theme_black_text_color:this.theme_white_text_color;if(this.submit_move){h.lineCap="square",h.save(),h.beginPath(),h.lineWidth=this.square_size*.075,h.globalAlpha=this.last_move_opacity;const se=Math.max(1,this.metrics.mid*.35)*.8;h.moveTo(m-se,w),h.lineTo(m+se,w),h.moveTo(m,w-se),h.lineTo(m,w+se),h.strokeStyle=Z,h.stroke(),h.restore(),y=!1}else if(this.engine.undo_requested&&this.getShowUndoRequestIndicator()&&this.engine.undo_requested===this.engine.cur_move.move_number){const se="?";h.save(),h.fillStyle=Z;const he=h.measureText(se),J=m-he.width/2,W=w+(/WebKit|Trident/.test(navigator.userAgent)?this.square_size*-.03:1);h.textBaseline="middle",h.fillText(se,J,W),y=!1,h.restore()}else{h.save(),h.beginPath(),h.strokeStyle=Z,h.lineWidth=this.square_size*.075,h.globalAlpha=this.last_move_opacity;let se=this.square_size*this.last_move_radius;this.submit_move&&(se=this.square_size*.3),se=Math.max(.1,se),h.arc(m,w,se,0,2*Math.PI,!1),h.stroke(),h.restore()}}if(this.scoring_mode===!0&&this.score_estimator||this.scoring_mode==="stalling-scoring-mode"&&this.stalling_score_estimate&&this.mode!=="analyze"){const se=(this.scoring_mode==="stalling-scoring-mode"?this.stalling_score_estimate:this.score_estimator).ownership[u][f];h.beginPath();const he=se<0?"white":"black";if((he==="black"?1:2)!==N){he==="white"?(h.fillStyle=this.theme_black_text_color,h.strokeStyle="#777777"):he==="black"&&(h.fillStyle=this.theme_white_text_color,h.strokeStyle="#888888"),h.lineWidth=Math.ceil(this.square_size*.035)-.5;const W=this.square_size*.2*Math.abs(se);h.rect(m-W,w-W,W*2,W*2),h.fill(),h.stroke()}}this.__draw_state[u][f]=this.drawingHash(f,u)}drawingHash(f,u){var o;if(this.no_display)return"";if(f<0||u<0)return"..";let r=this.square_size+",";const b=!this.dont_draw_last_move;let h=0;this.engine&&(h=this.engine.board[u][f]),r+=h+",",this.heatmap&&this.heatmap[u][f]>.001&&(r+="heat "+this.heatmap[u][f]+",");const F=(o=this.colored_circles)===null||o===void 0?void 0:o[u][f];F&&(r+="circle "+F.color);let T=this.getMarks(f,u);T||(console.error("No position for ",u,f),T={});let P;if(this.engine&&this.engine.cur_move&&(this.mode!=="play"||typeof this.isInPushedAnalysis()<"u"&&this.isInPushedAnalysis())){let y=this.engine.cur_move;for(;y&&!y.trunk;y=y.parent)y.x===f&&y.y===u&&y.getMoveNumberDifferenceFromTrunk()!==y.move_number&&!y.edited&&this.show_variation_move_numbers&&(P=y.getMoveNumberDifferenceFromTrunk().toString())}let m=!1;this.engine&&this.engine.cur_move.lookupMove(f,u,this.engine.player,!1)&&(m=!0);let w=!1;if(h||this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&this.engine&&!this.scoring_mode&&(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze")&&(this.engine.puzzle_player_move_mode!=="fixed"||m||this.getPuzzlePlacementSetting&&this.getPuzzlePlacementSetting().mode!=="play")||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f]||this.engine&&this.engine.phase==="stone removal"&&this.engine.board[u][f]&&this.engine.removal[u][f]||T.black||T.white){let y=!1,N;this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f]?(N=this.score_estimator.board[u][f],y=!0):this.engine&&this.engine.phase==="stone removal"&&this.engine.board&&this.engine.removal&&this.engine.board[u][f]&&this.engine.removal[u][f]?(N=this.engine.board[u][f],y=!0):h?N=h:this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate"?N=this.edit_color==="black"?1:2:this.move_selected?this.engine.handicapMovesLeft()<=0?N=this.engine.otherPlayer():N=this.engine.player:T.black||T.white?(N=T.black?1:2,y=!0):N=this.engine.player,T.stone_removed&&(y=!0),N===1&&(r+=this.theme_black.getStoneHash(f,u,this.theme_black_stones,this)),N===2&&(r+=this.theme_white.getStoneHash(f,u,this.theme_white_stones,this)),(this.engine&&this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move&&this.engine.board[u][f]&&this.engine.removal[u][f]||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[u][f]&&this.score_estimator.removal[u][f]||T.stone_removed)&&(w=!0),r+=(y?"T":"")+N+","}if(w||this.mode==="analyze"&&this.analyze_tool==="removal"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u||this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u){const y=this.engine.board[u][f]===q.JGOFNumericPlayerColor.BLACK?"black":"white";T.score==="black"&&y==="white"?r+="whiteX":T.score==="white"&&y==="black"?r+="blackX":r+="redX"}(T.hint||this.highlight_movetree_moves&&m)&&(T.hint?r+="hint,":r+="highlight,");{let y=!1,N=!1;this.engine&&(this.scoring_mode||this.engine.phase==="stone removal")&&this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&(y=!0,N=!0),T.mark_x&&(y=!0,N=!1),this.scoring_mode&&this.score_estimator&&this.score_estimator.removal[u][f]&&(y=!0,N=!1),T.remove&&this.mode!=="analyze"&&(y=!0,N=!1),r+=y+","+N}if(T.score&&(this.engine.phase!=="finished"||this.mode==="play"||this.mode==="analyze")||this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[u][f]||this.score_estimator.removal[u][f]&&this.score_estimator.board[u][f]===0)||(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[u][f]===0&&(this.engine.removal[u][f]||T.needs_sealing)||this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u){let y=T.score;this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[u][f]||this.score_estimator.removal[u][f]&&this.score_estimator.board[u][f]===0)&&(y=this.score_estimator.territory[u][f]===1?"black":"white",this.score_estimator.board[u][f]===0&&this.score_estimator.removal[u][f]&&(y="dame")),(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[u][f]===0&&this.engine.removal[u][f]&&(y="dame"),T.needs_sealing&&(y="seal"),this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(y=this.analyze_subtool),this.scoring_mode&&this.score_estimator&&this.score_estimator.territory[u][f]&&(y=this.score_estimator.territory[u][f]===1?"black":"white"),r+="score "+y+","}{let y,N=!1;if(T.letter&&(y=T.letter),this.mode==="play"&&this.byoyomi_label&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(y=this.byoyomi_label),this.mode==="analyze"&&this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(N=!0,y=this.label_character),!y&&P!=="triangle"&&(y=P),this.show_variation_move_numbers&&!y&&!(T.circle||T.triangle||T.chat_triangle||T.cross||T.square)){const x=this.engine.getMoveByLocation(f,u,!1);x&&!x.trunk&&(x.edited?this.engine.board[u][f]&&(P="triangle"):y=x.getMoveNumberDifferenceFromTrunk().toString())}y&&(r+=y+(N?" fade":"")+","),T.subscript&&(r+=" _ "+T.subscript+(N?" fade":"")+",")}if(this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===f&&this.last_hover_square.y===u&&(this.analyze_subtool==="triangle"||this.analyze_subtool==="square"||this.analyze_subtool==="cross"||this.analyze_subtool==="circle")&&(r+="hover "+this.analyze_subtool+","),T.circle&&(r+="circle,"),(T.triangle||T.chat_triangle||P==="triangle")&&(r+="triangle,"),T.cross&&(r+="cross,"),T.square&&(r+="square,"),b&&this.engine&&this.engine.cur_move&&this.engine.cur_move.x===f&&this.engine.cur_move.y===u&&this.engine.board[u][f]&&(this.engine.phase==="play"||this.engine.phase==="finished")&&(r+="last_move,",this.engine.undo_requested&&this.getShowUndoRequestIndicator()&&this.engine.undo_requested===this.engine.cur_move.move_number&&(r+="?,")),this.scoring_mode===!0&&this.score_estimator||this.scoring_mode==="stalling-scoring-mode"&&this.stalling_score_estimate&&this.mode!=="analyze"){const N=(this.scoring_mode==="stalling-scoring-mode"?this.stalling_score_estimate:this.score_estimator).ownership[u][f];r+=N.toFixed(5)+","}return r}redraw(f){if(!this.ready_to_draw)return;if(this.destroyed){console.debug("Attempting to redraw destroyed goban");return}if(!this.drawing_enabled||this.no_display)return;const u=this.metrics=this.computeMetrics();if(f||!(this.__set_board_width===u.width&&this.__set_board_height===u.height&&this.theme_stone_radius===this.computeThemeStoneRadius())){f=!0;try{if(this.parent.style.width=u.width+"px",this.parent.style.height=u.height+"px",(0,C.resizeDeviceScaledCanvas)(this.board,u.width,u.height),this.pen_layer)if(this.pen_marks.length){(0,C.resizeDeviceScaledCanvas)(this.pen_layer,u.width,u.height);const P=this.pen_layer.getContext("2d",{willReadFrequently:!0});if(P)this.pen_ctx=P;else throw new Error("Failed to obtain drawing context for pen layer")}else this.detachPenCanvas();if(this.shadow_layer){(0,C.resizeDeviceScaledCanvas)(this.shadow_layer,u.width,u.height);const P=this.shadow_layer.getContext("2d",{willReadFrequently:!0});if(P)this.shadow_ctx=P;else throw new Error("Failed to obtain drawing context for shadow layer")}this.__set_board_width=u.width,this.__set_board_height=u.height;const T=this.board.getContext("2d",{willReadFrequently:!0});if(T)this.ctx=T;else throw new Error("Failed to obtain drawing context for board");this.setTheme(this.getSelectedThemes(),!0)}catch(T){setTimeout(()=>{throw T},1);return}}const o=this.ctx,r=(T,P,m)=>{const w=o.measureText(T),y=P-w.width/2,N=m;o.fillText(T,y,N)},b=(T,P,m)=>{for(let w=0;w<T.length;++w){const y=o.measureText(T[w]),N=P-y.width/2;let x=m;const z=y.width;T.length===2&&(x=x-z+w*z),T.length===3&&(x=x-z*1.5+w*z),o.fillText(T[w],N,x)}},h=(T,P)=>{switch(this.getCoordinateDisplaySystem()){case"A1":for(let m=0;m<this.width;++T,++m){const w=(T-this.bounds.left-(this.bounds.left>0?+this.draw_left_labels:0))*this.square_size+this.square_size/2,y=P*this.square_size+this.square_size/2;r((0,O.encodePrettyXCoordinate)(m),w,y)}break;case"1-1":for(let m=0;m<this.width;++T,++m){const w=(T-this.bounds.left-(this.bounds.left>0?+this.draw_left_labels:0))*this.square_size+this.square_size/2,y=P*this.square_size+this.square_size/2;r(""+(m+1),w,y)}break}},F=(T,P)=>{switch(this.getCoordinateDisplaySystem()){case"A1":for(let w=0;w<this.height;++P,++w){const y=T*this.square_size+this.square_size/2,N=(P-this.bounds.top-(this.bounds.top>0?+this.draw_top_labels:0))*this.square_size+this.square_size/2;r(""+(this.height-w),y,N)}break;case"1-1":const m=["","","","","","","","","","","","","","","","","","","","","","","","",""];for(let w=0;w<this.height;++P,++w){const y=T*this.square_size+this.square_size/2,N=(P-this.bounds.top-(this.bounds.top>0?+this.draw_top_labels:0))*this.square_size+this.square_size/2;b(m[w],y,N)}break}};if(f||!this.__borders_initialized){this.__borders_initialized=!0,this.shadow_ctx&&this.shadow_ctx.clearRect(0,0,u.width,u.height),o.clearRect(0,0,u.width,u.height);let T=Math.round(this.square_size*.5),P="bold";this.getCoordinateDisplaySystem()==="1-1"&&(T*=.7,P="",this.height>20&&(T*=.7)),o.font=`${P} ${T}px ${v.GOBAN_FONT}`,o.textBaseline="middle",o.fillStyle=this.theme_board.getLabelTextColor(),o.save(),this.draw_top_labels&&this.bounds.top===0&&h(this.draw_left_labels?1:0,0),this.draw_bottom_labels&&this.bounds.bottom===this.height-1&&h(this.draw_left_labels?1:0,+this.draw_top_labels+this.bounded_height),this.draw_left_labels&&this.bounds.left===0&&F(0,this.draw_top_labels?1:0),this.draw_right_labels&&this.bounds.right===this.width-1&&F(+this.draw_left_labels+this.bounded_width,+this.draw_top_labels),o.restore()}(!this.__draw_state||f||this.__draw_state.length!==this.height||this.__draw_state[0].length!==this.width)&&(this.__draw_state=(0,O.makeMatrix)(this.width,this.height,""));{const T=Math.round(this.square_size*.45);o.font="bold "+T+"px "+v.GOBAN_FONT}for(let T=this.bounds.top;T<=this.bounds.bottom;++T)for(let P=this.bounds.left;P<=this.bounds.right;++P)this.drawSquare(P,T);this.drawPenMarks(this.pen_marks),this.move_tree_redraw()}showMessage(f,u,o=5e3){var r;this.clearMessage();const b=((r=u==null?void 0:u.error)===null||r===void 0?void 0:r.message_id)||f,h=(0,R.formatMessage)(b,u);if(this.emit("show-message",{formatted:h,message_id:b,parameters:u}),!this.config.dont_show_messages){this.message_div=document.createElement("div"),this.message_div.className="GobanMessage",this.message_td=document.createElement("td");const F=document.createElement("table"),T=document.createElement("tr");T.appendChild(this.message_td),F.appendChild(T),this.message_div.appendChild(F),this.message_text=document.createElement("div"),this.message_text.innerHTML=h,this.message_td.appendChild(this.message_text),this.parent.appendChild(this.message_div);const P=Date.now();this.message_div.addEventListener("click",()=>{try{if(Date.now()-P<100)return;o>0&&this.clearMessage()}catch(m){console.error(m)}})}o||(o=5e3),o>0&&(this.message_timeout=window.setTimeout(()=>{this.clearMessage()},o))}clearMessage(){var f;this.message_div&&((f=this.message_div.parentNode)===null||f===void 0||f.removeChild(this.message_div),delete this.message_div),this.message_timeout&&(clearTimeout(this.message_timeout),delete this.message_timeout),this.emit("clear-message")}setTheme(f,u){var o,r,b;if(this.no_display)return;this.themes=f;const h=((o=L.THEMES.board)===null||o===void 0?void 0:o[f.board])||L.THEMES.board.Plain,F=((r=L.THEMES.white)===null||r===void 0?void 0:r[f.white])||L.THEMES.white.Plain,T=((b=L.THEMES.black)===null||b===void 0?void 0:b[f.black])||L.THEMES.black.Plain;if(this.theme_board=new h,this.theme_white=new F(this.theme_board),this.theme_black=new T(this.theme_board),this.metrics||(this.metrics=this.computeMetrics()),this.theme_stone_radius=this.computeThemeStoneRadius(),isNaN(this.theme_stone_radius))throw console.error("setThemes was not able to find the board size, metrics were: ",JSON.stringify(this.metrics)),new Error("invalid stone radius computed");if(this.theme_white.stoneCastsShadow(this.theme_stone_radius)||this.theme_black.stoneCastsShadow(this.theme_stone_radius))if(this.shadow_layer){(0,C.resizeDeviceScaledCanvas)(this.shadow_layer,this.metrics.width,this.metrics.height);const y=this.shadow_layer.getContext("2d",{willReadFrequently:!0});if(y)this.shadow_ctx=y;else throw new Error("Failed to get drawing context for shadow layer")}else this.attachShadowLayer();else this.detachShadowLayer();f.white in s.white||(s.white[f.white]={creation_order:[]}),f.black in s.black||(s.black[f.black]={creation_order:[]});const P=()=>{this.redraw(!0),this.move_tree_redraw()};try{this.theme_stone_radius in s.white[f.white]||(s.white[f.white][this.theme_stone_radius]=this.theme_white.preRenderWhite(this.theme_stone_radius,23434,P),s.white[f.white].creation_order.push(this.theme_stone_radius)),this.theme_stone_radius in s.black[f.black]||(s.black[f.black][this.theme_stone_radius]=this.theme_black.preRenderBlack(this.theme_stone_radius,2081,P),s.black[f.black].creation_order.push(this.theme_stone_radius)),S.MoveTree.stone_radius in s.white[f.white]||(s.white[f.white][S.MoveTree.stone_radius]=this.theme_white.preRenderWhite(S.MoveTree.stone_radius,23434,P),s.white[f.white].creation_order.push(S.MoveTree.stone_radius)),S.MoveTree.stone_radius in s.black[f.black]||(s.black[f.black][S.MoveTree.stone_radius]=this.theme_black.preRenderBlack(S.MoveTree.stone_radius,2081,P),s.black[f.black].creation_order.push(S.MoveTree.stone_radius))}catch(y){throw console.error("Error pre-rendering stones.",{themes:f,move_tree_stone_radius:S.MoveTree.stone_radius}),y}let m=500;try{/iP(ad|hone|od).+(Version\/[\d.]|OS \d.*like mac os x)+.*Safari/i.test(navigator.userAgent)&&(console.log("iOS device detected, reducing cache size"),m=12)}catch(y){console.error(y)}if(s.black[f.black].creation_order.length>m){const y=s.black[f.black].creation_order.shift();y&&(console.log("deleting old radius [black]",y),delete s.black[f.black][y])}if(s.white[f.white].creation_order.length>m){const y=s.white[f.white].creation_order.shift();y&&(console.log("deleting old radius [white]",y),delete s.white[f.white][y])}if(this.theme_white_stones=s.white[f.white][this.theme_stone_radius],this.theme_black_stones=s.black[f.black][this.theme_stone_radius],!this.theme_white_stones||!this.theme_black_stones)throw new Error("Failed to load stone images for given radius"+this.theme_stone_radius);this.theme_line_color=this.theme_board.getLineColor(),this.theme_faded_line_color=this.theme_board.getFadedLineColor(),this.theme_star_color=this.theme_board.getStarColor(),this.theme_faded_star_color=this.theme_board.getFadedStarColor(),this.theme_blank_text_color=this.theme_board.getBlankTextColor(),this.theme_black_text_color=this.theme_black.getBlackTextColor(),this.theme_white_text_color=this.theme_white.getWhiteTextColor();const w=this.theme_board.getBackgroundCSS();if(this.parent)for(const y in w)this.parent.style[y]=w[y];u||(this.redraw(!0),this.move_tree_redraw())}onLabelingStart(f){const u=(0,C.getRelativeEventPosition)(f);this.last_label_position=this.xy2ij(u.x,u.y,!1);{const o=this.last_label_position.i,r=this.last_label_position.j;if(!(o>=0&&o<this.width&&r>=0&&r<this.height))return}if(this.labeling_mode=this.putOrClearLabel(this.last_label_position.i,this.last_label_position.j)?"put":"clear",this.__last_pt.valid){const o=this.last_hover_square;delete this.last_hover_square,o&&this.drawSquare(o.x,o.y)}this.__last_pt=this.xy2ij(-1,-1),this.drawSquare(this.last_label_position.i,this.last_label_position.j)}onLabelingMove(f){const u=(0,C.getRelativeEventPosition)(f),o=this.xy2ij(u.x,u.y);{const r=o.i,b=o.j;if(!(r>=0&&r<this.width&&b>=0&&b<this.height))return}(o.i!==this.last_label_position.i||o.j!==this.last_label_position.j)&&(this.last_label_position=o,this.putOrClearLabel(o.i,o.j,this.labeling_mode),this.setLabelCharacterFromMarks())}setTitle(f){this.title=f,this.title_div&&(this.title_div.innerHTML=f)}watchSelectedThemes(f){return p.callbacks.watchSelectedThemes?p.callbacks.watchSelectedThemes(f):{remove:()=>{}}}setMoveTreeContainer(f){this.move_tree_container=f,this.move_tree_redraw()}move_tree_redraw(f){if(!this.move_tree_container)return;let u=!1;if(!this.move_tree_inner_container){u=!0,this.move_tree_inner_container=document.createElement("div"),this.move_tree_canvas=(0,C.allocateCanvasOrError)(),this.move_tree_inner_container.appendChild(this.move_tree_canvas),this.move_tree_container.appendChild(this.move_tree_inner_container),this.move_tree_bindCanvasEvents(this.move_tree_canvas),this.move_tree_container.style.position="relative",this.move_tree_canvas.style.position="absolute";try{const D=new ResizeObserver(()=>{this.move_tree_redraw(!0)});D.observe(this.move_tree_container),this.on("destroy",()=>{D.disconnect()})}catch{}}if(!this.move_tree_canvas){console.warn("move_tree_redraw called without move_tree_canvas set");return}if(u||this.move_tree_inner_container.parentNode!==this.move_tree_container){const D=j=>{try{this.move_tree_redraw(!0)}catch(ee){console.error(ee)}};this.move_tree_container.appendChild(this.move_tree_inner_container),this.move_tree_container.style.position="relative",this.move_tree_container.removeEventListener("scroll",D),this.move_tree_container.addEventListener("scroll",D);const B=this.move_tree_container;this.on("destroy",()=>{B.removeEventListener("scroll",D)})}this.engine.move_tree.recomputeIsobranches();const o=this.engine.cur_move;this.engine.move_tree_layout_dirty=!1,o.setActivePath(++S.MoveTree.active_path_number);const r=this.move_tree_canvas,b=this.engine;this.engine.move_tree_layout_vector=[];const h={};this.engine.move_tree.layout(0,0,h,0),this.engine.move_tree_layout_hash=h;let F=0;for(let D=0;D<this.engine.move_tree_layout_vector.length;++D)F=Math.max(this.engine.move_tree_layout_vector[D]+1,F);const T=this.move_tree_container.clientWidth,P=this.move_tree_container.clientHeight,m=Math.max(T,this.engine.move_tree_layout_vector.length*S.MoveTree.stone_square_size),w=Math.max(P,F*S.MoveTree.stone_square_size);let y=this.move_tree_container.scrollTop,N=this.move_tree_container.scrollLeft;(r.width!==T||r.height!==P)&&(0,C.resizeDeviceScaledCanvas)(r,this.move_tree_container.clientWidth,this.move_tree_container.clientHeight),this.move_tree_inner_container.style.width=m+"px",this.move_tree_inner_container.style.height=w+"px",f||(N>o.layout_cx||N+T-20<o.layout_cx||y>o.layout_cy||y+P-20<o.layout_cy)&&(this.move_tree_container.scrollLeft=o.layout_cx-T/2,this.move_tree_container.scrollTop=o.layout_cy-P/2,y=this.move_tree_container.scrollTop,N=this.move_tree_container.scrollLeft),r.style.top=y+"px",r.style.left=N+"px";const x={offset_x:N,offset_y:y,minx:N-S.MoveTree.stone_square_size,miny:y-S.MoveTree.stone_square_size,maxx:N+T+S.MoveTree.stone_square_size,maxy:y+P+S.MoveTree.stone_square_size},z=r.getContext("2d",{willReadFrequently:!0});if(!z)throw new Error("Failed to get drawing context for move tree canvas");z.clearRect(0,0,r.width,r.height),this.move_tree_hilightNode(z,o,"#6BAADA",x),b.cur_review_move&&b.cur_review_move.id!==o.id&&this.move_tree_hilightNode(z,b.cur_review_move,"#6BDA6B",x),z.save(),z.lineWidth=1,z.strokeStyle=this.theme_line_color,this.move_tree_recursiveDrawPath(z,this.engine.move_tree,x),z.restore(),z.save(),z.globalCompositeOperation="source-over";const U=10;z.font=`bold ${U}px Verdana,Arial,sans-serif`,z.textBaseline="middle",this.move_tree_drawRecursive(z,this.engine.move_tree,S.MoveTree.active_path_number,x),z.restore()}move_tree_bindCanvasEvents(f){const u=o=>{try{if(!this.move_tree_container)throw new Error("move_tree_container was not set");const r=this.move_tree_container.scrollLeft,b=this.move_tree_container.scrollTop,h=(0,C.getRelativeEventPosition)(o);h.x+=r,h.y+=b;const F=Math.floor(h.x/S.MoveTree.stone_square_size),T=Math.floor(h.y/S.MoveTree.stone_square_size),P=this.engine.move_tree.getNodeAtLayoutPosition(F,T);if(P&&(this.engine.cur_move.id!==P.id&&(this.engine.jumpTo(P),this.setLabelCharacterFromMarks(),this.updateTitleAndStonePlacement(),this.emit("update"),this.syncReviewMove(),this.redraw()),this.engine.cur_move.played_by)){const m=(0,C.getRelativeEventPosition)(o);this.emit("played-by-click",{player_id:this.engine.cur_move.played_by,x:m.x,y:m.y})}}catch(r){console.error(r)}};f.addEventListener("touchstart",u),f.addEventListener("mousedown",u),this.on("destroy",()=>{f.removeEventListener("touchstart",u),f.removeEventListener("mousedown",u)})}computeThemeStoneRadius(){let f=this.square_size*.488;return this.square_size%2===0&&(f=Math.min(f,(this.square_size-1)/2)),Math.max(1,f)}move_tree_drawStone(f,u,o,r){const b=u.move_number*31,h=u.layout_cx-r.offset_x,F=u.layout_cy-r.offset_y,T=u.player,P=u.active_path_number===o;P||(f.save(),f.globalAlpha=.4);const m=s.white[this.themes.white][S.MoveTree.stone_radius],w=s.black[this.themes.black][S.MoveTree.stone_radius];if(!m||!w)throw new Error("Failed to load stone images for given radius"+this.theme_stone_radius);if(T===1){const B=w[b%w.length];this.theme_black.placeBlackStone(f,null,B,h,F,S.MoveTree.stone_radius)}else if(T===2){const B=m[b%m.length];this.theme_white.placeWhiteStone(f,null,B,h,F,S.MoveTree.stone_radius)}else return;const y=T===1?this.theme_black_text_color:this.theme_white_text_color;let N="";switch(p.callbacks.getMoveTreeNumbering?p.callbacks.getMoveTreeNumbering():"move-number"){case"move-coordinates":N=u.pretty_coordinates;break;case"none":N="";break;case"move-number":default:u.pretty_coordinates==="pass"?N=".":N=String(u.move_number);break}u.label!==N&&(u.label=N,delete u.label_metrics),f.fillStyle=y,u.label_metrics||(u.label_metrics=f.measureText(u.label));const x=u.label_metrics,z=h-x.width/2,U=F+(/WebKit|Trident/.test(navigator.userAgent)?S.MoveTree.stone_radius*-.01:1);f.fillText(u.label,z,U),P||f.restore();let D=null;u.text&&(D="#3333ff"),u.correct_answer&&(D="#33ff33"),u.wrong_answer&&(D="#ff3333"),D&&(f.beginPath(),f.strokeStyle=D,f.lineWidth=2,f.arc(h,F,S.MoveTree.stone_radius,0,2*Math.PI,!0),f.stroke())}move_tree_drawRecursive(f,u,o,r){u.trunk_next&&this.move_tree_drawRecursive(f,u.trunk_next,o,r);for(let b=0;b<u.branches.length;++b)this.move_tree_drawRecursive(f,u.branches[b],o,r);(!r||u.layout_cx>=r.minx&&u.layout_cx<=r.maxx&&u.layout_cy>=r.miny&&u.layout_cy<=r.maxy)&&this.move_tree_drawStone(f,u,o,r)}move_tree_hilightNode(f,u,o,r){f.beginPath();const b=Math.round(u.layout_cx-S.MoveTree.stone_square_size*.5)-r.offset_x,h=Math.round(u.layout_cy-S.MoveTree.stone_square_size*.5)-r.offset_y;f.rect(b,h,S.MoveTree.stone_square_size,S.MoveTree.stone_square_size),f.fillStyle=o,f.fill()}move_tree_drawPath(f,u,o){if(u.parent){if(u.parent.layout_cx<o.minx&&u.layout_cx<o.minx||u.parent.layout_cy<o.miny&&u.layout_cy<o.miny||u.parent.layout_cx>o.maxx&&u.layout_cx>o.maxx||u.parent.layout_cy>o.maxy&&u.layout_cy>o.maxy)return;f.beginPath(),f.strokeStyle=u.trunk?"#000000":S.MoveTree.line_colors[u.line_color];const r=o.offset_x,b=o.offset_y;f.moveTo(u.parent.layout_cx-r,u.parent.layout_cy-b),f.quadraticCurveTo(u.layout_cx-S.MoveTree.stone_square_size*.5-r,u.layout_cy-b,u.layout_cx-r,u.layout_cy-b),f.stroke()}}move_tree_drawIsoBranchTo(f,u,o,r){let b=u,h=o;if(b.layout_cx<r.minx&&h.layout_cx<r.minx||b.layout_cy<r.miny&&h.layout_cy<r.miny||b.layout_cx>r.maxx&&h.layout_cx>r.maxx||b.layout_cy>r.maxy&&h.layout_cy>r.maxy)return;if(h.trunk_next===null&&h.branches.length===0&&(b.trunk_next!==null||b.branches.length!==0)){const N=b;b=h,h=N}const F=b.trunk_next==null&&b.branches.length===0&&(h.trunk_next!==null||h.branches.length!==0),T=r.offset_x,P=r.offset_y;f.beginPath(),f.strokeStyle=S.MoveTree.isobranch_colors[F?"strong":"weak"];const m=f.lineWidth;f.lineWidth=2,f.moveTo(h.layout_cx-T,h.layout_cy-P);const w=F?h.layout_cy:(b.layout_cy+h.layout_cy)/2,y=(b.layout_cx+h.layout_cx)/2+S.MoveTree.stone_square_size*.5;f.quadraticCurveTo(y-T,w-P,b.layout_cx-T,b.layout_cy-P),f.stroke(),f.lineWidth=m}move_tree_recursiveDrawPath(f,u,o){u.trunk_next&&this.move_tree_recursiveDrawPath(f,u.trunk_next,o);for(let r=0;r<u.branches.length;++r)this.move_tree_recursiveDrawPath(f,u.branches[r],o);if(u.isobranches)for(let r=0;r<u.isobranches.length;++r)this.move_tree_drawIsoBranchTo(f,u,u.isobranches[r],o);this.move_tree_drawPath(f,u,o)}}A.GobanCanvas=c;const d={};function g(k,f,u,o,r){if(u.indexOf("FONT_SIZE")<0)throw new Error(`fitText expects FONT_SIZE to be present in the fontPattern, was ${u}`);const h=`${r} ${u} ${o} ${f}`;if(h in d){const T=d[h];return k.font=T[1],T}let F=o;do{const T=u.replace("FONT_SIZE",F.toString());k.font=T;const P=k.measureText(f);if(F<=4||P.width<r)return d[h]=[F,T,P],d[h];const m=Math.floor(F*r/P.width);m>=F?F=F-1:F=m}while(!0)}},"./src/Goban/Goban.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.Goban=A.GOBAN_FONT=void 0;const q=G("./src/Goban/InteractiveBase.ts"),S=G("./src/Goban/OGSConnectivity.ts"),L=G("./src/Goban/callbacks.ts"),C=G("./src/engine/index.ts"),E=G("./src/Goban/canvas_utils.ts"),R=G("./src/Goban/themes/index.ts");A.GOBAN_FONT="Verdana,Arial,sans-serif";class O extends S.OGSConnectivity{constructor(v,s){super(v,s),this.analysis_scoring_last_position={i:NaN,j:NaN},v.display_width&&this.original_square_size==="auto"&&this.setSquareSizeBasedOnDisplayWidth(v.display_width,!0),this.on("load",a=>{this.display_width&&this.original_square_size==="auto"&&this.setSquareSizeBasedOnDisplayWidth(this.display_width,!0)})}destroy(){super.destroy()}getSelectedThemes(){return L.callbacks.getSelectedThemes?L.callbacks.getSelectedThemes():{white:"Shell",black:"Slate",board:"Kaya","removal-graphic":"square","removal-scale":1}}putOrClearLabel(v,s,a){let c=!1;if(a==null||typeof a>"u")this.analyze_subtool==="letters"||this.analyze_subtool==="numbers"?(this.label_mark=this.label_character,c=this.toggleMark(v,s,this.label_character,!0),c===!0?this.incrementLabelCharacter():this.setLabelCharacterFromMarks()):(this.label_mark=this.analyze_subtool,c=this.toggleMark(v,s,this.analyze_subtool));else if(a==="put")c=this.toggleMark(v,s,this.label_mark,this.label_mark.length<=3,!0);else{const d=this.getMarks(v,s);for(let g=0;g<q.MARK_TYPES.length;++g)delete d[q.MARK_TYPES[g]];this.drawSquare(v,s)}return this.syncReviewMove(),c}getAnalysisScoreColorAtLocation(v,s){return this.getMarks(v,s).score}putAnalysisScoreColorAtLocation(v,s,a,c=!0){const d=this.getMarks(v,s);d.score=a,this.drawSquare(v,s),c&&this.syncReviewMove()}putAnalysisRemovalAtLocation(v,s,a){const c=this.getMarks(v,s);c.remove=a,c.stone_removed=a,this.drawSquare(v,s),this.syncReviewMove()}markAnalysisScores(){var v;if(this.mode!=="analyze"){console.error("markAnalysisScores called when not in analyze mode");return}if(this.marked_analysis_score)for(let d=0;d<this.width;++d)for(let g=0;g<this.height;++g)this.marked_analysis_score[g][d]&&this.putAnalysisScoreColorAtLocation(d,g,void 0,!1);this.marked_analysis_score=(0,C.makeMatrix)(this.width,this.height,!1);const s=this.engine.cloneBoardState();for(let d=0;d<this.width;++d)for(let g=0;g<this.height;++g)(v=s.removal[g])[d]||(v[d]=!!this.getMarks(d,g).stone_removed);const a=this.engine.rules==="japanese"||this.engine.rules==="korean",c=s.computeScoringLocations(!a);for(const d of["black","white"])for(const g of c[d].locations)this.putAnalysisScoreColorAtLocation(g.x,g.y,d,!1),this.marked_analysis_score[g.y][g.x]=!0;this.syncReviewMove()}setSquareSizeBasedOnDisplayWidth(v,s=!1){let a=Math.max(this.bounded_width+ +this.draw_left_labels+ +this.draw_right_labels,this.bounded_height+ +this.draw_bottom_labels+ +this.draw_top_labels);this.display_width=v,isNaN(this.display_width)&&(console.error("Invalid display width. (NaN)"),this.display_width=320),isNaN(a)&&(console.error("Invalid n_squares: ",a),console.error("bounded_width: ",this.bounded_width),console.error("this.draw_left_labels: ",this.draw_left_labels),console.error("this.draw_right_labels: ",this.draw_right_labels),console.error("bounded_height: ",this.bounded_height),console.error("this.draw_top_labels: ",this.draw_top_labels),console.error("this.draw_bottom_labels: ",this.draw_bottom_labels),a=19),this.setSquareSize(Math.floor(this.display_width/a),s)}setLabelPosition(v){this.draw_top_labels=v==="all"||v.indexOf("top")>=0,this.draw_left_labels=v==="all"||v.indexOf("left")>=0,this.draw_right_labels=v==="all"||v.indexOf("right")>=0,this.draw_bottom_labels=v==="all"||v.indexOf("bottom")>=0,this.setSquareSizeBasedOnDisplayWidth(Number(this.display_width)),this.redraw(!0)}onAnalysisToggleStoneRemoval(v){var s;const a=(0,E.getRelativeEventPosition)(v,this.parent);this.analysis_removal_last_position=this.xy2ij(a.x,a.y,!1);const{i:c,j:d}=this.analysis_removal_last_position,g=c,k=d;if(!(g>=0&&g<this.width&&k>=0&&k<this.height))return;this.getMarks(g,k).stone_removed?this.analysis_removal_state=void 0:this.analysis_removal_state=!0,new C.StoneStringBuilder(this.engine).getGroup(g,k).map(b=>{this.putAnalysisRemovalAtLocation(b.x,b.y,this.analysis_removal_state)}),((s=this.marked_analysis_score)===null||s===void 0?void 0:s.some(b=>b.includes(!0)))&&this.markAnalysisScores()}clearAnalysisScores(){if(delete this.marked_analysis_score,this.mode!=="analyze"){console.error("clearAnalysisScores called when not in analyze mode");return}for(let v=0;v<this.width;++v)for(let s=0;s<this.height;++s)this.putAnalysisScoreColorAtLocation(v,s,void 0,!1);this.syncReviewMove()}setSquareSize(v,s=!1){const a=this.square_size!==v&&!s;this.square_size=Math.max(v,1),a&&this.redraw(!0)}setStoneFontScale(v,s=!1){const a=this.stone_font_scale!==v&&!s;this.stone_font_scale=v,a&&this.redraw(!0)}computeMetrics(){(!this.square_size||this.square_size<=0)&&(this.square_size=12);const v={width:this.square_size*(this.bounded_width+ +this.draw_left_labels+ +this.draw_right_labels),height:this.square_size*(this.bounded_height+ +this.draw_top_labels+ +this.draw_bottom_labels),mid:this.square_size/2,offset:0};return this.square_size%2===0&&(v.mid-=.5,v.offset=.5),v}onAnalysisScoringStart(v){const s=(0,E.getRelativeEventPosition)(v,this.parent);this.analysis_scoring_last_position=this.xy2ij(s.x,s.y,!1);{const c=this.analysis_scoring_last_position.i,d=this.analysis_scoring_last_position.j;if(!(c>=0&&c<this.width&&d>=0&&d<this.height))return}if(this.getAnalysisScoreColorAtLocation(this.analysis_scoring_last_position.i,this.analysis_scoring_last_position.j)===this.analyze_subtool?this.analysis_scoring_color=void 0:this.analysis_scoring_color=this.analyze_subtool,this.putAnalysisScoreColorAtLocation(this.analysis_scoring_last_position.i,this.analysis_scoring_last_position.j,this.analysis_scoring_color),this.__last_pt.valid){const c=this.last_hover_square;delete this.last_hover_square,c&&this.drawSquare(c.x,c.y)}this.__last_pt=this.xy2ij(-1,-1),this.drawSquare(this.analysis_scoring_last_position.i,this.analysis_scoring_last_position.j)}onAnalysisScoringMove(v){const s=(0,E.getRelativeEventPosition)(v,this.parent),a=this.xy2ij(s.x,s.y);{const c=a.i,d=a.j;if(!(c>=0&&c<this.width&&d>=0&&d<this.height))return}(a.i!==this.analysis_scoring_last_position.i||a.j!==this.analysis_scoring_last_position.j)&&(this.analysis_scoring_last_position=a,this.putAnalysisScoreColorAtLocation(a.i,a.j,this.analysis_scoring_color))}}A.Goban=O,O.THEMES=R.THEMES,O.THEMES_SORTED=R.THEMES_SORTED},"./src/Goban/InteractiveBase.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanInteractive=A.MARK_TYPES=A.SCORE_ESTIMATION_TOLERANCE=A.SCORE_ESTIMATION_TRIALS=void 0;const q=G("./src/engine/index.ts"),S=G("./src/engine/util/index.ts"),L=G("./src/engine/util/index.ts"),C=G("./src/engine/translate.ts"),E=G("./src/Goban/callbacks.ts"),R=G("./src/GobanBase.ts");A.SCORE_ESTIMATION_TRIALS=1e3,A.SCORE_ESTIMATION_TOLERANCE=.3,A.MARK_TYPES=["letter","circle","square","triangle","sub_triangle","cross","black","white","score","stone_removed"];class O extends R.GobanBase{get mode(){return this._mode}set mode(s){this._mode!==s&&(this._mode=s,this.emit("mode",this.mode))}get title(){return this._title}set title(s){this._title!==s&&(this._title=s,this.emit("title",this.title))}get submit_move(){return this._submit_move}set submit_move(s){this._submit_move!==s&&(this._submit_move=s,this.emit("submit_move",this.submit_move))}get analyze_tool(){return this._analyze_tool}set analyze_tool(s){this._analyze_tool!==s&&(this._analyze_tool=s,this.emit("analyze_tool",this.analyze_tool))}get analyze_subtool(){return this._analyze_subtool}set analyze_subtool(s){this._analyze_subtool!==s&&(this._analyze_subtool=s,this.emit("analyze_subtool",this.analyze_subtool))}get score_estimator(){return this._score_estimator}set score_estimator(s){var a;this._score_estimator!==s&&(this._score_estimator=s,this.emit("score_estimate",this.score_estimator),(a=this._score_estimator)===null||a===void 0||a.when_ready.then(()=>{this.emit("score_estimate",this.score_estimator)}).catch(()=>{}))}get review_owner_id(){return this._review_owner_id}set review_owner_id(s){this._review_owner_id!==s&&(this._review_owner_id=s,this.emit("review_owner_id",this.review_owner_id))}get review_controller_id(){return this._review_controller_id}set review_controller_id(s){this._review_controller_id!==s&&(this._review_controller_id=s,this.emit("review_controller_id",this.review_controller_id))}constructor(s,a){super(),this.conditional_starting_color="invalid",this.conditional_tree=new q.ConditionalMoveTree(null),this.clock_should_be_paused_for_move_submission=!1,this.showing_scores=!1,this.chat_log=[],this.last_paused_state=null,this.last_paused_by_player_state=null,this.analysis_removal_last_position={i:NaN,j:NaN},this._mode="play",this._title="play",this._analyze_tool="stone",this._analyze_subtool="alternate",this._score_estimator=null,this.square_size=10,this.__board_redraw_pen_layer_timer=null,this.__last_pt={i:-1,j:-1,valid:!1},this.__update_move_tree=null,this.stone_removal_auto_scoring_done=!1,this.conditional_path="",this.currently_my_cmove=!1,this.dirty_redraw=null,this.disconnectedFromGame=!0,this.done_loading_review=!1,this.label_mark="[UNSET]",this.last_emitted_captured_stones=[],this.preloaded_data=a,this.on("clock",g=>{g&&(this.last_emitted_clock=g)});const c={},d=this.defaultConfig();for(const g in d)c[g]=d[g];for(const g in s)c[g]=s[g];s=c,this.on_game_screen=this.getLocation().indexOf("/game/")>=0,this.no_display=!1,this.width=s.width||19,this.height=s.height||19,this.bounds=s.bounds||{top:0,left:0,bottom:this.height-1,right:this.width-1},this.bounded_width=this.bounds?this.bounds.right-this.bounds.left+1:this.width,this.bounded_height=this.bounds?this.bounds.bottom-this.bounds.top+1:this.height,this.last_stone_sound=-1,this.scoring_mode=!1,this.game_type=s.game_type||"",this.one_click_submit="one_click_submit"in s?!!s.one_click_submit:!1,this.double_click_submit="double_click_submit"in s?!!s.double_click_submit:!0,this.variation_stone_opacity=typeof s.variation_stone_opacity<"u"?s.variation_stone_opacity:.6,this.original_square_size=s.square_size||"auto",this.interactive=!!s.interactive,this.pen_marks=[],this.config=p(s),this.__draw_state=(0,S.makeMatrix)(this.width,this.height,""),this.game_id=(typeof s.game_id=="string"?parseInt(s.game_id):s.game_id)||0,this.player_id=s.player_id||0,this.review_id=s.review_id||0,this.last_review_message={},this.review_had_gamedata=!1,this.puzzle_autoplace_delay=s.puzzle_autoplace_delay||300,this.isPlayerOwner=s.isPlayerOwner||(()=>!1),this.isPlayerController=s.isPlayerController||(()=>!1),this.isInPushedAnalysis=s.isInPushedAnalysis?s.isInPushedAnalysis:()=>!1,this.leavePushedAnalysis=s.leavePushedAnalysis?s.leavePushedAnalysis:()=>{},"onError"in s&&(this.onError=s.onError),this.dont_draw_last_move=!!s.dont_draw_last_move,this.last_move_radius=s.last_move_radius||.25,this.circle_radius=s.circle_radius||.25,this.getPuzzlePlacementSetting=s.getPuzzlePlacementSetting,this.mode=s.mode||"play",this.previous_mode=this.mode,this.label_character="A",this.stone_placement_enabled=!1,this.highlight_movetree_moves=!1,this.restrict_moves_to_movetree=!1,this.analysis_move_counter=0,this.errorHandler=g=>{if(!(g instanceof q.GobanMoveError&&g.message_id==="stone_already_placed_here")){if(g instanceof q.GobanMoveError&&g.message_id==="illegal_self_capture"){this.showMessage("self_capture_not_allowed",{error:g},5e3);return}else this.showMessage("error",{error:g},5e3);this.onError&&this.onError(g)}},this.draw_top_labels="draw_top_labels"in s?!!s.draw_top_labels:!0,this.draw_left_labels="draw_left_labels"in s?!!s.draw_left_labels:!0,this.draw_right_labels="draw_right_labels"in s?!!s.draw_right_labels:!0,this.draw_bottom_labels="draw_bottom_labels"in s?!!s.draw_bottom_labels:!0,this.show_variation_move_numbers=this.getShowVariationMoveNumbers(),this.stone_font_scale=this.getStoneFontScale(),this.bounds.left>0&&(this.draw_left_labels=!1),this.bounds.top>0&&(this.draw_top_labels=!1),this.bounds.right<this.width-1&&(this.draw_right_labels=!1),this.bounds.bottom<this.height-1&&(this.draw_bottom_labels=!1),typeof s.square_size=="function"?(this.square_size=s.square_size(this),isNaN(this.square_size)&&(console.error("Invalid square size set: (NaN)"),this.square_size=12)):typeof s.square_size=="number"&&(this.square_size=s.square_size),this.__update_move_tree=null,this.shift_key_is_down=!1}post_config_constructor(){let s;return delete this.current_cmove,this.currently_my_cmove=!1,this.setConditionalTree(void 0),delete this.last_hover_square,this.__last_pt=this.xy2ij(-1,-1),this.preloaded_data?s=this.load(this.preloaded_data):s=this.load(this.config),s}getCoordinateDisplaySystem(){return E.callbacks.getCoordinateDisplaySystem?E.callbacks.getCoordinateDisplaySystem():"A1"}getShowUndoRequestIndicator(){return E.callbacks.getShowUndoRequestIndicator?E.callbacks.getShowUndoRequestIndicator():!0}getShowVariationMoveNumbers(){return E.callbacks.getShowVariationMoveNumbers?E.callbacks.getShowVariationMoveNumbers():!1}getStoneFontScale(){return E.callbacks.getStoneFontScale?E.callbacks.getStoneFontScale():1}static getMoveTreeNumbering(){return E.callbacks.getMoveTreeNumbering?E.callbacks.getMoveTreeNumbering():"move-number"}static getCDNReleaseBase(){return E.callbacks.getCDNReleaseBase?E.callbacks.getCDNReleaseBase():""}static getSoundEnabled(){return E.callbacks.getSoundEnabled?E.callbacks.getSoundEnabled():!0}static getSoundVolume(){return E.callbacks.getSoundVolume?E.callbacks.getSoundVolume():.5}defaultConfig(){return E.callbacks.defaultConfig?E.callbacks.defaultConfig():{}}isAnalysisDisabled(s=!1){return E.callbacks.isAnalysisDisabled?E.callbacks.isAnalysisDisabled(this,s):!1}getLocation(){return E.callbacks.getLocation?E.callbacks.getLocation():window.location.pathname}destroy(){super.destroy(),delete this.isPlayerController,delete this.isPlayerOwner,delete this.isInPushedAnalysis,delete this.leavePushedAnalysis,delete this.onError,delete this.onScoreEstimationUpdated,delete this.getPuzzlePlacementSetting}scheduleRedrawPenLayer(){this.__board_redraw_pen_layer_timer||(this.__board_redraw_pen_layer_timer=setTimeout(()=>{this.engine.cur_move.pen_marks.length?this.drawPenMarks(this.engine.cur_move.pen_marks):this.pen_marks.length&&this.clearAnalysisDrawing(),this.__board_redraw_pen_layer_timer=null},100))}getWidthForSquareSize(s){return(this.bounded_width+ +this.draw_left_labels+ +this.draw_right_labels)*s}xy2ij(s,a,c=!0){s>0&&a>0&&(this.bounds.left>0?s+=this.bounds.left*this.square_size:s-=+this.draw_left_labels*this.square_size,this.bounds.top>0?a+=this.bounds.top*this.square_size:a-=+this.draw_top_labels*this.square_size);const d=s/this.square_size,g=a/this.square_size;let k=Math.floor(d),f=Math.floor(g);return Math.min(d-k,g-f,1-(d-k),1-(g-f))<.1&&c&&(k=-1,f=-1),{i:k,j:f,valid:k>=0&&f>=0&&k<this.width&&f<this.height}}setAnalyzeTool(s,a){this.analyze_tool=s,this.analyze_subtool=a??"alternate",s==="stone"&&a==="black"?this.edit_color="black":s==="stone"&&a==="white"?this.edit_color="white":delete this.edit_color,this.setLabelCharacterFromMarks(this.analyze_subtool),s==="draw"&&this.enablePen()}setSubmit(s){this.submit_move=s,this.emit("submit_move",s)}markDirty(){this.dirty_redraw||(this.dirty_redraw=setTimeout(()=>{this.dirty_redraw=null,this.redraw()},1))}set(s,a,c){this.markDirty()}updateMoveTree(){this.move_tree_redraw()}updateOrRedrawMoveTree(){this.engine.move_tree_layout_dirty?this.move_tree_redraw():this.updateMoveTree()}setBounds(s){this.bounds=s||{top:0,left:0,bottom:this.height-1,right:this.width-1},this.bounds?(this.bounded_width=this.bounds.right-this.bounds.left+1,this.bounded_height=this.bounds.bottom-this.bounds.top+1):(this.bounded_width=this.width,this.bounded_height=this.height),this.draw_left_labels=!!this.config.draw_left_labels,this.draw_right_labels=!!this.config.draw_right_labels,this.draw_top_labels=!!this.config.draw_top_labels,this.draw_bottom_labels=!!this.config.draw_bottom_labels,this.bounds.left>0&&(this.draw_left_labels=!1),this.bounds.top>0&&(this.draw_top_labels=!1),this.bounds.right<this.width-1&&(this.draw_right_labels=!1),this.bounds.bottom<this.height-1&&(this.draw_bottom_labels=!1)}load(s){s=p(s);for(const r in s)this.config[r]=s[r];this.clearMessage();const a=s.width||19,c=s.height||19;let d=a===this.width&&c===this.height;this.width=a,this.height=c,delete this.move_selected,this.bounds=s.bounds||{top:0,left:0,bottom:this.height-1,right:this.width-1},this.bounds?(this.bounded_width=this.bounds.right-this.bounds.left+1,this.bounded_height=this.bounds.bottom-this.bounds.top+1):(this.bounded_width=this.width,this.bounded_height=this.height),s.display_width!==void 0&&(this.display_width=s.display_width),(!this.__draw_state||this.__draw_state.length!==this.height||this.__draw_state[0].length!==this.width)&&(this.__draw_state=(0,S.makeMatrix)(this.width,this.height,"")),this.chat_log=[];const g=(s.chat_log||[]).map(r=>(r.channel="main",r)),k=(s.spectator_log||[]).map(r=>(r.channel="spectator",r)),f=(s.malkovich_log||[]).map(r=>(r.channel="malkovich",r));this.chat_log=this.chat_log.concat(g,k,f),this.chat_log.sort((r,b)=>r.date-b.date);for(const r of this.chat_log)this.emit("chat",r);if(s.player_pool||(s.player_pool={}),s.players&&(s.player_pool[s.players.black.id]=s.players.black,s.player_pool[s.players.white.id]=s.players.white),s.rengo_teams)for(const r of s.rengo_teams.black.concat(s.rengo_teams.white))s.player_pool[r.id]=r;const u=this.engine;d=d&&u!==null&&u!==void 0,d=d&&this.mode==="analyze"&&u.phase==="finished";const o=new q.GobanEngine(s);return d=d&&u.phase===o.phase,d=d&&u.move_tree.containsOtherTreeAsSubset(o.move_tree),d||(this.engine=new q.GobanEngine(s,this),this.emit("engine.updated",this.engine),this.engine.parentEventEmitter=this),this.paused_since=s.paused_since,this.pause_control=s.pause_control,this.config.marks&&this.engine&&this.setMarks(this.config.marks),this.setConditionalTree(),this.getPuzzlePlacementSetting&&(this.engine.puzzle_player_move_mode==="fixed"&&this.getPuzzlePlacementSetting().mode==="play"&&(this.highlight_movetree_moves=!0,this.restrict_moves_to_movetree=!0),this.getPuzzlePlacementSetting&&this.getPuzzlePlacementSetting().mode!=="play"&&(this.highlight_movetree_moves=!0)),u&&(0,L.matricesAreEqual)(u.board,this.engine.board)||this.redraw(!0),this.updatePlayerToMoveTitle(),this.mode==="play"?this.engine.playerToMove()===this.player_id?this.enableStonePlacement():this.disableStonePlacement():this.stone_placement_enabled&&(this.disableStonePlacement(),this.enableStonePlacement()),d||this.setLastOfficialMove(),this.emit("update"),this.emit("load",s),this.engine}setForRemoval(s,a,c,d=!0){c?(this.getMarks(s,a).stone_removed=!0,this.getMarks(s,a).remove=!0):(this.getMarks(s,a).stone_removed=!1,this.getMarks(s,a).remove=!1),this.drawSquare(s,a),this.emit("set-for-removal",{x:s,y:a,removed:c}),d&&this.emit("stone-removal.updated")}showScores(s,a=!1){this.hideScores(),this.showing_scores=!0;for(let c=0;c<2;++c){const d=c?"black":"white",g=this.engine.decodeMoves(s[d].scoring_positions);for(let k=0;k<g.length;++k){const f=g[k];a&&this.engine.board[f.y][f.x]>0||(f.y<0||f.x<0?(console.error("Negative scoring position: ",f),console.error("Scoring positions ["+d+"]: ",s[d].scoring_positions)):(this.getMarks(f.x,f.y).score=d,this.drawSquare(f.x,f.y)))}}}hideScores(){this.showing_scores=!1;for(let s=0;s<this.height;++s)for(let a=0;a<this.width;++a)this.getMarks(a,s).score&&(delete this.getMarks(a,s).score,this.drawSquare(a,s))}showStallingScoreEstimate(s){this.hideScores(),this.showing_scores=!0,this.scoring_mode="stalling-scoring-mode",this.stalling_score_estimate=s,this.redraw()}updatePlayerToMoveTitle(){switch(this.engine.phase){case"play":if(this.player_id&&this.player_id===this.engine.playerToMove()&&this.engine.cur_move.id===this.engine.last_official_move.id)this.engine.cur_move.passed()&&this.engine.handicapMovesLeft()<=0&&this.engine.cur_move.parent?(this.setTitle((0,C._)("Your move - opponent passed")),this.last_move&&this.last_move.x>=0&&this.drawSquare(this.last_move.x,this.last_move.y)):this.setTitle((0,C._)("Your move")),this.engine.cur_move.id===this.engine.last_official_move.id&&this.mode==="play"&&this.emit("state_text",{title:(0,C._)("Your move")});else{const s=this.engine.playerColor(this.engine.playerToMove());let a;s==="black"?a=(0,C._)("Black to move"):a=(0,C._)("White to move"),this.setTitle(a),this.engine.cur_move.id===this.engine.last_official_move.id&&this.mode==="play"&&this.emit("state_text",{title:a,show_moves_made_count:!0})}break;case"stone removal":this.setTitle((0,C._)("Stone Removal")),this.emit("state_text",{title:(0,C._)("Stone Removal Phase")});break;case"finished":this.setTitle((0,C._)("Game Finished")),this.emit("state_text",{title:(0,C._)("Game Finished")});break;default:this.setTitle(this.engine.phase);break}}disableStonePlacement(){this.stone_placement_enabled=!1,this.__last_pt&&this.__last_pt.valid&&this.drawSquare(this.__last_pt.i,this.__last_pt.j)}enableStonePlacement(){this.stone_placement_enabled&&this.disableStonePlacement(),this.stone_placement_enabled=!0,this.__last_pt&&this.__last_pt.valid&&this.drawSquare(this.__last_pt.i,this.__last_pt.j)}showFirst(s){this.engine.jumpTo(this.engine.move_tree),s||(this.updateTitleAndStonePlacement(),this.emit("update"))}showPrevious(s){if(this.mode==="conditional"){if(this.conditional_path.length>=2){const a=this.conditional_path.substr(0,this.conditional_path.length-2);this.jumpToLastOfficialMove(),this.followConditionalPath(a)}}else{if(this.move_selected){this.jumpToLastOfficialMove();return}this.engine.showPrevious()}s||(this.updateTitleAndStonePlacement(),this.emit("update"))}showNext(s){if(this.mode==="conditional"){if(this.current_cmove)if(this.currently_my_cmove)this.current_cmove.move!==null&&this.followConditionalPath(this.current_cmove.move);else for(const a in this.current_cmove.children){this.followConditionalPath(a);break}}else{if(this.move_selected)return;this.engine.showNext()}s||(this.updateTitleAndStonePlacement(),this.emit("update"))}prevSibling(){const s=this.engine.cur_move.prevSibling();s&&(this.engine.jumpTo(s),this.emit("update"))}nextSibling(){const s=this.engine.cur_move.nextSibling();s&&(this.engine.jumpTo(s),this.emit("update"))}jumpToLastOfficialMove(){delete this.move_selected,this.engine.jumpToLastOfficialMove(),this.updateTitleAndStonePlacement(),this.conditional_path="",this.currently_my_cmove=!1,this.mode==="conditional"&&(this.current_cmove=this.conditional_tree),this.emit("update")}setLastOfficialMove(){this.engine.setLastOfficialMove(),this.updateTitleAndStonePlacement()}isLastOfficialMove(){return this.engine.isLastOfficialMove()}updateTitleAndStonePlacement(){if(this.updatePlayerToMoveTitle(),this.engine.phase==="stone removal"||this.scoring_mode)this.enableStonePlacement();else if(this.engine.phase==="play")switch(this.mode){case"play":this.isLastOfficialMove()&&this.engine.playerToMove()===this.player_id?this.enableStonePlacement():this.disableStonePlacement();break;case"analyze":case"conditional":case"puzzle":this.disableStonePlacement(),this.enableStonePlacement();break}else this.engine.phase==="finished"&&(this.disableStonePlacement(),this.mode==="analyze"&&this.enableStonePlacement())}setConditionalTree(s){typeof s>"u"?this.conditional_tree=new q.ConditionalMoveTree(null):this.conditional_tree=s,this.current_cmove=this.conditional_tree,this.emit("conditional-moves.updated"),this.emit("update")}followConditionalPath(s){const a=this.engine.decodeMoves(s);for(let c=0;c<a.length;++c)this.engine.place(a[c].x,a[c].y),this.followConditionalSegment(a[c].x,a[c].y);this.emit("conditional-moves.updated")}followConditionalSegment(s,a){const c=(0,S.encodeMove)(s,a);if(this.conditional_path+=c,!this.current_cmove)throw new Error("followConditionalSegment called when current_cmove was not set");if(this.currently_my_cmove)c!==this.current_cmove.move&&(this.current_cmove.children={}),this.current_cmove.move=c;else{let d=null;c in this.current_cmove.children?d=this.current_cmove.children[c]:(d=new q.ConditionalMoveTree(null,this.current_cmove),this.current_cmove.children[c]=d),this.current_cmove=d}this.currently_my_cmove=!this.currently_my_cmove,this.emit("conditional-moves.updated")}deleteConditionalSegment(s,a){if(this.conditional_path+=(0,S.encodeMove)(s,a),!this.current_cmove)throw new Error("deleteConditionalSegment called when current_cmove was not set");if(this.currently_my_cmove){this.current_cmove.children={},this.current_cmove.move=null;const c=this.current_cmove,d=c.parent;if(this.current_cmove=d,d)for(const g in d.children)d.children[g]===c&&delete d.children[g]}else{console.error("deleteConditionalSegment called on other player's move, which doesn't make sense");return}this.currently_my_cmove=!this.currently_my_cmove,this.emit("conditional-moves.updated")}deleteConditionalPath(s){const a=this.engine.decodeMoves(s);if(a.length){for(let c=0;c<a.length-1;++c)c!==a.length-2&&this.engine.place(a[c].x,a[c].y),this.followConditionalSegment(a[c].x,a[c].y);this.deleteConditionalSegment(a[a.length-1].x,a[a.length-1].y),this.conditional_path=this.conditional_path.substr(0,this.conditional_path.length-4)}this.emit("conditional-moves.updated")}getCurrentConditionalPath(){return this.conditional_path}setToPreviousMode(s){return this.setMode(this.previous_mode,s)}setModeDeferred(s){setTimeout(()=>{this.setMode(s)},1)}setMode(s,a){if(s==="conditional"&&this.player_id===this.engine.playerToMove()&&this.mode!=="score estimation"){try{swal.fire("Can't enter conditional move planning when it's your turn")}catch(d){console.error(d)}return!1}if(this.setSubmit(),["play","analyze","conditional","edit","score estimation","puzzle"].indexOf(s)===-1){try{swal.fire("Invalid mode for Goban: "+s)}catch(d){console.error(d)}return!1}if(s==="analyze"&&this.scoring_mode==="stalling-scoring-mode"&&(this.scoring_mode=!1),this.engine.config.disable_analysis&&this.engine.phase!=="finished"&&(s==="analyze"||s==="conditional")){try{swal.fire("Unable to enter "+s+" mode")}catch(d){console.error(d)}return!1}s==="conditional"&&(this.conditional_starting_color=this.engine.playerColor());let c=!0;return this.previous_mode=this.mode,this.mode=s,a||this.jumpToLastOfficialMove(),this.mode!=="analyze"||this.analyze_tool!=="draw"?this.disablePen():this.enablePen(),s==="play"&&this.engine.phase!=="finished"&&(this.engine.cur_move.clearMarks(),c=!0),c&&(this.clearAnalysisDrawing(),this.redraw()),this.updateTitleAndStonePlacement(),!0}setEditColor(s){this.edit_color=s,this.updateTitleAndStonePlacement()}playMovementSound(){if(this.last_sound_played_for_a_stone_placement===this.engine.cur_move.x+","+this.engine.cur_move.y)return;this.last_sound_played_for_a_stone_placement=this.engine.cur_move.x+","+this.engine.cur_move.y;let s;do s=Math.round(Math.random()*1e4)%5;while(s===this.last_stone_sound);this.last_stone_sound=s,this.last_sound_played_for_a_stone_placement==="-1,-1"?this.emit("audio-pass"):this.emit("audio-stone",{x:this.engine.cur_move.x,y:this.engine.cur_move.y,width:this.engine.width,height:this.engine.height,color:this.engine.colorNotToMove()})}setMarks(s,a){for(const c in s){const d=this.engine.decodeMoves(s[c]);for(let g=0;g<d.length;++g){const k=d[g];this.setMark(k.x,k.y,c,a)}}}setHeatmap(s,a){this.heatmap=s,a||this.redraw(!0)}setColoredCircles(s,a){if(!s||s.length===0){delete this.colored_circles;return}this.colored_circles=(0,S.makeEmptyMatrix)(this.width,this.height);for(const c of s){const d=c.move;this.colored_circles[d.y][d.x]=c}a||this.redraw(!0)}setColoredMarks(s){for(const a in s){const c=this.engine.decodeMoves(s[a].move);for(let d=0;d<c.length;++d){const g=c[d];this.setMarkColor(g.x,g.y,s[a].color),this.setMark(g.x,g.y,a,!1)}}}setMarkColor(s,a,c){this.engine.cur_move.getMarks(s,a).color=c}setLetterMark(s,a,c,d){this.engine.cur_move.getMarks(s,a).letter=c,d&&this.drawSquare(s,a)}setSubscriptMark(s,a,c,d=!0){this.engine.cur_move.getMarks(s,a).subscript=c,d&&this.drawSquare(s,a)}setCustomMark(s,a,c,d){this.engine.cur_move.getMarks(s,a)[c]=!0,d&&this.drawSquare(s,a)}deleteCustomMark(s,a,c,d){delete this.engine.cur_move.getMarks(s,a)[c],d&&this.drawSquare(s,a)}editPlaceByPrettyCoordinates(s,a,c){for(const d of this.engine.decodeMoves(s))this.engine.editPlace(d.x,d.y,a,c)}placeByPrettyCoordinates(s){for(const a of this.engine.decodeMoves(s)){const c=[],d=this.engine.place(a.x,a.y,void 0,void 0,void 0,void 0,void 0,c);d>0&&(this.emit("audio-capture-stones",{count:d,already_captured:0}),this.debouncedEmitCapturedStones(c))}}setMarkByPrettyCoordinates(s,a,c){for(const d of this.engine.decodeMoves(s))this.setMark(d.x,d.y,a,c)}setMark(s,a,c,d){try{if(s>=0&&a>=0)if(typeof c=="number"&&(c=""+c),c.startsWith("score-")){const g=c.split("-")[1];this.getMarks(s,a).score=g,d||this.drawSquare(s,a)}else c.length<=3||parseFloat(c)?this.setLetterMark(s,a,c,!d):this.setCustomMark(s,a,c,!d)}catch(g){console.error(g.stack)}}setTransientMark(s,a,c,d){try{s>=0&&a>=0&&(typeof c=="number"&&(c=""+c),c.length<=3?this.engine.cur_move.getMarks(s,a).transient_letter=c:this.engine.cur_move.getMarks(s,a)["transient_"+c]=!0,d||this.drawSquare(s,a))}catch(g){console.error(g.stack)}}getMarks(s,a){return this.engine&&this.engine.cur_move?this.engine.cur_move.getMarks(s,a):{}}toggleMark(s,a,c,d,g){let k=!0;typeof c=="number"&&(c=""+c);const f=this.getMarks(s,a),u=()=>{for(let o=0;o<A.MARK_TYPES.length;++o)delete f[A.MARK_TYPES[o]]};return d||/^[a-zA-Z0-9]{1,2}$/.test(c)?!g&&"letter"in f?(u(),k=!1):(u(),f.letter=c):!g&&c in f?(u(),k=!1):(u(),this.getMarks(s,a)[c]=!0),this.drawSquare(s,a),k}incrementLabelCharacter(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";parseInt(this.label_character)?this.label_character=""+(parseInt(this.label_character)+1):s.indexOf(this.label_character)!==-1&&(this.label_character=s[(s.indexOf(this.label_character)+1)%s.length])}setLabelCharacterFromMarks(s){if(s==="letters"||/^[a-zA-Z]$/.test(this.label_character)){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let c=-1;for(let d=0;d<this.height;++d)for(let g=0;g<this.width;++g){const k=this.getMarks(g,d).letter;k&&(c=Math.max(c,a.indexOf(k)))}this.label_character=a[c+1%a.length]}if(s==="numbers"||/^[0-9]+$/.test(this.label_character)){let a=0;for(let c=0;c<this.height;++c)for(let d=0;d<this.width;++d){const g=parseInt(this.getMarks(d,c).letter||"");g&&(a=Math.max(a,g))}this.label_character=""+(a+1)}}setLabelCharacter(s){this.label_character=s,this.last_hover_square&&this.drawSquare(this.last_hover_square.x,this.last_hover_square.y)}clearMark(s,a,c){try{typeof c=="number"&&(c=""+c),/^[a-zA-Z0-9]{1,2}$/.test(c)?this.getMarks(s,a).letter="":this.getMarks(s,a)[c]=!1,this.drawSquare(s,a)}catch(d){console.error(d)}}clearTransientMark(s,a,c){try{typeof c=="number"&&(c=""+c),/^[a-zA-Z0-9]{1,2}$/.test(c)?this.getMarks(s,a).transient_letter="":this.getMarks(s,a)["transient_"+c]=!1,this.drawSquare(s,a)}catch(d){console.error(d)}}updateScoreEstimation(){if(this.score_estimator){const s=this.score_estimator.estimated_hard_score-this.engine.komi;E.callbacks.updateScoreEstimation&&E.callbacks.updateScoreEstimation(s>0?"black":"white",Math.abs(s)),this.config.onScoreEstimationUpdated&&this.config.onScoreEstimationUpdated(s>0?"black":"white",Math.abs(s)),this.emit("score_estimate",this.score_estimator)}}isCurrentUserAPlayer(){return this.player_id in this.engine.player_pool}setScoringMode(s,a=!1){this.scoring_mode=s;const c=this.engine.cur_move;if(this.scoring_mode){this.showMessage("processing",void 0,-1),this.setMode("score estimation",!0),this.clearMessage();const d=!1;this.score_estimator=this.engine.estimateScore(A.SCORE_ESTIMATION_TRIALS,A.SCORE_ESTIMATION_TOLERANCE,a,d),this.enableStonePlacement(),this.redraw(!0),this.emit("update")}else this.previous_mode==="analyze"||this.previous_mode==="conditional"?this.setToPreviousMode(!0):this.setMode("play"),this.redraw(!0);return c}debouncedEmitCapturedStones(s){if(s.length>0){const a=s.map(d=>({x:d.x,y:d.y})).sort((d,g)=>d.x<g.x?-1:d.x>g.x?1:d.y<g.y?-1:d.y>g.y?1:0);let c=a.length!==this.last_emitted_captured_stones.length;if(!c){for(let d=0;d<a.length;++d)if(a[d].x!==this.last_emitted_captured_stones[d].x||a[d].y!==this.last_emitted_captured_stones[d].y){c=!0;break}}c&&(this.last_emitted_captured_stones=s,this.emit("captured-stones",{removed_stones:s}))}}}A.GobanInteractive=O;function p(v){if(v.time_control&&(!v.time_control.system&&v.time_control.time_control&&(v.time_control.system=v.time_control.time_control,console.log("Repairing goban config: time_control.time_control -> time_control.system = ",v.time_control.system)),!v.time_control.speed)){const s=(0,L.computeAverageMoveTime)(v.time_control,v.width,v.height);v.time_control.speed=s===0||s>3600?"correspondence":s<10?"blitz":"live",console.log("Repairing goban config: time_control.speed = ",v.time_control.speed)}return v}},"./src/Goban/OGSConnectivity.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.OGSConnectivity=void 0;const q=G("./src/Goban/InteractiveBase.ts"),S=G("./src/Goban/callbacks.ts"),L=G("./src/engine/translate.ts"),C=G("./src/Goban/focus_tracker.ts"),E=G("./src/engine/index.ts");class R extends q.GobanInteractive{constructor(a,c){super(a,c),this.sent_timed_out_message=!1,this.socket_event_bindings=[],this.setGameClock(null),this.on("load",d=>{this.engine.phase==="stone removal"&&!("auto_scoring_done"in this)&&!("auto_scoring_done"in this.engine)&&this.performStoneRemovalAutoScoring()})}post_config_constructor(){const a=super.post_config_constructor();return"server_socket"in this.config&&this.config.server_socket&&(this.preloaded_data||this.showMessage("loading",void 0,-1),this.connect(this.config.server_socket)),a}destroy(){super.destroy(),this.socket&&this.disconnect(),this.sendLatencyTimer&&(clearInterval(this.sendLatencyTimer),delete this.sendLatencyTimer),this.clock_should_be_paused_for_move_submission=!1,this.setGameClock(null)}_socket_on(a,c){this.socket.on(a,c),this.socket_event_bindings.push([a,c])}getClockDrift(){return S.callbacks.getClockDrift?S.callbacks.getClockDrift():(console.warn("getClockDrift not provided for Goban instance"),0)}getNetworkLatency(){return S.callbacks.getNetworkLatency?S.callbacks.getNetworkLatency():(console.warn("getNetworkLatency not provided for Goban instance"),0)}connect(a){const c=this.socket=a;this.disconnectedFromGame=!1;const d=()=>{if(!this.disconnectedFromGame&&(this.review_id?(this.connectToReviewSent=!0,this.done_loading_review=!1,this.setTitle((0,L._)("Review")),this.disconnectedFromGame||c.send("review/connect",{review_id:this.review_id}),this.emit("chat-reset")):this.game_id&&(this.disconnectedFromGame||c.send("game/connect",{game_id:this.game_id,chat:!!this.config.connect_to_chat})),!this.sendLatencyTimer)){const o=()=>{!this.interactive||!this.isCurrentUserAPlayer()||!S.callbacks.getNetworkLatency||!S.callbacks.getNetworkLatency()||!this.game_id||this.game_id<=0||this.socket.send("game/latency",{game_id:this.game_id,latency:this.getNetworkLatency()})};this.sendLatencyTimer=(0,E.niceInterval)(o,5e3),o()}};c.connected&&d(),this._socket_on("connect",d),this._socket_on("disconnect",()=>{this.disconnectedFromGame});let g=!1;this._socket_on("connect",()=>{this.disconnectedFromGame||(g&&this.emit("audio-reconnected"),g=!0)}),this._socket_on("disconnect",()=>{this.disconnectedFromGame||this.emit("audio-disconnected")});let k=null;if(this.game_id&&(k="game/"+this.game_id+"/"),this.review_id&&(k="review/"+this.review_id+"/"),this._socket_on(k+"error",o=>{if(this.disconnectedFromGame)return;this.emit("error",o);let r=500;(o==="This is a protected game"||o==="This is a protected review")&&(r=-1),this.showMessage("error",{error:{message:(0,L._)(o)}},r),console.error("ERROR: ",o)}),this.game_id){this._socket_on(k+"gamedata",r=>{if(!this.disconnectedFromGame){if(this.clearMessage(),this.emit("chat-reset"),C.focus_tracker.reset(),this.last_phase&&this.last_phase!=="finished"&&r.phase==="finished"){const b=r.winner;let h;typeof b=="number"?h=b===r.black_player_id?"black":"white":(b==="black"||b==="white")&&(h=b),h&&this.emit("audio-game-ended",h)}r.phase?this.last_phase=r.phase:console.warn("Game gamedata missing phase"),this.load(r),this.emit("gamedata",r)}}),this._socket_on(k+"chat",r=>{this.disconnectedFromGame||(r.line.channel=r.channel,this.chat_log.push(r.line),this.emit("chat",r.line))}),this._socket_on(k+"reset-chats",()=>{this.disconnectedFromGame||this.emit("chat-reset")}),this._socket_on(k+"chat/remove",r=>{this.disconnectedFromGame||this.emit("chat-remove",r)}),this._socket_on(k+"message",r=>{this.disconnectedFromGame||this.showMessage("server_message",{message:r})}),delete this.last_phase,this._socket_on(k+"latency",r=>{this.disconnectedFromGame||this.engine&&(this.engine.latencies||(this.engine.latencies={}),this.engine.latencies[r.player_id]=r.latency)}),this._socket_on(k+"clock",r=>{this.disconnectedFromGame||(this.clock_should_be_paused_for_move_submission=!1,this.setGameClock(r),this.updateTitleAndStonePlacement(),this.emit("update"))}),this._socket_on(k+"phase",r=>{this.disconnectedFromGame||(this.setMode("play"),r!=="finished"&&this.engine.clearRemoved(),this.engine.phase!==r&&(r==="stone removal"&&this.emit("audio-enter-stone-removal"),r==="play"&&this.engine.phase==="stone removal"&&this.emit("audio-resume-game-from-stone-removal")),this.engine.phase=r,this.engine.phase==="stone removal"?this.performStoneRemovalAutoScoring():delete this.stone_removal_auto_scoring_done,this.updateTitleAndStonePlacement(),this.emit("update"))}),this._socket_on(k+"undo_requested",r=>{this.disconnectedFromGame||(this.engine.undo_requested=parseInt(r),this.emit("update"),this.emit("audio-undo-requested"),this.getShowUndoRequestIndicator()&&this.redraw(!0))}),this._socket_on(k+"undo_canceled",()=>{this.disconnectedFromGame||(this.engine.undo_requested=void 0,this.emit("update"),this.emit("undo_canceled"),this.getShowUndoRequestIndicator()&&this.redraw(!0))}),this._socket_on(k+"undo_accepted",()=>{if(!this.disconnectedFromGame){if(!this.engine.undo_requested){console.warn("Undo accepted, but no undo requested, we might be out of sync");try{swal.fire("Game synchronization error related to undo, please reload your game page")}catch(r){console.error(r)}return}this.engine.undo_requested=void 0,this.setMode("play"),this.engine.showPrevious(),this.engine.setLastOfficialMove(),this.setConditionalTree(),this.engine.undo_requested=void 0,this.updateTitleAndStonePlacement(),this.emit("update"),this.emit("audio-undo-granted")}}),this._socket_on(k+"move",r=>{var b;try{if(this.disconnectedFromGame)return;if(C.focus_tracker.reset(),r.game_id!==this.game_id){console.error("Invalid move for this game received ["+this.game_id+"]",r);return}const h=r.move;this.isInPushedAnalysis()&&this.leavePushedAnalysis(),this.engine.undo_requested=void 0;const F=this.engine.decodeMoves(h);F.length>1&&console.warn("More than one move provided in encoded move in a `move` event.  That's odd.");const T=F[0];(this.mode==="conditional"||this.mode==="play")&&this.setMode("play");let P=null;if(this.engine.cur_move.id!==this.engine.last_official_move.id&&(this.engine.cur_move.parent==null&&this.engine.cur_move.trunk_next!=null||((b=this.engine.cur_move.parent)===null||b===void 0?void 0:b.id)!==this.engine.last_official_move.id)&&(P=this.engine.cur_move),this.engine.jumpToLastOfficialMove(),this.engine.playerToMove()!==this.player_id){const N=this.conditional_tree.getChild((0,E.encodeMove)(T.x,T.y));N.move=null,this.setConditionalTree(N)}if(this.engine.getMoveNumber()!==r.move_number-1){this.showMessage("synchronization_error"),setTimeout(()=>{window.location.href=window.location.href},2500),console.error("Synchronization error, we thought move should be "+this.engine.getMoveNumber()+" server thought it should be "+(r.move_number-1));return}const m=this.engine.computeScore(!0)[this.engine.colorToMove()].prisoners;let w=0;const y=[];T.edited?this.engine.editPlace(T.x,T.y,T.color||0):w=this.engine.place(T.x,T.y,!1,!1,!1,!0,!0,y),T.player_update&&this.engine.player_pool&&(this.engine.cur_move.player_update=T.player_update,this.engine.updatePlayers(T.player_update)),T.played_by&&(this.engine.cur_move.played_by=T.played_by),this.setLastOfficialMove(),delete this.move_selected,P&&this.engine.jumpTo(P),this.emit("update"),this.playMovementSound(),w&&(console.log("audio-capture-stones",{count:w,already_captured:m}),this.emit("audio-capture-stones",{count:w,already_captured:m}),this.debouncedEmitCapturedStones(y)),this.emit("move-made")}catch(h){console.error(h)}}),this._socket_on(k+"player_update",r=>{var b;try{let h=null;this.engine.cur_move.id!==this.engine.last_official_move.id&&(this.engine.cur_move.parent==null&&this.engine.cur_move.trunk_next!=null||((b=this.engine.cur_move.parent)===null||b===void 0?void 0:b.id)!==this.engine.last_official_move.id)&&(h=this.engine.cur_move),this.engine.jumpToLastOfficialMove(),this.engine.cur_move.player_update=r,this.engine.updatePlayers(r),this.mode==="conditional"||this.mode==="play"?this.setMode("play"):console.warn("unexpected player_update received!"),h&&this.engine.jumpTo(h)}catch(h){console.error(h)}this.emit("player-update",r)}),this._socket_on(k+"conditional_moves",r=>{this.disconnectedFromGame||(r.moves==null?this.setConditionalTree():this.setConditionalTree(E.ConditionalMoveTree.decode(r.moves)))}),this._socket_on(k+"removed_stones",r=>{if(!this.disconnectedFromGame){if("strict_seki_mode"in r)this.engine.strict_seki_mode=r.strict_seki_mode;else{const b=r.removed,h=r.stones;let F;h?F=this.engine.decodeMoves(h):F=[];for(let T=0;T<F.length;++T)this.engine.setRemoved(F[T].x,F[T].y,b,!1);this.emit("stone-removal.updated")}this.updateTitleAndStonePlacement(),this.emit("update")}}),this._socket_on(k+"removed_stones_accepted",r=>{if(this.disconnectedFromGame)return;const b=r.player_id,h=r.stones;if(b===0)this.engine.players.white.accepted_stones=h,this.engine.players.black.accepted_stones=h;else{const F=this.engine.playerColor(b);if(F==="invalid")throw console.error(`Invalid player_id ${b} in removed_stones_accepted`,{cfg:r,player_id:this.player_id,players:this.engine.players}),new Error(`Invalid player_id ${b} in removed_stones_accepted`);this.engine.players[F].accepted_stones=h,this.engine.players[F].accepted_strict_seki_mode="strict_seki_mode"in r?r.strict_seki_mode:!1}this.updateTitleAndStonePlacement(),this.emit("stone-removal.accepted"),this.emit("update")});const o={};this._socket_on(k+"auto_resign",r=>{this.emit("auto-resign",{game_id:r.game_id,player_id:r.player_id,expiration:r.expiration}),o[r.player_id]=!0,this.emit("audio-other-player-disconnected",{player_id:r.player_id})}),this._socket_on(k+"clear_auto_resign",r=>{this.emit("clear-auto-resign",{game_id:r.game_id,player_id:r.player_id}),o[r.player_id]&&(this.emit("audio-other-player-reconnected",{player_id:r.player_id}),delete o[r.player_id])}),this._socket_on(k+"stalling_score_estimate",r=>{this.disconnectedFromGame||(console.log("Score estimate received: ",r),this.engine.stalling_score_estimate=r,this.engine.config.stalling_score_estimate=r,this.emit("stalling_score_estimate",r))})}let f=!1;const u=o=>{var r,b;if(!this.disconnectedFromGame){if(o.chat&&(o.chat.channel="discussion",o.chat.chat_id||(o.chat.chat_id=o.chat.player_id+"."+o.chat.date),this.chat_log.push(o.chat),this.emit("chat",o.chat)),o["remove-chat"]&&this.emit("chat-remove",{chat_ids:[o["remove-chat"]]}),o.gamedata&&(o.gamedata.phase==="stone removal"&&(o.gamedata.phase="finished"),this.load(o.gamedata),this.review_had_gamedata=!0),o.player_update&&this.engine.player_pool&&(console.log("process_r got player update:",o.player_update),this.engine.updatePlayers(o.player_update)),o.owner&&(this.review_owner_id=typeof o.owner=="object"?o.owner.id:o.owner),o.controller&&(this.review_controller_id=typeof o.controller=="object"?o.controller.id:o.controller),!this.isPlayerController()||!this.done_loading_review||"om"in o||"undo"in o){const h=this.engine.cur_move,F=this.engine.cur_review_move==null||this.engine.cur_review_move.id===h.id;let T=!1;if("f"in o&&typeof o.m=="string"){const P=this.done_loading_review;this.done_loading_review=!1,this.engine.followPath(o.f||0,o.m),this.drawSquare(this.engine.cur_move.x,this.engine.cur_move.y),this.done_loading_review=P,this.engine.setAsCurrentReviewMove(),this.scheduleRedrawPenLayer()}if("om"in o){const P=this.engine.cur_review_move||this.engine.cur_move,m=this.engine.decodeMoves([o.om])[0],w=P.id===this.engine.last_official_move.id;this.engine.jumpToLastOfficialMove(),this.engine.place(m.x,m.y,!1,!1,!0,!0,!0),this.engine.setLastOfficialMove(),(P.x!==m.x||P.y!==m.y)&&!w&&this.engine.jumpTo(P),this.engine.setAsCurrentReviewMove(),this.done_loading_review&&this.move_tree_redraw()}if("undo"in o){const P=this.engine.cur_review_move,m=((r=this.engine.cur_review_move)===null||r===void 0?void 0:r.id)===this.engine.last_official_move.id;this.engine.jumpToLastOfficialMove(),this.engine.showPrevious(),this.engine.setLastOfficialMove(),m||(P?this.engine.jumpTo(P):console.warn("No valid move to jump back to in review game relay of undo")),this.engine.setAsCurrentReviewMove(),this.done_loading_review&&this.move_tree_redraw()}if(this.engine.cur_review_move){if(typeof o.t=="string"&&(this.engine.cur_review_move.text=o.t),"t+"in o&&(this.engine.cur_review_move.text+=o["t+"]),typeof o.k<"u"){const P=this.engine.cur_move;this.engine.cur_review_move.clearMarks(),this.engine.cur_move=this.engine.cur_review_move,this.setMarks(o.k,this.engine.cur_move.id!==P.id),this.engine.cur_move=P,this.engine.cur_move.id===P.id&&this.redraw()}if("clearpen"in o&&(this.engine.cur_review_move.pen_marks=[],this.scheduleRedrawPenLayer(),T=!1),"delete"in o){const P=this.engine.cur_review_move.parent;this.engine.cur_review_move.remove(),this.engine.jumpTo(P),this.engine.setAsCurrentReviewMove(),this.scheduleRedrawPenLayer(),this.done_loading_review&&this.move_tree_redraw()}if(typeof o.pen<"u"&&this.engine.cur_review_move.pen_marks.push({color:o.pen,points:[]}),typeof o.pp<"u")try{const P=this.engine.cur_review_move.pen_marks[this.engine.cur_review_move.pen_marks.length-1].points;this.engine.cur_review_move.pen_marks[this.engine.cur_review_move.pen_marks.length-1].points=P.concat(o.pp),this.scheduleRedrawPenLayer(),T=!1}catch(P){console.error(P)}}this.done_loading_review&&(F?(T&&this.redraw(!0),this.__update_move_tree||(this.__update_move_tree=setTimeout(()=>{this.__update_move_tree=null,this.updateOrRedrawMoveTree(),this.emit("update")},100))):(this.engine.jumpTo(h),this.move_tree_redraw()))}if("controller"in o&&!("owner"in o)){this.isPlayerController()&&this.emit("review.sync-to-current-move"),this.updateTitleAndStonePlacement();const h={system:!0,chat_id:O(),body:(0,L.interpolate)((0,L._)("Control passed to %s"),[typeof o.controller=="number"?`%%%PLAYER-${o.controller}%%%`:((b=o.controller)===null||b===void 0?void 0:b.username)||"[missing controller name]"]),channel:"system"};this.emit("chat",h),this.emit("update")}f||this.emit("review.updated")}};this.review_id&&(this._socket_on(`review/${this.review_id}/full_state`,o=>{try{if(!o||o.length===0){console.error("Blank full state received, ignoring");return}if(this.disconnectedFromGame)return;this.disableDrawing(),this.emit("review.load-start"),f=!0;for(let r=0;r<o.length;++r)u(o[r]);f=!1,this.enableDrawing(),this.done_loading_review=!0,this.drawPenMarks(this.engine.cur_move.pen_marks),this.emit("review.load-end"),this.emit("review.updated"),this.move_tree_redraw(),this.redraw(!0)}catch(r){console.error(r)}}),this._socket_on(`review/${this.review_id}/r`,u))}disconnect(){this.emit("destroy"),this.disconnectedFromGame||(this.disconnectedFromGame=!0,this.socket&&this.socket.connected&&(this.review_id&&this.socket.send("review/disconnect",{review_id:this.review_id}),this.game_id&&this.socket.send("game/disconnect",{game_id:this.game_id})));for(const a of this.socket_event_bindings)this.socket.off(a[0],a[1]);this.socket_event_bindings=[]}sendChat(a,c){if(typeof a=="string"&&a.length===0)return;const d={body:a};if(this.game_id)d.type=c,d.game_id=this.game_id,d.move_number=this.engine.getCurrentMoveNumber(),this.socket.send("game/chat",d);else{const g=this.engine.getMoveDiff();d.review_id=this.review_id,d.from=g.from,d.moves=g.moves,this.socket.send("review/chat",d)}}sendTimedOut(){var a;this.sent_timed_out_message||((a=this.engine)===null||a===void 0?void 0:a.phase)==="play"&&(console.log("Sending timed out"),this.sent_timed_out_message=!0,this.socket.send("game/timed_out",{game_id:this.game_id}))}syncReviewMove(a,c){if(this.review_id&&(this.isPlayerController()||this.isPlayerOwner()&&a&&a.controller)&&this.done_loading_review){if(this.isInPushedAnalysis())return;const d=this.engine.getMoveDiff();this.engine.setAsCurrentReviewMove();let g;if(a)g=a,g.clearpen&&(this.engine.cur_move.pen_marks=[]);else{const k={};for(let u=0;u<this.height;++u)for(let o=0;o<this.width;++o){const r=this.getMarks(o,u);for(let b=0;b<q.MARK_TYPES.length;++b)if(q.MARK_TYPES[b]in r&&r[q.MARK_TYPES[b]]){const h=q.MARK_TYPES[b]==="letter"?r.letter||"[ERR]":q.MARK_TYPES[b]==="score"?`score-${r.score}`:q.MARK_TYPES[b];h in k||(k[h]=""),k[h]+=(0,E.encodeMove)(o,u)}}!c&&c!==""&&(c=this.engine.cur_move.text||""),g={f:d.from,t:c,m:d.moves,k};const f=(0,E.deepClone)(g);if(this.last_review_message.f===g.f&&this.last_review_message.m===g.m?(delete g.f,delete g.m,c.indexOf(this.engine.cur_move.text||"")===0&&(delete g.t,c!==this.engine.cur_move.text&&(g["t+"]=c.substr(this.engine.cur_move.text.length))),(0,E.deepEqual)(k,this.last_review_message.k)&&delete g.k):this.scheduleRedrawPenLayer(),this.engine.cur_move.text=c,this.last_review_message=f,Object.keys(g).length===0)return}g.review_id=this.review_id,this.socket.send("review/append",g)}}sendMove(a,c){a.blur||(a.blur=C.focus_tracker.getMaxBlurDurationSinceLastReset(),C.focus_tracker.reset()),this.setConditionalTree();try{if(this.player_id){this.__clock_timer&&(clearTimeout(this.__clock_timer),delete this.__clock_timer,this.clock_should_be_paused_for_move_submission=!0);const k=this.last_clock;if(!k)throw new Error("No last_clock when calling sendMove()");let f;if(this.player_id===k.black_player_id)f="black";else if(this.player_id===k.white_player_id)f="white";else throw new Error(`Player id ${this.player_id} not found in clock`);if(f){const u=!(S.callbacks===null||S.callbacks===void 0)&&S.callbacks.getClockDrift?S.callbacks===null||S.callbacks===void 0?void 0:S.callbacks.getClockDrift():0,o=Date.now()-u,r=this.pause_control,b=r?p(v(r)):!1,h=k.start_mode?0:b&&k.paused_since?Math.max(k.paused_since,k.last_move)-k.last_move:o-k.last_move,F=this.computeNewPlayerClock(k[`${f}_time`],!0,h,this.config.time_control);if(F.timed_out)return this.sendTimedOut(),!1;a.clock=F}else throw new Error(`No color for player_id ${this.player_id}`)}}catch(k){console.error(k)}let d;const g=setTimeout(()=>{this.showMessage("error_submitting_move",void 0,-1),d=setTimeout(()=>{window.location.reload()},5e3)},5e3);return this.emit("submitting-move",!0),this.socket.send("game/move",a,()=>{d&&clearTimeout(d),clearTimeout(g),this.clearMessage(),this.emit("submitting-move",!1),c&&c()}),!0}giveReviewControl(a){this.syncReviewMove({controller:a})}saveConditionalMoves(){this.socket.send("game/conditional_moves/set",{move_number:this.engine.getCurrentMoveNumber(),game_id:this.game_id,conditional_moves:this.conditional_tree.encode()}),this.emit("conditional-moves.updated")}resign(){this.socket.send("game/resign",{game_id:this.game_id})}sendPendingResignation(){this.socket.send("game/delayed_resign",{game_id:this.game_id})}clearPendingResignation(){this.socket.send("game/clear_delayed_resign",{game_id:this.game_id})}cancelGame(){this.socket.send("game/cancel",{game_id:this.game_id})}annul(){this.socket.send("game/annul",{game_id:this.game_id})}pass(){this.mode==="conditional"&&this.followConditionalSegment(-1,-1),this.engine.place(-1,-1),this.mode==="play"?this.sendMove({game_id:this.game_id,move:(0,E.encodeMove)(-1,-1)}):(this.syncReviewMove(),this.move_tree_redraw())}requestUndo(){this.socket.send("game/undo/request",{game_id:this.game_id,move_number:this.engine.getCurrentMoveNumber()})}acceptUndo(){this.socket.send("game/undo/accept",{game_id:this.game_id,move_number:this.engine.getCurrentMoveNumber()})}cancelUndo(){this.socket.send("game/undo/cancel",{game_id:this.game_id,move_number:this.engine.getCurrentMoveNumber()})}pauseGame(){this.socket.send("game/pause",{game_id:this.game_id})}resumeGame(){this.socket.send("game/resume",{game_id:this.game_id})}deleteBranch(){this.engine.cur_move.trunk||(this.isPlayerController()&&this.syncReviewMove({delete:1}),this.engine.deleteCurMove(),this.emit("update"),this.move_tree_redraw())}setState(){(this.game_type==="review"||this.game_type==="demo")&&this.engine&&(this.drawPenMarks(this.engine.cur_move.pen_marks),this.isPlayerController()&&this.connectToReviewSent&&this.syncReviewMove()),this.setLabelCharacterFromMarks(),this.markDirty()}sendPreventStalling(a){this.socket.send("game/prevent_stalling",{game_id:this.game_id,winner:a})}sendPreventEscaping(a,c){this.socket.send("game/prevent_escaping",{game_id:this.game_id,winner:a,annul:c})}performStoneRemovalAutoScoring(){try{if(!window.user||!this.on_game_screen||!this.engine||window.user.id!==this.engine.players.black.id&&window.user.id!==this.engine.players.white.id)return}catch(c){console.error(c.stack);return}this.stone_removal_auto_scoring_done=!0,this.showMessage("processing",void 0,-1),this.emit("stone-removal.auto-scoring-started");const a=()=>{const c=new E.ScoreEstimator(this.engine,this,E.AUTOSCORE_TRIALS,E.AUTOSCORE_TOLERANCE,!0,!0,(0,E.makeMatrix)(this.width,this.height,!1));c.when_ready.then(()=>{const d=this.engine.getStoneRemovalString(),g=c.getProbablyDead();this.engine.clearRemoved();const k=this.engine.decodeMoves(g);for(let f=0;f<k.length;++f)this.engine.setRemoved(k[f].x,k[f].y,!0,!1);this.emit("stone-removal.updated"),this.engine.needs_sealing=c.autoscored_needs_sealing,this.emit("stone-removal.needs-sealing",c.autoscored_needs_sealing),this.updateTitleAndStonePlacement(),this.emit("update"),this.socket.send("game/removed_stones/set",{game_id:this.game_id,removed:!1,needs_sealing:c.autoscored_needs_sealing,stones:d}),this.socket.send("game/removed_stones/set",{game_id:this.game_id,removed:!0,needs_sealing:c.autoscored_needs_sealing,stones:g}),this.clearMessage(),this.emit("stone-removal.auto-scoring-complete")}).catch(d=>{console.error("Auto-scoring error: ",d),this.clearMessage(),this.showMessage("error",{error:{message:"Auto-scoring failed, please manually score the game"}},3e3)})};setTimeout(()=>{(0,E.init_wasm_ownership_estimator)().then(a).catch(c=>console.error(c))},10)}acceptRemovedStones(){const a=this.engine.getStoneRemovalString();this.engine.players[this.engine.playerColor(this.config.player_id)].accepted_stones=a,this.socket.send("game/removed_stones/accept",{game_id:this.game_id,stones:a,strict_seki_mode:this.engine.strict_seki_mode})}rejectRemovedStones(){delete this.engine.players[this.engine.playerColor(this.config.player_id)].accepted_stones,this.socket.send("game/removed_stones/reject",{game_id:this.game_id})}getPlayerRelativeLatency(a){var c,d;return a===this.player_id?0:(((d=(c=this.engine)===null||c===void 0?void 0:c.latencies)===null||d===void 0?void 0:d[a])||this.getNetworkLatency())-this.getNetworkLatency()}getLastReviewMessage(){return this.last_review_message}setLastReviewMessage(a){this.last_review_message=a}setGameClock(a){if(this.__clock_timer&&(clearTimeout(this.__clock_timer),delete this.__clock_timer),!a){this.emit("clock",null);return}if(!this.config.time_control||!this.config.time_control.system){this.emit("clock",null);return}const c=this.config.time_control;this.last_clock=a;let d=0;function g(){if(S.callbacks.getClockDrift){const o=S.callbacks.getClockDrift();d=Date.now()-o}}g();const k={current_player:a.current_player===a.black_player_id?"black":"white",current_player_id:a.current_player.toString(),time_of_last_move:a.last_move,paused_since:a.paused_since,black_clock:{main_time:0},white_clock:{main_time:0},black_move_transmitting:0,white_move_transmitting:0};a.pause&&(a.pause.paused?(this.paused_since=a.pause.paused_since,this.pause_control=a.pause.pause_control,this.paused_since<2e9&&(this.paused_since*=1e3),k.paused_since=a.pause.paused_since,k.pause_state=v(a.pause.pause_control)):(delete this.paused_since,delete this.pause_control)),a.start_mode&&(k.start_mode=!0);const f={black:{countdown_seconds:0,clock:{main_time:0},player_id:"",color:"black",time_control_system:"none",in_overtime:!1},white:{countdown_seconds:0,clock:{main_time:0},player_id:"",color:"white",time_control_system:"none",in_overtime:!1}},u=()=>{var o,r;if(!c||!c.system)return;g();const b=100;if(k.start_mode&&(k.start_time_left=a.expiration-d),this.paused_since){if(k.paused_since=this.paused_since,!this.pause_control)throw new Error("Invalid pause_control state when performing clock do_update");k.pause_state=v(this.pause_control),k.pause_state.stone_removal&&(k.stone_removal_time_left=a.expiration-d)}if((!k.pause_state||Object.keys(k.pause_state).length===0)&&(delete k.paused_since,delete k.pause_state),this.last_paused_state===null)this.last_paused_state=!!k.pause_state;else{const y=!!k.pause_state;y!==this.last_paused_state&&(this.last_paused_state=y,y?this.emit("audio-game-paused"):this.emit("audio-game-resumed"))}if(this.last_paused_by_player_state===null)this.last_paused_by_player_state=!!(!((o=this.pause_control)===null||o===void 0)&&o.paused);else{const y=!!(!((r=this.pause_control)===null||r===void 0)&&r.paused);y!==this.last_paused_by_player_state&&(this.last_paused_by_player_state=y,y?this.emit("paused",y):this.emit("paused",y))}const h=k.paused_since?Math.max(k.paused_since,a.last_move)-a.last_move:d-a.last_move,F=this.getPlayerRelativeLatency(a.black_player_id),T=this.getPlayerRelativeLatency(a.white_player_id),P=Math.max(0,h-Math.abs(F)),m=Math.max(0,h-Math.abs(T));k.black_clock=this.computeNewPlayerClock(a.black_time,k.current_player==="black"&&!k.start_mode,P,c),k.white_clock=this.computeNewPlayerClock(a.white_time,k.current_player==="white"&&!k.start_mode,m,c);const w=d-a.last_move;if(k.black_move_transmitting=k.current_player==="black"?Math.max(0,F-w):0,k.white_move_transmitting=k.current_player==="white"?Math.max(0,T-w):0,!this.sent_timed_out_message&&!this.clock_should_be_paused_for_move_submission&&(k.current_player==="white"&&this.player_id===this.engine.config.white_player_id&&k.white_clock.timed_out&&this.sendTimedOut(),k.current_player==="black"&&this.player_id===this.engine.config.black_player_id&&k.black_clock.timed_out&&this.sendTimedOut()),this.clock_should_be_paused_for_move_submission&&this.last_emitted_clock?this.emit("clock",this.last_emitted_clock):this.emit("clock",k),(this.mode==="play"||this.mode==="analyze"||this.mode==="conditional"||this.mode==="score estimation")&&this.engine.phase==="play"){const y=this.engine.last_official_move.stoneColor==="black"?"white":"black",N=this.engine.players[y].id.toString();if(y===k.current_player){const x=k.current_player==="black"?k.black_clock:k.white_clock,z={countdown_seconds:0,clock:x,player_id:N,color:y,time_control_system:c.system,in_overtime:!1};switch(c.system){case"simple":z.countdown_seconds===c.per_move?z.countdown_seconds=-1:z.countdown_seconds=Math.ceil(x.main_time/1e3);break;case"absolute":case"fischer":z.countdown_seconds=Math.ceil(x.main_time/1e3);break;case"byoyomi":x.main_time>0?z.countdown_seconds=Math.ceil(x.main_time/1e3):(z.in_overtime=!0,z.countdown_seconds=Math.ceil((x.period_time_left||0)/1e3),(x.periods_left||0)<=0&&(z.countdown_seconds=-1));break;case"canadian":x.main_time>0?z.countdown_seconds=Math.ceil(x.main_time/1e3):(z.in_overtime=!0,z.countdown_seconds=Math.ceil((x.block_time_left||0)/1e3),z.countdown_seconds===c.period_time&&(z.countdown_seconds=-1));break;case"none":break;default:throw new Error(`Unsupported time control system: ${c.system}`)}const U=z,D=f[k.current_player];(U.countdown_seconds!==D.countdown_seconds||U.player_id!==D.player_id||U.in_overtime!==D.in_overtime)&&(f[k.current_player]=z,z.countdown_seconds>0&&this.emit("audio-clock",z))}}this.engine.phase!=="finished"&&(this.__clock_timer=setTimeout(u,b))};u()}computeNewPlayerClock(a,c,d,g){const k={main_time:0,timed_out:!1};if(!this.last_clock)throw new Error("No last_clock when computing new player clock");const u=""+g.system;switch(g.system){case"simple":k.main_time=c?Math.max(0,g.per_move-d/1e3)*1e3:g.per_move*1e3,k.main_time<=0&&(k.timed_out=!0);break;case"none":k.main_time=0;break;case"absolute":k.main_time=c?Math.max(0,a.thinking_time*1e3-d):a.thinking_time*1e3,k.main_time<=0&&(k.timed_out=!0);break;case"fischer":k.main_time=c?Math.max(0,a.thinking_time*1e3-d):a.thinking_time*1e3,k.main_time<=0&&(k.timed_out=!0);break;case"byoyomi":if(c){let o=0;if(a.thinking_time>0?(k.main_time=a.thinking_time*1e3-d,k.main_time<=0&&(o=-k.main_time,k.main_time=0)):(k.main_time=0,o=d),k.periods_left=a.periods||0,k.period_time_left=g.period_time*1e3,o>0){const r=Math.floor(o/(g.period_time*1e3));k.periods_left-=r,k.period_time_left=g.period_time*1e3-(o-r*g.period_time*1e3),k.periods_left<0&&(k.periods_left=0),k.period_time_left<0&&(k.period_time_left=0)}}else k.main_time=a.thinking_time*1e3,k.periods_left=a.periods,k.period_time_left=g.period_time*1e3;k.main_time<=0&&(k.periods_left||0)===0&&(k.timed_out=!0);break;case"canadian":if(c){let o=0;a.thinking_time>0?(k.main_time=a.thinking_time*1e3-d,k.main_time<=0&&(o=-k.main_time,k.main_time=0)):(k.main_time=0,o=d),k.moves_left=a.moves_left,k.block_time_left=(a.block_time||0)*1e3,o>0&&(k.block_time_left-=o,k.block_time_left<0&&(k.block_time_left=0))}else k.main_time=a.thinking_time*1e3,k.moves_left=a.moves_left,k.block_time_left=(a.block_time||0)*1e3;k.main_time<=0&&k.block_time_left<=0&&(k.timed_out=!0);break;default:throw new Error(`Unsupported time control system: ${u}`)}return k}setStrictSekiMode(a){if(this.engine.phase!=="stone removal")throw"Not in stone removal phase";this.engine.strict_seki_mode!==a&&(this.engine.strict_seki_mode=a,this.socket.send("game/removed_stones/set",{game_id:this.game_id,stones:"",removed:!1,strict_seki_mode:a}))}}A.OGSConnectivity=R;function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const a=Math.random()*16|0;return(s==="x"?a:a&3|8).toString(16)})}function p(s){for(const a in s)return!0;return!1}function v(s){var a,c,d;const g={};for(const k in s){const f=k.match(/vacation-([0-9]+)/);if(f){const u=f[1];g.vacation||(g.vacation={}),g.vacation[u]=!0}else switch(k){case"stone-removal":g.stone_removal=!0;break;case"weekend":g.weekend=!0;break;case"server":case"system":g.server=!0;break;case"paused":g.player={player_id:((a=s.paused)===null||a===void 0?void 0:a.pausing_player_id.toString())||"0",pauses_left:((c=s.paused)===null||c===void 0?void 0:c.pauses_left)||0};break;case"moderator_paused":g.moderator=((d=s.moderator_paused)===null||d===void 0?void 0:d.moderator_id.toString())||"0";break;default:throw new Error(`Unhandled pause control key: ${k}`)}}return g}},"./src/Goban/SVGRenderer.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.SVGRenderer=void 0;const q=G("./src/engine/formats/JGOF.ts"),S=G("./src/engine/MoveTree.ts"),L=G("./src/Goban/themes/index.ts"),C=G("./src/Goban/canvas_utils.ts"),E=G("./src/engine/translate.ts"),R=G("./src/engine/messages.ts"),O=G("./src/engine/util/index.ts"),p=G("./src/Goban/callbacks.ts"),v=G("./src/Goban/Goban.ts"),s={black:{},white:{}},a=!0;function c(){try{return new CSSStyleSheet,!0}catch{}return!1}const d=document.body.attachShadow!==void 0&&CSSStyleSheet!==void 0&&c(),g="#ff69b4";class k extends v.Goban{constructor(o,r){var b,h;if(super(o,r),this.__set_board_height=-1,this.__set_board_width=-1,this.ready_to_draw=!1,this.grid=[],this.cells=[],this.shadow_grid=[],this.last_move_opacity=1,this.autoplaying_puzzle_move=!1,this.byoyomi_label="",this.last_label_position={i:NaN,j:NaN},this.metrics={width:NaN,height:NaN,mid:NaN,offset:NaN},this.drawing_enabled=!0,this.themes={board:"Plain",black:"Plain",white:"Plain","removal-graphic":"x","removal-scale":1},this.theme_black_stones=[],this.theme_black_text_color=g,this.theme_blank_text_color=g,this.theme_faded_line_color=g,this.theme_faded_star_color=g,this.theme_line_color="",this.theme_star_color="",this.theme_stone_radius=10,this.theme_white_stones=[],this.theme_white_text_color=g,o.board_div?this.parent=o.board_div:(this.no_display=!0,this.parent=document.createElement("div")),this.title_div=o.title_div,this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),d){const T=(b=this.parent.shadowRoot)!==null&&b!==void 0?b:this.parent.attachShadow({mode:"open"});if(T.childNodes.length)throw new Error("Shadow root already has children");T.appendChild(this.svg);const P=new CSSStyleSheet;P!=null&&P.replaceSync&&P.replaceSync(`text {
                font-family: Verdana, Arial, sans-serif;
                text-anchor: middle;
                font-weight: bold;
                user-select: none;
            }`),T.adoptedStyleSheets=[P]}else this.parent.appendChild(this.svg);this.on("destroy",()=>{this.svg.remove()}),this.svg_defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.svg.appendChild(this.svg_defs),this.last_move_opacity=(h=o.last_move_opacity)!==null&&h!==void 0?h:1,d?this.bindPointerBindings(this.parent):(this.event_layer=document.createElement("div"),this.event_layer.style.position="absolute",this.event_layer.style.top="0",this.event_layer.style.right="0",this.event_layer.style.left="0",this.event_layer.style.bottom="0",this.parent.appendChild(this.event_layer),this.bindPointerBindings(this.event_layer)),this.move_tree_container=o.move_tree_container,this.handleShiftKey=T=>{try{T.shiftKey!==this.shift_key_is_down&&(this.shift_key_is_down=T.shiftKey,this.last_hover_square&&a&&this.cellDraw(this.last_hover_square.x,this.last_hover_square.y))}catch(P){console.error(P)}},window.addEventListener("keydown",this.handleShiftKey),window.addEventListener("keyup",this.handleShiftKey),this.setTheme(this.getSelectedThemes(),!0);const F=this.watchSelectedThemes(T=>{var P,m,w;this.engine&&((P=s.black)===null||P===void 0||delete P.Custom,(m=s.white)===null||m===void 0||delete m.Custom,(w=s.board)===null||w===void 0||delete w.Custom,this.setTheme(T,!1))});this.on("destroy",()=>F.remove()),this.engine=this.post_config_constructor(),this.emit("engine.updated",this.engine),this.ready_to_draw=!0,this.redraw(!0)}setLastMoveOpacity(o){this.last_move_opacity=o}enablePen(){this.attachPenLayer()}disablePen(){this.detachPenLayer()}cell(o,r){return this.cells[r]||(this.cells[r]=[]),this.cells[r][o]||(this.cells[r][o]=new f(this,o,r)),this.cells[r][o]}clearCells(){this.cells=[]}destroy(){super.destroy(),this.clearMessage(),this.svg&&this.svg.parentNode&&this.svg.remove(),delete this.board,delete this.svg,this.detachPenLayer(),this.message_timeout&&(clearTimeout(this.message_timeout),delete this.message_timeout),window.removeEventListener("keydown",this.handleShiftKey),window.removeEventListener("keyup",this.handleShiftKey),this.theme_black_stones=[],this.theme_white_stones=[],delete this.theme_board,delete this.theme_black,delete this.theme_white,delete this.message_div,delete this.message_td,delete this.message_text,delete this.move_tree_container,delete this.move_tree_inner_container,delete this.move_tree_svg,delete this.title_div}detachPenLayer(){this.pen_layer&&(this.pen_layer.remove(),delete this.pen_layer)}attachPenLayer(){this.pen_layer||(this.pen_layer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.pen_layer.setAttribute("id","pen-svg"),this.pen_layer.setAttribute("class","PenLayer"),this.pen_layer.setAttribute("width",this.metrics.width.toString()),this.pen_layer.setAttribute("height",this.metrics.height.toString()),this.svg.appendChild(this.pen_layer))}bindPointerBindings(o){if(!this.interactive||o.getAttribute("data-pointers-bound")==="true")return;o.setAttribute("data-pointers-bound","true"),this.on("destroy",()=>{o.removeAttribute("data-pointers-bound")});let r=!1,b=this.xy2ij(0,0),h=0;const F=(I,le)=>{const _e=performance.now()-h;try{if(!r)return;let K=!1;if(I instanceof MouseEvent&&I.button===2&&(K=!0,I.preventDefault()),r=!1,this.scoring_mode){const Y=(0,C.getRelativeEventPosition)(I,this.parent),Q=this.xy2ij(Y.x,Y.y);Q.i>=0&&Q.i<this.width&&Q.j>=0&&Q.j<this.height&&(this.score_estimator&&this.score_estimator.handleClick(Q.i,Q.j,I.ctrlKey||I.metaKey||I.altKey||I.shiftKey,_e),this.emit("update"));return}if(I.ctrlKey||I.metaKey||I.altKey){try{const Y=(0,C.getRelativeEventPosition)(I,this.parent),Q=this.xy2ij(Y.x,Y.y);p.callbacks.addCoordinatesToChatInput&&p.callbacks.addCoordinatesToChatInput(this.engine.prettyCoordinates(Q.i,Q.j))}catch(Y){console.error(Y)}return}if(!(this.mode==="analyze"&&this.analyze_tool==="draw")){if(!(this.mode==="analyze"&&this.analyze_tool==="score"))if(this.mode==="analyze"&&this.analyze_tool==="removal")this.onAnalysisToggleStoneRemoval(I);else{const Y=(0,C.getRelativeEventPosition)(I,this.parent),Q=this.xy2ij(Y.x,Y.y);if(!le)b=Q;else if(b.i!==Q.i||b.j!==Q.j){this.onMouseOut(I);return}this.onTap(I,le,K,_e),this.onMouseOut(I)}}}catch(K){console.error(K)}},T=I=>{h=performance.now();try{if(r=!0,this.mode==="analyze"&&this.analyze_tool==="draw")this.onPenStart(I);else if(this.mode==="analyze"&&this.analyze_tool==="label"){if(I.shiftKey&&this.analyze_subtool==="letters"){const le=prompt((0,E._)("Enter the label you want to add to the board"),"");if(le){this.label_character=le.substring(0,3),r=!1;return}}this.onLabelingStart(I)}else this.mode==="analyze"&&this.analyze_tool==="score"?this.onAnalysisScoringStart(I):this.mode==="analyze"&&this.analyze_tool}catch(le){console.error(le)}},P=I=>{try{if(this.mode==="analyze"&&this.analyze_tool==="draw"){if(!r)return;this.onPenMove(I)}else r&&this.mode==="analyze"&&this.analyze_tool==="label"?this.onLabelingMove(I):r&&this.mode==="analyze"&&this.analyze_tool==="score"?this.onAnalysisScoringMove(I):r&&this.mode==="analyze"&&this.analyze_tool==="removal"||this.onMouseMove(I)}catch(le){console.error(le)}},m=I=>{try{r=!1,this.onMouseOut(I)}catch(le){console.error(le)}};let w=0;const y=I=>(w||(r=!0,F(I,!1)),I.preventDefault(),!1),N=I=>(w||(r=!0,F(I,!0)),I.preventDefault(),!1),x=I=>(w||T(I),I.preventDefault(),!1),z=I=>(w||(r=!1),!1),U=I=>(w||P(I),I.preventDefault(),!1),D=I=>(w?I.preventDefault():m(I),!1),B=I=>(w?I.preventDefault():F(I,!1),!1),j=I=>(I.preventDefault(),!1);o.addEventListener("click",y),o.addEventListener("dblclick",N),o.addEventListener("mousedown",x),o.addEventListener("mouseup",z),o.addEventListener("mousemove",U),o.addEventListener("mouseout",D),o.addEventListener("contextmenu",B),o.addEventListener("focus",j),this.on("destroy",()=>{o.removeEventListener("click",y),o.removeEventListener("dblclick",N),o.removeEventListener("mousedown",x),o.removeEventListener("mouseup",z),o.removeEventListener("mousemove",U),o.removeEventListener("mouseout",D),o.removeEventListener("contextmenu",B),o.removeEventListener("focus",j)});let ee=0,me=0,Z=0,se=0;const he=I=>{try{w&&clearTimeout(w),w=setTimeout(()=>{w=0},5e3),(0,C.getRelativeEventPosition)(I,this.parent),I.target===o?(ee=I.touches[0].clientX,me=I.touches[0].clientY,Z=I.touches[0].clientX,se=I.touches[0].clientY,T(I)):r&&m(I)}catch(le){console.error(le)}},J=I=>{try{const le=document.activeElement;I.target===o&&le&&le instanceof HTMLElement&&le.tagName.toLowerCase()==="input"&&le.blur(),w&&clearTimeout(w),w=setTimeout(()=>{w=0},5e3),I.target===o?Math.sqrt((Z-ee)*(Z-ee)+(se-me)*(se-me))>10?m(I):F(I,!1):r&&m(I)}catch(le){console.error(le)}},W=I=>{try{if(w&&clearTimeout(w),w=setTimeout(()=>{w=0},5e3),(0,C.getRelativeEventPosition)(I,this.parent),I.target===o){if(ee=I.touches[0].clientX,me=I.touches[0].clientY,this.mode==="analyze"&&this.analyze_tool==="draw")return P(I),I.preventDefault(),!1}else r&&m(I)}catch(le){console.error(le)}};document.addEventListener("touchstart",he),document.addEventListener("touchend",J),document.addEventListener("touchmove",W);const H=()=>{document.removeEventListener("touchstart",he),document.removeEventListener("touchend",J),document.removeEventListener("touchmove",W),this.off("destroy",H)};this.on("destroy",H)}clearAnalysisDrawing(){this.pen_marks=[],this.pen_layer&&(this.pen_layer.innerHTML="")}xy2pen(o,r){const b=this.draw_left_labels?0:1,h=this.draw_top_labels?0:1;return[Math.round((o/this.square_size+b)*64),Math.round((r/this.square_size+h)*64)]}pen2xy(o,r){const b=this.draw_left_labels?0:1,h=this.draw_top_labels?0:1;return[(o/64-b)*this.square_size,(r/64-h)*this.square_size]}setPenStyle(o){}onPenStart(o){this.attachPenLayer();const r=(0,C.getRelativeEventPosition)(o,this.parent);this.last_pen_position=this.xy2pen(r.x,r.y),this.current_pen_mark={color:this.analyze_subtool,points:this.xy2pen(r.x,r.y)},this.pen_marks.push(this.current_pen_mark),this.setPenStyle(this.analyze_subtool),this.syncReviewMove({pen:this.analyze_subtool,pp:this.xy2pen(r.x,r.y)})}onPenMove(o){var r;if(!this.last_pen_position||!this.current_pen_mark)throw new Error("onPenMove called with invalid last pen position or current pen mark");const b=(0,C.getRelativeEventPosition)(o,this.parent),h=this.last_pen_position,F=this.pen2xy(h[0],h[1]),T=this.xy2pen(b.x,b.y),P=this.pen2xy(T[0],T[1]),m=T[0]-h[0],w=T[1]-h[1];if(m*m+w*w<64)return;this.last_pen_position=T,this.current_pen_mark.points.push(m),this.current_pen_mark.points.push(w);const y=`M ${F[0]} ${F[1]} L ${P[0]} ${P[1]}`,N=document.createElementNS("http://www.w3.org/2000/svg","path");N.setAttribute("d",y),N.setAttribute("stroke",this.analyze_subtool),N.setAttribute("stroke-width","3"),N.setAttribute("fill","none"),(r=this.pen_layer)===null||r===void 0||r.appendChild(N),this.syncReviewMove({pp:[m,w]})}drawPenMarks(o){var r;if(!(this.review_id&&!this.done_loading_review)&&o.length){this.attachPenLayer(),this.clearAnalysisDrawing(),this.pen_marks=o;for(let b=0;b<o.length;++b){const h=o[b];this.setPenStyle(h.color);let F=h.points[0],T=h.points[1];const P=this.pen2xy(F,T);let m=`M ${P[0]} ${P[1]}`;for(let y=2;y<h.points.length;y+=2){F+=h.points[y],T+=h.points[y+1];const N=this.pen2xy(F,T);m+=` L ${N[0]} ${N[1]}`}const w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",m),w.setAttribute("stroke",h.color),w.setAttribute("stroke-width","3"),w.setAttribute("fill","none"),(r=this.pen_layer)===null||r===void 0||r.appendChild(w)}}}onTap(o,r,b,h){if(!(this.stone_placement_enabled&&(this.player_id||!this.engine.players.black.id||this.mode==="analyze"||this.mode==="puzzle"))||b&&this.mode==="play")return;const F=(0,C.getRelativeEventPosition)(o,this.parent),T=F.x,P=F.y,m=this.xy2ij(T,P),w=m.i,y=m.j;if(w<0||y<0||w>=this.engine.width||y>=this.engine.height)return;if(this.double_click_submit||(r=!1),this.mode==="analyze"&&o.shiftKey&&!(this.analyze_tool==="stone"&&(this.analyze_subtool==="black"||this.analyze_subtool==="white"))&&this.analyze_tool!=="label"){const D=this.engine.getMoveByLocation(w,y,!0);D&&(this.engine.jumpTo(D),this.emit("update"));return}if(this.mode==="analyze"&&this.analyze_tool==="label")return;this.setSubmit(void 0);const N=Date.now();let x=0;const z=[],U=()=>{const D=Date.now();if(!this.one_click_submit&&(!this.double_click_submit||!r)){const j=D-N;if(j<=50){console.info("Submit button pressed only ",j,"ms after stone was placed, presuming bad click");return}}this.sendMove({game_id:this.game_id,move:(0,O.encodeMove)(w,y)})?(this.playMovementSound(),this.setTitle((0,E._)("Submitting...")),x&&this.debouncedEmitCapturedStones(z),this.disableStonePlacement(),delete this.move_selected):console.log("Move not sent, not playing movement sound")};try{let D=!1;if(this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move){const{removed:B,group:j}=this.engine.toggleSingleGroupRemoval(w,y,o.shiftKey||h>500);j.length&&this.socket.send("game/removed_stones/set",{game_id:this.game_id,removed:B,stones:(0,O.encodeMoves)(j)})}else if(this.mode==="puzzle"){let B="place",j=0;if(this.getPuzzlePlacementSetting){const ee=this.getPuzzlePlacementSetting();B=ee.mode,ee.mode==="setup"&&(j=ee.color,(this.shift_key_is_down||b)&&(j=j===1?2:1))}if(B==="place"&&(r||(this.engine.place(w,y,!0,!1,!0,!1,!1),this.emit("puzzle-place",{x:w,y,width:this.engine.width,height:this.engine.height,color:this.engine.colorToMove()}))),B==="play"&&!r&&!this.autoplaying_puzzle_move){let ee=0;if(this.engine.puzzle_player_move_mode!=="fixed"||this.engine.cur_move.lookupMove(w,y,this.engine.player,!1)){const me=(Z,se)=>{if(++ee,x=this.engine.place(Z,se,!0,!1,!0,!1,!1,z),this.emit("puzzle-place",{x:Z,y:se,width:this.engine.width,height:this.engine.height,color:this.engine.colorToMove()}),this.engine.cur_move.wrong_answer&&this.emit("puzzle-wrong-answer"),this.engine.cur_move.correct_answer&&this.emit("puzzle-correct-answer"),this.engine.cur_move.branches.length===0){const he=this.engine.cur_move.findStrongIsobranches();if(he.length>0){const J=(0,O.getRandomInt)(0,he.length),W=he[J];console.info("Following isomorphism ("+(J+1)+" of "+he.length+")"),this.engine.jumpTo(W),this.emit("update")}}if(this.engine.cur_move.branches.length){const he=this.engine.cur_move.branches[(0,O.getRandomInt)(0,this.engine.cur_move.branches.length)];ee===1&&(he.player===2&&this.engine.config.initial_player==="black"||he.player===1&&this.engine.config.initial_player==="white")&&this.engine.puzzle_opponent_move_mode!=="manual"&&(this.autoplaying_puzzle_move=!0,setTimeout(()=>{this.autoplaying_puzzle_move=!1,me(he.x,he.y),this.emit("update")},this.puzzle_autoplace_delay))}else{let he=this.engine.cur_move,J=!1;for(;he;){if(he.correct_answer){J=!0;break}he=he.parent}J||this.engine.cur_move.wrong_answer||this.emit("puzzle-wrong-answer")}};me(w,y)}}B==="setup"&&(this.engine.board[y][w]===j?this.engine.initialStatePlace(w,y,0):this.engine.initialStatePlace(w,y,j)),this.emit("update"),x>0&&(this.emit("audio-capture-stones",{count:x,already_captured:0}),this.debouncedEmitCapturedStones(z))}else if(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze"){if(this.move_selected){this.mode==="play"&&this.engine.cur_move.removeIfNoChildren();let B=!1;if(this.move_selected.x===w&&this.move_selected.y===y&&(delete this.move_selected,B=!0),this.engine.jumpTo(this.engine.last_official_move),B&&(this.updatePlayerToMoveTitle(),!r)){this.emit("update");return}}this.move_selected={x:w,y};try{if(!(this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate"))x=this.engine.place(w,y,!0,!0,void 0,void 0,void 0,z),this.mode==="analyze"&&this.engine.handicapMovesLeft()>0&&this.engine.place(-1,-1);else{if(!this.edit_color)throw new Error("Edit place called with invalid edit_color value");let B=this.engine.playerByColor(this.edit_color);o.shiftKey&&B===1?B=2:o.shiftKey&&B===2&&(B=1),this.engine.board[y][w]===B?this.engine.editPlace(w,y,0):this.engine.editPlace(w,y,B)}if(this.mode==="analyze"&&this.analyze_tool==="stone"){let B=this.engine.cur_move;for(;B&&!B.trunk;){let j=B.getMoveNumberDifferenceFromTrunk();B.edited&&(j="triangle"),B.x>=0&&B.y>=0&&!this.engine.board[B.y][B.x]?this.clearTransientMark(B.x,B.y,j):this.setTransientMark(B.x,B.y,j,!0),B=B.parent}}this.isPlayerController()&&(this.syncReviewMove(),D=!0)}catch(B){throw delete this.move_selected,this.updatePlayerToMoveTitle(),B}switch(this.mode){case"play":this.one_click_submit||r?U():this.setSubmit(U);break;case"analyze":delete this.move_selected,this.updateTitleAndStonePlacement(),this.emit("update"),this.playMovementSound();break;case"conditional":this.followConditionalSegment(w,y),delete this.move_selected,this.updateTitleAndStonePlacement(),this.emit("update"),this.playMovementSound();break}D&&this.redraw()}}catch(D){delete this.move_selected,D.message_id!=="stone_already_placed_here"&&(this.errorHandler(D),this.emit("error","stone_already_placed_here")),this.emit("update")}}onMouseMove(o){if(!(this.stone_placement_enabled&&(this.player_id||!this.engine.players.black.id||this.mode==="analyze"||this.scoring_mode)))return;const r=(0,C.getRelativeEventPosition)(o,this.parent),b=this.xy2ij(r.x,r.y);if(!(this.__last_pt.i===b.i&&this.__last_pt.j===b.j)){if(this.__last_pt.valid){const h=this.last_hover_square;delete this.last_hover_square,h&&this.drawSquare(h.x,h.y)}this.__last_pt=b,b.valid&&(this.last_hover_square={x:b.i,y:b.j},this.drawSquare(b.i,b.j))}}onMouseOut(o){if(this.__last_pt.valid){const r=this.last_hover_square;delete this.last_hover_square,r&&this.drawSquare(r.x,r.y)}this.__last_pt=this.xy2ij(-1,-1)}enableDrawing(){this.drawing_enabled=!0}disableDrawing(){this.drawing_enabled=!1}setByoYomiLabel(o){this.byoyomi_label!==o&&(this.byoyomi_label=o,this.last_hover_square&&this.drawSquare(this.last_hover_square.x,this.last_hover_square.y))}drawSquare(o,r){o<0||r<0||!this.drawing_enabled||this.no_display||this.grid_layer&&this.cellDraw(o,r)}cellDraw(o,r){var b,h;if(!this.drawing_enabled||this.no_display||o<0||r<0)return;const F=this.cell(o,r),T=this.themes["removal-scale"],P=this.square_size;let m=this.draw_left_labels?P:0,w=this.draw_top_labels?P:0;this.bounds.left>0&&(m=-P*this.bounds.left),this.bounds.top>0&&(w=-P*this.bounds.top);const y=o*P+m,N=r*P+w;let x=`translate(${y},${N})`,z=!this.dont_draw_last_move,U=0;this.engine&&(U=this.engine.board[r][o]);let D=this.getMarks(o,r);D||(console.error("No position for ",r,o),D={});let B;if(this.engine&&this.engine.cur_move&&(this.mode!=="play"||typeof this.isInPushedAnalysis()<"u"&&this.isInPushedAnalysis()&&this.show_variation_move_numbers)){let W=this.engine.cur_move;for(;W&&!W.trunk;W=W.parent)W.x===o&&W.y===r&&W.getMoveNumberDifferenceFromTrunk()!==W.move_number&&!W.edited&&this.show_variation_move_numbers&&(B=W.getMoveNumberDifferenceFromTrunk().toString())}let j=!1;this.engine&&this.engine.cur_move.lookupMove(o,r,this.engine.player,!1)&&(j=!0);let ee=!1,me=this.theme_blank_text_color;for(const W in D)W.length<=3&&(ee=!0);if((D.circle||D.triangle||D.chat_triangle||D.sub_triangle||D.cross||D.square)&&(ee=!0),D.letter&&D.letter.length>0&&(ee=!0),D.subscript&&D.subscript.length>0&&(ee=!0),ee){let W;this.square_size<5?W=.5:W=Math.max(2,(this.metrics.mid-1.5)*.16);let H=!1;this.width===19&&this.height===19&&(o===3&&(r===3||r===9||r===15)||o===9&&(r===3||r===9||r===15)||o===15&&(r===3||r===9||r===15))&&(H=!0),this.width===13&&this.height===13&&(o===3&&(r===3||r===9)||o===6&&r===6||o===9&&(r===3||r===9))&&(H=!0),this.width===9&&this.height===9&&(o===2&&(r===2||r===6)||o===4&&r===4||o===6&&(r===2||r===6))&&(H=!0),F.drawFadedIntersectionLines(H,W)}else F.clearFadedLines();if(this.heatmap&&this.heatmap[r][o]>.001?F.heatmap(this.heatmap[r][o]):F.clearHeatmap(),D.hint||this.highlight_movetree_moves&&j||D.color){const W=D.color?D.color:D.hint?"#8EFF0A":"#FF8E0A";F.highlight(W)}else F.clearHighlight();const Z=(b=this.colored_circles)===null||b===void 0?void 0:b[r][o];Z?F.circle(Z):F.clearCircle();let se=!1;if(U||this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&this.engine&&!this.scoring_mode&&(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze")&&(this.engine.puzzle_player_move_mode!=="fixed"||j||this.getPuzzlePlacementSetting&&this.getPuzzlePlacementSetting().mode==="play")||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o]||this.engine&&this.engine.phase==="stone removal"&&this.engine.board[r][o]&&this.engine.removal[r][o]||D.black||D.white){let W=!1,H=.6,I;if(this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o])I=this.score_estimator.board[r][o],W=!0;else if(this.engine&&(this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move||this.engine.phase==="finished"&&this.mode!=="analyze")&&this.engine.board&&this.engine.removal&&this.engine.board[r][o]&&this.engine.removal[r][o])I=this.engine.board[r][o],W=!0;else if(U)I=U;else if(this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate")I=this.edit_color==="black"?1:2,this.shift_key_is_down&&(I=this.edit_color==="black"?2:1);else if(this.move_selected)this.engine.handicapMovesLeft()<=0?I=this.engine.otherPlayer():I=this.engine.player;else if(this.mode==="puzzle")if(this.getPuzzlePlacementSetting){const _e=this.getPuzzlePlacementSetting();_e.mode==="setup"?(I=_e.color,this.shift_key_is_down&&(I=I===1?2:1)):I=this.engine.player}else I=this.engine.player;else D.black||D.white?(I=D.black?1:2,W=!0,H=this.variation_stone_opacity):I=this.engine.player;if(D.stone_removed&&(W=!0),this.autoplaying_puzzle_move&&!U)F.clearStone();else{if(me=I===1?this.theme_black_text_color:this.theme_white_text_color,!this.theme_black_stones){const K=new Error(`Goban.theme_black_stones not set. Current themes is ${JSON.stringify(this.themes)}`);setTimeout(()=>{throw K},1);return}if(!this.theme_white_stones){const K=new Error(`Goban.theme_white_stones not set. Current themes is ${JSON.stringify(this.themes)}`);setTimeout(()=>{throw K},1);return}const _e=W||!U;F.stone(I,_e,I===q.JGOFNumericPlayerColor.BLACK?this.theme_black.getStone(o,r,this.theme_black_stones,this):this.theme_white.getStone(o,r,this.theme_white_stones,this),this.theme_stone_radius,H)}const le=(h=this.colored_circles)===null||h===void 0?void 0:h[r][o];D.blue_move&&le?F.blueMove(le.border_color||"#000000",le.border_width||.1):F.clearBlueMove(),(this.engine&&this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move&&this.engine.board[r][o]&&this.engine.removal[r][o]||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o]||D.stone_removed)&&(se=this.themes["removal-graphic"]==="x",x=`translate(${y+this.metrics.mid*(1-T)}, ${N+this.metrics.mid*(1-T)}) scale(${T})`)}else F.clearStone(),F.clearBlueMove();let he=!1;if(se||this.mode==="analyze"&&this.analyze_tool==="removal"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r||this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r){const W=this.engine.board[r][o]===q.JGOFNumericPlayerColor.BLACK?"black":"white";let H="";const I=this.metrics.mid;let le=Math.max(1,I*.5);D.score==="black"&&W==="white"?H=this.theme_white_text_color:D.score==="white"&&W==="black"?H=this.theme_black_text_color:D.score==="white"&&W==="white"||D.score==="black"&&W==="black"?(H="#ff0000",he=!0,le=Math.max(1,I*.65)):H="#777777";const _e=this.engine.board[r][o]?1:.2;F.removalCross(H,le,_e)}else F.clearRemovalCross();if(D.score&&(!se||he)&&(this.engine.phase!=="finished"||this.mode==="play"||this.mode==="analyze")||this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[r][o]||this.score_estimator.removal[r][o]&&this.score_estimator.board[r][o]===0)||(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[r][o]===0&&(this.engine.removal[r][o]||D.needs_sealing)||this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r){let W=D.score;this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[r][o]||this.score_estimator.removal[r][o]&&this.score_estimator.board[r][o]===0)&&(W=this.score_estimator.territory[r][o]===1?"black":"white",this.score_estimator.board[r][o]===0&&this.score_estimator.removal[r][o]&&(W="dame")),(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[r][o]===0&&this.engine.removal[r][o]&&(W="dame"),D.needs_sealing&&(W="seal"),this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(W=this.analyze_subtool);let H=1,I="",le="";W==="white"&&(I=this.theme_black_text_color,le="#777777"),W==="black"&&(I=this.theme_white_text_color,le="#888888"),W==="dame"&&(H=.2,le="#365FE6"),W==="seal"&&(H=.8,I="#ff4444",le="#E079CE"),(W==null?void 0:W[0])==="#"&&(I=W,le=(0,O.color_blend)("#888888",W)),F.score(I,le,H)}else F.clearScore();let J=!1;{let W,H,I=!1;if(D.letter&&(W=D.letter),D.subscript&&(H=D.subscript),this.mode==="play"&&this.byoyomi_label&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(W=this.byoyomi_label),this.mode==="analyze"&&this.analyze_tool==="label"&&(this.analyze_subtool==="letters"||this.analyze_subtool==="numbers")&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(I=!0,W=this.label_character),!W&&B!=="triangle"&&(W=B),this.show_variation_move_numbers&&!W&&!(D.circle||D.triangle||D.chat_triangle||D.sub_triangle||D.cross||D.square)){const le=this.engine.getMoveByLocation(o,r,!1);if(le&&!le.trunk){const _e=le.getMoveNumberDifferenceFromTrunk();_e!==le.move_number&&(le.edited?this.engine.board[r][o]&&(B="triangle"):W=_e.toString())}}if(W){J=!0,z=!1;let le=this.square_size*.5*this.stone_font_scale;H&&(le*=.8),F.letter(W,me,le,I?.6:1,!!H)}else F.clearLetter();H?(J=!0,z=!1,F.subscript(H,me,this.square_size*.4*this.stone_font_scale,I?.6:1,!!W,!!D.sub_triangle)):F.clearSubscript()}{let W=J,H;const I=U===1?this.theme_black_text_color:U===2?this.theme_white_text_color:me;this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(this.analyze_subtool==="triangle"||this.analyze_subtool==="square"||this.analyze_subtool==="cross"||this.analyze_subtool==="circle")&&(W=!0,H=this.analyze_subtool),D.circle||H==="circle"?(z=!1,F.circleSymbol(I,W?.6:1)):F.clearCircleSymbol(),D.triangle||D.chat_triangle||D.sub_triangle||B==="triangle"||H==="triangle"?(z=!1,F.triangleSymbol(I,W?.6:1,!!D.sub_triangle)):F.clearTriangleSymbol(),D.cross||H==="cross"?(z=!1,F.crossSymbol(I,W?.6:1)):F.clearCrossSymbol(),D.square||H==="square"?(z=!1,F.squareSymbol(I,W?.6:1)):F.clearSquareSymbol()}if(this.last_move&&this.engine&&!this.last_move.is(this.engine.cur_move)){const W=this.last_move;delete this.last_move,this.cell(W.x,W.y).clearLastMove()}if(z&&this.engine&&this.engine.cur_move&&this.engine.cur_move.x===o&&this.engine.cur_move.y===r&&this.engine.board[r][o]&&(this.engine.phase==="play"||this.engine.phase==="finished")&&(this.last_move=this.engine.cur_move,o>=0&&r>=0)){const W=U===1?this.theme_black_text_color:this.theme_white_text_color;this.submit_move?(z=!1,F.lastMove("+",W,this.last_move_opacity)):this.engine.undo_requested&&this.getShowUndoRequestIndicator()&&this.engine.undo_requested===this.engine.cur_move.move_number?(z=!1,F.lastMove("?",W,1)):F.lastMove("o",W,this.last_move_opacity)}if(this.scoring_mode===!0&&this.score_estimator||this.scoring_mode==="stalling-scoring-mode"&&this.stalling_score_estimate&&this.mode!=="analyze"){const H=(this.scoring_mode==="stalling-scoring-mode"?this.stalling_score_estimate:this.score_estimator).ownership[r][o],I=H<0?"white":"black";(I==="black"?1:2)!==U?F.scoreEstimate(I,H):F.clearScoreEstimate()}else F.clearScoreEstimate();F.transform=x}__drawSquare(o,r){throw new Error("USE_CELL_RENDERER is set, this should not be called")}drawingHash(o,r){var b;if(this.no_display)return"";if(o<0||r<0)return"..";let h=this.square_size+",";const F=!this.dont_draw_last_move;let T=0;this.engine&&(T=this.engine.board[r][o]),h+=T+",",this.heatmap&&this.heatmap[r][o]>.001&&(h+="heat "+this.heatmap[r][o]+",");const P=(b=this.colored_circles)===null||b===void 0?void 0:b[r][o];P&&(h+="circle "+P.color);let m=this.getMarks(o,r);m||(console.error("No position for ",r,o),m={});let w;if(this.engine&&this.engine.cur_move&&(this.mode!=="play"||typeof this.isInPushedAnalysis()<"u"&&this.isInPushedAnalysis())){let z=this.engine.cur_move;for(;z&&!z.trunk;z=z.parent)z.x===o&&z.y===r&&z.getMoveNumberDifferenceFromTrunk()!==z.move_number&&!z.edited&&this.show_variation_move_numbers&&(w=z.getMoveNumberDifferenceFromTrunk().toString())}let y=!1;this.engine&&this.engine.cur_move.lookupMove(o,r,this.engine.player,!1)&&(y=!0);let N=!1;if(T||this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&this.engine&&!this.scoring_mode&&(this.engine.phase==="play"||this.engine.phase==="finished"&&this.mode==="analyze")&&(this.engine.puzzle_player_move_mode!=="fixed"||y||this.getPuzzlePlacementSetting&&this.getPuzzlePlacementSetting().mode!=="play")||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o]||this.engine&&this.engine.phase==="stone removal"&&this.engine.board[r][o]&&this.engine.removal[r][o]||m.black||m.white){let z=!1,U;this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o]?(U=this.score_estimator.board[r][o],z=!0):this.engine&&this.engine.phase==="stone removal"&&this.engine.board&&this.engine.removal&&this.engine.board[r][o]&&this.engine.removal[r][o]?(U=this.engine.board[r][o],z=!0):T?U=T:this.mode==="analyze"&&this.analyze_tool==="stone"&&this.analyze_subtool!=="alternate"?U=this.edit_color==="black"?1:2:this.move_selected?this.engine.handicapMovesLeft()<=0?U=this.engine.otherPlayer():U=this.engine.player:m.black||m.white?(U=m.black?1:2,z=!0):U=this.engine.player,m.stone_removed&&(z=!0),U===1&&(h+=this.theme_black.getStoneHash(o,r,this.theme_black_stones,this)),U===2&&(h+=this.theme_white.getStoneHash(o,r,this.theme_white_stones,this)),m.blue_move&&this.colored_circles&&this.colored_circles[r]&&this.colored_circles[r][o]&&(h+="blue"),(this.engine&&this.engine.phase==="stone removal"&&this.engine.last_official_move===this.engine.cur_move&&this.engine.board[r][o]&&this.engine.removal[r][o]||this.scoring_mode&&this.score_estimator&&this.score_estimator.board[r][o]&&this.score_estimator.removal[r][o]||m.stone_removed)&&(N=!0),h+=(z?"T":"")+U+","}let x=!1;if(N||this.mode==="analyze"&&this.analyze_tool==="removal"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r||this.engine.phase==="stone removal"&&this.engine.isActivePlayer(this.player_id)&&this.engine.cur_move===this.engine.last_official_move&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r){const z=this.engine.board[r][o]===q.JGOFNumericPlayerColor.BLACK?"black":"white";m.score==="black"&&z==="white"?h+="whiteX":m.score==="white"&&z==="black"?h+="blackX":(h+="redX",x=!0)}(m.hint||this.highlight_movetree_moves&&y)&&(m.hint?h+="hint,":h+="highlight,");{let z=!1,U=!1;this.engine&&(this.scoring_mode||this.engine.phase==="stone removal")&&this.stone_placement_enabled&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(this.mode!=="analyze"||this.analyze_tool==="stone")&&(z=!0,U=!0),m.mark_x&&(z=!0,U=!1),this.scoring_mode&&this.score_estimator&&this.score_estimator.removal[r][o]&&(z=!0,U=!1),m.remove&&this.mode!=="analyze"&&(z=!0,U=!1),h+=z+","+U}if(m.score&&(!N||x)&&(this.engine.phase!=="finished"||this.mode==="play"||this.mode==="analyze")||this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[r][o]||this.score_estimator.removal[r][o]&&this.score_estimator.board[r][o]===0)||(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[r][o]===0&&(this.engine.removal[r][o]||m.needs_sealing)||this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r){let z=m.score;this.scoring_mode&&this.score_estimator&&(this.score_estimator.territory[r][o]||this.score_estimator.removal[r][o]&&this.score_estimator.board[r][o]===0)&&(z=this.score_estimator.territory[r][o]===1?"black":"white",this.score_estimator.board[r][o]===0&&this.score_estimator.removal[r][o]&&(z="dame")),(this.engine.phase==="stone removal"||this.engine.phase==="finished"&&this.mode==="play")&&this.engine.board[r][o]===0&&this.engine.removal[r][o]&&(z="dame"),m.needs_sealing&&(z="seal"),this.mode==="analyze"&&this.analyze_tool==="score"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(z=this.analyze_subtool),this.scoring_mode&&this.score_estimator&&this.score_estimator.territory[r][o]&&(z=this.score_estimator.territory[r][o]===1?"black":"white"),h+="score "+z+","}{let z,U=!1;if(m.letter&&(z=m.letter),this.mode==="play"&&this.byoyomi_label&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(z=this.byoyomi_label),this.mode==="analyze"&&this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(U=!0,z=this.label_character),!z&&w!=="triangle"&&(z=w),this.show_variation_move_numbers&&!z&&!(m.circle||m.triangle||m.chat_triangle||m.cross||m.square)){const D=this.engine.getMoveByLocation(o,r,!1);D&&!D.trunk&&(D.edited?this.engine.board[r][o]&&(w="triangle"):z=D.getMoveNumberDifferenceFromTrunk().toString())}z&&(h+=z+(U?" fade":"")+","),m.subscript&&(h+=" _ "+m.subscript+(U?" fade":"")+",")}if(this.analyze_tool==="label"&&this.last_hover_square&&this.last_hover_square.x===o&&this.last_hover_square.y===r&&(this.analyze_subtool==="triangle"||this.analyze_subtool==="square"||this.analyze_subtool==="cross"||this.analyze_subtool==="circle")&&(h+="hover "+this.analyze_subtool+","),m.circle&&(h+="circle,"),(m.triangle||m.chat_triangle||w==="triangle")&&(h+="triangle,"),m.cross&&(h+="cross,"),m.square&&(h+="square,"),F&&this.engine&&this.engine.cur_move&&this.engine.cur_move.x===o&&this.engine.cur_move.y===r&&this.engine.board[r][o]&&(this.engine.phase==="play"||this.engine.phase==="finished")&&(h+="last_move,",this.engine.undo_requested&&this.getShowUndoRequestIndicator()&&this.engine.undo_requested===this.engine.cur_move.move_number&&(h+="?,")),this.scoring_mode===!0&&this.score_estimator||this.scoring_mode==="stalling-scoring-mode"&&this.stalling_score_estimate&&this.mode!=="analyze"){const U=(this.scoring_mode==="stalling-scoring-mode"?this.stalling_score_estimate:this.score_estimator).ownership[r][o];h+=U.toFixed(5)+","}return h}drawLines(o){if(o&&this.lines_layer&&(this.lines_layer.remove(),delete this.lines_layer),!this.lines_layer){const r=this.square_size;let b=this.draw_left_labels?r:0,h=this.draw_top_labels?r:0;this.bounds.left>0&&(b=-r*this.bounds.left),this.bounds.top>0&&(h=-r*this.bounds.top),b+=Math.round(r/2),h+=Math.round(r/2);const F=10,T=r>F?Math.round(2*Math.round(Math.max(1,r*.02)))*.5:r*.08;b-=T*.5,h-=T*.5,b=Math.round(b*2)*.5,h=Math.round(h*2)*.5,this.lines_layer=document.createElementNS("http://www.w3.org/2000/svg","g");const P=document.createElementNS("http://www.w3.org/2000/svg","path");let m="";for(let y=0;y<this.width;++y)m+=`M ${b+y*r} ${h} L ${b+y*r} ${h+(this.height-1)*r} `;for(let y=0;y<this.height;++y)m+=`M ${b} ${h+y*r} L ${b+(this.width-1)*r} ${h+y*r} `;P.setAttribute("d",m),P.setAttribute("stroke",this.theme_line_color),r>F?P.setAttribute("stroke-width",`${T.toFixed(0)}px`):P.setAttribute("stroke-width",`${T.toFixed(1)}px`),P.setAttribute("stroke-linecap","square"),this.lines_layer.appendChild(P);let w=null;if(this.width===19&&this.height===19&&(w=[[3,3],[3,9],[3,15],[9,3],[9,9],[9,15],[15,3],[15,9],[15,15]]),this.width===13&&this.height===13&&(w=[[3,3],[3,9],[6,6],[9,3],[9,9]]),this.width===9&&this.height===9&&(w=[[2,2],[2,6],[4,4],[6,2],[6,6]]),w){const y=this.square_size<5?.5:Math.max(2,this.square_size*.075);for(let N=0;N<w.length;++N){const[x,z]=w[N],U=document.createElementNS("http://www.w3.org/2000/svg","circle");U.setAttribute("cx",(b+x*r).toString()),U.setAttribute("cy",(h+z*r).toString()),U.setAttribute("r",`${y.toFixed(1)}px`),U.setAttribute("fill",this.theme_star_color),this.lines_layer.appendChild(U)}}this.svg.appendChild(this.lines_layer)}}drawCoordinateLabels(o){if(o&&this.coordinate_labels_layer&&(this.coordinate_labels_layer.remove(),delete this.coordinate_labels_layer),!this.coordinate_labels_layer){this.coordinate_labels_layer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.coordinate_labels_layer.setAttribute("class","coordinate-labels");let r=Math.round(this.square_size*.5),b="bold";this.getCoordinateDisplaySystem()==="1-1"&&(r*=.7,b="",this.height>20&&(r*=.7));const h=(m,w,y)=>{const x=this.square_size/6,z=document.createElementNS("http://www.w3.org/2000/svg","text");z.setAttribute("x",(w+0).toFixed(0)),z.setAttribute("y",(y+x).toFixed(0)),z.setAttribute("font-size",`${Math.round(r)}px`),z.setAttribute("font-size",`${Math.round(r)}px`),z.setAttribute("font-weight",b),z.setAttribute("fill",this.theme_board.getLabelTextColor()),z.textContent=m,this.coordinate_labels_layer.appendChild(z)},F=(m,w,y)=>{for(let N=0;N<m.length;++N){const x=r,z=w;let U=y+r/2.5;m.length===2&&(U=U-x*.5+N*x),m.length===3&&(U=U-x*1+N*x+.5);const D=document.createElementNS("http://www.w3.org/2000/svg","text");D.setAttribute("x",z.toFixed(0)),D.setAttribute("y",U.toFixed(1)),D.setAttribute("font-size",`${Math.round(r)}px`),D.setAttribute("font-weight",b),D.setAttribute("fill",this.theme_board.getLabelTextColor()),D.textContent=m[N],this.coordinate_labels_layer.appendChild(D)}},T=(m,w)=>{switch(this.getCoordinateDisplaySystem()){case"A1":for(let y=0;y<this.width;++m,++y){const N=(m-this.bounds.left-(this.bounds.left>0?+this.draw_left_labels:0))*this.square_size+this.square_size/2,x=w*this.square_size+this.square_size/2;h((0,O.encodePrettyXCoordinate)(y),N,x)}break;case"1-1":for(let y=0;y<this.width;++m,++y){const N=(m-this.bounds.left-(this.bounds.left>0?+this.draw_left_labels:0))*this.square_size+this.square_size/2,x=w*this.square_size+this.square_size/2;h(""+(y+1),N,x)}break}},P=(m,w)=>{switch(this.getCoordinateDisplaySystem()){case"A1":for(let N=0;N<this.height;++w,++N){const x=m*this.square_size+this.square_size/2,z=(w-this.bounds.top-(this.bounds.top>0?+this.draw_top_labels:0))*this.square_size+this.square_size/2;h(""+(this.height-N),x,z)}break;case"1-1":const y=["","","","","","","","","","","","","","","","","","","","","","","","",""];for(let N=0;N<this.height;++w,++N){const x=m*this.square_size+this.square_size/2,z=(w-this.bounds.top-(this.bounds.top>0?+this.draw_top_labels:0))*this.square_size+this.square_size/2;F(y[N],x,z)}break}};this.draw_top_labels&&this.bounds.top===0&&T(this.draw_left_labels?1:0,0),this.draw_bottom_labels&&this.bounds.bottom===this.height-1&&T(this.draw_left_labels?1:0,+this.draw_top_labels+this.bounded_height),this.draw_left_labels&&this.bounds.left===0&&P(0,this.draw_top_labels?1:0),this.draw_right_labels&&this.bounds.right===this.width-1&&P(+this.draw_left_labels+this.bounded_width,+this.draw_top_labels),this.svg.appendChild(this.coordinate_labels_layer)}}computeThemeStoneRadius(){const o=this.square_size*.5;return Math.max(1,o)}redraw(o){var r,b;if(!this.ready_to_draw)return;if(this.destroyed){console.debug("Attempting to redraw destroyed goban");return}if(!this.drawing_enabled||this.no_display)return;const h=this.metrics=this.computeMetrics();if(o||!(this.__set_board_width===h.width&&this.__set_board_height===h.height&&this.theme_stone_radius===this.computeThemeStoneRadius())){o=!0;try{this.parent.style.width=h.width+"px",this.parent.style.height=h.height+"px",this.svg.setAttribute("width",h.width.toString()),this.svg.setAttribute("height",h.height.toString()),this.__set_board_width=h.width,this.__set_board_height=h.height,this.setTheme(this.getSelectedThemes(),!0)}catch(F){setTimeout(()=>{throw F},1);return}}if(this.drawLines(o),this.drawCoordinateLabels(o),o||!this.grid_layer||!this.shadow_layer){(r=this.shadow_layer)===null||r===void 0||r.remove(),this.shadow_layer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.shadow_layer.setAttribute("class","shadow-layer"),this.svg.appendChild(this.shadow_layer),(b=this.grid_layer)===null||b===void 0||b.remove(),this.grid_layer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.grid_layer.setAttribute("class","grid"),this.svg.appendChild(this.grid_layer),this.clearCells();for(let F=0;F<this.height;++F)this.grid[F]=[],this.shadow_grid[F]=[]}(!this.__draw_state||o||this.__draw_state.length!==this.height||this.__draw_state[0].length!==this.width)&&(this.__draw_state=(0,O.makeMatrix)(this.width,this.height,""));for(let F=this.bounds.top;F<=this.bounds.bottom;++F)for(let T=this.bounds.left;T<=this.bounds.right;++T)this.drawSquare(T,F);this.pen_marks&&(o&&this.detachPenLayer(),this.drawPenMarks(this.pen_marks)),this.move_tree_redraw()}showMessage(o,r,b=5e3){var h;this.clearMessage();const F=((h=r==null?void 0:r.error)===null||h===void 0?void 0:h.message_id)||o,T=(0,R.formatMessage)(F,r);if(this.emit("show-message",{formatted:T,message_id:F,parameters:r}),!this.config.dont_show_messages){this.message_div=document.createElement("div"),this.message_div.className="GobanMessage",this.message_td=document.createElement("td");const P=document.createElement("table"),m=document.createElement("tr");m.appendChild(this.message_td),P.appendChild(m),this.message_div.appendChild(P),this.message_text=document.createElement("div"),this.message_text.innerHTML=T,this.message_td.appendChild(this.message_text),this.parent.appendChild(this.message_div);const w=Date.now();this.message_div.addEventListener("click",()=>{try{if(Date.now()-w<100)return;b>0&&this.clearMessage()}catch(y){console.error(y)}})}b||(b=5e3),b>0&&(this.message_timeout=window.setTimeout(()=>{this.clearMessage()},b))}clearMessage(){this.message_div&&(this.message_div.remove(),delete this.message_div),this.message_timeout&&(clearTimeout(this.message_timeout),delete this.message_timeout),this.emit("clear-message")}generateSvgDefs(o){const r=document.createElementNS("http://www.w3.org/2000/svg","defs"),b=this.themes;return b.white in s.white||(s.white[b.white]={}),b.black in s.black||(s.black[b.black]={}),this.theme_black.preRenderShadowSVG(r,"black"),this.theme_white.preRenderShadowSVG(r,"white"),s.white[b.white][o]=this.theme_white.preRenderWhiteSVG(r,o,23434,()=>{}),s.black[b.black][o]=this.theme_black.preRenderBlackSVG(r,o,2081,()=>{}),r}setTheme(o,r){var b,h,F,T,P;if(this.no_display){console.log("No display");return}this.themes=o;const m=((b=L.THEMES.board)===null||b===void 0?void 0:b[o.board])||L.THEMES.board.Plain,w=((h=L.THEMES.white)===null||h===void 0?void 0:h[o.white])||L.THEMES.white.Plain,y=((F=L.THEMES.black)===null||F===void 0?void 0:F[o.black])||L.THEMES.black.Plain;if(this.theme_board=new m,this.theme_white=new w(this.theme_board),this.theme_black=new y(this.theme_board),this.metrics||(this.metrics=this.computeMetrics()),this.theme_stone_radius=this.computeThemeStoneRadius(),isNaN(this.theme_stone_radius))throw console.error("setThemes was not able to find the board size, metrics were: ",JSON.stringify(this.metrics)),new Error("invalid stone radius computed");try{(T=this.svg_defs)===null||T===void 0||T.remove(),this.svg_defs=this.generateSvgDefs(this.theme_stone_radius),this.svg.appendChild(this.svg_defs),this.move_tree_svg&&((P=this.move_tree_svg_defs)===null||P===void 0||P.remove(),this.move_tree_svg_defs=this.generateSvgDefs(S.MoveTree.stone_radius),this.move_tree_svg.appendChild(this.move_tree_svg_defs))}catch(x){throw console.error("Error pre-rendering stones.",{themes:o,move_tree_stone_radius:S.MoveTree.stone_radius}),x}if(this.theme_white_stones=s.white[o.white][this.theme_stone_radius],this.theme_black_stones=s.black[o.black][this.theme_stone_radius],!this.theme_white_stones||!this.theme_black_stones)throw new Error("Failed to load stone images for given radius"+this.theme_stone_radius);this.theme_line_color=this.theme_board.getLineColor(),this.theme_faded_line_color=this.theme_board.getFadedLineColor(),this.theme_star_color=this.theme_board.getStarColor(),this.theme_faded_star_color=this.theme_board.getFadedStarColor(),this.theme_blank_text_color=this.theme_board.getBlankTextColor(),this.theme_black_text_color=this.theme_black.getBlackTextColor(),this.theme_white_text_color=this.theme_white.getWhiteTextColor();const N=this.theme_board.getBackgroundCSS();if(this.parent)for(const x in N)this.parent.style[x]=N[x];r||(this.redraw(!0),this.move_tree_redraw())}onLabelingStart(o){const r=(0,C.getRelativeEventPosition)(o,this.parent);this.last_label_position=this.xy2ij(r.x,r.y,!1);{const b=this.last_label_position.i,h=this.last_label_position.j;if(!(b>=0&&b<this.width&&h>=0&&h<this.height))return}if(this.labeling_mode=this.putOrClearLabel(this.last_label_position.i,this.last_label_position.j)?"put":"clear",this.__last_pt.valid){const b=this.last_hover_square;delete this.last_hover_square,b&&this.drawSquare(b.x,b.y)}this.__last_pt=this.xy2ij(-1,-1),this.drawSquare(this.last_label_position.i,this.last_label_position.j)}onLabelingMove(o){const r=(0,C.getRelativeEventPosition)(o,this.parent),b=this.xy2ij(r.x,r.y);{const h=b.i,F=b.j;if(!(h>=0&&h<this.width&&F>=0&&F<this.height))return}(b.i!==this.last_label_position.i||b.j!==this.last_label_position.j)&&(this.last_label_position=b,this.putOrClearLabel(b.i,b.j,this.labeling_mode),this.setLabelCharacterFromMarks())}setTitle(o){this.title=o,this.title_div&&(this.title_div.innerHTML=o)}watchSelectedThemes(o){return p.callbacks.watchSelectedThemes?p.callbacks.watchSelectedThemes(o):{remove:()=>{}}}setMoveTreeContainer(o){this.move_tree_container=o,this.move_tree_redraw()}move_tree_redraw(o){var r;if(!this.move_tree_container)return;let b=!1;if(!this.move_tree_inner_container){if(b=!0,this.move_tree_inner_container=document.createElement("div"),this.move_tree_svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),d){const B=(r=this.move_tree_inner_container.shadowRoot)!==null&&r!==void 0?r:this.move_tree_inner_container.attachShadow({mode:"open"});B.appendChild(this.move_tree_svg);const j=new CSSStyleSheet;j!=null&&j.replaceSync&&j.replaceSync(`text {
                    font-family: Verdana, Arial, sans-serif;
                    text-anchor: middle;
                    font-weight: bold;
                    user-select: none;
                }`),B.adoptedStyleSheets=[j]}else this.move_tree_inner_container.appendChild(this.move_tree_svg);this.move_tree_svg_defs=this.generateSvgDefs(S.MoveTree.stone_radius),this.move_tree_container.appendChild(this.move_tree_inner_container),this.move_tree_bindEvents(this.move_tree_svg),this.move_tree_container.style.position="relative",this.move_tree_svg.style.position="absolute",this.move_tree_svg.appendChild(this.move_tree_svg_defs);try{const B=new ResizeObserver(()=>{this.move_tree_redraw(!0)});B.observe(this.move_tree_container),this.on("destroy",()=>{B.disconnect()})}catch{}}if(!this.move_tree_svg){console.warn("move_tree_redraw called without move_tree_svg set");return}if(b||this.move_tree_inner_container.parentNode!==this.move_tree_container){const B=ee=>{try{this.move_tree_redraw(!0)}catch(me){console.error(me)}};this.move_tree_container.appendChild(this.move_tree_inner_container),this.move_tree_container.style.position="relative",this.move_tree_container.removeEventListener("scroll",B),this.move_tree_container.addEventListener("scroll",B);const j=this.move_tree_container;this.on("destroy",()=>{j.removeEventListener("scroll",B)})}(this.move_tree_svg.clientWidth!==this.move_tree_container.clientWidth||this.move_tree_svg.clientHeight!==this.move_tree_container.clientHeight)&&(this.move_tree_svg.setAttribute("width",this.move_tree_container.clientWidth.toString()),this.move_tree_svg.setAttribute("height",this.move_tree_container.clientHeight.toString())),this.engine.move_tree.recomputeIsobranches();const h=this.engine.cur_move;this.engine.move_tree_layout_dirty=!1,h.setActivePath(++S.MoveTree.active_path_number);const F=this.move_tree_svg,T=this.engine;this.engine.move_tree_layout_vector=[];const P={};this.engine.move_tree.layout(0,0,P,0),this.engine.move_tree_layout_hash=P;let m=0;for(let B=0;B<this.engine.move_tree_layout_vector.length;++B)m=Math.max(this.engine.move_tree_layout_vector[B]+1,m);const w=this.move_tree_container.clientWidth,y=this.move_tree_container.clientHeight,N=Math.max(w,this.engine.move_tree_layout_vector.length*S.MoveTree.stone_square_size),x=Math.max(y,m*S.MoveTree.stone_square_size);let z=this.move_tree_container.scrollTop,U=this.move_tree_container.scrollLeft;this.move_tree_inner_container.style.width=N+"px",this.move_tree_inner_container.style.height=x+"px",o||(U>h.layout_cx||U+w-20<h.layout_cx||z>h.layout_cy||z+y-20<h.layout_cy)&&(this.move_tree_container.scrollLeft=h.layout_cx-w/2,this.move_tree_container.scrollTop=h.layout_cy-y/2,z=this.move_tree_container.scrollTop,U=this.move_tree_container.scrollLeft),F.style.top=z+"px",F.style.left=U+"px";const D={offset_x:U,offset_y:z,minx:U-S.MoveTree.stone_square_size,miny:z-S.MoveTree.stone_square_size,maxx:U+w+S.MoveTree.stone_square_size,maxy:z+y+S.MoveTree.stone_square_size};F.innerHTML="",this.move_tree_svg_defs&&F.appendChild(this.move_tree_svg_defs),this.move_tree_hilightNode(F,h,"#6BAADA",D),T.cur_review_move&&T.cur_review_move.id!==h.id&&this.move_tree_hilightNode(F,T.cur_review_move,"#6BDA6B",D),this.move_tree_recursiveDrawPath(F,this.engine.move_tree,D),this.move_tree_drawRecursive(F,this.engine.move_tree,S.MoveTree.active_path_number,D)}move_tree_bindEvents(o){const r=b=>{try{if(!this.move_tree_container)throw new Error("move_tree_container was not set");const h=this.move_tree_container.scrollLeft,F=this.move_tree_container.scrollTop,T=(0,C.getRelativeEventPosition)(b,this.move_tree_container);T.x+=h,T.y+=F;const P=Math.floor(T.x/S.MoveTree.stone_square_size),m=Math.floor(T.y/S.MoveTree.stone_square_size),w=this.engine.move_tree.getNodeAtLayoutPosition(P,m);if(w&&(this.engine.cur_move.id!==w.id&&(this.engine.jumpTo(w),this.setLabelCharacterFromMarks(),this.updateTitleAndStonePlacement(),this.emit("update"),this.syncReviewMove(),this.redraw()),this.engine.cur_move.played_by)){const y=(0,C.getRelativeEventPosition)(b,this.move_tree_container);this.emit("played-by-click",{player_id:this.engine.cur_move.played_by,x:y.x,y:y.y})}}catch(h){console.error(h)}};o.addEventListener("touchstart",r),o.addEventListener("mousedown",r),this.on("destroy",()=>{o.removeEventListener("touchstart",r),o.removeEventListener("mousedown",r)})}move_tree_drawStone(o,r,b,h){const F=r.move_number*31,T=r.layout_cx-h.offset_x,P=r.layout_cy-h.offset_y,m=r.player,w=r.active_path_number===b,y=S.MoveTree.stone_radius,N=document.createElementNS("http://www.w3.org/2000/svg","g");o.appendChild(N),w||(N.setAttribute("class","move-tree-stone"),N.setAttribute("fill-opacity","0.6"),N.setAttribute("stroke-opacity","0.6"),N.setAttribute("opacity","0.6"));const x=s.white[this.themes.white][y],z=s.black[this.themes.black][y];if(!x||!z)throw new Error("Failed to load stone images for given radius"+this.theme_stone_radius);if(m===1){const me=z[F%z.length];this.theme_black.placeBlackStoneSVG(N,void 0,me,T,P,y)}else if(m===2){const me=x[F%x.length];this.theme_white.placeWhiteStoneSVG(N,void 0,me,T,P,y)}else return;const U=m===1?this.theme_black_text_color:this.theme_white_text_color;let D="";switch(p.callbacks.getMoveTreeNumbering?p.callbacks.getMoveTreeNumbering():"move-number"){case"move-coordinates":D=r.pretty_coordinates;break;case"none":D="";break;case"move-number":default:r.pretty_coordinates==="pass"?D=".":D=String(r.move_number);break}r.label!==D&&(r.label=D,delete r.label_metrics);const B=10,j=document.createElementNS("http://www.w3.org/2000/svg","text");j.setAttribute("x",T.toFixed(0)),j.setAttribute("y",(P+B/8).toFixed(1)),j.setAttribute("width",S.MoveTree.stone_square_size.toFixed(1)),j.setAttribute("height",S.MoveTree.stone_square_size.toFixed(1)),j.setAttribute("font-size",`${B}px`),j.setAttribute("font-weight","bold"),j.setAttribute("alignment-baseline","middle"),j.setAttribute("text-anchor","middle"),j.setAttribute("dominant-baseline","middle"),j.setAttribute("fill",U),j.textContent=r.label,N.appendChild(j);const ee=r.text?"#3333ff":r.correct_answer?"#33ff33":r.wrong_answer?"#ff3333":null;if(ee){const me=document.createElementNS("http://www.w3.org/2000/svg","circle");me.setAttribute("cx",T.toFixed(0)),me.setAttribute("cy",P.toFixed(1)),me.setAttribute("r",y.toFixed(0)),me.setAttribute("fill","none"),me.setAttribute("stroke",ee),me.setAttribute("stroke-width","2"),N.appendChild(me)}}move_tree_drawRecursive(o,r,b,h){r.trunk_next&&this.move_tree_drawRecursive(o,r.trunk_next,b,h);for(let F=0;F<r.branches.length;++F)this.move_tree_drawRecursive(o,r.branches[F],b,h);(!h||r.layout_cx>=h.minx&&r.layout_cx<=h.maxx&&r.layout_cy>=h.miny&&r.layout_cy<=h.maxy)&&this.move_tree_drawStone(o,r,b,h)}move_tree_hilightNode(o,r,b,h){const F=document.createElementNS("http://www.w3.org/2000/svg","rect"),T=Math.round(r.layout_cx-S.MoveTree.stone_square_size*.5)-h.offset_x,P=Math.round(r.layout_cy-S.MoveTree.stone_square_size*.5)-h.offset_y;F.setAttribute("x",T.toFixed(0)),F.setAttribute("y",P.toFixed(0)),F.setAttribute("width",S.MoveTree.stone_square_size.toFixed(0)),F.setAttribute("height",S.MoveTree.stone_square_size.toFixed(0)),F.setAttribute("fill",b),o.appendChild(F)}move_tree_drawPath(o,r,b){if(r.parent){if(r.parent.layout_cx<b.minx&&r.layout_cx<b.minx||r.parent.layout_cy<b.miny&&r.layout_cy<b.miny||r.parent.layout_cx>b.maxx&&r.layout_cx>b.maxx||r.parent.layout_cy>b.maxy&&r.layout_cy>b.maxy)return;const h=document.createElementNS("http://www.w3.org/2000/svg","path"),F=b.offset_x,T=b.offset_y;h.setAttribute("d",`M ${r.parent.layout_cx-F} ${r.parent.layout_cy-T} Q ${r.layout_cx-S.MoveTree.stone_square_size*.5-F} ${r.layout_cy-T} ${r.layout_cx-F} ${r.layout_cy-T}`),h.setAttribute("fill","none"),h.setAttribute("stroke",r.trunk?"#000000":S.MoveTree.line_colors[r.line_color]),h.setAttribute("stroke-width","1"),o.appendChild(h)}}move_tree_drawIsoBranchTo(o,r,b,h){let F=r,T=b;if(F.layout_cx<h.minx&&T.layout_cx<h.minx||F.layout_cy<h.miny&&T.layout_cy<h.miny||F.layout_cx>h.maxx&&T.layout_cx>h.maxx||F.layout_cy>h.maxy&&T.layout_cy>h.maxy)return;if(T.trunk_next===null&&T.branches.length===0&&(F.trunk_next!==null||F.branches.length!==0)){const z=F;F=T,T=z}const P=F.trunk_next==null&&F.branches.length===0&&(T.trunk_next!==null||T.branches.length!==0),m=h.offset_x,w=h.offset_y,y=document.createElementNS("http://www.w3.org/2000/svg","path"),N=P?T.layout_cy:(F.layout_cy+T.layout_cy)/2,x=(F.layout_cx+T.layout_cx)/2+S.MoveTree.stone_square_size*.5;y.setAttribute("d",`M ${T.layout_cx-m} ${T.layout_cy-w} Q ${x-m} ${N-w} ${F.layout_cx-m} ${F.layout_cy-w}`),y.setAttribute("fill","none"),y.setAttribute("stroke",S.MoveTree.isobranch_colors[P?"strong":"weak"]),y.setAttribute("stroke-width","2"),o.appendChild(y)}move_tree_recursiveDrawPath(o,r,b){r.trunk_next&&this.move_tree_recursiveDrawPath(o,r.trunk_next,b);for(let h=0;h<r.branches.length;++h)this.move_tree_recursiveDrawPath(o,r.branches[h],b);if(r.isobranches)for(let h=0;h<r.isobranches.length;++h)this.move_tree_drawIsoBranchTo(o,r,r.isobranches[h],b);this.move_tree_drawPath(o,r,b)}}A.SVGRenderer=k;class f{constructor(o,r,b){this._transform="",this.renderer=o,this.i=r,this.j=b}get g(){return this._g||(this._g=document.createElementNS("http://www.w3.org/2000/svg","g"),this._transform&&this.g.setAttribute("transform",this._transform),this.renderer.grid_layer.appendChild(this._g)),this._g}set transform(o){this._transform!==o&&(this._transform=o,this._g&&(this.g.setAttribute("transform",o),this.last_stone_shadow&&this.last_stone_shadow.setAttribute("transform",o)))}get transform(){return this._transform}drawFadedIntersectionLines(o,r){if(this.last_faded_lines)return;const b=this.renderer.metrics.mid,h=this.renderer.square_size,F=this.renderer.metrics.offset,T=this.renderer.width,P=this.renderer.height;let m=0,w=h;const y=h/2-F;let N=0,x=h;const z=h/2-F;this.i===0&&(m+=b),this.i===T-1&&(w-=b),this.j===0&&(N+=b),this.j===P-1&&(x-=b),this.i===T-1&&this.j===P-1&&y===w&&z===x&&(w+=1,x+=1);const U=b,D=b,B=this.g;if(o){const ee=document.createElementNS("http://www.w3.org/2000/svg","circle");this.last_faded_star_point=ee,ee.setAttribute("cx",U.toString()),ee.setAttribute("cy",D.toString()),ee.setAttribute("r",r.toString()),ee.setAttribute("fill",this.renderer.theme_faded_star_color),B.prepend(ee)}const j=document.createElementNS("http://www.w3.org/2000/svg","path");this.last_faded_lines=j,j.setAttribute("stroke",this.renderer.theme_faded_line_color),j.setAttribute("stroke-width",this.renderer.square_size<5?"0.2":"1"),j.setAttribute("fill","none"),j.setAttribute("d",`
                M ${Math.floor(m)} ${z} L ${Math.floor(w)} ${z}
                M ${y} ${Math.floor(N)} L ${y} ${Math.floor(x)} 
            `),B.prepend(j)}clearFadedLines(){this.last_faded_lines&&(this.last_faded_lines.remove(),delete this.last_faded_lines),this.last_faded_star_point&&(this.last_faded_star_point.remove(),delete this.last_faded_star_point)}heatmap(o){if(this.last_heatmap_value!==o){if(!this.last_heatmap_rect){const r=this.renderer.metrics.mid,b=this.renderer.square_size,h=r,F=r,T="#00FF00",P=Math.floor(b*.5)-.5,m=document.createElementNS("http://www.w3.org/2000/svg","rect");this.last_heatmap_rect=m,m.setAttribute("x",(h-P).toFixed(1)),m.setAttribute("y",(F-P).toFixed(1)),m.setAttribute("width",(P*2).toFixed(1)),m.setAttribute("height",(P*2).toFixed(1)),this.last_heatmap_rect.setAttribute("fill",T),this.g.appendChild(this.last_heatmap_rect)}this.last_heatmap_value=o,this.last_heatmap_rect.setAttribute("fill-opacity",Math.min(o,.5).toFixed(2))}}clearHeatmap(){this.last_heatmap_rect&&(this.last_heatmap_rect.remove(),delete this.last_heatmap_rect,this.last_heatmap_value=void 0)}highlight(o){if(this.last_highlight_color!==o){if(!this.last_highlight_rect){const r=this.renderer.metrics.mid,b=this.renderer.square_size,h=r,F=r,T=Math.floor(b*.5)-.5,P=document.createElementNS("http://www.w3.org/2000/svg","rect");this.last_highlight_rect=P,P.setAttribute("x",(h-T).toFixed(1)),P.setAttribute("y",(F-T).toFixed(1)),P.setAttribute("width",(T*2).toFixed(1)),P.setAttribute("height",(T*2).toFixed(1)),P.setAttribute("fill-opacity","0.6"),this.g.appendChild(P)}this.last_highlight_rect.setAttribute("fill",o),this.last_highlight_color=o}}clearHighlight(){this.last_highlight_rect&&(this.last_highlight_rect.remove(),delete this.last_highlight_rect,this.last_highlight_color=void 0)}circle(o){const r=this.renderer.square_size,b=Math.floor(r*.5)-.5;if(!this.last_circle){const F=this.renderer.metrics.mid,T=F,P=F,m=document.createElementNS("http://www.w3.org/2000/svg","circle");this.last_circle=m,m.setAttribute("class","colored-circle"),m.setAttribute("cx",T.toString()),m.setAttribute("cy",P.toString()),this.g.appendChild(m)}this.last_circle_fill!==o.color&&(this.last_circle.setAttribute("fill",o.color),this.last_circle_fill=o.color),this.last_circle_stroke!==o.border_color&&(o.border_color?this.last_circle.setAttribute("stroke",o.border_color):this.last_circle.removeAttribute("stroke"),this.last_circle_stroke=o.border_color);let h=b*(o.border_width||.1);h<.3&&(h=0),this.last_circle_stroke_width!==o.border_width&&(h>0?this.last_circle.setAttribute("stroke-width",h.toFixed(1)):this.last_circle.setAttribute("stroke-width","1px"),this.last_circle_stroke_width=o.border_width),this.last_circle_radius!==b&&(this.last_circle.setAttribute("r",Math.max(.1,b-h/2).toString()),this.last_circle_radius=b)}clearCircle(){this.last_circle&&(this.last_circle.remove(),delete this.last_circle,delete this.last_circle_fill,delete this.last_circle_radius,delete this.last_circle_stroke,delete this.last_circle_stroke_width)}stone(o,r,b,h,F){if(this.last_stone&&this.last_stone_color===o&&this.last_stone_transparent===r&&this.last_stone_stone===b&&this.last_stone_radius===h&&this.last_stone_alpha_value===F)return;this.clearStone();const T=this.renderer.metrics.mid,P=T,m=T,[w,y]=o===q.JGOFNumericPlayerColor.BLACK?this.renderer.theme_black.placeBlackStoneSVG(this.g,r?void 0:this.renderer.shadow_layer,b,P,m,h):this.renderer.theme_black.placeWhiteStoneSVG(this.g,r?void 0:this.renderer.shadow_layer,b,P,m,h);this.last_stone_shadow&&this.last_stone_shadow.remove(),this.last_stone_shadow=y,this.last_stone_shadow&&this.last_stone_shadow.setAttribute("transform",this.transform),r&&w.setAttribute("opacity",F.toString()),this.last_stone=w,this.last_stone_color=o,this.last_stone_transparent=r,this.last_stone_stone=b,this.last_stone_radius=h,this.last_stone_alpha_value=F}clearStone(){this.last_stone&&(this.last_stone.remove(),delete this.last_stone),this.last_stone_shadow&&(this.last_stone_shadow.remove(),delete this.last_stone_shadow)}blueMove(o,r){if(this.last_blue_move&&this.last_blue_move_color===o&&this.last_blue_move_border_width===r)return;this.clearBlueMove();const b=this.renderer.metrics.mid,h=b,F=b,T=this.renderer.square_size,P=Math.floor(T*.5)-.5;let m=P*(r||.1);m<.3&&(m=0);const w=document.createElementNS("http://www.w3.org/2000/svg","circle");w.setAttribute("class","colored-circle"),w.setAttribute("stroke",o),m>0?w.setAttribute("stroke-width",`${m.toFixed(1)}px`):w.setAttribute("stroke-width","1px"),w.setAttribute("fill","none"),w.setAttribute("cx",h.toString()),w.setAttribute("cy",F.toString()),w.setAttribute("r",Math.max(.1,P-m/2).toString()),this.g.appendChild(w),this.last_blue_move=w,this.last_blue_move_color=o,this.last_blue_move_border_width=r}clearBlueMove(){this.last_blue_move&&(this.last_blue_move.remove(),delete this.last_blue_move)}removalCross(o,r,b){if(this.last_removal_cross&&this.last_removal_cross_fill===o&&this.last_removal_cross_radius===r&&this.last_removal_cross_opacity===b)return;this.clearRemovalCross();const h=this.renderer.metrics.mid,F=h,T=h,P=this.renderer.square_size,m=r,w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("class","removal-cross"),w.setAttribute("fill",o);const y=m*.25,N=m*.3,x=N*.4,U=[-m,-m,-m+y,-m,-N+x,-N-x,N-x,-N-x,m-y,-m,m,-m,m,-m+y,N+x,-N+x,N+x,N-x,m,m-y,m,m,m-y,m,N-x,N+x,-N+x,N+x,-m+y,m,-m,m,-m,m-y,-N-x,N-x,-N-x,-N+x,-m,-m+y].map((D,B)=>(B%2===0?B===0?"M":"L":" ")+D).join(" ")+" Z";w.setAttribute("stroke","#888888"),w.setAttribute("stroke-width",`${P*.0275}px`),w.setAttribute("d",U),w.setAttribute("stroke-opacity",b.toString()),w.setAttribute("transform",`translate(${F}, ${T})`),this.g.appendChild(w),this.last_removal_cross=w,this.last_removal_cross_fill=o,this.last_removal_cross_radius=r,this.last_removal_cross_opacity=b}clearRemovalCross(){this.last_removal_cross&&(this.last_removal_cross.remove(),delete this.last_removal_cross,delete this.last_removal_cross_fill,delete this.last_removal_cross_radius,delete this.last_removal_cross_opacity)}score(o,r,b){const h=this.renderer.metrics.mid,F=h,T=h,P=this.renderer.square_size;if(this.last_score&&this.last_score_fill===o&&this.last_score_stroke===r&&this.last_score_opacity===b)return;this.clearScore();const m=P*.15,w=document.createElementNS("http://www.w3.org/2000/svg","rect");w.setAttribute("x",(F-m).toFixed(1)),w.setAttribute("y",(T-m).toFixed(1)),w.setAttribute("width",(m*2).toFixed(1)),w.setAttribute("height",(m*2).toFixed(1)),w.setAttribute("stroke-width",(Math.ceil(P*.065)-.5).toFixed(1)),w.setAttribute("fill",o),w.setAttribute("stroke",r),b<1&&w.setAttribute("fill-opacity",b.toString()),this.g.appendChild(w),this.last_score=w,this.last_score_fill=o,this.last_score_stroke=r,this.last_score_opacity=b}clearScore(){this.last_score&&(this.last_score.remove(),delete this.last_score,delete this.last_score_fill,delete this.last_score_stroke,delete this.last_score_opacity)}letter(o,r,b,h,F){if(this.last_letter&&this.last_letter_letter===o&&this.last_letter_color===r&&this.last_letter_font_size===b&&this.last_letter_opacity===h&&this.last_letter_room_for_subscript===F)return;this.clearLetter();const T=this.renderer.metrics.mid,P=T,m=T,w=this.renderer.square_size,y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("class","letter"),y.setAttribute("fill",r),y.setAttribute("font-size",`${b}px`),y.setAttribute("text-anchor","middle"),y.setAttribute("x",P.toString());let N=m+b*.35;F&&(N-=w*.15),y.setAttribute("y",N.toString()),y.textContent=o,h<1&&y.setAttribute("fill-opacity",h.toString()),this.g.appendChild(y),this.last_letter=y,this.last_letter_letter=o,this.last_letter_color=r,this.last_letter_font_size=b,this.last_letter_opacity=h,this.last_letter_room_for_subscript=F}clearLetter(){this.last_letter&&(this.last_letter.remove(),delete this.last_letter,delete this.last_letter_letter,delete this.last_letter_color,delete this.last_letter_font_size,delete this.last_letter_opacity,delete this.last_letter_room_for_subscript)}subscript(o,r,b,h,F,T){if(this.last_subscript&&this.last_subscript_subscript===o&&this.last_subscript_color===r&&this.last_subscript_font_size===b&&this.last_subscript_opacity===h&&this.last_subscript_room_for_letter===F&&this.last_subscript_room_for_sub_triangle===T)return;this.clearSubscript();const P=this.renderer.metrics.mid,m=P,w=P,y=this.renderer.square_size,N=document.createElementNS("http://www.w3.org/2000/svg","text");N.setAttribute("class","subscript"),N.setAttribute("fill",r),N.setAttribute("font-size",`${b}px`),N.setAttribute("text-anchor","middle"),N.setAttribute("x",m.toString());let x=w+b*.3;F&&(x+=y*.3),T&&(x-=y*.08),N.setAttribute("y",x.toString()),N.textContent=o,h<1&&N.setAttribute("fill-opacity",h.toString()),this.g.appendChild(N),this.last_subscript=N,this.last_subscript_subscript=o,this.last_subscript_color=r,this.last_subscript_font_size=b,this.last_subscript_opacity=h,this.last_subscript_room_for_letter=F,this.last_subscript_room_for_sub_triangle=T}clearSubscript(){this.last_subscript&&(this.last_subscript.remove(),delete this.last_subscript,delete this.last_subscript_subscript,delete this.last_subscript_color,delete this.last_subscript_font_size,delete this.last_subscript_opacity,delete this.last_subscript_room_for_letter,delete this.last_subscript_room_for_sub_triangle)}circleSymbol(o,r){if(this.last_circle_symbol&&this.last_circle_symbol_color===o&&this.last_circle_symbol_opacity===r)return;this.clearCircleSymbol();const b=this.renderer.metrics.mid,h=b,F=b,T=this.renderer.square_size*this.renderer.stone_font_scale,P=document.createElementNS("http://www.w3.org/2000/svg","circle");P.setAttribute("class","circle"),P.setAttribute("fill","none"),P.setAttribute("stroke",o),P.setAttribute("stroke-width",`${T*.075}px`),P.setAttribute("cx",h.toString()),P.setAttribute("cy",F.toString()),P.setAttribute("r",Math.max(.1,T*this.renderer.circle_radius*this.renderer.stone_font_scale).toFixed(2)),r<1&&P.setAttribute("stroke-opacity",r.toString()),this.g.appendChild(P),this.last_circle_symbol=P,this.last_circle_symbol_color=o,this.last_circle_symbol_opacity=r}clearCircleSymbol(){this.last_circle_symbol&&(this.last_circle_symbol.remove(),delete this.last_circle_symbol,delete this.last_circle_symbol_color,delete this.last_circle_symbol_opacity)}triangleSymbol(o,r,b){if(this.last_triangle_symbol&&this.last_triangle_symbol_color===o&&this.last_triangle_symbol_opacity===r&&this.last_triangle_symbol_as_subscript===b)return;this.clearTriangleSymbol();const h=this.renderer.metrics.mid,F=h,T=h,P=this.renderer.square_size;let m=1*this.renderer.stone_font_scale,w=0,y=P*.075*m;b&&(m=.5*m,w=P*.3,r=1,y*=.5);const N=document.createElementNS("http://www.w3.org/2000/svg","polygon");N.setAttribute("class","triangle"),N.setAttribute("fill","none"),N.setAttribute("stroke",o),N.setAttribute("stroke-width",`${y}px`);const x=P*.3*m;let z=-(Math.PI*2)/4;const U=[];U.push([F+x*Math.cos(z),T+w+x*Math.sin(z)]),z+=Math.PI*2/3,U.push([F+x*Math.cos(z),T+w+x*Math.sin(z)]),z+=Math.PI*2/3,U.push([F+x*Math.cos(z),T+w+x*Math.sin(z)]),z+=Math.PI*2/3,U.push([F+x*Math.cos(z),T+w+x*Math.sin(z)]),N.setAttribute("points",U.map(D=>`${D[0].toFixed(2)},${D[1].toFixed(2)}`).join(" ")),r<1&&N.setAttribute("stroke-opacity",r.toString()),this.g.appendChild(N),this.last_triangle_symbol=N,this.last_triangle_symbol_color=o,this.last_triangle_symbol_opacity=r,this.last_triangle_symbol_as_subscript=b}clearTriangleSymbol(){this.last_triangle_symbol&&(this.last_triangle_symbol.remove(),delete this.last_triangle_symbol,delete this.last_triangle_symbol_color,delete this.last_triangle_symbol_opacity,delete this.last_triangle_symbol_as_subscript)}crossSymbol(o,r){if(this.last_cross_symbol&&this.last_cross_symbol_color===o&&this.last_cross_symbol_opacity===r)return;this.clearCrossSymbol();const b=this.renderer.metrics.mid,h=b,F=b,T=this.renderer.square_size*this.renderer.stone_font_scale,P=Math.max(1,b*.35*this.renderer.stone_font_scale),m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("class","cross"),m.setAttribute("fill","none"),m.setAttribute("stroke",o),m.setAttribute("stroke-width",`${T*.075}px`),r<1&&m.setAttribute("stroke-opacity",r.toString()),m.setAttribute("d",`
                M ${h-P} ${F-P}
                L ${h+P} ${F+P}
                M ${h+P} ${F-P}
                L ${h-P} ${F+P}
            `),this.g.appendChild(m),this.last_cross_symbol=m,this.last_cross_symbol_color=o,this.last_cross_symbol_opacity=r}clearCrossSymbol(){this.last_cross_symbol&&(this.last_cross_symbol.remove(),delete this.last_cross_symbol,delete this.last_cross_symbol_color,delete this.last_cross_symbol_opacity)}squareSymbol(o,r){if(this.last_square_symbol&&this.last_square_symbol_color===o&&this.last_square_symbol_opacity===r)return;this.clearSquareSymbol();const b=this.renderer.metrics.mid,h=b,F=b,T=this.renderer.square_size*this.renderer.stone_font_scale,P=Math.max(1,b*.4*this.renderer.stone_font_scale),m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("class","square"),m.setAttribute("fill","none"),m.setAttribute("stroke",o),m.setAttribute("stroke-width",`${T*.075}px`),r<1&&m.setAttribute("stroke-opacity",r.toString()),m.setAttribute("x",(h-P).toFixed(2)),m.setAttribute("y",(F-P).toFixed(2)),m.setAttribute("width",(P*2).toFixed(2)),m.setAttribute("height",(P*2).toFixed(2)),this.g.appendChild(m),this.last_square_symbol=m,this.last_square_symbol_color=o,this.last_square_symbol_opacity=r}clearSquareSymbol(){this.last_square_symbol&&(this.last_square_symbol.remove(),delete this.last_square_symbol,delete this.last_square_symbol_color,delete this.last_square_symbol_opacity)}lastMove(o,r,b){var h;if(this.last_last_move&&this.last_last_move_symbol===o&&this.last_last_move_color===r&&this.last_last_move_opacity===b)return;this.clearLastMove();const F=this.renderer.metrics.mid,T=F,P=F,m=this.renderer.square_size*this.renderer.stone_font_scale;switch(o){case"+":{const w=Math.max(1,F*.35)*.8*this.renderer.stone_font_scale,y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("class","last-move"),y.setAttribute("stroke",r),y.setAttribute("stroke-width",`${m*.075}px`),y.setAttribute("fill","none"),y.setAttribute("d",`
                        M ${T-w} ${P}
                        L ${T+w} ${P}
                        M ${T} ${P-w}
                        L ${T} ${P+w}
                    `),this.g.appendChild(y),this.last_last_move=y}break;case"?":{const w="?",y=document.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("class","letter"),y.setAttribute("fill",r),y.setAttribute("font-size",`${m*.5}px`),y.setAttribute("text-anchor","middle"),y.setAttribute("x",T.toString());let N=P;N+=m/6,y.setAttribute("y",N.toString()),y.textContent=w,this.g.appendChild(y),this.last_last_move=y}break;case"o":{const w=document.createElementNS("http://www.w3.org/2000/svg","circle");let y=m*this.renderer.last_move_radius*this.renderer.stone_font_scale;m&&(y=m*.3),y=Math.max(.1,y),w.setAttribute("class","last-move"),w.setAttribute("fill","none"),w.setAttribute("stroke",r),w.setAttribute("stroke-width",`${m*.075}px`),w.setAttribute("cx",T.toString()),w.setAttribute("cy",P.toString()),w.setAttribute("r",y.toString()),this.g.appendChild(w),this.last_last_move=w}break}b<1&&((h=this.last_last_move)===null||h===void 0||h.setAttribute("opacity",b.toString())),this.last_last_move_symbol=o,this.last_last_move_color=r,this.last_last_move_opacity=b}clearLastMove(){this.last_last_move&&(this.last_last_move.remove(),delete this.last_last_move)}scoreEstimate(o,r){if(this.last_score_estimate&&this.last_score_estimate_color===o&&this.last_score_estimate_estimate===r)return;this.clearScoreEstimate();const b=this.renderer.metrics.mid,h=b,F=b,T=this.renderer.square_size*this.renderer.stone_font_scale,P=T*.2*Math.abs(r),m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x",(h-P).toFixed(1)),m.setAttribute("y",(F-P).toFixed(1)),m.setAttribute("width",(P*2).toFixed(1)),m.setAttribute("height",(P*2).toFixed(1)),o==="white"&&(m.setAttribute("fill",this.renderer.theme_black_text_color),m.setAttribute("stroke","#777777")),o==="black"&&(m.setAttribute("fill",this.renderer.theme_white_text_color),m.setAttribute("stroke","#888888")),m.setAttribute("stroke-width",(Math.ceil(T*.035)-.5).toFixed(1)),this.g.appendChild(m),this.last_score_estimate=m,this.last_score_estimate_color=o,this.last_score_estimate_estimate=r}clearScoreEstimate(){this.last_score_estimate&&(this.last_score_estimate.remove(),delete this.last_score_estimate,delete this.last_score_estimate_color)}}},"./src/Goban/TestGoban.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.TestGoban=void 0;const q=G("./src/engine/GobanEngine.ts"),S=G("./src/Goban/Goban.ts");class L extends S.Goban{constructor(E){super(E),this.engine=new q.GobanEngine(E)}enablePen(){}disablePen(){}clearAnalysisDrawing(){}drawPenMarks(E){}showMessage(E,R,O){}clearMessage(){}setTheme(E,R){}drawSquare(E,R){}redraw(E){}move_tree_redraw(E){}setMoveTreeContainer(E){}setTitle(E){}enableDrawing(){}disableDrawing(){}}A.TestGoban=L},"./src/Goban/callbacks.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.callbacks=void 0,A.setGobanCallbacks=G,A.callbacks={getClockDrift:()=>0};function G(q){for(const S in q)q[S]!==void 0&&(A.callbacks[S]=q[S])}},"./src/Goban/canvas_utils.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.allocateCanvasOrError=E,A.validateCanvas=R,A.createDeviceScaledCanvas=O,A.resizeDeviceScaledCanvas=p,A.deviceCanvasScalingRatio=v,A.getRelativeEventPosition=c,A.elementOffset=d;const q=G("./src/Goban/callbacks.ts");let S=0,L=0,C=0;function E(g,k){let f=null;try{f=document.createElement("canvas"),++L}catch(u){R(null,u)}return f&&g&&typeof g=="string"?f.setAttribute("width",g):f&&g&&typeof g=="number"&&(f.width=g),f&&k&&typeof k=="string"?f.setAttribute("height",k):f&&k&&typeof k=="number"&&(f.height=k),R(f,void 0,g,k)?(C+=(f&&f.width||0)*(f&&f.height||0),f):null}function R(g,k,f,u){let o=null,r=k?"Initial error":null;if(!g)r=r||"Canvas allocation failed",k=k||new Error(r);else try{o=g.getContext("2d",{willReadFrequently:!0})}catch(b){r=r||"Canvas context allocation failed",k=k||b}return o||(r=r||"getContext('2d') failed"),r&&!k&&(k=new Error(r)),k?(q.callbacks.canvasAllocationErrorHandler&&q.callbacks.canvasAllocationErrorHandler(r,k,{total_pixels_allocated:C,total_allocations_made:L,width:f,height:u}),!1):!0}function O(g,k){return E(`${g}px`,`${k}px`)}function p(g,k,f){R(g);const u=g.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("Failed to get context for canvas");const o=window.devicePixelRatio||1,r=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1,b=o/r;g.width=k*b,g.height=f*b,g.style.width=k+"px",g.style.height=f+"px",R(g);try{u.scale(b,b)}catch(h){S=1,g.width=k,g.height=f,console.warn(h)}return R(g),g}function v(){if(!S){const k=E(257,257).getContext("2d",{willReadFrequently:!0}),f=window.devicePixelRatio||1,u=k.webkitBackingStorePixelRatio||k.mozBackingStorePixelRatio||k.msBackingStorePixelRatio||k.oBackingStorePixelRatio||k.backingStorePixelRatio||1;S=f/u}return S}let s=-1e3,a=-1e3;function c(g,k){let f=-1e3,u=-1e3;const o=(k||g.target).getBoundingClientRect();return typeof TouchEvent<"u"&&g instanceof TouchEvent?(g.touches&&g.touches.length?(f=g.touches[0].clientX-o.left,u=g.touches[0].clientY-o.top):g.type!=="touchend"?console.log("Missing event tap location:",g):(f=s,u=a),s=f,a=u):g instanceof MouseEvent&&(g.clientX?(f=g.clientX-o.left,u=g.clientY-o.top):console.log("Missing event click location:",g)),{x:f,y:u}}function d(g){if(!g)throw new Error("No element passed to elementOffset");const k=g.getBoundingClientRect();if(!k)throw new Error("Element.getBoundingClientRect() returned null");return{top:k.top+document.body.scrollTop,left:k.left+document.body.scrollLeft}}},"./src/Goban/focus_tracker.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.focus_tracker=void 0;class G{constructor(){this.hasFocus=!0,this.lastFocus=Date.now(),this.outOfFocusDurations=[],this.onFocus=()=>{this.hasFocus=!0,this.outOfFocusDurations.push(Date.now()-this.lastFocus),this.lastFocus=Date.now()},this.onBlur=()=>{this.hasFocus=!1,this.lastFocus=Date.now()};try{window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}catch(S){console.error(S)}}reset(){this.lastFocus=Date.now(),this.outOfFocusDurations=[]}getMaxBlurDurationSinceLastReset(){if(this.hasFocus||this.outOfFocusDurations.push(Date.now()-this.lastFocus),this.outOfFocusDurations.length===0)return 0;const S=Math.max.apply(Math.max,this.outOfFocusDurations);return this.hasFocus||this.outOfFocusDurations.pop(),S}}A.focus_tracker=new G},"./src/Goban/themes/GobanTheme.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanTheme=void 0;let G=0;class q{constructor(L){this.styles={},this.name="[ERROR theme missing name]",this.parent=L}get theme_name(){return"ERROR missing theme_name"}sort(){return 0}preRenderBlack(L,C,E){return{black:"stone"}}preRenderWhite(L,C,E){return{white:"stone"}}preRenderBlackSVG(L,C,E,R){const O=[],p=this.def_uid(`black-${C}`);return O.push(p),L.appendChild(this.renderSVG({id:p,fill:this.getBlackStoneColor(),stroke:this.getBlackStoneColor()},C)),O}preRenderWhiteSVG(L,C,E,R){const O=[],p=this.def_uid(`white-${C}`);return O.push(p),L.appendChild(this.renderSVG({id:p,fill:this.getWhiteStoneColor(),stroke:this.getBlackStoneColor()},C)),O}preRenderShadowSVG(L,C){const E=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");E.setAttribute("id","shadow-"+C),E.setAttribute("r","1.0");const R=document.createElementNS("http://www.w3.org/2000/svg","stop");R.setAttribute("offset","0"),R.setAttribute("stop-color",C),R.setAttribute("stop-opacity","1.0"),E.appendChild(R);const O=document.createElementNS("http://www.w3.org/2000/svg","stop");O.setAttribute("offset","30%"),O.setAttribute("stop-color",C),O.setAttribute("stop-opacity","1.0"),E.appendChild(O);const p="#333333";{const v=document.createElementNS("http://www.w3.org/2000/svg","stop");v.setAttribute("offset","31%"),v.setAttribute("stop-color",p),v.setAttribute("stop-opacity","0.6"),E.appendChild(v)}{const v=document.createElementNS("http://www.w3.org/2000/svg","stop");v.setAttribute("offset","34%"),v.setAttribute("stop-color",p),v.setAttribute("stop-opacity","0.50"),E.appendChild(v)}{const v=document.createElementNS("http://www.w3.org/2000/svg","stop");v.setAttribute("offset","40%"),v.setAttribute("stop-color",p),v.setAttribute("stop-opacity","0.5"),E.appendChild(v)}{const v=document.createElementNS("http://www.w3.org/2000/svg","stop");v.setAttribute("offset","50%"),v.setAttribute("stop-color",p),v.setAttribute("stop-opacity","0.0"),E.appendChild(v)}L.appendChild(E)}placeWhiteStone(L,C,E,R,O,p){L.fillStyle=this.getWhiteStoneColor(),L.beginPath(),L.arc(R,O,Math.max(.1,p),0,2*Math.PI,!0),L.fill()}placeBlackStone(L,C,E,R,O,p){L.fillStyle=this.getBlackStoneColor(),L.beginPath(),L.arc(R,O,Math.max(.1,p),0,2*Math.PI,!0),L.fill()}placeStoneShadowSVG(L,C,E,R,O){if(!L)return;const p=document.createElementNS("http://www.w3.org/2000/svg","circle");return p.setAttribute("fill",`url(#shadow-${O})`),p.setAttribute("cx",(C*1.2).toString()),p.setAttribute("cy",(E*1.2).toString()),p.setAttribute("r",(R*.95).toString()),L.appendChild(p),p}placeStoneSVG(L,C,E,R,O,p,v){const s=this.placeStoneShadowSVG(C,R,O,p,v),a=document.createElementNS("http://www.w3.org/2000/svg","use");return a.setAttribute("href",`#${E}`),a.setAttribute("x",`${R-p}`),a.setAttribute("y",`${O-p}`),L.appendChild(a),[a,s]}placeWhiteStoneSVG(L,C,E,R,O,p){return this.placeStoneSVG(L,C,E,R,O,p,"white")}placeBlackStoneSVG(L,C,E,R,O,p){return this.placeStoneSVG(L,C,E,R,O,p,"black")}getStone(L,C,E,R){const O=Array.isArray(E)?E[(L+1)*53*((C+1)*97)%E.length]:E;if(!O)throw console.error("No stone returned for ",L,C,E),new Error("Failed to get stone for "+L+", "+C);return O}getStoneHash(L,C,E,R){return Array.isArray(E)?""+(L+1)*53*((C+1)*97)%E.length:""}stoneCastsShadow(L){return!1}getWhiteStoneColor(){return"#ffffff"}getBlackStoneColor(){return"#000000"}getWhiteTextColor(L){return"#000000"}getBlackTextColor(L){return"#ffffff"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":""}}getReactStyles(){const L={},C=this.getBackgroundCSS();return L.backgroundColor=C["background-color"],L.backgroundImage=C["background-image"],L}getLineColor(){return"#000000"}getFadedLineColor(){return"#888888"}getStarColor(){return"#000000"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#000000"}renderSVG(L,C){var E,R,O,p,v,s,a,c,d;const g=C,k=C,f=document.createElementNS("http://www.w3.org/2000/svg","g");if(f.setAttribute("id",L.id),f.setAttribute("class","stone"),L.fill||L.stroke||L.gradient){const u=document.createElementNS("http://www.w3.org/2000/svg","circle");f.appendChild(u),L.fill&&u.setAttribute("fill",L.fill);let o=0;if(L.stroke&&(u.setAttribute("stroke",L.stroke),L.stroke_scale?o=C*L.stroke_scale:o=C/20,u.setAttribute("stroke-width",`${o.toFixed(1)}px`)),u.setAttribute("cx",g.toString()),u.setAttribute("cy",k.toString()),u.setAttribute("r",(C-o*.5).toString()),u.setAttribute("shape-rendering","geometricPrecision"),L.gradient){const r=L.gradient,b=document.createElementNS("http://www.w3.org/2000/svg","defs");let h;r.type==="linear"?(h=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),h.setAttribute("x1",((E=r.x1)!==null&&E!==void 0?E:0).toFixed(2)),h.setAttribute("y1",((R=r.y1)!==null&&R!==void 0?R:0).toFixed(2)),h.setAttribute("x2",((O=r.x2)!==null&&O!==void 0?O:1).toFixed(2)),h.setAttribute("y2",((p=r.y2)!==null&&p!==void 0?p:1).toFixed(2))):(h=document.createElementNS("http://www.w3.org/2000/svg",L.gradient.type==="linear"?"linearGradient":"radialGradient"),h.setAttribute("cx",((v=r.cx)!==null&&v!==void 0?v:.5).toFixed(2)),h.setAttribute("cy",((s=r.cy)!==null&&s!==void 0?s:.5).toFixed(2)),h.setAttribute("r",((a=r.r)!==null&&a!==void 0?a:.5).toFixed(2)),h.setAttribute("fx",((c=r.fx)!==null&&c!==void 0?c:.3).toFixed(2)),h.setAttribute("fy",((d=r.fy)!==null&&d!==void 0?d:.2).toFixed(2))),h.setAttribute("id",L.id+"-gradient");for(const F of L.gradient.stops){const T=document.createElementNS("http://www.w3.org/2000/svg","stop");T.setAttribute("offset",`${F.offset}%`),T.setAttribute("stop-color",F.color),h.appendChild(T)}b.appendChild(h),f.appendChild(b),u.setAttribute("fill",`url(#${L.id}-gradient)`)}}if(L.url){const u=document.createElementNS("http://www.w3.org/2000/svg","image");u.setAttribute("class","stone"),u.setAttribute("x",`${g-C}`),u.setAttribute("y",`${k-C}`),u.setAttribute("width",`${C*2}`),u.setAttribute("height",`${C*2}`),u.setAttributeNS("http://www.w3.org/1999/xlink","href",L.url),f.appendChild(u)}return f}def_uid(L){const C=G++;return`${L}-${C}`}}A.GobanTheme=q},"./src/Goban/themes/board_plain.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.default=E;const q=G("./src/Goban/themes/GobanTheme.ts"),S=G("./src/Goban/callbacks.ts"),L=G("./src/engine/translate.ts");function C(R,O=1){const p=R.replace("#","");if(p.length!==6)return R;const v=parseInt(`0x${p.substr(0,2)}`),s=parseInt(`0x${p.substr(2,2)}`),a=parseInt(`0x${p.substr(4,2)}`);return`rgba(${v}, ${s}, ${a}, ${O})`}function E(R){class O extends q.GobanTheme{sort(){return 1}get theme_name(){return"Plain"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":""}}getLineColor(){return"#000000"}getFadedLineColor(){return C("#000000",.5)}getStarColor(){return"#000000"}getFadedStarColor(){return C("#000000",.5)}getBlankTextColor(){return"#000000"}getLabelTextColor(){return C("#000000",.75)}}(0,L._)("Plain"),R.board.Plain=O;class p extends q.GobanTheme{sort(){return 200}get theme_name(){return"Custom"}getBackgroundCSS(){return{"background-color":S.callbacks.customBoardColor?S.callbacks.customBoardColor():"#DCB35C","background-image":S.callbacks.customBoardUrl&&S.callbacks.customBoardUrl()!==""?"url('"+S.callbacks.customBoardUrl()+"')":"","background-size":"cover"}}getLineColor(){return S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000"}getFadedLineColor(){return C(S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000",.5)}getStarColor(){return S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000"}getFadedStarColor(){return C(S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000",.5)}getBlankTextColor(){return S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000"}getLabelTextColor(){return C(S.callbacks.customBoardLineColor?S.callbacks.customBoardLineColor():"#000000",.75)}}(0,L._)("Custom"),R.board.Custom=p;class v extends q.GobanTheme{sort(){return 100}get theme_name(){return"Night Play"}getBackgroundCSS(){return{"background-color":"#444444","background-image":""}}getLineColor(){return"#555555"}getFadedLineColor(){return"#333333"}getStarColor(){return"#555555"}getFadedStarColor(){return"#333333"}getBlankTextColor(){return"#ffffff"}getLabelTextColor(){return"#555555"}}(0,L._)("Night Play"),R.board["Night Play"]=v;class s extends q.GobanTheme{sort(){return 105}get theme_name(){return"HNG"}getBackgroundCSS(){return{"background-color":"#00e7fc","background-image":""}}getLineColor(){return s.C}getFadedLineColor(){return"#00AFBF"}getStarColor(){return s.C}getFadedStarColor(){return"#00AFBF"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return s.C2}}s.C="#00193E",s.C2="#004C75",(0,L._)("HNG"),R.board.HNG=s;class a extends q.GobanTheme{sort(){return 105}get theme_name(){return"HNG Night"}getBackgroundCSS(){return{"background-color":"#090C1F","background-image":""}}getLineColor(){return a.C}getFadedLineColor(){return"#4481B5"}getStarColor(){return a.C}getFadedStarColor(){return"#4481B5"}getBlankTextColor(){return"#ffffff"}getLabelTextColor(){return"#4481B5"}}a.C="#007591",(0,L._)("HNG Night"),R.board["HNG Night"]=a;class c extends q.GobanTheme{sort(){return 110}get theme_name(){return"Book"}getBackgroundCSS(){return{"background-color":"#ffffff","background-image":""}}getLineColor(){return"#555555"}getFadedLineColor(){return"#999999"}getStarColor(){return"#555555"}getFadedStarColor(){return"#999999"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#555555"}}(0,L._)("Book"),R.board.Book=c}},"./src/Goban/themes/board_woods.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.default=E;const q=G("./src/Goban/themes/GobanTheme.ts"),S=G("./src/engine/translate.ts"),L=G("./src/Goban/callbacks.ts");function C(){return L.callbacks.getCDNReleaseBase?L.callbacks.getCDNReleaseBase():""}function E(R){class O extends q.GobanTheme{sort(){return 10}get theme_name(){return"Kaya"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/kaya.jpg')"}}getLineColor(){return"#000000"}getFadedLineColor(){return"#888888"}getStarColor(){return"#000000"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#444444"}}(0,S._)("Kaya"),R.board.Kaya=O;class p extends q.GobanTheme{sort(){return 20}get theme_name(){return"Red Oak"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/oak.jpg')"}}getLineColor(){return"#000000"}getFadedLineColor(){return"#888888"}getStarColor(){return"#000000"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#000000"}}(0,S._)("Red Oak"),R.board["Red Oak"]=p;class v extends q.GobanTheme{sort(){return 30}get theme_name(){return"Persimmon"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/persimmon.jpg')"}}getLineColor(){return"#000000"}getFadedLineColor(){return"#888888"}getStarColor(){return"#000000"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#000000"}}(0,S._)("Persimmon"),R.board.Persimmon=v;class s extends q.GobanTheme{sort(){return 40}get theme_name(){return"Black Walnut"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/black_walnut.jpg')"}}getLineColor(){return"#000000"}getFadedLineColor(){return"#4A2F24"}getStarColor(){return"#000000"}getFadedStarColor(){return"#4A2F24"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#000000"}}(0,S._)("Black Walnut"),R.board["Black Walnut"]=s;class a extends q.GobanTheme{sort(){return 40}get theme_name(){return"Granite"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/granite.jpg')"}}getLineColor(){return"#cccccc"}getFadedLineColor(){return"#888888"}getStarColor(){return"#cccccc"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#ffffff"}getLabelTextColor(){return"#cccccc"}}(0,S._)("Granite"),R.board.Granite=a;class c extends q.GobanTheme{sort(){return 10}get theme_name(){return"Anime"}getBackgroundCSS(){return{"background-color":"#DCB35C","background-image":"url('"+C()+"/img/anime_board.svg')","background-size":"cover"}}getLineColor(){return"#000000"}getFadedLineColor(){return"#888888"}getStarColor(){return"#000000"}getFadedStarColor(){return"#888888"}getBlankTextColor(){return"#000000"}getLabelTextColor(){return"#444444"}}(0,S._)("Anime"),R.board.Anime=c;class d extends q.GobanTheme{sort(){return 15}get theme_name(){return"Bright Kaya"}getBackgroundCSS(){return{"background-color":"#DBB25B","background-image":"url('"+C()+"/img/kaya.jpg')"}}getLineColor(){return"#FFFFFF"}getFadedLineColor(){return"#FFFFFF"}getStarColor(){return"#FFFFFF"}getFadedStarColor(){return"#999999"}getBlankTextColor(){return"#FFFFFF"}getLabelTextColor(){return"#FFFFFF"}}(0,S._)("Bright Kaya"),R.board["Bright Kaya"]=d}},"./src/Goban/themes/image_stones.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.preRenderImageStone=c,A.placeRenderedImageStone=d,A.default=k;const q=G("./src/Goban/themes/GobanTheme.ts"),S=G("./src/Goban/canvas_utils.ts"),L=G("./src/Goban/themes/rendered_stones.ts"),C=G("./src/Goban/themes/plain_stones.ts"),E=G("./src/Goban/callbacks.ts"),R=v(G("./assets/img/anime_black.svg")),O=v(G("./assets/img/anime_white.svg"));function p(){return E.callbacks.getCDNReleaseBase?E.callbacks.getCDNReleaseBase():""}function v(f){return"data:image/svg+xml,"+f.replace(/#/g,"%23")}function s(f,u){return 2*Math.floor(f)+(u?0:1)}function a(f,u){return Math.floor(f)+(u?0:.5)}function c(f,u,o,r=!0){const b=(0,S.deviceCanvasScalingRatio)();f*=b;const h=s(f,b!==1),F=Math.round(f*2.5),T=a(f,b!==1);typeof u=="string"&&(u=[u]);const P=[],m=[];for(const w of u){const y=new Image(h,h);y.crossOrigin="anonymous",y.loading="eager",y.width=h,y.height=h,y.src=w;const N=(0,S.allocateCanvasOrError)(`${h}px`,`${h}px`),x=(0,S.allocateCanvasOrError)(`${F}px`,`${F}px`),z=new Promise((D,B)=>{y.onerror=B,y.onload=D});m.push(z);const U=x.getContext("2d",{willReadFrequently:!0});if(!U)throw new Error("Error getting shadow context 2d");r&&(0,L.renderShadow)(U,T,f*1.05,F,0,"rgba(60,60,40,0.4)"),z.then(()=>{const D=N.getContext("2d",{willReadFrequently:!0});if(!D)throw new Error("Error getting stone context 2d");D.drawImage(y,0,0,h,h)}).catch(D=>console.error(D)),P.push({stone:N,shadow:x})}return Promise.all(m).then(o).catch(w=>console.error(w)),P}function d(f,u,o,r,b,h){const F=(0,S.deviceCanvasScalingRatio)();if(F!==1){const T=a(h*F,!0)/F,P=s(h*F,!0)/F,m=r-T,w=b-T;u&&u.drawImage(o.shadow,m,w,h*2.5,h*2.5),f.drawImage(o.stone,m,w,P,P)}else{const T=a(h,!1),P=r-T,m=b-T;u&&u.drawImage(o.shadow,P,m),f.drawImage(o.stone,P,m)}}function g(f){return f>=10}function k(f){var u,o;let r=!1;try{typeof navigator<"u"&&(r=((o=(u=navigator==null?void 0:navigator.userAgent)===null||u===void 0?void 0:u.toLocaleLowerCase())===null||o===void 0?void 0:o.indexOf("firefox"))>-1)}catch{}class b extends q.GobanTheme{stoneCastsShadow(P){return g(P*(0,S.deviceCanvasScalingRatio)())}placeBlackStone(P,m,w,y,N,x){d(P,m,w,y,N,x)}placeWhiteStone(P,m,w,y,N,x){d(P,m,w,y,N,x)}}class h extends b{sort(){return 30}get theme_name(){return"Anime"}preRenderBlack(P,m,w){return c(P,r?p()+"/img/anime_black.svg":R,w)}preRenderWhite(P,m,w){return c(P,r?p()+"/img/anime_white.svg":O,w)}getBlackTextColor(P){return"#ffffff"}getWhiteTextColor(P){return"#000000"}placeStoneShadowSVG(P,m,w,y){if(!P)return;const N=document.createElementNS("http://www.w3.org/2000/svg","image");return N.setAttribute("class","stone"),N.setAttribute("x",`${m-y*.98}`),N.setAttribute("y",`${w-y*1.05}`),N.setAttribute("width",`${y*2*1.05}`),N.setAttribute("height",`${y*2*1.14}`),N.setAttributeNS("http://www.w3.org/1999/xlink","href",p()+"/img/anime_shadow.svg"),P.appendChild(N),N}preRenderBlackSVG(P,m,w,y){const N=this.def_uid(`anime-black-${m}`);return P.append(this.renderSVG({id:N,url:p()+"/img/anime_black.svg"},m)),[N]}preRenderWhiteSVG(P,m,w,y){const N=this.def_uid(`anime-white-${m}`);return P.append(this.renderSVG({id:N,url:p()+"/img/anime_white.svg"},m)),[N]}}f.black.Anime=h,f.white.Anime=h;class F extends b{sort(){return 200}get theme_name(){return"Custom"}placeBlackStone(P,m,w,y,N,x){E.callbacks.customBlackStoneUrl&&E.callbacks.customBlackStoneUrl()!==""?d(P,m,w,y,N,x):(0,C.renderPlainStone)(P,y,N,x,this.getBlackStoneColor(),this.parent?this.parent.getLineColor():this.getLineColor())}preRenderBlack(P,m,w){return!E.callbacks.customBlackStoneUrl||E.callbacks.customBlackStoneUrl()===""?!0:c(P,E.callbacks.customBlackStoneUrl?E.callbacks.customBlackStoneUrl():"",w,!1)}getBlackStoneColor(){return E.callbacks.customBlackStoneColor?E.callbacks.customBlackStoneColor():"#000000"}getBlackTextColor(){return E.callbacks.customBlackTextColor?E.callbacks.customBlackTextColor():"#FFFFFF"}placeWhiteStone(P,m,w,y,N,x){E.callbacks.customWhiteStoneUrl&&E.callbacks.customWhiteStoneUrl()!==""?d(P,m,w,y,N,x):(0,C.renderPlainStone)(P,y,N,x,this.getWhiteStoneColor(),this.parent?this.parent.getLineColor():this.getLineColor())}preRenderWhite(P,m,w){return!E.callbacks.customWhiteStoneUrl||E.callbacks.customWhiteStoneUrl()===""?!0:c(P,E.callbacks.customWhiteStoneUrl?E.callbacks.customWhiteStoneUrl():"",w,!1)}getWhiteStoneColor(){return E.callbacks.customWhiteStoneColor?E.callbacks.customWhiteStoneColor():"#FFFFFF"}getWhiteTextColor(){return E.callbacks.customWhiteTextColor?E.callbacks.customWhiteTextColor():"#000000"}preRenderBlackSVG(P,m,w,y){if(!E.callbacks.customBlackStoneUrl||E.callbacks.customBlackStoneUrl()==="")return super.preRenderBlackSVG(P,m,w,y);const N=this.def_uid(`custom-black-${m}`);return P.append(this.renderSVG({id:N,url:E.callbacks.customBlackStoneUrl()},m)),[N]}preRenderWhiteSVG(P,m,w,y){if(!E.callbacks.customWhiteStoneUrl||E.callbacks.customWhiteStoneUrl()==="")return super.preRenderWhiteSVG(P,m,w,y);const N=this.def_uid(`custom-white-${m}`);return P.append(this.renderSVG({id:N,url:E.callbacks.customWhiteStoneUrl()},m)),[N]}}f.black.Custom=F,f.white.Custom=F}},"./src/Goban/themes/index.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.THEMES_SORTED=A.THEMES=A.GobanTheme=void 0;var q=G("./src/Goban/themes/GobanTheme.ts");Object.defineProperty(A,"GobanTheme",{enumerable:!0,get:function(){return q.GobanTheme}}),A.THEMES={white:{},black:{},board:{}},A.THEMES_SORTED={white:[],black:[],board:[]};const S=G("./src/Goban/themes/board_plain.ts"),L=G("./src/Goban/themes/board_woods.ts"),C=G("./src/Goban/themes/plain_stones.ts"),E=G("./src/Goban/themes/rendered_stones.ts"),R=G("./src/Goban/themes/image_stones.ts");(0,S.default)(A.THEMES),(0,L.default)(A.THEMES),(0,C.default)(A.THEMES),(0,E.default)(A.THEMES),(0,R.default)(A.THEMES);function O(p,v){return p.sort()-v.sort()}for(const p in A.THEMES)A.THEMES_SORTED[p]=Object.keys(A.THEMES[p]).map(v=>new A.THEMES[p][v]),A.THEMES_SORTED[p].sort(O)},"./src/Goban/themes/plain_stones.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.renderPlainStone=S,A.default=L;const q=G("./src/Goban/themes/GobanTheme.ts");function S(C,E,R,O,p,v){let s=O*.1;s<.3&&(s=0),C.fillStyle=p,C.strokeStyle=v,s>0&&(C.lineWidth=s),C.beginPath(),C.arc(E,R,Math.max(.1,O-s/2),.001,2*Math.PI,!1),s>0&&C.stroke(),C.fill()}function L(C){class E extends q.GobanTheme{sort(){return 1}}class R extends E{get theme_name(){return"Plain"}preRenderBlack(p,v){return!0}placeBlackStone(p,v,s,a,c,d){S(p,a,c,d,this.getBlackStoneColor(),this.parent?this.parent.getLineColor():this.getLineColor())}getBlackStoneColor(){return"#000000"}getBlackTextColor(){return"#FFFFFF"}preRenderWhite(p,v){return!0}placeWhiteStone(p,v,s,a,c,d){S(p,a,c,d,this.getWhiteStoneColor(),this.parent?this.parent.getLineColor():this.getLineColor())}getWhiteStoneColor(){return"#FFFFFF"}getWhiteTextColor(){return"#000000"}preRenderBlackSVG(p,v,s,a){const c=[],d=this.def_uid(`plain-black-${v}`);c.push(d);let g=this.getBlackStoneColor();return g==="#000000"&&(g=void 0),p.appendChild(this.renderSVG({id:d,stroke:g??"hsl(8, 7%, 20%)",gradient:{type:"linear",x1:.4,y1:.1,x2:.7,y2:.7,stops:[{offset:0,color:g??"hsl(8, 7%, 27%)"},{offset:100,color:g??"hsl(8, 7%, 12%)"}]}},v)),c}preRenderWhiteSVG(p,v,s,a){const c=[],d=this.def_uid(`plain-white-${v}`);return c.push(d),p.appendChild(this.renderSVG({id:d,stroke:"hsl(8, 7%, 20%)",gradient:{type:"linear",x1:.4,y1:.1,x2:.9,y2:.9,stops:[{offset:0,color:"hsl(8, 7%, 95%)"},{offset:90,color:"hsl(226, 7%, 75%)"}]}},v)),c}}C.black.Plain=R,C.white.Plain=R}},"./src/Goban/themes/rendered_stones.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.clearAboveColor=o,A.renderShadow=r,A.default=P;const q=G("./src/Goban/themes/GobanTheme.ts"),S=G("./src/engine/translate.ts"),L=G("./src/Goban/canvas_utils.ts");function C(m,w,y){m/=255,w/=255,y/=255;const N=Math.max(m,w,y),x=Math.min(m,w,y);let z=NaN,U=NaN;const D=(N+x)/2;if(N===x)z=U=0;else{const B=N-x;switch(U=D>.5?B/(2-N-x):B/(N+x),N){case m:z=(w-y)/B+(w<y?6:0);break;case w:z=(y-m)/B+2;break;case y:z=(m-w)/B+4;break}z/=6}return[z,U,D]}function E(m,w,y){return y<0&&(y+=1),y>1&&(y-=1),y<.16666666666666666?m+(w-m)*6*y:y<.5?w:y<.6666666666666666?m+(w-m)*(.6666666666666666-y)*6:m}function R(m,w,y){let N,x,z;if(w===0)N=x=z=y;else{const U=y<.5?y*(1+w):y+w-y*w,D=2*y-U;N=E(D,U,m+.3333333333333333),x=E(D,U,m),z=E(D,U,m-.3333333333333333)}return[Math.min(255,N*255),Math.min(255,x*255),Math.min(255,z*255)]}function O(m,w){return[m[0]+w[0],m[1]+w[1],m[2]+w[2]]}function p(m,w){return m[0]*w[0]+m[1]*w[1]+m[2]*w[2]}function v(m,w){return[m[0]*w,m[1]*w,m[2]*w]}function s(m){return Math.sqrt(p(m,m))}function a(m){return v(m,1/s(m))}function c(m,w,y){let N=Math.sqrt(Math.max(0,y*y-m*m-w*w));const x=a([m,w,N]);return N=x[2],x[2]=N*N*(3-2*N),x}function d(m,w){return 2*Math.ceil(m)+(w?0:1)}function g(m,w){return Math.ceil(m)+(w?0:.5)}function k(m,w,y){if(w<=0||y<=0)throw"Invalid width/height given: "+(w+"x"+y);const N=m.getImageData(0,0,w,y),x=new Array(w*y);let z=0,U=0;for(let D=0;D<y;++D)for(let B=0;B<w;++B)x[U]=N.data[z+3],z+=4,++U;return x}function f(m,w,y,N){const x=m.getImageData(0,0,y,N);let z=0,U=0;for(let D=0;D<N;++D)for(let B=0;B<y;++B)x.data[z+3]=w[U],z+=4,++U;m.putImageData(x,0,0)}function u(m,w,y,N,x,z,U,D,B){const j=m.getImageData(0,0,w,w),ee=(N+1)*(N+1),me=[0,0,1];let Z=0;for(let se=-y;se<w-y;++se)for(let he=-y;he<w-y;++he){if(he*he+se*se<ee){const W=j.data[Z],H=j.data[Z+1],I=j.data[Z+2],le=c(he,se,N),_e=p(le,B)/U,K=a(O(B,me)),Y=Math.pow(p(le,K),z)/D,Q=C(W,H,I);Q[2]=Math.min(1,Q[2]*(x+_e)+_e*.5+Y);const ae=R(Q[0],Q[1],Q[2]);j.data[Z]=ae[0],j.data[Z+1]=ae[1],j.data[Z+2]=ae[2]}Z+=4}m.putImageData(j,0,0)}function o(m,w,y,N,x,z){const U=m.getImageData(0,0,w,y);let D=0;for(let B=0;B<y;++B)for(let j=0;j<w;++j)U.data[D+0]>N&&U.data[D+1]>x&&U.data[D+2]>z&&(U.data[D+0]=0,U.data[D+1]=0,U.data[D+2]=0,U.data[D+3]=0),D+=4;m.putImageData(U,0,0)}function r(m,w,y,N,x=.15,z="rgba(60,60,60,0.7)"){m.beginPath(),m.shadowColor=z,m.shadowBlur=y*x,m.shadowOffsetX=y*.2,m.shadowOffsetY=y*.2,m.fillStyle="rgba(255,255,255,1.0)",m.arc(w,w,Math.max(y*.9,.1),0,2*Math.PI,!1),m.fill(),o(m,N,N,150,150,150)}const b={};function h(m,w,y){const N=`${m}-${w}-${y.base_color}-${y.light}-${y.ambient}-${y.specular_hardness}-${y.diffuse_light_distance}-${y.specular_light_distance}`;if(b[N])return b[N];const x=(0,L.deviceCanvasScalingRatio)();m*=x,m=Math.max(.1,m);const z=d(m,x!==1),U=g(m,x!==1),D=m*2.5;let B,j,ee,me;if(typeof document<"u"){if(B=(0,L.allocateCanvasOrError)(`${z}px`,`${z}px`),j=(0,L.allocateCanvasOrError)(`${D}px`,`${D}px`),ee=B.getContext("2d",{willReadFrequently:!0}),me=j.getContext("2d",{willReadFrequently:!0}),!ee)throw new Error("Error getting stone context 2d");if(!me)throw new Error("Error getting shadow context 2d")}else throw new Error("Backend server rendering has been removed, should be easy to re-enable if we still need it though (code is here, just needs wiring up again)");ee.clearRect(0,0,z,z),me.clearRect(0,0,D,D);const Z=y.base_color;if(ee.beginPath(),ee.fillStyle=Z,ee.arc(U,U,m,0,2*Math.PI,!1),ee.fill(),y.shell_lines)try{const se=k(ee,z,z),he=5+w%5;let J=(w%160+10)*.0174532925;w&256&&(J=-J);const W=m/(he*2),H=Math.cos(J),I=Math.sin(J),le=H/I,_e=I/H;let K=_e*_e-1;K=Math.abs(K);let Y=w;const Q=Math.round(m*.1);ee.save();let ae=-m;const te=m*.07;for(let ne=0;ne<he*4;++ne)for(let re=0;re<2;++re){ae+=W+Y%Q;const Ce=Math.sqrt(ae*ae/K),Me=_e*Ce,we=(re?-1:1)*Me-le*Ce,be=0,Be=m*2,de=le*be+we,fe=le*Be+we;Y=Y*97>>3,ee.beginPath();const Ee="rgba(194,191,198,"+Y%10/10+")";ee.strokeStyle=Ee,ee.shadowColor=Ee,ee.shadowBlur=(Y%3+1)*te,ee.shadowOffsetX=0,ee.shadowOffsetY=0,Y=Y*51>>3,ee.lineWidth=te*.5,ee.moveTo(be,de),ee.lineTo(Be,fe),ee.stroke()}ee.restore(),f(ee,se,z,z)}catch(se){console.log(se)}return u(ee,z,U,m,y.ambient,y.specular_hardness,y.diffuse_light_distance,y.specular_light_distance,y.light),T(m)||(ee.beginPath(),ee.strokeStyle="rgba(100,100,100,0.3)",ee.lineWidth=m*.15,ee.arc(U,U,m,Math.PI/2*.25,Math.PI/2*.75,!1),ee.stroke(),ee.beginPath(),ee.strokeStyle="rgba(100,100,100,0.5)",ee.arc(U,U,m,0,Math.PI/2,!1),ee.stroke()),r(me,U,m,D),b[N]=[{stone:B,shadow:j}],b[N]}function F(m,w,y,N,x,z){const U=(0,L.deviceCanvasScalingRatio)();if(U!==1){const D=g(z*U,!0)/U,B=d(z*U,!0)/U,j=N-D,ee=x-D;w&&w.drawImage(y.shadow,j,ee,z*2.5,z*2.5),m.drawImage(y.stone,j,ee,B,B)}else{const D=g(z,!1),B=N-D,j=x-D;w&&w.drawImage(y.shadow,B,j),m.drawImage(y.stone,B,j)}}function T(m){return m>=10}function P(m){class w extends q.GobanTheme{stoneCastsShadow(B){return T(B*(0,L.deviceCanvasScalingRatio)())}placeBlackStone(B,j,ee,me,Z,se){F(B,j,ee,me,Z,se)}placeWhiteStone(B,j,ee,me,Z,se){F(B,j,ee,me,Z,se)}preRenderSVG(B,j,ee,me){const Z=[];for(let se=0;se<ee.length;++se){const he=this.def_uid(`white-shell-${se}-${j}`),J=document.createElementNS("http://www.w3.org/2000/svg","image");J.setAttribute("id",he),J.setAttribute("width",`${Math.ceil(j*2)}`),J.setAttribute("height",`${Math.ceil(j*2)}`),J.setAttribute("x","0"),J.setAttribute("y","0"),J.setAttributeNS("http://www.w3.org/1999/xlink","href",ee[se].stone.toDataURL()),B.appendChild(J),Z.push(he)}return Z}preRenderWhiteSVG(B,j,ee,me){const Z=this.preRenderWhite(j,ee,me);return this.preRenderSVG(B,j,Z,me)}preRenderBlackSVG(B,j,ee,me){const Z=this.preRenderBlack(j,ee,me);return this.preRenderSVG(B,j,Z,me)}}class y extends w{sort(){return 30}get theme_name(){return"Slate"}preRenderBlack(B,j){return h(B,j,{base_color:"rgba(30,30,35,1.0)",light:a([-4,-4,5]),ambient:.85,specular_hardness:17,diffuse_light_distance:10,specular_light_distance:8})}getBlackTextColor(B){return"#ffffff"}}(0,S._)("Slate"),m.black.Slate=y;class N extends w{sort(){return 30}get theme_name(){return"Shell"}preRenderWhite(B,j){let ee=[];for(let me=0;me<10;++me)ee=ee.concat(h(B,j*=13,{base_color:"rgba(207,205,206,1.0)",light:a([-4,-4,2]),shell_lines:!0,ambient:1,specular_hardness:24,diffuse_light_distance:7,specular_light_distance:100}));return ee}getWhiteTextColor(B){return"#000000"}}(0,S._)("Shell"),m.white.Shell=N;class x extends w{sort(){return 20}get theme_name(){return"Glass"}preRenderBlack(B,j){return h(B,j,{base_color:"rgba(15,15,20,1.0)",light:a([-4,-4,2]),ambient:.85,specular_hardness:30,diffuse_light_distance:10,specular_light_distance:10})}getBlackTextColor(B){return"#ffffff"}preRenderWhite(B,j){return h(B,j*=13,{base_color:"rgba(207,205,206,1.0)",light:a([-4,-4,2]),ambient:1,specular_hardness:80,diffuse_light_distance:7,specular_light_distance:100})}getWhiteTextColor(B){return"#000000"}}(0,S._)("Glass"),m.black.Glass=x,m.white.Glass=x;class z extends w{sort(){return 21}get theme_name(){return"Worn Glass"}preRenderBlack(B,j){return h(B,j,{base_color:"rgba(15,15,20,1.0)",light:a([-4,-4,2]),ambient:.85,specular_hardness:20,diffuse_light_distance:10,specular_light_distance:10})}getBlackTextColor(B){return"#ffffff"}preRenderWhite(B,j){return h(B,j*=13,{base_color:"rgba(189,189,194,1.0)",light:a([-4,-4,2]),ambient:1,specular_hardness:35,diffuse_light_distance:7,specular_light_distance:100})}getWhiteTextColor(B){return"#000000"}}(0,S._)("Worn Glass"),m.black["Worn Glass"]=z,m.white["Worn Glass"]=z;class U extends w{sort(){return 100}get theme_name(){return"Night"}preRenderBlack(B,j){return h(B,j,{base_color:"rgba(15,15,20,1.0)",light:a([-4,-4,2]),ambient:.85,specular_hardness:5,diffuse_light_distance:10,specular_light_distance:10})}getBlackTextColor(B){return"#888888"}preRenderWhite(B,j){return h(B,j*=13,{base_color:"rgba(100,100,100,1.0)",light:a([-4,-4,2]),ambient:1,specular_hardness:13,diffuse_light_distance:7,specular_light_distance:100})}getWhiteTextColor(B){return"#000000"}}(0,S._)("Night"),m.black.Night=U,m.white.Night=U}},"./src/GobanBase.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanBase=void 0;const q=G("./src/engine/translate.ts"),S=G("./node_modules/eventemitter3/index.js"),L=G("./src/Goban/callbacks.ts");let C=0;class E extends S.EventEmitter{get destroyed(){return this._destroyed}constructor(){super(),this.goban_id=++C,this._destroyed=!1}destroy(){this.emit("destroy"),this._destroyed=!0,this.engine.removeAllListeners(),this.removeAllListeners()}decodeMoves(O){return this.engine.decodeMoves(O)}encodeMoves(O){return this.engine.encodeMoves(O)}encodeMove(O){return this.engine.encodeMove(O)}prettyCoordinates(O,p){return this.engine.prettyCoordinates(O,p)}decodePrettyCoordinates(O){return this.engine.decodePrettyCoordinates(O)}get is_game_record(){return this.engine.is_game_record}}A.GobanBase=E,E.setTranslations=q.setGobanTranslations,E.setCallbacks=L.setGobanCallbacks},"./src/engine/BoardState.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.BoardState=void 0;const q=G("./node_modules/eventemitter3/index.js"),S=G("./src/engine/formats/JGOF.ts"),L=G("./src/engine/util/index.ts"),C=G("./src/third_party/goscorer/goscorer.js"),E=G("./src/engine/StoneStringBuilder.ts"),R=G("./src/engine/util/index.ts"),O=G("./src/Goban/callbacks.ts");let p=0;const v=Array(25*25).fill(0);class s extends q.EventEmitter{constructor(c,d){var g,k,f,u,o,r,b,h,F,T,P;if(super(),this.height=19,this.width=19,this.goban_callback=d,this.width=(u=(g=c.width)!==null&&g!==void 0?g:(f=(k=c.board)===null||k===void 0?void 0:k[0])===null||f===void 0?void 0:f.length)!==null&&u!==void 0?u:19,this.height=(b=(o=c.height)!==null&&o!==void 0?o:(r=c.board)===null||r===void 0?void 0:r.length)!==null&&b!==void 0?b:19,this.board=c.board?(0,R.cloneMatrix)(c.board):(0,L.makeMatrix)(this.width,this.height,S.JGOFNumericPlayerColor.EMPTY),this.removal=c.removal?(0,R.cloneMatrix)(c.removal):(0,L.makeMatrix)(this.width,this.height,!1),this.height!==this.board.length||this.width!==this.board[0].length)throw new Error("Board size mismatch");if(this.height!==this.removal.length||this.width!==this.removal[0].length)throw new Error("Removal size mismatch");this.player=(h=c.player)!==null&&h!==void 0?h:S.JGOFNumericPlayerColor.EMPTY,this.board_is_repeating=(F=c.board_is_repeating)!==null&&F!==void 0?F:!1,this.white_prisoners=(T=c.white_prisoners)!==null&&T!==void 0?T:0,this.black_prisoners=(P=c.black_prisoners)!==null&&P!==void 0?P:0}cloneBoardState(){return new s(this,this.goban_callback)}cloneBoard(){return this.board.map(c=>c.slice())}toggleSingleGroupRemoval(c,d,g=!1){var k;const f={removed:!1,group:[]};if(c<0||d<0)return f;try{if(c>=0&&d>=0){const u=!this.removal[d][c];if(this.board[d][c]===S.JGOFNumericPlayerColor.EMPTY)return f;const b=new E.StoneStringBuilder(this,this.board).getGroup(c,d);if(u&&!g){const h=C.territoryScoring(this.board,this.removal,!1);let F=0,T=0;if(b.foreachNeighboringEmptyString(P=>{let m=!1;P.map(w=>{h[w.y][w.x].isTerritoryFor===this.board[d][c]&&!h[w.y][w.x].isFalseEye&&(m=!0)}),m&&(T+=1,F+=P.intersections.length)}),F>=5||T>=2)return console.log("This group is almost assuredly alive, refusing to remove"),(k=O.callbacks.toast)===null||k===void 0||k.call(O.callbacks,"refusing_to_remove_group_is_alive",4e3),f}return b.map(({x:h,y:F})=>this.setRemoved(h,F,u,!1)),this.emit("stone-removal.updated"),{removed:u,group:b.intersections}}}catch(u){console.log(u.stack)}return f}setRemoved(c,d,g,k=!0){c<0||d<0||c>this.width||d>this.height||(this.removal[d][c]=g,this.goban_callback&&this.goban_callback.setForRemoval(c,d,this.removal[d][c],k))}clearRemoved(){let c=!1;for(let d=0;d<this.height;++d)for(let g=0;g<this.width;++g)this.removal[d][g]&&(c=!0,this.setRemoved(g,d,!1,!1));c&&this.emit("stone-removal.updated")}getNeighboringRawStoneStrings(c){const d=c;++p,this._floodFillMarkFilled(c);const g=[];return this.foreachNeighbor(c,(k,f)=>{if(this.board[f][k]){++p,this._floodFillMarkFilled(d);for(let o=0;o<g.length;++o)this._floodFillMarkFilled(g[o]);const u=this.getRawStoneString(k,f,!1);u.length&&g.push(u)}}),g}getRawStoneString(c,d,g){const k=this.board[d][c];g&&++p;const f=[c],u=[d],o=[];for(;f.length;)if(c=f.pop()||0,d=u.pop()||0,v[d*this.width+c]!==p&&(v[d*this.width+c]=p,this.board[d][c]===k)){const b={x:c,y:d};o.push(b),this.foreachNeighbor(b,r)}function r(b,h){f.push(b),u.push(h)}return o}_floodFillMarkFilled(c){for(let d=0;d<c.length;++d)v[c[d].y*this.width+c[d].x]=p}countLiberties(c){let d=0;const g=(0,L.makeMatrix)(this.width,this.height,0),k=(f,u)=>{this.board[u][f]===0&&g[u][f]===0&&(g[u][f]=1,d+=1)};for(let f=0;f<c.length;++f)this.foreachNeighbor(c[f],k);return d}foreachNeighbor(c,d){if(c instanceof Array){const g=c,k=new Array(this.height*this.width);for(let u=0;u<g.length;++u)k[g[u].x+g[u].y*this.width]=!0;const f=(u,o)=>{const r=u+o*this.width;k[r]||(k[r]=!0,d(u,o))};for(let u=0;u<g.length;++u){const o=g[u];o.x-1>=0&&f(o.x-1,o.y),o.x+1!==this.width&&f(o.x+1,o.y),o.y-1>=0&&f(o.x,o.y-1),o.y+1!==this.height&&f(o.x,o.y+1)}}else{const g=c;g.x-1>=0&&d(g.x-1,g.y),g.x+1!==this.width&&d(g.x+1,g.y),g.y-1>=0&&d(g.x,g.y-1),g.y+1!==this.height&&d(g.x,g.y+1)}}boardEquals(c){return(0,R.matricesAreEqual)(this.board,c.board)}computeScoringLocations(c){const d={black:{territory:0,stones:0,locations:[]},white:{territory:0,stones:0,locations:[]}};if(c){const g=C.areaScoring(this.board,this.removal);for(let k=0;k<this.height;++k)for(let f=0;f<this.width;++f)g[k][f]===C.BLACK?(this.board[k][f]===S.JGOFNumericPlayerColor.BLACK?d.black.stones+=1:d.black.territory+=1,d.black.locations.push({x:f,y:k})):g[k][f]===C.WHITE&&(this.board[k][f]===S.JGOFNumericPlayerColor.WHITE?d.white.stones+=1:d.white.territory+=1,d.white.locations.push({x:f,y:k}))}else{const g=C.territoryScoring(this.board,this.removal);for(let k=0;k<this.height;++k)for(let f=0;f<this.width;++f)g[k][f].isTerritoryFor===C.BLACK?(d.black.territory+=1,d.black.locations.push({x:f,y:k})):g[k][f].isTerritoryFor===C.WHITE&&(d.white.territory+=1,d.white.locations.push({x:f,y:k}))}return d}}A.BoardState=s},"./src/engine/ConditionalMoveTree.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.ConditionalMoveTree=void 0;class G{constructor(S,L){this.move=S,this.parent=L,this.children={}}encode(){const S={};for(const L in this.children)S[L]=this.children[L].encode();return[this.move,S]}static decode(S){const L=S[0],C=S[1],E=new G(L);for(const R in C){const O=G.decode(C[R]);O.parent=E,E.children[R]=O}return E}getChild(S){return S in this.children?this.children[S]:new G(null,this)}duplicate(){return G.decode(this.encode())}}A.ConditionalMoveTree=G},"./src/engine/GobanEngine.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanEngine=A.AUTOSCORE_TOLERANCE=A.AUTOSCORE_TRIALS=void 0;const q=G("./src/engine/BoardState.ts"),S=G("./src/engine/GobanError.ts"),L=G("./src/engine/MoveTree.ts"),C=G("./src/engine/util/index.ts"),E=G("./src/engine/ScoreEstimator.ts"),R=G("./src/engine/formats/JGOF.ts"),O=G("./src/third_party/goscorer/goscorer.js");A.AUTOSCORE_TRIALS=1e3,A.AUTOSCORE_TOLERANCE=.1;class p extends q.BoardState{get phase(){return this._phase}set phase(s){this._phase!==s&&(this._phase=s,this.emit("phase",this.phase))}get cur_move(){return this._cur_move}set cur_move(s){this._cur_move!==s&&(this._cur_move=s,this.emit("cur_move",this.cur_move))}get cur_review_move(){return this._cur_review_move}set cur_review_move(s){this._cur_review_move!==s&&(this._cur_review_move=s,this.emit("cur_review_move",this.cur_review_move))}get last_official_move(){return this._last_official_move}set last_official_move(s){this._last_official_move!==s&&(this._last_official_move=s,this.emit("last_official_move",this.last_official_move))}get strict_seki_mode(){return this._strict_seki_mode}set strict_seki_mode(s){this._strict_seki_mode!==s&&(this._strict_seki_mode=s,this.emit("strict_seki_mode",this.strict_seki_mode))}get rules(){return this._rules}set rules(s){this._rules!==s&&(this._rules=s,this.emit("rules",this.rules))}get winner(){return this._winner}set winner(s){this._winner!==s&&(this._winner=s,typeof s=="number"&&this.emit("winner",this.winner))}get undo_requested(){return this._undo_requested}set undo_requested(s){this._undo_requested!==s&&(this._undo_requested=s,this.emit("undo_requested",this.undo_requested))}get outcome(){return this._outcome}set outcome(s){this._outcome!==s&&(this._outcome=s,this.emit("outcome",this.outcome))}constructor(s,a,c){var d,g;super(p.fillDefaults(p.migrateConfig((r=>{try{"original_sgf"in r&&(r.initial_state={black:"",white:""})}catch(b){console.log(b)}return r})(s))),a),this.handicap=NaN,this.initial_state={black:"",white:""},this.komi=NaN,this.move_tree_layout_vector=[],this.move_tree_layout_hash={},this.move_tree_layout_dirty=!1,this.name="",this.players={black:{username:"black",id:NaN},white:{username:"white",id:NaN}},this.puzzle_collection=NaN,this.puzzle_description="[missing puzzle description]",this.puzzle_opponent_move_mode="manual",this.puzzle_player_move_mode="free",this.puzzle_rank=NaN,this.puzzle_type="[missing puzzle type]",this.disable_analysis=!1,this.time_control={system:"none",speed:"correspondence",pause_on_weekends:!0},this.game_id=NaN,this.decoded_moves=[],this.automatic_stone_removal=!1,this.is_game_record=!1,this._phase="play",this._strict_seki_mode=!1,this._rules="japanese",this._outcome="",this.aga_handicap_scoring=!1,this.allow_ko=!1,this.allow_self_capture=!1,this.allow_superko=!1,this.superko_algorithm="psk",this.free_handicap_placement=!1,this.loading_sgf=!1,this.score_prisoners=!1,this.score_stones=!1,this.score_handicap=!1,this.score_territory=!1,this.score_territory_in_seki=!1,this.territory_included_in_sgf=!1;for(const r in s)r!=="move_tree"&&(this[r]=s[r]);const k=this;this.config=s,this.is_game_record=!!s.is_game_record,this.dontStoreBoardHistory=!!c,a&&(this.goban_callback=a,this.goban_callback.engine=this),this.white_prisoners=0,this.black_prisoners=0,this.board_is_repeating=!1,this.players=s.players||{black:{username:"black",id:NaN},white:{username:"white",id:NaN}},this.player_pool=s.player_pool||{},this.rengo_casual_mode=s.rengo_casual_mode||!1;try{this.config.original_disable_analysis=this.config.disable_analysis,typeof window<"u"&&typeof window.user<"u"&&window.user&&!this.isParticipant(window.user.id)&&(this.disable_analysis=!1,this.config.disable_analysis=!1)}catch(r){console.log(r)}if(this.player=1,"initial_player"in s&&(this.player=s.initial_player==="white"?2:1),s.players&&(this.player_pool[s.players.black.id]=s.players.black,this.player_pool[s.players.white.id]=s.players.white),s.rengo&&s.rengo_teams)for(const r of s.rengo_teams.black.concat(s.rengo_teams.white))this.player_pool[r.id]=r;let f=()=>{};if(s.original_sgf&&(s.initial_state={black:((d=s.initial_state)===null||d===void 0?void 0:d.black)||"",white:((g=s.initial_state)===null||g===void 0?void 0:g.white)||""},this.phase==="play"&&(this.phase="finished"),f=this.parseSGF(s.original_sgf)),s.initial_state){this.initial_state=s.initial_state;const r=this.decodeMoves(s.initial_state.black||""),b=this.decodeMoves(s.initial_state.white||"");for(let h=0;h<r.length;++h){const F=r[h].x,T=r[h].y;this.initialStatePlace(F,T,1,!0)}for(let h=0;h<b.length;++h){const F=b[h].x,T=b[h].y;this.initialStatePlace(F,T,2,!0)}}this.move_tree=new L.MoveTree(this,!0,-1,-1,!1,0,0,null,this.getState()),this._cur_move=this.move_tree,this._last_official_move=this.cur_move,delete this.move_before_jump;try{this.loading_sgf=!0,f(),this.loading_sgf=!1}catch(r){console.log("Error loading SGF: ",r.message),r.stack&&console.log(r.stack)}if(s.moves){const r=this.decoded_moves=this.decodeMoves(s.moves);for(let b=0;b<r.length;++b){const h=r[b];if(h.edited)this.editPlace(h.x,h.y,h.color||0,!0);else try{this.place(h.x,h.y,!1,!1,!0,!0,!0),h.player_update&&(this.cur_move.player_update=h.player_update,this.updatePlayers(h.player_update)),h.played_by&&(this.cur_move.played_by=h.played_by)}catch(F){if(this.throw_all_errors)throw F;s.errors||(s.errors=[]),s.errors.push({error:`Error placing ${this.cur_move.player===R.JGOFNumericPlayerColor.BLACK?"black":"white"} at ${this.prettyCoordinates(h.x,h.y)} (${h.x}, ${h.y})`,stack:F.stack}),console.log(s.errors[s.errors.length-1]),this.editPlace(h.x,h.y,h.color||0,!0)}}}s.move_tree&&o(this.move_tree,s.move_tree);let u;if(s.removed&&(u=this.decodeMoves(s.removed)),u){for(let r=0;r<u.length;++r)this.setRemoved(u[r].x,u[r].y,!0,!1);this.emit("stone-removal.updated")}if(s.needs_sealing){if(this.needs_sealing=s.needs_sealing,this.phase==="stone removal")for(const r of s.needs_sealing)this.setNeedsSealing(r.x,r.y,!0);this.emit("stone-removal.needs-sealing",s.needs_sealing)}function o(r,b){if(r.loadJsonForThisNode(b),b.trunk_next){const h=b.trunk_next;k.place(h.x,h.y,!1,!1,!0,!0,!0),o(k.cur_move,h),k.jumpTo(r)}if(b.branches)for(let h=0;h<b.branches.length;++h){const F=b.branches[h];k.place(F.x,F.y,!1,!1,!0,!0,!1),o(k.cur_move,F),k.jumpTo(r)}}}decodeMoves(s){return(0,C.decodeMoves)(s,this.width,this.height)}encodeMoves(s){return(0,C.encodeMoves)(s)}encodeMove(s){return(0,C.encodeMoves)([s])}decodePrettyCoordinates(s){return(0,C.decodePrettyCoordinates)(s,this.height)}prettyCoordinates(s,a){return typeof s!="number"&&(a=s.y,s=s.x),(0,C.prettyCoordinates)(s,a,this.height)}getState(){return this.cloneBoardState()}setState(s){var a,c;this.player=s.player,this.white_prisoners=s.white_prisoners,this.black_prisoners=s.black_prisoners,this.board_is_repeating=s.board_is_repeating,(c=(a=this.goban_callback)===null||a===void 0?void 0:a.setState)===null||c===void 0||c.call(a);const d=(0,C.makeMatrix)(this.width,this.height,!1);for(let g=0;g<this.height;++g)for(let k=0;k<this.width;++k)(this.board[g][k]!==s.board[g][k]||this.cur_move.x===k&&this.cur_move.y===g)&&(this.board[g][k]=s.board[g][k],d[g][k]=!0),(this.removal[g][k]!==s.removal[g][k]||this.cur_move.x===k&&this.cur_move.y===g)&&(this.removal[g][k]=s.removal[g][k],d[g][k]=!0);if(this.goban_callback)for(let g=0;g<this.height;++g)for(let k=0;k<this.width;++k)this.goban_callback.set(k,g,this.board[g][k]);return s}currentPositionId(){return(0,C.positionId)(this.board,this.height,this.width)}followPath(s,a,c){try{const d=[],g=this.move_tree.index(s);let k;g?k=g:k=this.last_official_move;const f=this.decodeMoves(a);let u=0;for(;u<f.length;){const o=f[u],r=k.lookupMove(o.x,o.y,this.playerByColor(o.color||0),!!o.edited);if(r)k=r,++u,c&&c(o.x,o.y,!!o.edited,o.color||0);else break}for(this.jumpTo(k);u<f.length;++u){const o=f[u];o.edited?this.editPlace(o.x,o.y,o.color||0):this.place(o.x,o.y,!1,!1,!0,!0),c&&c(o.x,o.y,!!o.edited,o.color||0),d.push(this.cur_move)}return d}catch(d){return console.log(d.stack),this.jumpTo(this.last_official_move),[]}}updatePlayers(s){if(!this.player_pool)throw new Error("updatePlayers called with no player_pool available");this.players.black=this.player_pool[s.players.black],this.players.white=this.player_pool[s.players.white];try{if(this.config.rengo&&s.rengo_teams){this.rengo_teams={black:[],white:[]};for(const a of["black","white"])for(const c of s.rengo_teams[a])this.rengo_teams[a].push(this.player_pool[c])}}catch(a){console.error(a),console.error(a.stack)}this.config.black_player_id=s.players.black,this.config.white_player_id=s.players.white,this.emit("player-update",s)}showPrevious(){return this.dontStoreBoardHistory?!1:this.cur_move.prev()?(this.jumpTo(this.cur_move.prev()),!0):!1}showNext(){return this.dontStoreBoardHistory?!1:this.cur_move.next()?(this.jumpTo(this.cur_move.next()),!0):!1}showNextTrunk(){return this.dontStoreBoardHistory?!1:this.cur_move.trunk_next?(this.jumpTo(this.cur_move.trunk_next),!0):!1}jumpTo(s){s&&(this.move_before_jump=this.cur_move,this.setState(s.state),this.cur_move=s,s.player_update&&this.updatePlayers(s.player_update))}jumpToLastOfficialMove(){this.dontStoreBoardHistory||this.jumpTo(this.last_official_move)}setLastOfficialMove(){if(!this.dontStoreBoardHistory){if(!this.cur_move.trunk&&!("original_sgf"in this.config))throw new Error("Attempted to set official move to non-trunk move.");this.last_official_move=this.cur_move}}isLastOfficialMove(){return this.cur_move.is(this.last_official_move)}getMoveDiff(){const s=this.cur_move.getBranchPoint();let a=this.cur_move;const c=[];for(;a&&a.id!==s.id;)c.push({x:a.x,y:a.y,color:a.player,edited:a.edited}),a=a.parent;return c.reverse(),{from:s.getMoveIndex(),moves:(0,C.encodeMoves)(c)}}setAsCurrentReviewMove(){this.dontStoreBoardHistory||(this.cur_review_move=this.cur_move)}deleteCurMove(){if(this.cur_move.id===this.move_tree.id){console.log("Wont remove move tree itself.");return}if(this.cur_move.trunk){console.log("Wont remove trunk node");return}const s=this.cur_move.parent;this.cur_move.remove(),this.cur_move=s||this.move_tree,this.jumpTo(s)}gameCanBeCancelled(){if(this.phase!=="play"||"tournament_id"in this.config&&this.config.tournament_id||"ladder_id"in this.config&&this.config.ladder_id||this.rengo&&this.rengo_casual_mode)return!1;const s=this.getMoveNumber(),a=5+(this.free_handicap_placement?this.handicap:1);return s<a}jumpToOfficialMoveNumber(s){if(!this.dontStoreBoardHistory){for(;this.showPrevious(););for(let a=0;a<s;++a)this.cur_move.next(!0)&&this.jumpTo(this.cur_move.next(!0))}}opponent(){return this.player===1?2:1}captureGroup(s){for(let a=0;a<s.length;++a){const c=s[a].x,d=s[a].y;this.board[d][c]===1&&++this.white_prisoners,this.board[d][c]===2&&++this.black_prisoners,this.board[d][c]=0,this.goban_callback&&this.goban_callback.set(c,d,0)}return s.length}isParticipant(s){return(this.rengo&&this.rengo_teams?this.rengo_teams.black.concat(this.rengo_teams.white):[this.players.black,this.players.white]).map(c=>c.id).includes(s)}isActivePlayer(s){return[this.players.black,this.players.white].map(c=>c.id).includes(s)}playerToMoveOnOfficialBranch(){return this.last_official_move.state.player===1?this.players.black.id:this.players.white.id}playerToMove(){return this.player===1?this.players.black.id:this.players.white.id}playerNotToMove(){return this.player===2?this.players.black.id:this.players.white.id}otherPlayer(){return this.player===2?1:2}playerColor(s){return typeof s=="number"?s===this.players.black.id?"black":s===this.players.white.id?"white":"invalid":this.colorToMove()}colorToMove(){return this.player===1?"black":"white"}colorNotToMove(){return this.player!==1?"black":"white"}playerByColor(s){return s==="black"?1:s==="white"?2:s===1||s===2?s:0}place(s,a,c,d,g,k,f,u){var o,r,b,h,F,T,P,m;let w=0;try{if(s>=0&&a>=0&&s<this.width&&a<this.height){if(this.board[a][s]){if("loading_sgf"in this&&this.loading_sgf)return this.board[a][s]!==this.player&&(console.log("Invalid duplicate stone placement at "+this.prettyCoordinates(s,a)+" board color: "+this.board[a][s]+"   placed color: "+this.player+" - edit placing into new branch"),this.editPlace(s,a,this.player),this.player=this.opponent()),0;throw new S.GobanMoveError(this.game_id||this.review_id||0,(r=(o=this.cur_move)===null||o===void 0?void 0:o.move_number)!==null&&r!==void 0?r:-1,this.prettyCoordinates(s,a),"stone_already_placed_here")}this.board[a][s]=this.player;let z=!1;const U=this.getRawStoneString(s,a,!0),D=this.getNeighboringRawStoneStrings(U);for(let B=0;B<D.length;++B)this.countLiberties(D[B])===0&&(u!==void 0&&D[B].map(j=>u.push(j)),w+=this.captureGroup(D[B]));if(w===0&&this.countLiberties(U)===0)if(this.allow_self_capture||k)w+=this.captureGroup(U),z=!0;else throw this.board[a][s]=0,new S.GobanMoveError(this.game_id||this.review_id||0,(h=(b=this.cur_move)===null||b===void 0?void 0:b.move_number)!==null&&h!==void 0?h:-1,this.prettyCoordinates(s,a),"illegal_self_capture");if(c&&!this.allow_ko&&!this.cur_move.edited&&this.boardEquals(this.cur_move.index(-1).state))throw new S.GobanMoveError(this.game_id||this.review_id||0,(T=(F=this.cur_move)===null||F===void 0?void 0:F.move_number)!==null&&T!==void 0?T:-1,this.prettyCoordinates(s,a),"illegal_ko_move");if(this.board_is_repeating=!1,!g&&!this.allow_superko&&(this.board_is_repeating=this.isBoardRepeating(this.superko_algorithm),this.board_is_repeating&&d))throw new S.GobanMoveError(this.game_id||this.review_id||0,(m=(P=this.cur_move)===null||P===void 0?void 0:P.move_number)!==null&&m!==void 0?m:-1,this.prettyCoordinates(s,a),"illegal_board_repetition");z||this.goban_callback&&this.goban_callback.set(s,a,this.player)}if(s<0&&this.handicapMovesLeft()>0)return 0;const y=this.player;this.handicapMovesLeft()<2&&(this.player=this.opponent());const N=this.cur_move.move_number+1,x=!!f;this.cur_move=this.cur_move.move(s,a,x,!1,y,N,this.getState())}catch(y){throw this.jumpTo(this.cur_move),y}return w}isBoardRepeating(s){const c=this.player,d=s==="ssk";let g=this.cur_move.index(-2);for(let k=Math.min(30,this.cur_move.move_number-2);k>0;--k,g=g==null?void 0:g.prev())if(g&&(!d||g.player===c)&&this.boardEquals(g.state))return!0;return!1}editPlace(s,a,c,d){const g=this.playerByColor(c);s>=0&&a>=0&&(this.board[a][s]=g,this.goban_callback&&this.goban_callback.set(s,a,g));const k=!!d;this.cur_move=this.cur_move.move(s,a,k,!0,g,this.cur_move.move_number,this.getState())}initialStatePlace(s,a,c,d){var g,k;let f=null;const u=this.player;if(this.move_tree&&this.jumpTo(this.move_tree),this.player=u,s>=0&&a>=0&&(this.board[a][s]=c,this.goban_callback&&this.goban_callback.set(s,a,c)),!d){f=this.decodeMoves(((g=this.initial_state)===null||g===void 0?void 0:g.black)||"");for(let o=0;o<f.length;++o)if(f[o].x===s&&f[o].y===a){f.splice(o,1);break}this.initial_state.black=(0,C.encodeMoves)(f),f=this.decodeMoves(((k=this.initial_state)===null||k===void 0?void 0:k.white)||"");for(let o=0;o<f.length;++o)if(f[o].x===s&&f[o].y===a){f.splice(o,1);break}if(this.initial_state.white=(0,C.encodeMoves)(f),c){const o=this.decodeMoves(this.initial_state[c===1?"black":"white"]||"");o.push({x:s,y:a,color:c}),this.initial_state[c===1?"black":"white"]=(0,C.encodeMoves)(o)}}this.resetMoveTree()}resetMoveTree(){let s=null;this.move_tree&&(s=this.move_tree.getAllMarks()),this.move_tree=new L.MoveTree(this,!0,-1,-1,!1,0,0,null,this.getState()),this.cur_move=this.move_tree,this.last_official_move=this.cur_move,delete this.move_before_jump,s&&this.move_tree.setAllMarks(s),"initial_player"in this.config&&(this.player=this.config.initial_player==="white"?2:1)}computeInitialStateForForkedGame(){let s="",a="";for(let c=0;c<this.height;++c)for(let d=0;d<this.width;++d)this.board[c][d]===1?s+=(0,C.encodeMove)(d,c):this.board[c][d]===2&&(a+=(0,C.encodeMove)(d,c));return{black:s,white:a}}setNeedsSealing(s,a,c){this.cur_move.getMarks(s,a).needs_sealing=c}getStoneRemovalString(){let s="";const a=[];for(let c=0;c<this.height;++c)for(let d=0;d<this.width;++d)this.removal[c][d]&&a.push((0,C.encodeMove)(d,c));for(let c=0;c<a.length;++c)s+=a[c];return(0,C.sortMoves)(s,this.width,this.height)}getMoveNumber(){return this.cur_move?this.cur_move.move_number:0}getCurrentMoveNumber(){return this.last_official_move.move_number}computeScore(s){const a={white:{total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:this.getHandicapPointAdjustmentForWhite(),komi:this.komi},black:{total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:0,komi:0}};if(s||this.score_prisoners){a.white.prisoners=this.white_prisoners,a.black.prisoners=this.black_prisoners;for(let c=0;c<this.height;++c)for(let d=0;d<this.width;++d)this.removal[c][d]&&(this.board[c][d]===R.JGOFNumericPlayerColor.BLACK&&(a.white.prisoners+=1),this.board[c][d]===R.JGOFNumericPlayerColor.WHITE&&(a.black.prisoners+=1))}if(!s){if(!this.score_territory)throw new Error("The score_territory flag should always be set to true");if(this.score_stones){const c=O.areaScoring(this.board,this.removal);for(let d=0;d<this.height;++d)for(let g=0;g<this.width;++g)c[d][g]===O.BLACK?(this.board[d][g]===R.JGOFNumericPlayerColor.BLACK?a.black.stones+=1:a.black.territory+=1,a.black.scoring_positions+=(0,C.encodeMove)(g,d)):c[d][g]===O.WHITE&&(this.board[d][g]===R.JGOFNumericPlayerColor.WHITE?a.white.stones+=1:a.white.territory+=1,a.white.scoring_positions+=(0,C.encodeMove)(g,d))}else{const c=O.territoryScoring(this.board,this.removal);for(let d=0;d<this.height;++d)for(let g=0;g<this.width;++g)c[d][g].isTerritoryFor===O.BLACK?(a.black.territory+=1,a.black.scoring_positions+=(0,C.encodeMove)(g,d)):c[d][g].isTerritoryFor===O.WHITE&&(a.white.territory+=1,a.white.scoring_positions+=(0,C.encodeMove)(g,d))}}a.black.total=a.black.stones+a.black.territory+a.black.prisoners+a.black.handicap+a.black.komi,a.white.total=a.white.stones+a.white.territory+a.white.prisoners+a.white.handicap+a.white.komi;try{this.outcome&&this.aga_handicap_scoring&&parseFloat(this.outcome)-1===Math.abs(a.white.total-a.black.total)&&(a.white.handicap+=1)}catch(c){console.log(c)}return this.jumpTo(this.cur_move),a}handicapMovesLeft(){return this.free_handicap_placement?Math.max(0,this.handicap-this.getMoveNumber()):0}static migrateConfig(s){var a,c;if(s.ladder!==s.ladder_id&&(s.ladder_id=s.ladder),"ladder"in s&&delete s.ladder,(s.outcome==="resign"||s.outcome==="r")&&(s.outcome="Resignation"),s.black_player_id||s.white_player_id){if(s.players||(s.players={black:{username:"black",id:s.black_player_id||NaN},white:{username:"white",id:s.white_player_id||NaN}}),!s.players||!s.players.black||!s.players.white)throw new Error(`config.players is invalid: ${JSON.stringify(s.players)}`);if(s.players.black.id=(a=s.players.black.id)!==null&&a!==void 0?a:s.black_player_id,s.players.white.id=(c=s.players.white.id)!==null&&c!==void 0?c:s.white_player_id,s.players.black.id!==s.black_player_id)throw new Error(`config.players.black.id (${s.players.black.id}) !== deprecated config.black_player_id (${s.black_player_id})`);if(s.players.white.id!==s.white_player_id)throw new Error(`config.players.white.id (${s.players.white.id}) !== deprecated config.white_player_id (${s.white_player_id})`)}return s}static fillDefaults(s){var a,c;"phase"in s||(s.phase="play"),"rules"in s||(s.rules="japanese");const d={};d.game_id=0,d.initial_player="black",d.moves=[],d.width=19,d.height=19,d.rules="chinese",d.allow_self_capture=!1,d.automatic_stone_removal=!1,d.handicap=0,d.free_handicap_placement=!1,d.aga_handicap_scoring=!1,d.allow_ko=!1,d.allow_superko=!1,d.superko_algorithm="psk",d.players={black:{username:"Black",id:NaN,rank:-1},white:{username:"White",id:NaN,rank:-1}},d.player_pool={},d.disable_analysis=!1,d.score_territory=!0,d.score_territory_in_seki=!0,d.score_stones=!0,d.score_handicap=!1,d.score_prisoners=!0,d.score_passes=!0,d.white_must_pass_last=!1,d.opponent_plays_first_after_resume=!1,d.strict_seki_mode=s.phase==="finished";const g=s.rules||d.rules;switch(g.toLowerCase()){case"chinese":d.komi=7.5,d.score_prisoners=!1,d.allow_superko=!1,d.free_handicap_placement=!0,d.superko_algorithm="csk",d.score_handicap=!0,"ogs_import"in s&&(d.free_handicap_placement=!1);break;case"aga":d.komi=7.5,d.score_prisoners=!1,d.allow_superko=!1,d.superko_algorithm="ssk",d.white_must_pass_last=!0,d.aga_handicap_scoring=!0,d.score_handicap=!0;break;case"japanese":d.komi=6.5,d.allow_superko=!0,d.score_territory_in_seki=!1,d.score_stones=!1,d.superko_algorithm="noresult",d.opponent_plays_first_after_resume=!0;break;case"korean":d.komi=6.5,d.allow_superko=!0,d.score_territory_in_seki=!1,d.score_stones=!1,d.superko_algorithm="noresult",d.opponent_plays_first_after_resume=!0;break;case"ing":d.komi=7.5,d.score_prisoners=!1,d.allow_superko=!1,d.superko_algorithm="ing",d.free_handicap_placement=!0,d.allow_self_capture=!0,d.score_handicap=!0;break;case"nz":d.komi=7,d.score_prisoners=!1,d.allow_superko=!1,d.superko_algorithm="ssk",d.free_handicap_placement=!0,d.allow_self_capture=!0;break;default:console.log("Unsupported rule set: "+g+" error setting komi"),d.komi=0,d.score_prisoners=!1,d.allow_superko=!0,d.free_handicap_placement=!0,d.allow_self_capture=!0}!("komi"in s)&&s.handicap&&(d.komi-=Math.floor(d.komi));for(const k in d)k in s||(s[k]=d[k]);if(!("initial_state"in s)&&!("original_sgf"in s))if((s.width!==19||s.height!==19)&&(s.width!==13||s.height!==13)&&(s.width!==9||s.height!==9)&&(s.free_handicap_placement=!0),s.handicap&&!s.free_handicap_placement){const k="";let f="",u;if(s.width===19&&(u=[[(0,C.encodeMove)(3,3),(0,C.encodeMove)(9,3),(0,C.encodeMove)(15,3)],[(0,C.encodeMove)(3,9),(0,C.encodeMove)(9,9),(0,C.encodeMove)(15,9)],[(0,C.encodeMove)(3,15),(0,C.encodeMove)(9,15),(0,C.encodeMove)(15,15)]]),s.width===13&&(u=[[(0,C.encodeMove)(3,3),(0,C.encodeMove)(6,3),(0,C.encodeMove)(9,3)],[(0,C.encodeMove)(3,6),(0,C.encodeMove)(6,6),(0,C.encodeMove)(9,6)],[(0,C.encodeMove)(3,9),(0,C.encodeMove)(6,9),(0,C.encodeMove)(9,9)]]),s.width===9&&(u=[[(0,C.encodeMove)(2,2),(0,C.encodeMove)(4,2),(0,C.encodeMove)(6,2)],[(0,C.encodeMove)(2,4),(0,C.encodeMove)(4,4),(0,C.encodeMove)(6,4)],[(0,C.encodeMove)(2,6),(0,C.encodeMove)(4,6),(0,C.encodeMove)(6,6)]]),u){switch(s.handicap){case 8:f+=u[0][1]+u[2][1];case 6:f+=u[1][0]+u[1][2];case 4:f+=u[0][0];case 3:f+=u[2][2];case 2:f+=u[0][2]+u[2][0],s.initial_player="white";break;case 9:f+=u[0][1]+u[2][1];case 7:f+=u[1][0]+u[1][2];case 5:f+=u[1][1],f+=u[0][0],f+=u[2][2],f+=u[0][2]+u[2][0],s.initial_player="white";break;default:s.free_handicap_placement=!0;break}"ogs_import"in s&&(s.handicap===2&&(f=u[0][0]+u[2][2]),s.handicap===3&&(f=u[0][0]+u[0][2]+u[2][2]))}else s.free_handicap_placement=!0;s.initial_state={black:f,white:k}}else s.initial_state={black:"",white:""};if(s.phase==="finished"&&s.ogs&&s.score){const k=s.ogs;s.score.white.scoring_positions=(s.rules!=="japanese"?k.white_stones:"")+k.white_territory,s.score.black.scoring_positions=(s.rules!=="japanese"?k.black_stones:"")+k.black_territory;const f=k.black_seki_eyes+k.white_seki_eyes+k.black_dead_stones+k.white_dead_stones;!((a=s.players)===null||a===void 0)&&a.white&&(s.players.white.accepted_stones=f),!((c=s.players)===null||c===void 0)&&c.black&&(s.players.black.accepted_stones=f),s.removed=f}return s}static clearRuleSettings(s){return delete s.allow_self_capture,delete s.automatic_stone_removal,delete s.allow_ko,delete s.allow_superko,delete s.score_territory,delete s.score_territory_in_seki,delete s.strict_seki_mode,delete s.score_stones,delete s.score_prisoners,delete s.score_passes,delete s.white_must_pass_last,delete s.komi,s}parseSGF(s){const a=[],c=this;let d=0,g=1,k=!0,f=0,u,o;s.charCodeAt(0)>255&&(s=s.substr(1));function r(){const y=[];for(;d<s.length;)y.push(h()),k=!1;return y}function b(){for(;s[d]===" "||s[d]==="	"||s[d]===`
`||s[d]==="\r";)s[d]===`
`&&++g,++d}function h(){f++,f>1&&(k=!1);const y=[];if(b(),s[d]!=="(")throw new Error("Expecting '(' to start a GameTree");++d;const N=F();for(y.push(N),b();s[d]==="(";)x();function x(){let z;a.push(()=>{z=c.cur_move});const U=h();y.push(U),a.push(()=>{c.jumpTo(z)})}if(b(),s[d]!==")")throw new Error("Expecting ')' to end GameTree (found 0x"+s.charCodeAt(d)+")");return++d,b(),--f,y}function F(){b();const y=[];for(;s[d]===";";){const N=T();y.push(N)}if(y.length===0)throw new Error("Expecting Sequence");return y}function T(){const y=[];if(s[d]!==";")throw new Error("Expecting ';' to start a Node");for(++d,b();/[A-Za-z]/.test(s[d]);)y.push(P());return y}function P(){const y=[];let N="";for(;/[a-zA-Z]/.test(s[d]);)N+=s[d++];if(N==="")throw new Error("Expecting PropIdent");if(y.push(N),b(),s[d]!=="[")throw new Error("Expecting '[' to start a PropValue");for(;s[d]==="[";){++d;let x="";for(;s[d]!=="]";)s[d]===`
`&&g++,s[d]==="\\"&&++d,x+=s[d++];if(y.push(x),s[d]!=="]")throw new Error("Expecting ']' to close a PropValue");++d,b()}return w(N,y),y}function m(y){const N=parseInt(y);return/[kK]/.test(y)?30-N:/[d]/.test(y)?29+N:/[p]/.test(y)?1036+N:-100}function w(y,N){for(let z=1;z<N.length;++z)x(N[z]);function x(z){var U,D,B,j;switch(y){case"AB":case"AW":k?(c.config.initial_state||(c.config.initial_state={black:"",white:""}),y==="AB"?c.config.initial_state.black+=z:c.config.initial_state.white+=z,c.config.free_handicap_placement=!1,c.free_handicap_placement=!1):a.push(()=>{if(z!==""){const ee=c.decodeMoves(z)[0];c.editPlace(ee.x,ee.y,y==="AB"?1:2)}});break;case"W":case"B":o||(o=y==="B"?"black":"white",c.config.initial_player=o),k=!1,a.push(()=>{z===""&&(z="..");const ee=c.decodeMoves(z)[0];c.player===1&&y==="B"||c.player!==1&&y==="W"?c.place(ee.x,ee.y,!1,!1,!1,!0,!1):c.editPlace(ee.x,ee.y,y==="B"?1:2),c.cur_move&&(u==null||c.cur_move.move_number>u.move_number)&&(u=c.cur_move)});break;case"C":a.push(()=>{c.cur_move.text+=z});break;case"LB":case"TR":case"CR":case"SQ":case"XX":case"MA":a.push(()=>{try{const ee=z.substr(0,2),me=z.substr(3),Z=c.decodeMoves(ee)[0],se=c.cur_move.getMarks(Z.x,Z.y);switch(y){case"LB":se.letter=me;break;case"TR":se.triangle=!0;break;case"CR":se.circle=!0;break;case"SQ":se.square=!0;break;case"XX":case"MA":se.cross=!0;break}}catch(ee){console.error(ee)}});break;case"HA":a.push(()=>{c.handicap=parseInt(z),c.config.initial_player&&(c.player=c.config.initial_player==="black"?R.JGOFNumericPlayerColor.BLACK:R.JGOFNumericPlayerColor.WHITE)});break;case"RU":a.push(()=>{let ee="japanese";switch(z.toLowerCase()){case"japanese":case"jp":ee="japanese";break;case"chinese":case"cn":case"zh":ee="chinese";break;case"nz":ee="nz";break;case"aga":case"us":ee="aga";break;case"korean":case"ko":ee="korean";break;case"goe":case"ing":ee="ing";break;default:console.warn(`Unknown rule set ${z}, defaulting to Japanese`)}c.rules=ee});break;case"RE":a.push(()=>{if(z.length>0&&(z[0].toLowerCase()==="b"&&(c.winner="black"),z[0].toLowerCase()==="w"&&(c.winner="white")),c.outcome===""){let ee;const me=z.match(/[BW]\+(.*)/);if(me===null?ee=z:ee=me[1],me!==null&&/[0-9.]+/.test(ee))c.outcome=ee;else switch(ee||(ee="V"),ee[0].toUpperCase()){case"0":case"D":c.outcome="0";break;case"R":c.outcome="Resignation";break;case"T":c.outcome="Timeout";break;case"F":c.outcome="Disqualification";break;case"V":case"?":c.outcome="";break;default:c.outcome="",console.warn(`Unknown result: ${ee}`)}}});break;case"DT":c.config.game_date=z;break;case"GN":c.config.game_name=z;break;case"PW":!((U=c.config.players)===null||U===void 0)&&U.white&&(c.config.players.white.username=z);break;case"PB":!((D=c.config.players)===null||D===void 0)&&D.black&&(c.config.players.black.username=z);break;case"WR":!((B=c.config.players)===null||B===void 0)&&B.white&&(c.config.players.white.rank=m(z));break;case"BR":!((j=c.config.players)===null||j===void 0)&&j.black&&(c.config.players.black.rank=m(z));break;case"TB":a.push(()=>{c.territory_included_in_sgf=!0;const ee=c.decodeMoves(z)[0];c.board[ee.y][ee.x]===R.JGOFNumericPlayerColor.WHITE&&c.setRemoved(ee.x,ee.y,!0)});break;case"TW":a.push(()=>{c.territory_included_in_sgf=!0;const ee=c.decodeMoves(z)[0];c.board[ee.y][ee.x]===R.JGOFNumericPlayerColor.BLACK&&c.setRemoved(ee.x,ee.y,!0)});break}}}try{r()}catch(y){console.log("Failed to parse SGF on line "+g+" at char '"+s[d]+"' (right after '"+s.substr(d-10,10)+"')"),console.log(y.stack)}return()=>{c.config.players=c.config.players||{white:{id:0,username:"White",rank:0},black:{id:0,username:"Black",rank:0}},a.map(y=>y()),this.move_tree.hoistFirstBranchToTrunk(),u&&c.jumpTo(u)}}estimateScore(s,a,c=!1,d=!1){return new E.ScoreEstimator(this,this.goban_callback,s,a,c,d).score()}getMoveByLocation(s,a,c){let d=null,g=this.cur_move;if(c)for(;!d&&g;)g.x===s&&g.y===a&&(d=g),g=g.next();for(g=this.cur_move.parent;!d&&g;)g.x===s&&g.y===a&&(d=g),g=g.parent;return d}exportAsPuzzle(){return{mode:"puzzle",name:this.name,puzzle_type:this.puzzle_type,width:this.width,height:this.height,initial_state:this.initial_state,puzzle_opponent_move_mode:this.puzzle_opponent_move_mode,puzzle_player_move_mode:this.puzzle_player_move_mode,puzzle_rank:this.puzzle_rank,puzzle_description:this.puzzle_description,puzzle_collection:this.puzzle_collection,initial_player:this.config.initial_player,move_tree:this.move_tree.toJson()}}getBlackPrisoners(){return this.black_prisoners}getWhitePrisoners(){return this.white_prisoners}getHandicapPointAdjustmentForWhite(){let s=0;return this.score_handicap&&(this.aga_handicap_scoring&&this.handicap>0?s=this.handicap-1:s=this.handicap),s}emit(s,...a){let c=super.emit(s,...a);return this.parentEventEmitter&&(c=this.parentEventEmitter.emit(s,...a)||c),c}setRemoved(s,a,c,d=!0){this.cur_move.state.setRemoved(s,a,c,!1),super.setRemoved(s,a,c,d)}}A.GobanEngine=p},"./src/engine/GobanError.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanMoveError=A.GobanError=void 0;class G extends Error{constructor(L){super(L),Object.setPrototypeOf(this,new.target.prototype)}}A.GobanError=G;class q extends G{constructor(L,C,E,R){super(`Move error in ${L} on move number ${C} at ${E}: ${R}`),this.game_id=L,this.move_number=C,this.coords=E,this.message_id=R}}A.GobanMoveError=q},"./src/engine/GobanSocket.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.GobanSocket=void 0,A.closeErrorCodeToString=R;const q=G("./node_modules/eventemitter3/index.js"),S=G("./src/engine/util/index.ts"),L=[[50,50],[100,300],[250,750]],C=1e4;class E extends q.EventEmitter{constructor(p,v={}){super(),this.clock_drift=0,this.latency=0,this.last_request_id=0,this.promises_in_flight=new Map,this.reconnecting=!1,this.reconnect_tries=0,this.send_queue=[],this.callbacks=new Map,this.manually_disconnected=!1,this.signalTimeout=()=>{this.emit("timeout")},this.ping=()=>{this.options.dont_ping||(this.connected?(this.send("net/ping",{client:Date.now(),drift:this.clock_drift,latency:this.latency}),this.options.timeout_delay&&(this.timeout_timer=setTimeout(this.signalTimeout,this.options.timeout_delay)),this.options.ping_interval&&this.options.ping_interval!==this.current_ping_interval&&(this.ping_timer&&clearInterval(this.ping_timer),this.ping_timer=(0,S.niceInterval)(this.ping,this.options.ping_interval||C),this.current_ping_interval=this.options.ping_interval)):this.ping_timer&&(clearInterval(this.ping_timer),this.ping_timer=void 0))},this.options=v,p=p.replace(/^http/,"ws"),this.url=p,this.current_ping_interval=v.ping_interval||C,this.socket=this.connect(),this.on("net/pong",({client:s,server:a})=>{const c=Date.now(),d=c-s,g=c-d/2-a;this.latency=d,this.clock_drift=g,this.emit("latency",d,g),this.timeout_timer&&clearTimeout(this.timeout_timer)})}get connected(){return this.socket.readyState===WebSocket.OPEN}authenticate(p){this.authentication=p,this.send("authenticate",p)}sendAuthentication(){this.authentication&&this.send("authenticate",this.authentication)}startPing(){this.ping_timer&&clearInterval(this.ping_timer),this.timeout_timer&&clearTimeout(this.timeout_timer),this.ping_timer=(0,S.niceInterval)(this.ping,this.options.ping_interval||C),this.ping()}connect(){const p=new WebSocket(this.url);return p.addEventListener("open",v=>{this.options.quiet||console.log("GobanSocket connected to "+this.url),this.reconnecting=!1,this.reconnect_tries=0,this.connected||console.error("GobanSocket connected but readyState !== OPEN");try{this.emit("connect")}catch(s){console.error("GobanSocket connect event handler error",s)}if(this.promises_in_flight.size>0)throw new Error("GobanSocket connected with promises in flight");this.sendAuthentication(),this.startPing();for(const s of this.send_queue)s();this.send_queue=[]}),p.addEventListener("error",v=>{this.manually_disconnected||console.error(`GobanSocket error ${(v==null?void 0:v.message)||v}`)}),p.addEventListener("close",v=>{const s=v==null?void 0:v.code;s!==1e3&&!this.manually_disconnected&&console.warn(`GobanSocket closed with code ${s}: ${R(s)}`),this.rejectPromisesInFlight();try{this.emit("disconnect",s)}catch(a){console.error("Error in disconnect handler",a)}if(!this.manually_disconnected){if(s===1014||s===1015){console.error("OGS Socket closed with an unrecoverable error, not reconnecting"),this.emit("unrecoverable_error",s,s===1014?"bad_gateway":s===1015?"tls_handshake":"unknown",R(s));return}this.reconnecting=!1,this.reconnect()}}),p.addEventListener("message",v=>{let s;try{s=JSON.parse(v.data)}catch(g){throw console.error("Error parsing message",{event:v,data:v==null?void 0:v.data,exception:g}),g}const[a,c,d]=s;if(typeof a=="number"){const g=this.callbacks.get(a);g&&(this.callbacks.delete(a),g(c,d))}else this.emit(a,c)}),p}reconnect(){if(this.manually_disconnected||this.reconnecting)return;this.reconnecting=!0;const p=L[Math.min(this.reconnect_tries,L.length-1)];++this.reconnect_tries;const v=Math.floor(Math.random()*(p[1]-p[0])+p[0]);this.options.quiet||console.info(`GobanSocket reconnecting in ${v}ms`),setTimeout(()=>{this.socket=this.connect()},v)}rejectPromisesInFlight(){for(const[,{reject:p}]of this.promises_in_flight)try{p(`Socket closed with code ${this.socket.readyState}`)}catch(v){console.error("Error in reject handler",v)}this.promises_in_flight.clear()}send(p,v,s){const a=s?[p,v,++this.last_request_id]:v?[p,v]:[p];s&&this.callbacks.set(this.last_request_id,s);const c=JSON.stringify(a);if(this.connected)try{this.socket.send(c)}catch{this.send_queue.push(()=>{this.socket.send(c)})}else this.send_queue.push(()=>{this.socket.send(c)})}sendPromise(p,v){return new Promise((s,a)=>{this.send(p,v,(c,d)=>{d?a(d):s(c)})})}disconnect(){this.manually_disconnected=!0,this.socket.close(),this.rejectPromisesInFlight();for(const p of this.callbacks)p[1](void 0,{code:"manually_disconnected",message:"Manually disconnected"})}}A.GobanSocket=E;function R(O){if(O>=0&&O<=999)return"Not used";switch(O){case 1e3:return"Normal Closure";case 1001:return"Going Away";case 1002:return"Protocol error";case 1003:return"Unsupported Data";case 1004:return"Reserved";case 1005:return"No Status Received";case 1006:return"Abnormal Closure";case 1007:return"Invalid frame payload data";case 1008:return"Policy Violation";case 1009:return"Message Too Big";case 1010:return"Mandatory Ext.";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1014:return"Bad Gateway";case 1015:return"TLS handshake"}return O>=1016&&O<=2999?"Unknown official error code: "+O:O>=3e3&&O<=3999?"Unknown library status code: "+O:O>=4e3&&O<=4999?"Unknown private error code: "+O:"Unknown error code: "+O}},"./src/engine/MoveTree.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.MoveTree=void 0;const q=G("./src/engine/util/index.ts"),S=G("./src/engine/formats/JGOF.ts"),L=G("./src/engine/util/index.ts");let C=0,E={};class R{constructor(p,v,s,a,c,d,g,k,f){this.label="[unset]",this.correct_answer=!1,this.wrong_answer=!1,this.pen_marks=[],this.active_path_number=0,this.layout_cx=0,this.layout_cy=0,this.layout_x=0,this.layout_y=0,this.stashed_marks=[],this.id=++C,this.x=s,this.y=a,this.pretty_coordinates=p.prettyCoordinates(s,a),this.layout_x=0,this.layout_y=0,this.engine=p,this.trunk=v,this.edited=c,this.player=d,this.parent=k,this.move_number=g,this.state=f,this.trunk_next=void 0,this.branches=[],this.active_path_number=0,this.line_color=-1,this.text=""}toJson(){const p={x:this.x,y:this.y};if(this.pen_marks&&this.pen_marks.length&&(p.pen_marks=this.pen_marks),this.hasMarks()&&(p.marks=[],this.foreachMarkedPosition((v,s)=>{var a;(a=p.marks)===null||a===void 0||a.push({x:v,y:s,marks:this.getMarks(v,s)})})),this.text&&(p.text=this.text),this.trunk_next&&(p.trunk_next=this.trunk_next.toJson()),this.branches.length){p.branches=[];for(let v=0;v<this.branches.length;++v)p.branches.push(this.branches[v].toJson())}return this.correct_answer&&(p.correct_answer=this.correct_answer),this.wrong_answer&&(p.wrong_answer=this.wrong_answer),p}loadJsonForThisNode(p){if(p.x!==this.x||p.y!==this.y)throw new Error("Node mismatch when unpacking json object in MoveTree.fromJson");if(this.correct_answer=!!p.correct_answer,this.wrong_answer=!!p.wrong_answer,this.text=p!=null&&p.text?p.text:"",p.marks)for(let v=0;v<p.marks.length;++v){const s=p.marks[v];for(const a in s.marks)this.getMarks(s.x,s.y)[a]=s.marks[a]}p.pen_marks&&(this.pen_marks=p.pen_marks)}recomputeIsobranches(){if(this.parent)throw new Error("MoveTree.recomputeIsobranches needs to be called from the root node");E={};const p=s=>{const a=s.state.isobranch_hash?s.state.isobranch_hash:s.state.isobranch_hash=s.state.board.map(c=>c.join("")).join("")+s.player;s.isobranch_hash=a,a in E||(E[a]=[]),E[a].push(s),s.trunk_next&&p(s.trunk_next);for(let c=0;c<s.branches.length;++c)p(s.branches[c])},v=s=>{if(s.isobranches=[],s.x!==-1){for(const a of E[s.isobranch_hash])if(s.id!==a.id){if(s.isAncestorOf(a)||a.isAncestorOf(s))continue;s.isobranches.push(a)}}s.trunk_next&&v(s.trunk_next);for(let a=0;a<s.branches.length;++a)v(s.branches[a])};p(this),v(this)}lookupMove(p,v,s,a){if(typeof s!="number")throw new Error(`Invalid player color: ${s}`);if(this.trunk_next&&this.trunk_next.x===p&&this.trunk_next.y===v&&this.trunk_next.edited===a&&(!a||this.trunk_next.player))return this.trunk_next;for(let c=0;c<this.branches.length;++c)if(this.branches[c].x===p&&this.branches[c].y===v&&(!a||this.branches[c].player===s)&&this.branches[c].edited===a)return this.branches[c];return null}move(p,v,s,a,c,d,g){if(typeof c>"u")throw new Error("Invalid player");if(typeof c!="number")throw new Error(`Invalid player color: ${c}`);let k=this.lookupMove(p,v,c,a);if(!k||!k.trunk&&s)k=new R(this.engine,s,p,v,a,c,d,this,g);else return k.state=g,k.move_number=d,k;if(this.engine.move_tree_layout_dirty=!0,s){if(!this.trunk)throw console.log("Attempted trunk move made on ",this),new Error("Attempted trunk move made on non-trunk");this.trunk_next?(k=this.trunk_next,k.edited=a,k.move_number=d,k.state=g,k.x=p,k.y=v,k.player=c):this.trunk_next=k;for(let f=0;f<this.branches.length;++f)if(this.branches[f].x===p&&this.branches[f].y===v&&this.branches[f].player===c){const u=this.branches[f].branches;for(let o=0;o<u.length;++o)u[o].parent=this.trunk_next,this.trunk_next.branches.push(u[o]);this.branches.splice(f,1);break}}else{let f=!1;for(let u=0;u<this.branches.length;++u)this.branches[u].x===p&&this.branches[u].y===v&&this.branches[u].player===c&&(f=!0,k=this.branches[u],k.edited=a,k.move_number=d,k.state=g);f||this.branches.push(k)}return k}traverse(p){p(this),this.trunk_next&&this.trunk_next.traverse(p);for(let v=0;v<this.branches.length;++v)this.branches[v].traverse(p)}fold(p,v){let s=v(p,this);this.trunk_next&&(s=this.trunk_next.fold(s,v));for(let a=0;a<this.branches.length;++a)s=this.branches[a].fold(s,v);return s}size(){return this.fold(0,(p,v)=>p+1)}next(p){if(this.trunk_next)return this.trunk_next;if(this.hint_next&&!p){for(let v=0;v<this.branches.length;++v)if(this.branches[v].id===this.hint_next.id)return this.hint_next}return this.branches.length?this.branches[0]:null}prev(){return this.parent&&(this.parent.hint_next=this),this.parent}index(p){let v=this;for(;v.prev()&&p<0;)v=v.prev(),++p;for(;v.next(!0)&&p>0;)v=v.next(!0),--p;return v}is(p){return!!(p&&this.id===p.id)}hasTheSameRootMoveAs(p){return this.x===p.x&&this.y===p.y&&this.player===p.player}findChildWhich(p){if(this.trunk_next&&p(this.trunk_next))return this.trunk_next;for(let v=0;v<this.branches.length;++v){const s=this.branches[v];if(p(s))return s}return null}containsOtherTreeAsSubset(p){return this.hasTheSameRootMoveAs(p)&&this.hasAllChildrenOf(p)}containsOtherTreeAsChild(p){const v=this.findChildWhich(s=>s.hasTheSameRootMoveAs(p));return v==null?!1:v.hasAllChildrenOf(p)}hasAllChildrenOf(p){if(p.trunk_next&&!this.containsOtherTreeAsChild(p.trunk_next))return!1;for(let v=0;v<p.branches.length;++v){const s=p.branches[v];if(!this.containsOtherTreeAsChild(s))return!1}return!0}remove(){if(!this.parent)throw new Error("Cannot remove MoveTree child without a parent");if(this.is(this.parent.trunk_next))this.parent.trunk_next=void 0;else for(let p=0;p<this.parent.branches.length;++p)if(this.parent.branches[p].is(this))return this.parent.branches.splice(p,1),this.parent;return this.parent}getRoot(){let p=this;for(;p.parent;)p=p.parent;return p}removeIfNoChildren(){this.trunk_next==null&&this.branches.length===0&&this.remove()}getChatLog(){return this.chat_log||(this.chat_log=[]),this.chat_log}getAllMarks(){return this.marks||(this.marks=this.clearMarks()),this.marks}setAllMarks(p){this.marks=p}clearMarks(){return this.marks=(0,q.makeObjectMatrix)(this.engine.width,this.engine.height),this.marks}stashMarks(){this.stashed_marks.push(this.getAllMarks()),this.clearMarks()}popStashedMarks(){this.stashed_marks.length>0&&(this.marks=this.stashed_marks.pop())}hasMarks(){if(!this.marks)return!1;for(let p=0;p<this.marks.length;++p)for(let v=0;v<this.marks[p].length;++v)for(const s in this.marks[p][v])return!!s||!0;return!1}foreachMarkedPosition(p){if(this.marks)for(let v=0;v<this.marks.length;++v)for(let s=0;s<this.marks[v].length;++s)for(const a in this.marks[v][s]){p(s,v);break}}isAncestorOf(p){if(!p)return!1;do{if(p.id===this.id)return!0;p=p.parent}while(p);return!1}passed(){return this.x===-1}debug(p){let v="";for(let s=0;s<p;++s)v+=" ";v+="+ "+this.id,console.log(v),this.trunk_next&&this.trunk_next.debug(p);for(let s=0;s<this.branches.length;++s)this.branches[s].debug(p+2);return v}toSGF(){const p=[];try{const v=[];if(this.parent!=null&&(p.push(";"),this.edited&&p.push("A"),p.push(this.player===1?"B":this.player===2?"W":"E"),p.push("["),this.x===-1?p.push(""):(p.push((0,q.encodeCoordinate)(this.x)),p.push((0,q.encodeCoordinate)(this.y))),p.push("]"),v.push(this.text)),this.chat_log&&this.chat_log.length){v.push(`

`),v.push("-- chat --"),v.push(`
`);for(let g=0;g<this.chat_log.length;++g)v.push(R.fmtUsername(this.chat_log[g].username)),v.push(R.markupSGFChatMessage(this.chat_log[g].body,this.engine.width,this.engine.height)),v.push(`
`)}if(this.marks)for(let g=0;g<this.marks.length;++g)for(let k=0;k<this.marks[0].length;++k){const f=this.marks[g][k],u=(0,q.encodeCoordinate)(k)+(0,q.encodeCoordinate)(g);if(f.triangle&&p.push("TR["+u+"]"),f.square&&p.push("SQ["+u+"]"),f.cross&&p.push("MA["+u+"]"),f.circle&&p.push("CR["+u+"]"),f.letter){const o=(0,L.newlines_to_spaces)((0,L.escapeSGFText)(f.letter,!0));p.push("LB["+u+":"+o+"]")}}const s=v.join("");s!==""&&p.push("C["+(0,L.escapeSGFText)(s)+"]"),p.push(`
`);const a=(this.trunk_next!=null?1:0)+this.branches.length,c=a>1?"(":"",d=a>1?")":"";this.trunk_next&&(p.push(c),p.push(this.trunk_next.toSGF()),p.push(d));for(let g=0;g<this.branches.length;++g)p.push(c),p.push(this.branches[g].toSGF()),p.push(d)}catch(v){throw console.log(v),v}return p.join("")}get stoneColor(){switch(this.player){case S.JGOFNumericPlayerColor.BLACK:return"black";case S.JGOFNumericPlayerColor.WHITE:return"white";case S.JGOFNumericPlayerColor.EMPTY:return"empty"}throw new Error("Invalid stone color")}getBranchPoint(){let p=this;for(;!p.trunk&&p.parent;)p=p.parent;return p}getMoveIndex(){let p=0,v=this;for(;v.parent;)++p,v=v.parent;return p}getDistance(p){let v=0,s=this;for(;s.parent&&s.id!==p.id;)++v,s=s.parent;return v}getMoveNumberDifferenceFromTrunk(){return this.move_number-this.getBranchPoint().move_number}getMarks(p,v){return this.marks||(this.marks=this.clearMarks()),v<this.marks.length&&p<this.marks[v].length?this.marks[v][p]:(console.warn("getMarks called with invalid x,y = ",p,v," engine width/height = ",this.engine.width,this.engine.height),{})}setActivePath(p){this.active_path_number=p;let v=this.parent;for(;v;)v.active_path_number=p,v=v.parent;let s=this.next();for(;s;)s.active_path_number=p,s=s.next()}getMoveStringToThisPoint(){let p=[],v=this,s="";for(;v;)p.push(v),v=v.parent;p=p.reverse();for(let a=1;a<p.length;++a)s+=(0,q.encodeMove)(p[a]);return s}layout(p,v,s,a){this.engine.move_tree_layout_vector[p]||(this.engine.move_tree_layout_vector[p]=0),p===0&&v===0&&(R.current_line_color=0),v=Math.max(this.engine.move_tree_layout_vector[p]+1,v),this.trunk_next&&this.trunk_next.layout(p+1,0,s,(this.move_number+1)%R.line_colors.length),this.line_color===-1&&(this.line_color=a);let c=this.line_color+this.move_number;for(let d=0;d<this.branches.length;++d){c%=R.line_colors.length,d&&c===this.line_color&&(c+=2,c%=R.line_colors.length);const g=this.branches[d].layout(p+1,v,s,d===0?this.line_color:c++);d===0&&(v=Math.max(v,g-1)),c++}return this.trunk&&(v=0),this.layout_x=p,this.layout_y=v,s[p+","+v]=this,this.layout_cx=Math.floor((this.layout_x+.5)*R.stone_square_size)+.5,this.layout_cy=Math.floor((this.layout_y+.5)*R.stone_square_size)+.5,this.engine.move_tree_layout_vector[p]=Math.max(v,this.engine.move_tree_layout_vector[p]),p&&(this.engine.move_tree_layout_vector[p-1]=Math.max(v-1,this.engine.move_tree_layout_vector[p-1])),v}getNodeAtLayoutPosition(p,v){const s=p+","+v;return s in this.engine.move_tree_layout_hash?this.engine.move_tree_layout_hash[s]:null}findStrongIsobranches(){let p=this;for(;p.parent;)p=p.parent;p.recomputeIsobranches();const v=[];if(this.isobranches)for(let s=0;s<this.isobranches.length;++s)(this.isobranches[s].trunk_next||this.isobranches[s].branches.length)&&v.push(this.isobranches[s]);return v}nextSibling(){let p=null;for(let v=1;v<30&&p==null;++v)p=this.getNodeAtLayoutPosition(this.layout_x,this.layout_y+v);return p}prevSibling(){let p=null;for(let v=1;v<30&&p==null;++v)p=this.getNodeAtLayoutPosition(this.layout_x,this.layout_y-v);return p}getPositionInParent(){if(this.parent==null)return-5;if(this.parent.trunk_next&&this.id===this.parent.trunk_next.id)return-1;for(let p=0;p<this.parent.branches.length;++p)if(this.id===this.parent.branches[p].id)return p;return-5}isBranchWithCorrectAnswer(p){return p.correct_answer?!0:!p.branches||p.branches.length===0?!1:p.branches.some(v=>this.isBranchWithCorrectAnswer(v))}hoistFirstBranchToTrunk(){if(this.trunk_next){this.trunk_next.hoistFirstBranchToTrunk();return}if(this.trunk=!0,this.branches.length>0){const p=this.branches.shift();p&&(this.trunk_next=p,this.trunk_next.hoistFirstBranchToTrunk())}}findBranchesWithCorrectAnswer(){return this.branches.filter(p=>this.isBranchWithCorrectAnswer(p))}clearBranchesExceptFor(p){this.branches=this.branches.filter(v=>v.id===p.id)}static markupSGFChatMessage(p,v,s){try{if(typeof p=="object"&&p.type==="analysis"){const a=(0,q.decodeMoves)(p.moves,v,s);let c="";for(let d=0;d<a.length;++d)c+=(0,q.prettyCoordinates)(a[d].x,a[d].y,s)+" ";return p.name+". From move "+p.from+": "+c}}catch(a){console.log(a)}return`${p}`}static fmtUsername(p){return p?p+": ":""}static escapedSGFChat(p,v,s,a){const c=R.fmtUsername(p)+R.markupSGFChatMessage(v,s,a);return(0,L.escapeSGFText)(c)}static markupSGFChat(p,v,s,a){return"C["+R.escapedSGFChat(p,v,s,a)+`]
`}static markupSGFChatWithoutNode(p,v,s,a){return R.escapedSGFChat(p,v,s,a)+`
`}}A.MoveTree=R,R.stone_radius=11,R.stone_padding=3,R.stone_square_size=(R.stone_radius+R.stone_padding)*2,R.active_path_number=0,R.current_line_color=0,R.line_colors=["#ff0000","#00ff00","#0000ff","#00ffff","#ffff00","#FF9A00","#9200FF"],R.isobranch_colors={strong:"#C100FF",weak:"#A582A3"}},"./src/engine/ScoreEstimator.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.ScoreEstimator=void 0,A.set_local_ownership_estimator=v,A.adjust_estimate=a;const q=G("./src/engine/util/index.ts"),S=G("./src/engine/StoneStringBuilder.ts"),L=G("./src/engine/formats/JGOF.ts"),C=G("./src/engine/translate.ts"),E=G("./src/engine/ownership_estimators/index.ts"),R=G("./src/third_party/goscorer/goscorer.js"),O=G("./src/engine/BoardState.ts");let p=E.wasm_estimate_ownership;function v(g){p=g}class s extends O.BoardState{constructor(k,f,u,o,r=!1,b=!1,h){super(k,f),this.white={total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:0,komi:0},this.black={total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:0,komi:0},this.amount=NaN,this.winner="",this.autoscore=!1,h&&(this.removal=h),this.engine=k,this.color_to_move=k.colorToMove(),this.board=k.cloneBoard(),this.ownership=(0,q.makeMatrix)(this.width,this.height,0),this.territory=(0,q.makeMatrix)(this.width,this.height,0),this.estimated_hard_score=0,this.trials=u,this.tolerance=o,this.prefer_remote=r,this.autoscore=b,this.territory=(0,q.makeMatrix)(this.width,this.height,0),this.groups=new S.StoneStringBuilder(this),this.when_ready=this.estimateScore(this.trials,this.tolerance,b)}estimateScore(k,f,u){return!this.prefer_remote||this.height>19||this.width>19?this.estimateScoreLocal(k,f):E.remote_estimate_ownership?this.estimateScoreRemote(u):this.estimateScoreLocal(k,f)}estimateScoreRemote(k){const f=this.engine.komi,u=this.engine.score_prisoners?this.engine.getBlackPrisoners()-this.engine.getWhitePrisoners():0;return new Promise((o,r)=>{if(!E.remote_estimate_ownership)throw new Error("Remote scoring not setup");const b=[];for(let h=0;h<this.height;++h){const F=[];for(let T=0;T<this.width;++T)F.push(this.removal[h][T]?0:this.board[h][T]);b.push(F)}(0,E.remote_estimate_ownership)({player_to_move:this.engine.colorToMove(),width:this.engine.width,height:this.engine.height,rules:this.engine.rules,board_state:b,autoscore:k,jwt:""}).then(h=>{let F=0;for(let T=0;T<this.height;++T)for(let P=0;P<this.width;++P)F+=h.ownership[T][P]>0?1:-1;h.score||(h.score=0),h.score+=7.5-f,h.score+=u,h.score-=this.engine.getHandicapPointAdjustmentForWhite(),this.autoscored_removed=h.autoscored_removed,this.autoscored_state=h.autoscored_board_state,this.autoscored_needs_sealing=h.autoscored_needs_sealing,this.autoscored_state?this.updateEstimate(F,this.autoscored_state.map(T=>T.map(P=>P===2?-1:P)),h.score):(console.error("Remote scorer didn't have an autoscore board state, this should be unreachable"),this.updateEstimate(F,h.ownership,h.score)),o()}).catch(h=>{r(h)})})}estimateScoreLocal(k,f){k||(k=1e3),f||(f=.25);const u=(0,q.makeMatrix)(this.width,this.height,0);for(let h=0;h<this.height;++h)for(let F=0;F<this.width;++F)u[h][F]=this.board[h][F]===2?-1:this.board[h][F],this.removal[h][F]&&(u[h][F]=0);const o=p(u,this.engine.colorToMove(),k,f),r=d(o),b=a(this.engine,this.board,o,r);return this.updateEstimate(b.score,b.ownership),Promise.resolve()}updateEstimate(k,f,u){this.ownership=f,this.estimated_hard_score=k-this.engine.komi,typeof u>"u"?(this.winner=this.estimated_hard_score>0?(0,C._)("Black"):(0,C._)("White"),this.amount=Math.abs(this.estimated_hard_score)):(this.winner=u>0?(0,C._)("Black"):(0,C._)("White"),this.amount=Math.abs(u)),this.goban_callback&&this.goban_callback.updateScoreEstimation&&this.goban_callback.updateScoreEstimation()}getProbablyDead(){if(this.autoscored_removed)return console.info("Returning autoscored_removed for getProbablyDead"),this.autoscored_removed.map(q.encodeMove).join("");console.warn("Not able to use autoscored_removed for getProbablyDead");let k="";const f=[];for(let u=0;u<this.height;++u)for(let o=0;o<this.width;++o){const r=this.board[u][o],b=this.ownership[u][o]<-this.tolerance?2:this.ownership[u][o]>this.tolerance?1:0;(b===0||r!==0&&r!==b)&&f.push((0,q.encodeMove)(o,u))}f.sort();for(let u=0;u<f.length;++u)k+=f[u];return k}handleClick(k,f,u,o){this.toggleSingleGroupRemoval(k,f,u||o>500),this.estimateScore(this.trials,this.tolerance,this.autoscore).catch(()=>{})}setRemoved(k,f,u){this.clearAutoScore(),super.setRemoved(k,f,u)}clearRemoved(){this.clearAutoScore(),super.clearRemoved()}clearAutoScore(){(this.autoscored_removed||this.autoscored_state)&&(this.autoscored_removed=void 0,this.autoscored_state=void 0,console.warn("Clearing autoscored state"))}getStoneRemovalString(){if(this.autoscored_removed)return console.info("Returning autoscored_removed for getStoneRemovalString"),this.autoscored_removed.map(q.encodeMove).join("");console.warn("Not able to use autoscored_removed for getStoneRemovalString");let k="";const f=[];for(let u=0;u<this.height;++u)for(let o=0;o<this.width;++o)this.removal[u][o]&&f.push((0,q.encodeMove)(o,u));f.sort();for(let u=0;u<f.length;++u)k+=f[u];return k}getGroup(k,f){return this.groups.stone_strings[this.groups.stone_string_id_map[f][k]]}score(){this.white={total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:this.engine.handicap,komi:this.engine.komi},this.black={total:0,stones:0,territory:0,prisoners:0,scoring_positions:"",handicap:0,komi:0};let k=0,f=0;for(let u=0;u<this.height;++u)for(let o=0;o<this.width;++o)this.removal[u][o]&&(this.board[u][o]===1&&++k,this.board[u][o]===2&&++f,this.board[u][o]=0);if(this.engine.score_stones){const u=R.areaScoring(this.board,this.removal.map(o=>o.map(r=>!!r)));for(let o=0;o<this.height;++o)for(let r=0;r<this.width;++r)u[o][r]===R.BLACK?(this.board[o][r]===L.JGOFNumericPlayerColor.BLACK?this.black.stones+=1:this.black.territory+=1,this.black.scoring_positions+=(0,q.encodeMove)(r,o)):u[o][r]===R.WHITE&&(this.board[o][r]===L.JGOFNumericPlayerColor.WHITE?this.white.stones+=1:this.white.territory+=1,this.white.scoring_positions+=(0,q.encodeMove)(r,o))}else{const u=R.territoryScoring(this.board,this.removal.map(o=>o.map(r=>!!r)));for(let o=0;o<this.height;++o)for(let r=0;r<this.width;++r)u[o][r].isUnscorableFalseEye?(this.board[o][r]=0,this.territory[o][r]=0,this.ownership[o][r]=0):u[o][r].isTerritoryFor===R.BLACK?(this.black.territory+=1,this.black.scoring_positions+=(0,q.encodeMove)(r,o)):u[o][r].isTerritoryFor===R.WHITE&&(this.white.territory+=1,this.white.scoring_positions+=(0,q.encodeMove)(r,o))}return this.engine.score_prisoners&&(this.black.prisoners=f,this.white.prisoners=k),this.black.total=this.black.stones+this.black.territory+this.black.prisoners+this.black.komi,this.white.total=this.white.stones+this.white.territory+this.white.prisoners+this.white.komi,this.engine.score_stones&&(this.black.total+=this.black.handicap,this.white.total+=this.white.handicap),this}}A.ScoreEstimator=s;function a(g,k,f,u){let o=u-g.getHandicapPointAdjustmentForWhite();const{width:r,height:b}=c(k),h=(0,q.makeMatrix)(r,b,0),F=!g.score_stones&&g.score_prisoners;for(let T=0;T<k.length;++T)for(let P=0;P<k[T].length;++P)h[T][P]=f[T][P],F&&k[T][P]&&((k[T][P]===1&&f[T][P]===1||k[T][P]===2&&f[T][P]===-1)&&(h[T][P]=0),k[T][P]===1?o-=1:o+=1);return F&&(o+=g.getBlackPrisoners(),o-=g.getWhitePrisoners()),{score:o,ownership:h}}function c(g){return{width:g[0].length,height:g.length}}function d(g){const{width:k,height:f}=c(g);let u=0;for(let o=0;o<f;o++)for(let r=0;r<k;r++)u+=g[o][r];return u}},"./src/engine/StoneString.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.StoneString=void 0;const q=G("./src/engine/formats/JGOF.ts");class S{constructor(C,E){this.territory_color=0,this.is_territory=!1,this.intersections=[],this.neighbors=[],this.neighboring_space=[],this.neighboring_stone_strings=[],this.id=C,this.color=E,this.__added_neighbors={}}map(C){for(let E=0;E<this.intersections.length;++E)C(this.intersections[E])}foreachNeighboringString(C){for(let E=0;E<this.neighbors.length;++E)C(this.neighbors[E])}foreachNeighboringEmptyString(C){for(let E=0;E<this.neighboring_space.length;++E)C(this.neighboring_space[E])}foreachNeighboringStoneString(C){for(let E=0;E<this.neighboring_stone_strings.length;++E)C(this.neighboring_stone_strings[E])}size(){return this.intersections.length}_addStone(C,E){this.intersections.push({x:C,y:E})}_addNeighborGroup(C){C.id in this.__added_neighbors||(this.neighbors.push(C),this.__added_neighbors[C.id]=!0,C.color!==this.color&&(C.color===q.JGOFNumericPlayerColor.EMPTY?this.neighboring_space.push(C):this.neighboring_stone_strings.push(C)))}_computeIsTerritory(){if(this.is_territory=!1,this.territory_color=0,this.color)return;let C=0;for(let E=0;E<this.neighbors.length;++E)if(this.neighbors[E].color!==0){C=this.neighbors[E].color;break}this.foreachNeighboringString(E=>{E.color!==0&&C!==E.color&&(C=0)}),C&&(this.is_territory=!0,this.territory_color=C)}}A.StoneString=S},"./src/engine/StoneStringBuilder.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.StoneStringBuilder=void 0;const q=G("./src/engine/StoneString.ts"),S=G("./src/engine/util/index.ts");class L{constructor(E,R){const O=Array(1),p=(0,S.makeMatrix)(E.width,E.height,0);this.state=E,this.stone_string_id_map=p,this.stone_strings=O;const v=(a,c,d,g,k)=>{a>=0&&a<this.state.width&&c>=0&&c<this.state.height&&this.state.board[c][a]===d&&p[c][a]===0&&(!R||!g&&(R[c][a]!==0||!this.state.removal[c][a])||g&&R[c][a]===0&&this.state.removal[c][a])&&(p[c][a]=k,v(a-1,c,d,g,k),v(a+1,c,d,g,k),v(a,c-1,d,g,k),v(a,c+1,d,g,k))};let s=1;for(let a=0;a<this.state.height;++a)for(let c=0;c<this.state.width;++c)p[a][c]===0&&v(c,a,this.state.board[a][c],!!(R&&this.state.removal[a][c]&&R[a][c]===0),s++),p[a][c]in O||O.push(new q.StoneString(p[a][c],this.state.board[a][c])),O[p[a][c]]._addStone(c,a);this.foreachGroup(a=>{a.map(c=>{const d=c.x,g=c.y;d-1>=0&&p[g][d-1]!==a.id&&a._addNeighborGroup(O[p[g][d-1]]),d+1<this.state.width&&p[g][d+1]!==a.id&&a._addNeighborGroup(O[p[g][d+1]]),g-1>=0&&p[g-1][d]!==a.id&&a._addNeighborGroup(O[p[g-1][d]]),g+1<this.state.height&&p[g+1][d]!==a.id&&a._addNeighborGroup(O[p[g+1][d]])})}),this.foreachGroup(a=>{a._computeIsTerritory()})}foreachGroup(E){for(let R=1;R<this.stone_strings.length;++R)E(this.stone_strings[R])}getGroup(E,R){return this.stone_strings[this.stone_string_id_map[R][E]]}}A.StoneStringBuilder=L},"./src/engine/autoscore.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.autoscore=g;const q=G("./src/engine/StoneStringBuilder.ts"),S=G("./src/engine/formats/JGOF.ts"),L=G("./src/engine/util/index.ts"),C=G("./src/engine/GobanEngine.ts"),E=G("./src/engine/BoardState.ts"),R=.7,O=.3,p=-R,v=R,s=-O,a=O;function c(K){return K<=p}function d(K){return K>=v}function g(K,Y,Q,ae){const te=K.map(Le=>Le.slice()),ne=K[0].length,re=K.length,Ce=[],Me=(0,L.makeMatrix)(ne,re,!1),we=(0,L.makeMatrix)(ne,re,0),be=(0,L.makeMatrix)(ne,re,0),Be=(0,L.makeMatrix)(K[0].length,K.length,0),de=(0,L.makeMatrix)(K[0].length,K.length,0),fe=(0,L.makeMatrix)(ne,re,0),Ee=[],Se=(0,L.makeMatrix)(ne,re,0);for(let Le=0;Le<re;++Le)for(let Te=0;Te<ne;++Te)Se[Le][Te]=(Q[Le][Te]+ae[Le][Te])/2;se("Initial state"),u("Board",K),k("Black plays first estimates",Q),k("White plays first estimates",ae),k("Average estimates",Se);const xe=new q.StoneStringBuilder(new E.BoardState({board:K,removal:(0,L.makeMatrix)(ne,re,!1)}));h("Groups",xe),Ie(),Ke(),Ne(),ft(),st(),Yt(),ss(),ln(),se("Final state");const Ae=(0,L.makeMatrix)(ne,re,".");for(let Le=0;Le<re;++Le)for(let Te=0;Te<ne;++Te)fe[Le][Te]?Ae[Le][Te]="s":Ae[Le][Te]=Be[Le][Te]===1?"B":Be[Le][Te]===2?"W":".";return o("Final ownership",Ae),b("Sealed",fe,"s"),u("Final sealed ownership",de),[{result:Be,sealed_result:de,removed:Ce,needs_sealing:Ee},_e()];function Ue(Le,Te,ct){Me[Te][Le]||(Ce.push({x:Le,y:Te,removal_reason:ct}),K[Te][Le]=S.JGOFNumericPlayerColor.EMPTY,Me[Te][Le]=!0,J(`Removing ${(0,L.encodePrettyXCoordinate)(Le)}${re-Te}: ${ct}`))}function Ie(){se("Settling snapbacks");const Le=(0,L.makeMatrix)(ne,re,!1),Te=(0,L.makeMatrix)(ne,re,!1);new q.StoneStringBuilder(new E.BoardState({board:K,removal:Me}),te).foreachGroup(Ye=>{if(Ye.color===S.JGOFNumericPlayerColor.EMPTY)return;let ot=Ye.intersections.some(({x:He,y:Pe})=>d(Q[Pe][He]))&&Ye.intersections.some(({x:He,y:Pe})=>c(Q[Pe][He]));if(ot||(ot=Ye.intersections.some(({x:He,y:Pe})=>d(ae[Pe][He]))&&Ye.intersections.some(({x:He,y:Pe})=>c(ae[Pe][He]))),ot||(ot=Ye.intersections.some(({x:He,y:Pe})=>d(Se[Pe][He]))&&Ye.intersections.some(({x:He,y:Pe})=>c(Se[Pe][He]))),ot){const He=Ye.color;Ye.intersections.forEach(({x:Pe,y:$e})=>{we[$e][Pe]=1,be[$e][Pe]=He,Le[$e][Pe]=!0}),Ye.foreachNeighboringStoneString(Pe=>{const $e=Pe.color;Pe.intersections.forEach(({x:je,y:et})=>{we[et][je]=1,be[et][je]=$e,Te[et][je]=!0})})}}),b("Snapbacks",Le,"s"),b("Neighbors of snapbacks",Te,"n"),b("Settled",we)}function Ne(){se("Settling agreed upon territory");const Le=new q.StoneStringBuilder(new E.BoardState({board:K,removal:Me}),te);h("Initial",Le),Le.foreachGroup(Te=>{const ct=Te.territory_color;if(Te.is_territory&&ct){let Ye=0;Te.map(He=>{const Pe=He.x,$e=He.y;Ye+=Se[$e][Pe]});const ot=Ye/Te.intersections.length;(ct===S.JGOFNumericPlayerColor.BLACK&&ot>v||ct===S.JGOFNumericPlayerColor.WHITE&&ot<p)&&(Te.map(He=>{const Pe=He.x,$e=He.y;we[$e][Pe]=1,be[$e][Pe]=ct}),Te.neighbors.forEach(He=>{He.map(Pe=>{const $e=Pe.x,je=Pe.y;we[je][$e]=1,be[je][$e]=ct})}))}}),b("Settled",we),u("Settled ownership",be)}function Ke(){se("Marking settled stones");for(let Le=0;Le<re;++Le)for(let Te=0;Te<ne;++Te)K[Le][Te]===S.JGOFNumericPlayerColor.WHITE&&c(Q[Le][Te])&&c(ae[Le][Te])&&(we[Le][Te]=1,be[Le][Te]=S.JGOFNumericPlayerColor.WHITE),K[Le][Te]===S.JGOFNumericPlayerColor.BLACK&&d(Q[Le][Te])&&d(ae[Le][Te])&&(we[Le][Te]=1,be[Le][Te]=S.JGOFNumericPlayerColor.BLACK);b("Settled",we),u("Resulting board",K)}function ft(){se("Removing stones both estimates agree upon");for(let Le=0;Le<re;++Le)for(let Te=0;Te<ne;++Te)we[Le][Te]||(K[Le][Te]===S.JGOFNumericPlayerColor.WHITE&&d(Q[Le][Te])&&d(ae[Le][Te])?Ue(Te,Le,"both players agree this is captured by black"):K[Le][Te]===S.JGOFNumericPlayerColor.BLACK&&c(Q[Le][Te])&&c(ae[Le][Te])&&Ue(Te,Le,"both players agree this is captured by white"));b("Removed",Me,"x")}function st(){se("Settle groups with significant amounts of territory");const Le=new q.StoneStringBuilder(new E.BoardState({board:K,removal:Me}));h("Initial groups",Le);const Te=(0,L.makeMatrix)(ne,re,!1);Le.foreachGroup(ct=>{if(we[ct.intersections[0].y][ct.intersections[0].x])return;let Ye=0,ot=0;ct.foreachNeighboringEmptyString(He=>{He.is_territory&&(ot++,Ye+=He.intersections.length)}),(Ye>4||ot>1)&&ct.map(He=>{const Pe=He.x,$e=He.y;Te[$e][Pe]=!0,we[$e][Pe]=1,be[$e][Pe]=ct.color})}),b("Newly settled",Te,"s"),b("Settled",we,"s")}function Yt(){se("Clear unsettled stones from territory");const Le=Me.map(Ye=>Ye.slice()),Te=new q.StoneStringBuilder(new E.BoardState({board:we,removal:(0,L.makeMatrix)(ne,re,!1)}));h("Settlement intersection groups",Te),Te.foreachGroup(Ye=>{const ot=Ye.intersections[0];if(we[ot.y][ot.x])return;const He=[0,0,0],Pe=[0,0,0];let $e=0,je=0;const et=(0,L.makeMatrix)(ne,re,0);let wt=0;function Bt(Pt,lt){Pt<0||Pt>=ne||lt<0||lt>=re||et[lt][Pt]||we[lt][Pt]&&(He[be[lt][Pt]]++,et[lt][Pt]=1)}Ye.map(Pt=>{const lt=Pt.x,xt=Pt.y;Pe[K[xt][lt]]++,Bt(lt-1,xt),Bt(lt+1,xt),Bt(lt,xt-1),Bt(lt,xt+1),$e+=Se[xt][lt],wt+=1,je+=K[xt][lt]===S.JGOFNumericPlayerColor.BLACK?1:K[xt][lt]===S.JGOFNumericPlayerColor.WHITE?-1:0});const ui=je/wt;let Je;const Rt=8,di=1.5;if(Pe[0]<Rt){const{x:Pt,y:lt}=Ye.intersections[0];J(`${(0,L.encodePrettyXCoordinate)(Pt)}${re-lt} Not enough empty intersections to judge color ${Pe}`);return}const Ht=(0,L.encodePrettyXCoordinate)(Ye.intersections[0].x)+(re-Ye.intersections[0].y),si=[He[0]+Pe[0],He[1]+Pe[1],He[2]+Pe[2]];ui>.5?(J(`${Ht} Average color estimate is black (${ui})`),Je=S.JGOFNumericPlayerColor.BLACK):ui<-.5?(J(`${Ht} Average color estimate is white (${ui})`),Je=S.JGOFNumericPlayerColor.WHITE):si[S.JGOFNumericPlayerColor.BLACK]>si[S.JGOFNumericPlayerColor.WHITE]*di?(Je=S.JGOFNumericPlayerColor.BLACK,J(`${Ht} Average color estimate is black (${si[S.JGOFNumericPlayerColor.BLACK]} black stones vs ${si[S.JGOFNumericPlayerColor.WHITE]})`)):si[S.JGOFNumericPlayerColor.WHITE]>si[S.JGOFNumericPlayerColor.BLACK]*di?(J(`${Ht} Average color estimate is white (${si[S.JGOFNumericPlayerColor.WHITE]} white stones vs ${si[S.JGOFNumericPlayerColor.BLACK]})`),Je=S.JGOFNumericPlayerColor.WHITE):(Je=S.JGOFNumericPlayerColor.EMPTY,J(`${Ht} Average color estimate is empty`)),Je!==S.JGOFNumericPlayerColor.EMPTY&&Ye.map(Pt=>{const lt=Pt.x,xt=Pt.y;if(K[xt][lt]&&K[xt][lt]!==Je){const an=K[xt][lt]===S.JGOFNumericPlayerColor.BLACK?"black":"white",cn=Je===S.JGOFNumericPlayerColor.BLACK?"black":"white";Ue(lt,xt,`clearing unsettled ${an} stones within assumed ${cn} territory `),we[xt][lt]=1,be[xt][lt]=Je}})});const ct=Me.map((Ye,ot)=>Ye.map((He,Pe)=>He&&!Le[ot][Pe]?1:0));b("Removed",ct,"x")}function ss(){se("Sealing territory");{let Le=new q.StoneStringBuilder(new E.BoardState({board:K,removal:Me}),te);h("Initial groups",Le),Le.foreachGroup(Te=>{if(Te.color===S.JGOFNumericPlayerColor.EMPTY&&!Te.is_territory&&Te.intersections.length>3){let ct=0;Te.map(ot=>{const He=ot.x,Pe=ot.y;ct+=Se[Pe][He]});const Ye=ct/Te.intersections.length;if(Ye<=s||Ye>=a){const ot=Ye<=s?S.JGOFNumericPlayerColor.WHITE:S.JGOFNumericPlayerColor.BLACK;Te.map(He=>{var Pe,$e;const je=He.x,et=He.y,wt=Ye<=s?S.JGOFNumericPlayerColor.BLACK:S.JGOFNumericPlayerColor.WHITE;(((Pe=K[et+1])===null||Pe===void 0?void 0:Pe[je])===wt||(($e=K[et-1])===null||$e===void 0?void 0:$e[je])===wt||K[et][je+1]===wt||K[et][je-1]===wt)&&(we[et][je]=1,be[et][je]=S.JGOFNumericPlayerColor.EMPTY,fe[et][je]=1,Ee.push({x:je,y:et,color:ot}))})}}}),Le=new q.StoneStringBuilder(new E.BoardState({board:K,removal:Me}),te),b("Sealed positions",fe,"s"),h("After sealing",Le)}}function ln(){se("Score positions");let Le="",Te="";for(let Pe=0;Pe<te.length;++Pe)for(let $e=0;$e<te[Pe].length;++$e){const je=te[Pe][$e],et=(0,L.num2char)($e)+(0,L.num2char)(Pe);je===S.JGOFNumericPlayerColor.BLACK?Le+=et:je===2&&(Te+=et)}const ct=Le+Ee.filter(Pe=>Pe.color===S.JGOFNumericPlayerColor.BLACK).map(Pe=>(0,L.num2char)(Pe.x)+(0,L.num2char)(Pe.y)).join(""),Ye=Te+Ee.filter(Pe=>Pe.color===S.JGOFNumericPlayerColor.WHITE).map(Pe=>(0,L.num2char)(Pe.x)+(0,L.num2char)(Pe.y)).join(""),ot={black:Le,white:Te},He={black:ct,white:Ye};for(const Pe of[He,ot]){const $e=(0,L.makeMatrix)(ne,re,0),je=new C.GobanEngine({width:te[0].length,height:te.length,initial_state:Pe,rules:Y,removed:Ce}),et=je.board.map(Je=>Je.slice());Ce.map(Je=>et[Je.y][Je.x]=0);const wt=je.computeScore(),Bt=(0,L.makeMatrix)(ne,re,0);for(let Je=0;Je<wt.black.scoring_positions.length;Je+=2){const Rt=(0,L.char2num)(wt.black.scoring_positions[Je]),di=(0,L.char2num)(wt.black.scoring_positions[Je+1]);$e[di][Rt]=S.JGOFNumericPlayerColor.BLACK,Bt[di][Rt]=S.JGOFNumericPlayerColor.BLACK}for(let Je=0;Je<wt.white.scoring_positions.length;Je+=2){const Rt=(0,L.char2num)(wt.white.scoring_positions[Je]),di=(0,L.char2num)(wt.white.scoring_positions[Je+1]);$e[di][Rt]=S.JGOFNumericPlayerColor.WHITE,Bt[di][Rt]=S.JGOFNumericPlayerColor.WHITE}for(let Je=0;Je<et.length;++Je)for(let Rt=0;Rt<et[Je].length;++Rt)et[Je][Rt]!==S.JGOFNumericPlayerColor.EMPTY&&($e[Je][Rt]=et[Je][Rt]);const ui=new q.StoneStringBuilder(new E.BoardState({board:et,removal:Me}),je.board);if(Pe===ot){he("Unsealed");for(let Je=0;Je<$e.length;++Je)Be[Je]=$e[Je].slice()}else{he("Sealed");for(let Je=0;Je<$e.length;++Je)de[Je]=$e[Je].slice()}h("groups",ui),u(`Scoring positions (${Y})`,Bt),u("Board",et),u("Ownership",$e)}{let Pe=`
  "correct_ownership": [
`;for(let $e=0;$e<Be.length;++$e){Pe+='    "';for(let je=0;je<Be[$e].length;++je)fe[$e][je]?Pe+="s":Pe+=Be[$e][je]===1?"B":Be[$e][je]===2?"W":" ";$e!==Be.length-1?Pe+=`",
`:Pe+=`"
`}Pe+=`  ]
`,J(Pe)}}}function k(K,Y){H(K);let Q="   ";const ae="ABCDEFGHJKLMNOPQRST";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`;for(let te=0;te<Y.length;++te){Q+=` ${Y.length-te} `.substr(-3);for(let ne=0;ne<Y[te].length;++ne)Q+=f(Y[te][ne]);Q+=" "+` ${Y.length-te} `.substr(-3),Q+=`
`}Q+="   ";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`,Q+=`
`,le(Q),I()}function f(K){const Y=Math.round(Math.abs(K*10));let Q="";return Y>9?Q=K>0?"B":"W":Q=Y.toString(),Y<7?K>0?w(Q):z(Q):K>0?U(Q):x(Q)}function u(K,Y){H(K);let Q="   ";const ae="ABCDEFGHJKLMNOPQRST";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`;for(let te=0;te<Y.length;++te){Q+=` ${Y.length-te} `.substr(-3);for(let ne=0;ne<Y[te].length;++ne){let re="";Y[te][ne]===0?re=".":Y[te][ne]===1?re="B":Y[te][ne]===2?re="W":re="?",Q+=r(re)}Q+=" "+` ${Y.length-te} `.substr(-3),Q+=`
`}Q+="   ";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`,Q+=`
`,le(Q),I()}function o(K,Y){H(K);let Q="   ";const ae="ABCDEFGHJKLMNOPQRST";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`;for(let te=0;te<Y.length;++te){Q+=` ${Y.length-te} `.substr(-3);for(let ne=0;ne<Y[te].length;++ne)Q+=r(Y[te][ne]);Q+=" "+` ${Y.length-te} `.substr(-3),Q+=`
`}Q+="   ";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`,Q+=`
`,le(Q),I()}function r(K){return K==="B"||K==="S"?N(K):K==="W"?x(K):K==="?"||K==="x"?P(K):K==="e"||K==="s"?y(K):K==="."?w(K):K===" "||K==="_"?w("_"):m(K)}function b(K,Y,Q="S"){H(K);let ae="   ";const te="ABCDEFGHJKLMNOPQRST";for(let ne=0;ne<Y[0].length;++ne)ae+=`${te[ne]}`;ae+=`
`;for(let ne=0;ne<Y.length;++ne){ae+=` ${Y.length-ne} `.substr(-3);for(let re=0;re<Y[ne].length;++re)ae+=r(Y[ne][re]?Q:" ");ae+=" "+` ${Y.length-ne} `.substr(-3),ae+=`
`}ae+="   ";for(let ne=0;ne<Y[0].length;++ne)ae+=`${te[ne]}`;ae+=`
`,ae+=`
`,le(ae),I()}function h(K,Y){const Q=(0,L.makeMatrix)(Y.stone_string_id_map[0].length,Y.stone_string_id_map.length,""),ae="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let te=0;Y.foreachGroup(ne=>{let re=P;ne.color===S.JGOFNumericPlayerColor.EMPTY?ne.is_territory?ne.territory_color?re=ne.territory_color===S.JGOFNumericPlayerColor.BLACK?N:T:re=w:re=y:ne.color===S.JGOFNumericPlayerColor.BLACK?re=N:ne.color===S.JGOFNumericPlayerColor.WHITE?re=T:re=P;const Ce=ae[te%ae.length];ne.map(Me=>{Q[Me.y][Me.x]=re(Ce)}),te++}),F(K,Q)}function F(K,Y){H(K);let Q="   ";const ae="ABCDEFGHJKLMNOPQRST";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`;for(let te=0;te<Y.length;++te){Q+=` ${Y.length-te} `.substr(-3);for(let ne=0;ne<Y[te].length;++ne)Q+=Y[te][ne];Q+=" "+` ${Y.length-te} `.substr(-3),Q+=`
`}Q+="   ";for(let te=0;te<Y[0].length;++te)Q+=`${ae[te]}`;Q+=`
`,Q+=`
`,le(Q),I()}function T(K){return`\x1B[37m${K}\x1B[0m`}function P(K){return`\x1B[31m${K}\x1B[0m`}function m(K){return`\x1B[33m${K}\x1B[0m`}function w(K){return`\x1B[34m${K}\x1B[0m`}function y(K){return`\x1B[35m${K}\x1B[0m`}function N(K){return`\x1B[30m${K}\x1B[0m`}function x(K){return`\x1B[97m${K}\x1B[0m`}function z(K){return`\x1B[96m${K}\x1B[0m`}function U(K){return`\x1B[90m${K}\x1B[0m`}function D(K){let Y=0;for(let Q=0;Q<K.length;++Q)if(K[Q]==="\x1B")for(Y++;K[Q]!=="m";)++Q,++Y;return Y}let B="",j="",ee=[],me="",Z="";function se(K){W(),j=K;const Y=`####   ${j}   ####`,Q="#".repeat(Y.length);B+=`

${Q}
${Y}
${Q}

`}function he(K){W(),j=K;const Y=`====   ${j}   ====`;B+=`${Y}

`}function J(K){Z+="    "+K+`
`}function W(){var K,Y,Q,ae;if(I(),!j)return;j="";const te=5;for(;ee.length>0;){const ne=[],re=[];for(let Me=0;Me<ee.length&&Me<te;++Me){const we=ee[Me].split(`
`);for(let be=0;be<we.length;++be)re[be]||(re[be]=[]),re[be][Me]=we[be]}ee=ee.slice(te);for(let Me=0;Me<re.length;++Me){let we="";for(let be=0;be<re[Me].length;++be){const Be=D((K=re[Me][be])!==null&&K!==void 0?K:""),de=((Q=(Y=re[Me][be])===null||Y===void 0?void 0:Y.length)!==null&&Q!==void 0?Q:0)-Be;if(de<0)throw new Error("length_without_color_codes < 0");we+=((ae=re[Me][be])!==null&&ae!==void 0?ae:"")+" ".repeat(Math.max(0,30-de))+" "}B+=we+`
`}for(let Me=0;Me<ne.length;++Me)B+=ne[Me]+`
`}Z&&(B+=`

Log:
`+Z+`
`,Z="")}function H(K){I(),me=`${K}
`}function I(){me&&(ee.push(me),me="")}function le(K){me+=K}function _e(){W();const K=B;ee=[],B="";let Y="";return Y+=`Stone string coloring legend (not boolean maps):
`,Y+="  "+N("Black")+`
`,Y+="  "+T("White")+`
`,Y+="  "+w("Dame")+`
`,Y+="  "+y("Undecided territory")+`
`,Y+="  "+P("Error")+`
`,Y+K}},"./src/engine/formats/AdHocFormat.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},"./src/engine/formats/JGOF.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.JGOFNumericPlayerColor=void 0;var G;(function(q){q[q.EMPTY=0]="EMPTY",q[q.BLACK=1]="BLACK",q[q.WHITE=2]="WHITE"})(G||(A.JGOFNumericPlayerColor=G={}))},"./src/engine/formats/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(L,C,E,R){R===void 0&&(R=E);var O=Object.getOwnPropertyDescriptor(C,E);(!O||("get"in O?!C.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return C[E]}}),Object.defineProperty(L,R,O)}:function(L,C,E,R){R===void 0&&(R=E),L[R]=C[E]}),S=this&&this.__exportStar||function(L,C){for(var E in L)E!=="default"&&!Object.prototype.hasOwnProperty.call(C,E)&&q(C,L,E)};Object.defineProperty(A,"__esModule",{value:!0}),S(G("./src/engine/formats/AdHocFormat.ts"),A),S(G("./src/engine/formats/JGOF.ts"),A)},"./src/engine/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(L,C,E,R){R===void 0&&(R=E);var O=Object.getOwnPropertyDescriptor(C,E);(!O||("get"in O?!C.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return C[E]}}),Object.defineProperty(L,R,O)}:function(L,C,E,R){R===void 0&&(R=E),L[R]=C[E]}),S=this&&this.__exportStar||function(L,C){for(var E in L)E!=="default"&&!Object.prototype.hasOwnProperty.call(C,E)&&q(C,L,E)};Object.defineProperty(A,"__esModule",{value:!0}),A.translate=A.protocol=void 0,S(G("./src/engine/BoardState.ts"),A),S(G("./src/engine/GobanEngine.ts"),A),S(G("./src/engine/autoscore.ts"),A),S(G("./src/GobanBase.ts"),A),S(G("./src/engine/GobanError.ts"),A),S(G("./src/engine/GobanSocket.ts"),A),S(G("./src/engine/ConditionalMoveTree.ts"),A),S(G("./src/engine/MoveTree.ts"),A),S(G("./src/engine/ownership_estimators/index.ts"),A),S(G("./src/engine/ScoreEstimator.ts"),A),S(G("./src/engine/StoneString.ts"),A),S(G("./src/engine/StoneStringBuilder.ts"),A),S(G("./src/engine/formats/index.ts"),A),S(G("./src/engine/util/index.ts"),A),A.protocol=G("./src/engine/protocol/index.ts"),A.translate=G("./src/engine/translate.ts")},"./src/engine/messages.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.formatMessage=S;const q=G("./src/engine/translate.ts");function S(L,C){var E;switch(L){case"error":return(0,q._)("Error")+": "+(((E=C==null?void 0:C.error)===null||E===void 0?void 0:E.message)||"unknown");case"error_submitting_move":return(0,q._)("Error submitting move");case"loading":return(0,q._)("Loading...");case"processing":return(0,q._)("Processing...");case"illegal_self_capture":case"self_capture_not_allowed":return(0,q._)("Self-capture is not allowed");case"server_message":return(C==null?void 0:C.message)||"Missing server message";case"illegal_ko_move":case"illegal_board_repetition":return(0,q._)("The game would be repeating with that move, please play somewhere else first");case"synchronization_error":return(0,q._)("Synchronization error, reloading");default:console.error("Unhandled message id to format: ",L)}return L}},"./src/engine/ownership_estimators/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(L,C,E,R){R===void 0&&(R=E);var O=Object.getOwnPropertyDescriptor(C,E);(!O||("get"in O?!C.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return C[E]}}),Object.defineProperty(L,R,O)}:function(L,C,E,R){R===void 0&&(R=E),L[R]=C[E]}),S=this&&this.__exportStar||function(L,C){for(var E in L)E!=="default"&&!Object.prototype.hasOwnProperty.call(C,E)&&q(C,L,E)};Object.defineProperty(A,"__esModule",{value:!0}),S(G("./src/engine/ownership_estimators/remote_estimator.ts"),A),S(G("./src/engine/ownership_estimators/voronoi_estimator.ts"),A),S(G("./src/engine/ownership_estimators/wasm_estimator.ts"),A)},"./src/engine/ownership_estimators/remote_estimator.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.remote_estimate_ownership=void 0,A.init_remote_ownership_estimator=G;function G(q){A.remote_estimate_ownership=q}},"./src/engine/ownership_estimators/voronoi_estimator.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.voronoi_estimate_ownership=S;const q=G("./src/engine/util/index.ts");function S(O){const{width:p,height:v}=R(O),s=(0,q.cloneMatrix)(O);let a=C(O,c=>c!==0);for(;a.length;){const c=a.flatMap(d=>E(p,v,d)).filter(d=>s[d.y][d.x]===0);c.map(d=>({x:d.x,y:d.y,color:L(s,d)})).forEach(({x:d,y:g,color:k})=>{s[g][d]=k}),a=c.filter(({x:d,y:g})=>s[g][d]!==0)}return s}function L(O,p){const{width:v,height:s}=R(O),c=E(v,s,p).filter(d=>O[d.y][d.x]!==0);return c.every(d=>O[d.y][d.x]===1)?1:c.every(d=>O[d.y][d.x]===-1)?-1:0}function C(O,p){const{width:v,height:s}=R(O),a=[];for(let c=0;c<s;++c)for(let d=0;d<v;++d)p(O[c][d])&&a.push({x:d,y:c});return a}function E(O,p,{x:v,y:s}){const a=[];return v>0&&a.push({x:v-1,y:s}),v<O-1&&a.push({x:v+1,y:s}),s>0&&a.push({x:v,y:s-1}),s<p-1&&a.push({x:v,y:s+1}),a}function R(O){return{width:O[0].length,height:O.length}}},"./src/engine/ownership_estimators/wasm_estimator.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.init_wasm_ownership_estimator=E,A.wasm_estimate_ownership=R;const q=G("./src/engine/util/index.ts");let S=!1,L,C;function E(){if(S)return Promise.resolve(!0);if(C)return C;try{!L&&"OGSScoreEstimator"in window&&window.OGSScoreEstimator&&(L=window.OGSScoreEstimator)}catch(p){console.error(p)}if(L)return L=L(),S=!0,Promise.resolve(!0);const O=document.getElementById("ogs_score_estimator_script");if(O){let p,v;return C=new Promise((s,a)=>{p=s,v=a}),O.onload=()=>{try{L=OGSScoreEstimator,L=L(),S=!0}catch(s){v(s);return}p(!0)},C}else return Promise.reject("score estimator not available")}function R(O,p,v,s){const a=O[0].length,c=O.length,d=(0,q.makeMatrix)(a,c,0);if(!S)return console.warn("Score estimator not initialized yet, uptime = "+performance.now()),d;try{const g=4*a*c,k=L._malloc(g),f=new Int32Array(L.HEAP32.buffer,k,g);let u=0;for(let r=0;r<c;++r)for(let b=0;b<a;++b)f[u]=O[r][b],++u;L.cwrap("estimate","number",["number","number","number","number","number","number"])(a,c,k,p==="black"?1:-1,v,s),u=0;for(let r=0;r<c;++r)for(let b=0;b<a;++b)d[r][b]=f[u],++u;L._free(k)}catch(g){console.warn(g)}return d}},"./src/engine/protocol/AIServerToClient.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},"./src/engine/protocol/ClientToAIServer.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},"./src/engine/protocol/ClientToServer.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.RemoteStorageReplication=void 0;var G;(function(q){q[q.NONE=0]="NONE",q[q.LOCAL_OVERWRITES_REMOTE=1]="LOCAL_OVERWRITES_REMOTE",q[q.REMOTE_OVERWRITES_LOCAL=2]="REMOTE_OVERWRITES_LOCAL",q[q.REMOTE_ONLY=4]="REMOTE_ONLY"})(G||(A.RemoteStorageReplication=G={}))},"./src/engine/protocol/ServerToClient.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0})},"./src/engine/protocol/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(L,C,E,R){R===void 0&&(R=E);var O=Object.getOwnPropertyDescriptor(C,E);(!O||("get"in O?!C.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return C[E]}}),Object.defineProperty(L,R,O)}:function(L,C,E,R){R===void 0&&(R=E),L[R]=C[E]}),S=this&&this.__exportStar||function(L,C){for(var E in L)E!=="default"&&!Object.prototype.hasOwnProperty.call(C,E)&&q(C,L,E)};Object.defineProperty(A,"__esModule",{value:!0}),S(G("./src/engine/protocol/ClientToServer.ts"),A),S(G("./src/engine/protocol/ServerToClient.ts"),A),S(G("./src/engine/protocol/ClientToAIServer.ts"),A),S(G("./src/engine/protocol/AIServerToClient.ts"),A)},"./src/engine/translate.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.setGobanTranslations=L,A.interpolate=C,A._=E;let G={},q=!1;const S=q?R=>`[${R}]`:R=>R;function L(R,O=!1){G=R,q=O}function C(R,O){if(Array.isArray(O)){let p=0;return R.replace(/%[sd]/g,(v,s,a)=>{if(p>=O.length)throw new Error(`Missing array index ${p} for string: ${R}`);return O[p++]})}return typeof O=="object"?R.replace(/{{([^}]+)}}/g,(p,v,s)=>{if(!(v in O))throw new Error(`Missing interpolation key: ${v} for string: ${R}`);return O[v]}):R.replace(/%[sd]/g,(p,v,s)=>O)}function E(R){return R in G?G[R]:S(R)}},"./src/engine/util/ai_review_utils.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.getWorstMoves=L;const q=G("./src/engine/formats/JGOF.ts");function S(C,E,R=!1){const O=[];let p=C;const v=R?E.scores:E.win_rates,s=R?0:.5;if(v===void 0)return[];for(;p.trunk_next;){const a=p.trunk_next,c=v[p.move_number]||s,d=v[a.move_number]||s,g=a.player===q.JGOFNumericPlayerColor.WHITE?c-d:d-c;O.push({player:a.player,delta:g,move_number:a.move_number,move:{x:a.x,y:a.y}}),p=a}return O.sort((a,c)=>a.delta-c.delta),O}function L(C,E,R=3){let O,p;E.scores?(O=S(C,E,!0),p=-5):(O=S(C,E),p=-.2);const v=O.filter(s=>s.delta<=p);return v.length>=R?v.slice(0,R):O.slice(0,R)}},"./src/engine/util/color.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.color_blend=G;function G(L,C){const E=q(L),R=q(C),O=(p,v)=>Math.round((p+v)/2);return S(O(E.r,R.r),O(E.g,R.g),O(E.b,R.b))}function q(L){const C=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(L);if(!C)throw new Error("invalid hex color");return{r:parseInt(C[1],16),g:parseInt(C[2],16),b:parseInt(C[3],16)}}function S(L,C,E){return"#"+[L,C,E].map(R=>R.toString(16).padStart(2,"0")).join("")}},"./src/engine/util/computeAverageMoveTime.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.computeAverageMoveTime=G;function G(S,L,C){if(typeof S!="object"||S===null)return console.error(`computeAverageMoveTime passed ${S} instead of a time_control object`),S;const E=L&&C?q(L,C)/2:90;try{let R;switch(S.system){case"fischer":R=S.initial_time/E+S.time_increment;break;case"byoyomi":R=S.main_time/E+S.period_time;break;case"simple":R=S.per_move;break;case"canadian":R=S.main_time/E+S.period_time/S.stones_per_period;break;case"absolute":R=S.total_time/E;break;case"none":R=0;break}return Math.round(R)}catch(R){return console.error("Error computing average move time for time control: ",S),console.error(R),60}}function q(S,L){return Math.round(.7*S*L)}},"./src/engine/util/coordinates.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.decodeCoordinate=S,A.encodeCoordinate=L,A.decodePrettyXCoordinate=C,A.encodePrettyXCoordinate=E,A.prettyCoordinates=R,A.decodeGTPCoordinates=O,A.decodePrettyCoordinates=p;const G="abcdefghijklmnopqrstuvwxyz",q="ABCDEFGHJKLMNOPQRSTUVWXYZ";function S(v){return G.indexOf(v==null?void 0:v.toLowerCase())}function L(v){return G[v]}function C(v){return q.indexOf(v==null?void 0:v.toUpperCase())}function E(v){return q[v]}function R(v,s,a){return v>=0?E(v)+(""+(a-s)):"pass"}function O(v,s,a){if(v===".."||v.toLowerCase()==="pass")return{x:-1,y:-1};let c=a-parseInt(v.substr(1));const d=C(v[0]);return d===-1&&(c=-1),{x:d,y:c}}function p(v,s){return O(v,-1,s)}},"./src/engine/util/duration_strings.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.shortDurationString=S;const q=G("./src/engine/translate.ts");function S(L){const C=Math.floor(L/604800);L-=C*86400*7;const E=Math.floor(L/86400);L-=E*86400;const R=Math.floor(L/3600);L-=R*3600;const O=Math.floor(L/60);return L-=O*60,(C?" "+(0,q.interpolate)((0,q._)("%swk"),[C]):"")+(E?" "+(0,q.interpolate)((0,q._)("%sd"),[E]):"")+(R?" "+(0,q.interpolate)((0,q._)("%sh"),[R]):"")+(O?" "+(0,q.interpolate)((0,q._)("%sm"),[O]):"")+(L?" "+(0,q.interpolate)((0,q._)("%ss"),[L]):"")}},"./src/engine/util/getRandomInt.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.getRandomInt=G;function G(q,S){return Math.floor(Math.random()*(S-q))+q}},"./src/engine/util/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(L,C,E,R){R===void 0&&(R=E);var O=Object.getOwnPropertyDescriptor(C,E);(!O||("get"in O?!C.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return C[E]}}),Object.defineProperty(L,R,O)}:function(L,C,E,R){R===void 0&&(R=E),L[R]=C[E]}),S=this&&this.__exportStar||function(L,C){for(var E in L)E!=="default"&&!Object.prototype.hasOwnProperty.call(C,E)&&q(C,L,E)};Object.defineProperty(A,"__esModule",{value:!0}),S(G("./src/engine/util/matrix.ts"),A),S(G("./src/engine/util/color.ts"),A),S(G("./src/engine/util/coordinates.ts"),A),S(G("./src/engine/util/move_encoding.ts"),A),S(G("./src/engine/util/sgf_utils.ts"),A),S(G("./src/engine/util/niceInterval.ts"),A),S(G("./src/engine/util/computeAverageMoveTime.ts"),A),S(G("./src/engine/util/duration_strings.ts"),A),S(G("./src/engine/util/positionId.ts"),A),S(G("./src/engine/util/sortMoves.ts"),A),S(G("./src/engine/util/getRandomInt.ts"),A),S(G("./src/engine/util/object_utils.ts"),A),S(G("./src/engine/util/ai_review_utils.ts"),A)},"./src/engine/util/matrix.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.cloneMatrix=G,A.matricesAreEqual=q,A.makeMatrix=S,A.makeObjectMatrix=L,A.makeEmptyMatrix=C;function G(E){const R=new Array(E.length);for(let O=0;O<E.length;++O)R[O]=E[O].slice();return R}function q(E,R){if(E.length!==R.length)return!1;for(let O=0;O<E.length;++O){if(E[O].length!==R[O].length)return!1;for(let p=0;p<E[0].length;++p)if(E[O][p]!==R[O][p])return!1}return!0}function S(E,R,O){const p=[];for(let v=0;v<R;++v){p.push([]);for(let s=0;s<E;++s)p[v].push(O)}return p}function L(E,R){const O=new Array(R);for(let p=0;p<R;++p){const v=new Array(E);for(let s=0;s<E;++s)v[s]={};O[p]=v}return O}function C(E,R){const O=new Array(R);for(let p=0;p<R;++p)O[p]=new Array(E);return O}},"./src/engine/util/move_encoding.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.decodeMoves=S,A.char2num=L,A.num2char=E,A.encodeMove=R,A.encodeMoves=O,A.encodeMoveToArray=p,A.encodeMovesToArray=v,A.ojeSequenceToMoves=s;const q=G("./src/engine/util/coordinates.ts");function S(a,c,d){const g=[];if(!a)return[];function k(f){const u={x:f[0],y:f[1],timedelta:f.length>2?f[2]:-1,color:f.length>3?f[3]:0},o=f.length>4?f[4]:{};for(const r in o)u[r]=o[r];return u}if(a instanceof Array){if(a.length===0)return[];if(typeof a[0]=="number")g.push(k(a));else{if(typeof a[0]=="object"&&"x"in a[0]&&typeof a[0].x=="number")return a;for(let f=0;f<a.length;++f){const u=a[f];if(u instanceof Array&&typeof u[0]=="number")g.push(k(u));else throw new Error(`Unrecognized move format: ${u}`)}}}else if(typeof a=="string"){if(!d||!c)throw new Error("decodeMoves requires a height and width to be set when decoding a string coordinate");if(/[a-zA-Z][0-9]/.test(a)){const u=a.split(/([a-zA-Z][0-9]+|pass|[.][.])/);for(let o=0;o<u.length;++o)if(o%2){let r=C(u[o][0]),b=d-parseInt(u[o].substring(1));(c&&r>=c||r<0)&&(r=b=-1),(d&&b>=d||b<0)&&(r=b=-1),g.push({x:r,y:b,edited:!1,color:0})}else if(u[o]!=="")throw"Unparsed move input: "+u[o]}else{const f=a;for(let u=0;u<f.length-1;u+=2){let o=!1,r=0;f[u+0]==="!"&&(o=!0,f.substr(u,10)==="!undefined"?(r=0,u+=10):(r=parseInt(f[u+1]),u+=2));let b=L(f[u]),h=L(f[u+1]);c&&b>=c&&(b=h=-1),d&&h>=d&&(b=h=-1),g.push({x:b,y:h,edited:o,color:r})}}}else{if(typeof a=="object"&&"x"in a&&typeof a.x=="number")return[a];throw new Error("Invalid move format: "+JSON.stringify(a))}return g}function L(a){return a==="."?-1:(0,q.decodeCoordinate)(a)}function C(a){return a==="."?-1:(0,q.decodePrettyXCoordinate)(a)}function E(a){return a===-1?".":(0,q.encodeCoordinate)(a)}function R(a,c){if(typeof a=="number"){if(typeof c!="number")throw new Error(`Invalid y parameter to encodeMove y = ${c}`);return E(a)+E(c)}else{const d=a;return d.edited?"!"+d.color+E(d.x)+E(d.y):E(d.x)+E(d.y)}}function O(a){let c="";for(let d=0;d<a.length;++d)c+=R(a[d]);return c}function p(a){let c={};a.blur&&(c.blur=a.blur),a.sgf_downloaded_by&&(c.sgf_downloaded_by=a.sgf_downloaded_by),a.played_by&&(c.played_by=a.played_by),a.player_update&&(c.player_update=a.player_update),Object.keys(c).length===0&&(c=void 0);const d=[a.x,a.y,a.timedelta?a.timedelta:-1,void 0,c];return a.edited?(d[3]=a.color,c||d.pop()):c||(d.pop(),d.pop()),d}function v(a){const c=[];for(let d=0;d<a.length;++d)c.push(p(a[d]));return c}function s(a){const c=a.split(".");if(c.shift()!==""||c.shift()!=="root")throw new Error("Sequence passed to sequenceToMoves does not start with .root");return c.map(g=>g==="pass"?{x:-1,y:-1}:(0,q.decodeGTPCoordinates)(g,19,19))}},"./src/engine/util/niceInterval.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.niceInterval=G;function G(q,S){let L=performance.now();return setInterval(()=>{const C=performance.now();C-L>=S*.9&&(L=C,q())},S)}},"./src/engine/util/object_utils.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.deepClone=G,A.deepEqual=q;function G(S){let L;if(typeof S=="object")if(Array.isArray(S)){L=[];for(let C=0;C<S.length;++C)L.push(G(S[C]))}else{L={};for(const C in S)L[C]=G(S[C])}else return S;return L}function q(S,L){if(typeof S!=typeof L)return!1;if(typeof S=="object"){if(Array.isArray(S))if(Array.isArray(L)){if(S.length!==L.length)return!1;for(let C=0;C<S.length;++C)if(!q(S[C],L[C]))return!1}else return!1;else{for(const C in S)if(!(C in L)||!q(S[C],L[C]))return!1;for(const C in L)if(!(C in S))return!1}return!0}else return S===L}},"./src/engine/util/positionId.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.positionId=L;const q=G("./src/engine/formats/index.ts"),S=G("./src/engine/util/move_encoding.ts");function L(C,E,R){const O=[(v,s)=>({x:v,y:s}),(v,s)=>({x:v,y:E-s-1}),(v,s)=>({x:s,y:v}),(v,s)=>({x:s,y:R-v-1}),(v,s)=>({x:E-s-1,y:v}),(v,s)=>({x:E-s-1,y:R-v-1}),(v,s)=>({x:R-v-1,y:s}),(v,s)=>({x:R-v-1,y:E-s-1})],p=[];for(const v of O){let s="",a="";for(let c=0;c<R;c++)for(let d=0;d<E;d++){const g=v(c,d);C[c][d]===q.JGOFNumericPlayerColor.BLACK&&(s+=(0,S.encodeMove)(g.x,g.y)),C[c][d]===q.JGOFNumericPlayerColor.WHITE&&(a+=(0,S.encodeMove)(g.x,g.y))}p.push(`${s}.${a}`)}return p.reduce((v,s)=>s<v?s:v)}},"./src/engine/util/sgf_utils.ts":(ye,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.escapeSGFText=G,A.newlines_to_spaces=q;function G(S,L=!1){return S=S.replace(/\\/g,"\\\\"),S=S.replace(/]/g,"\\]"),S=S.replace(/[^\S\r\n]/g," "),L&&(S=S.replace(/:/g,"\\:")),S}function q(S){return S.replace(/[\r\n]/g," ")}},"./src/engine/util/sortMoves.ts":(ye,A,G)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.sortMoves=S;const q=G("./src/engine/util/move_encoding.ts");function S(C,E,R){if(C instanceof Array)return C.sort(L);{const O=(0,q.decodeMoves)(C,E,R);return O.sort(L),(0,q.encodeMoves)(O)}}function L(C,E){const R=(C.edited?1:0)*1e4+C.x+C.y*100,O=(E.edited?1:0)*1e4+E.x+E.y*100;return R-O}},"./src/index.ts":function(ye,A,G){var q=this&&this.__createBinding||(Object.create?function(v,s,a,c){c===void 0&&(c=a);var d=Object.getOwnPropertyDescriptor(s,a);(!d||("get"in d?!s.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return s[a]}}),Object.defineProperty(v,c,d)}:function(v,s,a,c){c===void 0&&(c=a),v[c]=s[a]}),S=this&&this.__exportStar||function(v,s){for(var a in v)a!=="default"&&!Object.prototype.hasOwnProperty.call(s,a)&&q(s,v,a)};Object.defineProperty(A,"__esModule",{value:!0}),A.preRenderImageStone=A.placeRenderedImageStone=A.protocol=void 0,A.setGobanRenderer=O,A.createGoban=p,S(G("./src/engine/index.ts"),A),S(G("./src/engine/protocol/index.ts"),A),S(G("./src/engine/formats/index.ts"),A),S(G("./src/GobanBase.ts"),A),S(G("./src/Goban/callbacks.ts"),A),S(G("./src/Goban/canvas_utils.ts"),A),S(G("./src/Goban/CanvasRenderer.ts"),A),S(G("./src/Goban/SVGRenderer.ts"),A),S(G("./src/Goban/themes/index.ts"),A),S(G("./src/Goban/themes/GobanTheme.ts"),A),S(G("./src/Goban/Goban.ts"),A),S(G("./src/Goban/InteractiveBase.ts"),A),S(G("./src/Goban/TestGoban.ts"),A),A.protocol=G("./src/engine/protocol/index.ts");var L=G("./src/Goban/themes/image_stones.ts");Object.defineProperty(A,"placeRenderedImageStone",{enumerable:!0,get:function(){return L.placeRenderedImageStone}}),Object.defineProperty(A,"preRenderImageStone",{enumerable:!0,get:function(){return L.preRenderImageStone}});const C=G("./src/Goban/CanvasRenderer.ts"),E=G("./src/Goban/SVGRenderer.ts");window.goban=ye.exports;let R="canvas";function O(v){R=v}function p(v,s){return R==="svg"?new E.SVGRenderer(v,s):new C.GobanCanvas(v,s)}},"./src/third_party/goscorer/goscorer.js":(ye,A,G)=>{G.r(A),G.d(A,{BLACK:()=>S,EMPTY:()=>q,LocScore:()=>C,WHITE:()=>L,areaScoring:()=>p,colorToStr:()=>o,finalAreaScore:()=>R,finalTerritoryScore:()=>E,getOpp:()=>v,isOnBoard:()=>c,isOnBorder:()=>d,print2d:()=>k,string2d:()=>f,string2d2:()=>u,territoryScoring:()=>O});const q=0,S=1,L=2;class C{constructor(){this.isTerritoryFor=q,this.belongsToSekiGroup=q,this.isFalseEye=!1,this.isUnscorableFalseEye=!1,this.isDame=!1,this.eyeValue=0}}function E(J,W,H,I,le,_e=!1){const K=O(J,W,_e),Y=J.length,Q=J[0].length;let ae=0,te=0;for(let ne=0;ne<Y;ne++)for(let re=0;re<Q;re++)K[ne][re].isTerritoryFor==S?ae+=1:K[ne][re].isTerritoryFor==L&&(te+=1),J[ne][re]==S&&W[ne][re]?te+=1:J[ne][re]==L&&W[ne][re]&&(ae+=1);return ae+=H,te+=I,te+=le,{black:ae,white:te}}function R(J,W,H){const I=p(J,W),le=J.length,_e=J[0].length;let K=0,Y=0;for(let Q=0;Q<le;Q++)for(let ae=0;ae<_e;ae++)I[Q][ae]==S?K+=1:I[Q][ae]==L&&(Y+=1);return Y+=H,{black:K,white:Y}}function O(J,W,H=!1){const I=J.length,le=J[0].length;if(J.forEach(Se=>{if(Se.length!==le)throw new Error(`Not all rows in stones are the same length ${le}`);Se.forEach(xe=>{if(xe!==q&&xe!==S&&xe!==L)throw new Error("Unexpected value in stones "+xe)})}),W.length!==I)throw new Error(`markedDead is not the same length as stones ${I}`);W.forEach(Se=>{if(Se.length!==le)throw new Error(`Not all rows in markedDead are the same length as stones ${le}`)});const _e=s(I,le,q);r(I,le,J,W,_e);const K=s(I,le,!1),Y=s(I,le,!1);b(I,le,J,W,null,K,Y);const Q=s(I,le,!1),ae=s(I,le,!1);b(I,le,J,W,_e,Q,ae);const te=s(I,le,-1),ne={};F(I,le,J,W,_e,Q,ae,te,ne);const re=s(I,le,-1),Ce={};P(I,le,J,W,te,re,Ce);const Me=s(I,le,-1),we={};w(I,le,J,W,_e,te,ne,re,Ce,Me,we);const be=s(I,le,-1),Be={};N(I,le,J,W,K,Y,te,ne,Me,we,be,Be);const de=s(I,le,!1);x(I,le,te,Me,we,Be,de),me(I,le,J,W,te,ne,re,Ce,de,be,Be);const fe=s(I,le,!1);x(I,le,te,Me,we,Be,fe);const Ee=a(I,le,()=>new C);return Z(I,le,J,W,H,K,Y,te,ne,re,Ce,de,be,Be,fe,Ee),Ee}function p(J,W){const H=J.length,I=J[0].length;if(J.forEach(Y=>{if(Y.length!==I)throw new Error(`Not all rows in stones are the same length ${I}`);Y.forEach(Q=>{if(Q!==q&&Q!==S&&Q!==L)throw new Error("Unexpected value in stones "+Q)})}),W.length!==H)throw new Error(`markedDead is not the same length as stones ${H}`);W.forEach(Y=>{if(Y.length!==I)throw new Error(`Not all rows in markedDead are the same length as stones ${I}`)});const le=s(H,I,!1),_e=s(H,I,!1);b(H,I,J,W,null,le,_e);const K=s(H,I,q);for(let Y=0;Y<H;Y++)for(let Q=0;Q<I;Q++)_e[Y][Q]&&!le[Y][Q]&&(K[Y][Q]=L),le[Y][Q]&&!_e[Y][Q]&&(K[Y][Q]=S);return K}function v(J){return 3-J}function s(J,W,H){return Array.from({length:J},()=>Array.from({length:W},()=>H))}function a(J,W,H){return Array.from({length:J},()=>Array.from({length:W},()=>H()))}function c(J,W,H,I){return J>=0&&W>=0&&J<H&&W<I}function d(J,W,H,I){return J===0||W===0||J===H-1||W===I-1}function g(J,W,H,I){return J===H&&(W===I+1||W===I-1)||W===I&&(J===H+1||J===H-1)}function k(J,W){console.log(f(J,W))}function f(J,W){const H=J.length,I=[];for(let le=0;le<H;le++){const _e=[];for(let K of J[le])_e.push(W(K));I.push(_e.join(""))}return I.join(`
`)}function u(J,W,H){const I=J.length,le=[];for(let _e=0;_e<I;_e++){const K=[];for(let Y=0;Y<J[_e].length;Y++){const Q=J[_e][Y],ae=W[_e][Y];K.push(H(Q,ae))}le.push(K.join(""))}return le.join(`
`)}function o(J){if(J===q)return".";if(J===S)return"x";if(J===L)return"o";throw new Error("Invalid color: "+J)}function r(J,W,H,I,le){const _e=[["pp","@e","pe"],["ep?","e@e","ep?"],["pee","e@p","pee"],["?e?","p@p","xxx"],["pp","@e","xx"],["ep?","e@e","xxx"]];for(const Y of[S,L]){const Q=v(Y);for(const[ae,te,ne,re]of[[1,0,0,1],[-1,0,0,1],[1,0,0,-1],[-1,0,0,-1],[0,1,1,0],[0,-1,1,0],[0,1,-1,0],[0,-1,-1,0]])for(const Ce of _e){let Me=Ce.length;const we=Ce[0].length,be=Ce[Me-1].includes("x");be&&Me--;let Be=Array.from({length:J},(fe,Ee)=>Ee),de=Array.from({length:W},(fe,Ee)=>Ee);be&&(ae===-1?Be=[Ce.length-2]:ae===1?Be=[J-(Ce.length-1)]:ne===-1?de=[Ce.length-2]:ne===1&&(de=[W-(Ce.length-1)]));for(let fe of Be)for(let Ee of de){let Se=function(Ne,Ke){return[fe+ae*Ne+ne*Ke,Ee+te*Ne+re*Ke]};var K=Se;let[xe,Ae]=Se(Me-1,we-1);if(!c(xe,Ae,J,W))continue;let Ue,Ie=!1;for(let Ne=0;Ne<Me;Ne++){for(let Ke=0;Ke<we;Ke++){const ft=Ce[Ne][Ke];if(ft!=="?")if([xe,Ae]=Se(Ne,Ke),ft==="p"){if(!(H[xe][Ae]===Y&&!I[xe][Ae])){Ie=!0;break}}else if(ft==="e"){if(!(H[xe][Ae]===q||H[xe][Ae]===Y&&!I[xe][Ae]||H[xe][Ae]===Q&&I[xe][Ae])){Ie=!0;break}}else if(ft==="@"){if(H[xe][Ae]!==q){Ie=!0;break}Ue=[xe,Ae]}else throw new Error("Invalid char: "+ft)}if(Ie)break}Ie||([xe,Ae]=Ue,le[xe][Ae]=Y)}}}}function b(J,W,H,I,le,_e,K){function Y(Q,ae,te,ne){c(Q,ae,J,W)&&(te[Q][ae]||H[Q][ae]===v(ne)&&!I[Q][ae]||(te[Q][ae]=!0,!(le&&le[Q][ae]===v(ne))&&(Y(Q-1,ae,te,ne),Y(Q+1,ae,te,ne),Y(Q,ae-1,te,ne),Y(Q,ae+1,te,ne))))}for(let Q=0;Q<J;Q++)for(let ae=0;ae<W;ae++)H[Q][ae]===S&&!I[Q][ae]&&Y(Q,ae,_e,S),H[Q][ae]===L&&!I[Q][ae]&&Y(Q,ae,K,L)}class h{constructor(W,H,I,le){this.regionId=W,this.color=H,this.regionAndDame=I,this.eyes=le}}function F(J,W,H,I,le,_e,K,Y,Q){function ae(ne,re,Ce,Me,we,be,Be){c(ne,re,J,W)&&(Be[ne][re]||Y[ne][re]===-1&&(H[ne][re]===Me&&!I[ne][re]||(Be[ne][re]=!0,Q[Ce].regionAndDame.add([ne,re]),we[ne][re]&&!be[ne][re]&&(Y[ne][re]=Ce),le[ne][re]!==Me&&(ae(ne-1,re,Ce,Me,we,be,Be),ae(ne+1,re,Ce,Me,we,be,Be),ae(ne,re-1,Ce,Me,we,be,Be),ae(ne,re+1,Ce,Me,we,be,Be)))))}let te=0;for(let ne=0;ne<J;ne++)for(let re=0;re<W;re++){if(_e[ne][re]&&!K[ne][re]&&Y[ne][re]===-1){const Ce=te++;Q[Ce]=new h(Ce,S,new he,new Set);const Me=s(J,W,!1);ae(ne,re,Ce,L,_e,K,Me)}if(K[ne][re]&&!_e[ne][re]&&Y[ne][re]===-1){const Ce=te++;Q[Ce]=new h(Ce,L,new he,new Set);const Me=s(J,W,!1);ae(ne,re,Ce,S,K,_e,Me)}}}class T{constructor(W,H,I,le,_e,K,Y,Q){this.chainId=W,this.regionId=H,this.color=I,this.points=le,this.neighbors=_e,this.adjacents=K,this.liberties=Y,this.isMarkedDead=Q}}function P(J,W,H,I,le,_e,K){function Y(ae,te,ne,re,Ce){if(c(ae,te,J,W)&&_e[ae][te]!==ne){if(_e[ae][te]!==-1){const Me=_e[ae][te];K[Me].neighbors.add(ne),K[ne].neighbors.add(Me),K[ne].adjacents.add([ae,te]),H[ae][te]==q&&K[ne].liberties.add([ae,te]);return}if(H[ae][te]!==re||I[ae][te]!==Ce){K[ne].adjacents.add([ae,te]),H[ae][te]==q&&K[ne].liberties.add([ae,te]);return}_e[ae][te]=ne,K[ne].points.push([ae,te]),K[ne].regionId!==le[ae][te]&&(K[ne].regionId=-1),se(re===q||le[ae][te]===K[ne].regionId),Y(ae-1,te,ne,re,Ce),Y(ae+1,te,ne,re,Ce),Y(ae,te-1,ne,re,Ce),Y(ae,te+1,ne,re,Ce)}}let Q=0;for(let ae=0;ae<J;ae++)for(let te=0;te<W;te++)if(_e[ae][te]===-1){const ne=Q++,re=H[ae][te],Ce=I[ae][te];K[ne]=new T(ne,le[ae][te],re,[],new Set,new he,new he,Ce),se(Ce||re===q||le[ae][te]!==-1),Y(ae,te,ne,re,Ce)}}class m{constructor(W,H,I,le,_e,K){this.macrochainId=W,this.regionId=H,this.color=I,this.points=le,this.chains=_e,this.eyeNeighborsFrom=K}}function w(J,W,H,I,le,_e,K,Y,Q,ae,te){let ne=0;for(const Ce of[S,L]){const Me=v(Ce),we=new Set,be=s(J,W,!1);for(let Be in Q){let Ae=function(Ne,Ke){if(!c(Ne,Ke,J,W)||be[Ne][Ke])return;be[Ne][Ke]=!0;const ft=Y[Ne][Ke];Q[ft];let st=!1;H[Ne][Ke]===Ce&&!I[Ne][Ke]?(ae[Ne][Ke]=Ee,Se.push([Ne,Ke]),xe.has(ft)||(xe.add(ft),we.add(ft)),st=!0):_e[Ne][Ke]===-1&&le[Ne][Ke]!==Me&&(st=!0),st&&(Ae(Ne-1,Ke),Ae(Ne+1,Ke),Ae(Ne,Ke-1),Ae(Ne,Ke+1))};var re=Ae;if(Be=Number(Be),we.has(Be))continue;const de=Q[Be];if(!(de.color===Ce&&!de.isMarkedDead))continue;const fe=de.regionId;se(fe!==-1);const Ee=ne++,Se=[],xe=new Set,[Ue,Ie]=de.points[0];Ae(Ue,Ie),te[Ee]=new m(Ee,fe,Ce,Se,xe,{})}}}class y{constructor(W,H,I,le,_e,K,Y,Q){this.pla=W,this.regionId=H,this.eyeId=I,this.potentialPoints=le,this.realPoints=_e,this.macrochainNeighborsFrom=K,this.isLoose=Y,this.eyeValue=Q}}function N(J,W,H,I,le,_e,K,Y,Q,ae,te,ne){let re=0;const Ce=s(J,W,!1);for(let we=0;we<J;we++)for(let be=0;be<W;be++){let Ue=function(Ie,Ne,Ke,ft){if(c(Ie,Ne,J,W)&&!Ce[Ie][Ne]&&K[Ie][Ne]===Be){if(Q[Ie][Ne]!==-1){const st=Q[Ie][Ne];Ae[st]||(Ae[st]=new he),Ae[st].add([Ke,ft]),ae[st].eyeNeighborsFrom[Se]||(ae[st].eyeNeighborsFrom[Se]=new he),ae[st].eyeNeighborsFrom[Se].add([Ie,Ne])}H[Ie][Ne]!==q&&!I[Ie][Ne]||(Ce[Ie][Ne]=!0,te[Ie][Ne]=Se,xe.add([Ie,Ne]),Ue(Ie-1,Ne,Ie,Ne),Ue(Ie+1,Ne,Ie,Ne),Ue(Ie,Ne-1,Ie,Ne),Ue(Ie,Ne+1,Ie,Ne))}};var Me=Ue;if(Ce[we][be]||te[we][be]!==-1||H[we][be]!==q&&!I[we][be])continue;const Be=K[we][be];if(Be===-1)continue;const fe=Y[Be].color,Ee=_e[we][be]&&le[we][be],Se=re++,xe=new he,Ae={};se(Q[we][be]===-1),Ue(we,be,1e4,1e4),ne[Se]=new y(fe,Be,Se,xe,new he,Ae,Ee,0),Y[Be].eyes.add(Se)}}function x(J,W,H,I,le,_e,K){for(let Q in _e){Q=Number(Q);const ae=_e[Q];for(let te in ae.macrochainNeighborsFrom){te=Number(te);const ne=ae.macrochainNeighborsFrom[te];for(let[re,Ce]of ne){let Ee=function(Se){if(be.has(Se))return!1;be.add(Se);const xe=le[Se];for(let Ae in xe.eyeNeighborsFrom)if(Ae=Number(Ae),!Be.has(Ae))if(Ae===Q){const Ue=_e[Ae];for(let[Ne,Ke]of xe.eyeNeighborsFrom[Ae])if(g(Ne,Ke,re,Ce)&&(we.add([Ne,Ke]),we.size>=fe))return!0;const Ie=z(Ue.potentialPoints,Ue.macrochainNeighborsFrom[Se],de);if(Ie.size===0)continue;if(Ie.forEach(Ne=>de.add(Ne)),Ue.eyeValue>0){for(let Ne of Ie)if(Ue.realPoints.has(Ne))return!0}for(let[Ne,Ke]of Ie)if(g(Ne,Ke,re,Ce)&&(we.add([Ne,Ke]),we.size>=fe))return!0;for(let Ne in Ue.macrochainNeighborsFrom)if([...Ue.macrochainNeighborsFrom[Ne]].some(Ke=>Ie.has(Ke))&&Ee(Number(Ne)))return!0}else{Be.add(Ae);const Ue=_e[Ae];if(Ue.eyeValue>0)return!0;for(let Ie of Object.keys(Ue.macrochainNeighborsFrom))if(Ee(Number(Ie)))return!0}return!1};var Y=Ee;let Me=0;for(let[Se,xe]of[[re-1,Ce],[re+1,Ce],[re,Ce-1],[re,Ce+1]])ae.potentialPoints.has([Se,xe])&&(Me+=1);if(Me>1)continue;const we=new he,be=new Set,Be=new Set,de=new he;de.add([re,Ce]);let fe=0;for(let[Se,xe]of[[re-1,Ce],[re+1,Ce],[re,Ce-1],[re,Ce+1]])c(Se,xe,J,W)&&H[Se][xe]===ae.regionId&&(fe+=1);Ee(te)||(K[re][Ce]=!0)}}}}function z(J,W,H){const I=new he;W=[...W];for(let le=0;le<W.length;le++){const _e=W[le];if(H.has(_e)||I.has(_e)||!J.has(_e))continue;I.add(_e);const[K,Y]=_e;W.push([K-1,Y]),W.push([K+1,Y]),W.push([K,Y-1]),W.push([K,Y+1])}return I}function U(J,W,H,I){const le=new he;function _e(Y,Q){if(le.has(Y)||I.has(Y))return;le.add(Y),Q.add(Y);const[ae,te]=Y,ne=[[ae-1,te],[ae+1,te],[ae,te-1],[ae,te+1]];for(let re of ne)H.has(re)&&_e(re,Q)}const K=[];for(let Y of H)if(!le.has(Y)){const Q=new he;_e(Y,Q),Q.size>0&&K.push(Q)}return K}function D(J,W,H,I,le,_e,K,Y){if(H[_e][K]!==q)return!1;const Q=[[_e-1,K],[_e+1,K],[_e,K-1],[_e,K+1]],ae=v(Y);for(let[te,ne]of Q)if(c(te,ne,J,W)&&(H[te][ne]!==ae||le[I[te][ne]].liberties.size<=1))return!0;return!1}function B(J,W,H){let I=0;const le=[[J-1,W],[J+1,W],[J,W-1],[J,W+1]];for(let _e of le)H.has(_e)&&(I+=1);return I}class j{constructor(W,H,I=0,le=0,_e=0,K=0,Y=!1,Q=0,ae=0){this.adjPoints=W,this.adjEyePoints=H,this.numEmptyAdjPoints=I,this.numEmptyAdjFalsePoints=le,this.numEmptyAdjEyePoints=_e,this.numOppAdjFalsePoints=K,this.isFalseEyePoke=Y,this.numMovesToBlock=Q,this.numBlockablesDependingOnThisSpot=ae}}function ee(J,W){let H=0;for(let I of J)W(I)&&H++;return H}function me(J,W,H,I,le,_e,K,Y,Q,ae,te){for(let ne in te){ne=Number(ne);const re=te[ne],Ce=re.pla,Me=v(Ce),we={};re.realPoints=new he;for(let[de,fe]of re.potentialPoints)if(!Q[de][fe]){re.realPoints.add([de,fe]);const Ee=new j([],[]);we[[de,fe]]=Ee}for(let[de,fe]of re.realPoints){const Ee=we[[de,fe]],Se=[[de-1,fe],[de+1,fe],[de,fe-1],[de,fe+1]];for(let[xe,Ae]of Se)c(xe,Ae,J,W)&&(Ee.adjPoints.push([xe,Ae]),re.realPoints.has([xe,Ae])&&Ee.adjEyePoints.push([xe,Ae]))}for(let[de,fe]of re.realPoints){const Ee=we[[de,fe]];for(let[Se,xe]of Ee.adjPoints)H[Se][xe]===q&&(Ee.numEmptyAdjPoints+=1),H[Se][xe]===q&&re.realPoints.has([Se,xe])&&(Ee.numEmptyAdjEyePoints+=1),H[Se][xe]===q&&Q[Se][xe]&&(Ee.numEmptyAdjFalsePoints+=1),H[Se][xe]===Me&&Q[Se][xe]&&(Ee.numOppAdjFalsePoints+=1);Ee.numOppAdjFalsePoints>0&&H[de][fe]===Me&&(Ee.isFalseEyePoke=!0),Ee.numEmptyAdjFalsePoints>=2&&H[de][fe]===Me&&(Ee.isFalseEyePoke=!0)}for(let[de,fe]of re.realPoints){const Ee=we[[de,fe]];Ee.numMovesToBlock=0,Ee.numMovesToBlockNoOpps=0;for(let[Se,xe]of Ee.adjPoints){let Ae=0;H[Se][xe]===q&&!re.realPoints.has([Se,xe])&&(Ae=1),H[Se][xe]===q&&[Se,xe]in we&&we[[Se,xe]].numOppAdjFalsePoints>=1&&(Ae=1),H[Se][xe]===Me&&[Se,xe]in we&&we[[Se,xe]].numEmptyAdjFalsePoints>=1&&(Ae=1),H[Se][xe]===Me&&Q[Se][xe]&&(Ae=1e3),H[Se][xe]===Me&&[Se,xe]in we&&we[[Se,xe]].isFalseEyePoke&&(Ae=1e3),Ee.numMovesToBlock+=Ae}}let be=0;ee(re.realPoints,([de,fe])=>we[[de,fe]].numMovesToBlock<=1)>=1&&(be=1);for(let[de,fe]of re.realPoints){if(!D(J,W,H,K,Y,de,fe,Ce))continue;const Ee=U(J,W,re.realPoints,new he([[de,fe]]));if(Ee.length<2)continue;let Se=we[[de,fe]].numOppAdjFalsePoints===1,xe=0;for(let Ae of Ee){let Ue=!1;for(let Ie of Ae){if(we[Ie].numMovesToBlock<=0){Ue=!0;break}if(Se&&we[Ie].numMovesToBlock<=1){Ue=!0;break}}Ue&&xe++}be=Math.max(be,xe)}let Be=ee(re.realPoints,([de,fe])=>H[de][fe]===Me&&I[de][fe]);if(Be>=5&&(be=Math.max(be,1)),Be>=8&&(be=Math.max(be,2)),be<2&&re.realPoints.size-ee(re.realPoints,([de,fe])=>we[[de,fe]].numMovesToBlock>=1)-ee(re.realPoints,([de,fe])=>we[[de,fe]].numMovesToBlock>=2)-ee(re.realPoints,([de,fe])=>H[de][fe]===Me&&we[[de,fe]].adjEyePoints.length>=2)>=6&&(be=Math.max(be,2)),be<2&&ee(re.realPoints,([de,fe])=>H[de][fe]===q&&we[[de,fe]].adjEyePoints.length>=4)+ee(re.realPoints,([de,fe])=>H[de][fe]===q&&we[[de,fe]].adjEyePoints.length>=3)>=6&&(be=Math.max(be,2)),be<2)for(let[de,fe]of re.realPoints){if(H[de][fe]!==q||d(de,fe,J,W)||!D(J,W,H,K,Y,de,fe,Ce))continue;const Ee=we[[de,fe]];if(!(Ee.numMovesToBlock>1||Ee.adjEyePoints.length<3)){for(let Se of Ee.adjEyePoints){const xe=we[Se];if(xe.adjEyePoints.length<3||xe.numMovesToBlock>1)continue;const[Ae,Ue]=Se;if(H[Ae][Ue]!==q&&xe.numEmptyAdjEyePoints<=1)continue;const Ie=U(J,W,re.realPoints,new he([[de,fe],Se]));if(Ie.length<2)continue;let Ne=0,Ke=0;for(let ft of Ie){let st=0;for(let Yt of ft)if(we[Yt].numMovesToBlock<=0&&(st+=1,st>=2))break;st>=1&&(Ne+=1),st>=2&&(Ke+=1)}if(Ne>=2&&Ke>=1&&(H[Ae][Ue]===q||Ke>=2)){be=Math.max(be,2);break}}if(be>=2)break}}if(be<2){const de=new he,fe=[];for(let Ee of re.realPoints){const[Se,xe]=Ee;H[Se][xe]===Me&&I[Se][xe]?de.add(Ee):D(J,W,H,K,Y,Se,xe,Ce)||fe.push(Ee)}if(de.size>0){let Ee=0;for(let[Ae,Ue]of re.potentialPoints)H[Ae][Ue]===Me&&Q[Ae][Ue]&&(Ee+=1);const Se=[...fe];Se.push(null);let xe=!0;for(let Ae of Se){const Ue=de.copy();for(let st of fe)st!==Ae&&Ue.add(st);const Ie=U(J,W,Ue,new he).length;let Ne=0,Ke=0;for(let st of Ue){const[Yt,ss]=st;U(J,W,Ue,new he([st])).length>Ie?Ne+=1:B(Yt,ss,Ue)>=3&&(Ke+=1)}let ft=0;if(Ue.size>=7&&(ft+=1),Ie-Ee+Math.floor((Ne+Ke+ft)/2)<2){xe=!1;break}}xe&&(be=2)}}be=Math.min(be,2),re.eyeValue=be}}function Z(J,W,H,I,le,_e,K,Y,Q,ae,te,ne,re,Ce,Me,we){const be=new he,Be=new he;for(let de=0;de<J;de++)for(let fe=0;fe<W;fe++)if(Me[de][fe]&&H[de][fe]!=q&&I[de][fe]){const Ee=[[de-1,fe],[de+1,fe],[de,fe-1],[de,fe+1]];if(H[de][fe]==L)for(const Se of Ee)be.add(Se);else for(const Se of Ee)Be.add(Se)}for(let de=0;de<J;de++)for(let fe=0;fe<W;fe++){const Ee=we[de][fe],Se=Y[de][fe];if(Se===-1)Ee.isDame=!0;else{const xe=Q[Se],Ae=xe.color;Array.from(xe.eyes).reduce((Ie,Ne)=>Ie+Ce[Ne].eyeValue,0)<=1&&(Ee.belongsToSekiGroup=xe.color),ne[de][fe]&&(Ee.isFalseEye=!0),Me[de][fe]&&(Ee.isUnscorableFalseEye=!0),(H[de][fe]==q||I[de][fe])&&(Ae==S&&be.has([de,fe])||Ae==L&&Be.has([de,fe]))&&(Ee.isUnscorableFalseEye=!0),Ee.eyeValue=re[de][fe]!==-1?Ce[re[de][fe]].eyeValue:0,(H[de][fe]!==Ae||I[de][fe])&&Ee.belongsToSekiGroup===q&&(le||!Ee.isUnscorableFalseEye)&&te[ae[de][fe]].regionId===Se&&!(Ae===L&&_e[de][fe])&&!(Ae===S&&K[de][fe])&&(Ee.isTerritoryFor=Ae)}}}function se(J,W){if(!J)throw new Error("Assertion failed")}class he{constructor(W=[]){if(this.map=new Map,this.size=0,W.length>0)for(let H of W)this.add(H)}add(W){const[H,I]=W;this.map.has(H)||this.map.set(H,new Set),this.map.get(H).has(I)||(this.map.get(H).add(I),this.size++)}has(W){const[H,I]=W;return this.map.has(H)&&this.map.get(H).has(I)}forEach(W){for(let[H,I]of this.map.entries())for(let le of I)W([H,le])}copy(){const W=new he;return W.map=new Map(this.map),W.size=this.size,W}[Symbol.iterator](){const W=[];for(let[H,I]of this.map.entries())for(let le of I)W.push([H,le]);return W[Symbol.iterator]()}}}},St={};function Qe(ye){var A=St[ye];if(A!==void 0)return A.exports;var G=St[ye]={exports:{}};return ue[ye].call(G.exports,G,G.exports,Qe),G.exports}Qe.d=(ye,A)=>{for(var G in A)Qe.o(A,G)&&!Qe.o(ye,G)&&Object.defineProperty(ye,G,{enumerable:!0,get:A[G]})},Qe.o=(ye,A)=>Object.prototype.hasOwnProperty.call(ye,A),Qe.r=ye=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(ye,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(ye,"__esModule",{value:!0})};var rt=Qe("./src/index.ts");return rt})())}(sl)),sl.exports}var Du=qu();function $u(){const We=nl.useRef(null);return nl.useEffect(()=>{const it=new Du.GobanCore(We.current,{boardSize:19});return()=>it.destroy()},[]),pr.jsx("div",{style:{width:"500px",height:"500px",margin:"20px auto"},children:pr.jsx("div",{ref:We,style:{width:"100%",height:"100%"}})})}Iu.createRoot(document.getElementById("root")).render(pr.jsx(nl.StrictMode,{children:pr.jsx($u,{})}));
